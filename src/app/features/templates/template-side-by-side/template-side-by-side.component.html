<div
  class="bg-base-100 border border-base-300 rounded-lg p-2 md:p-4 shadow-sm text-sm print:p-6"
  style="max-width: 210mm; margin: 0 auto"
>
  <!-- 頂部：LOGO + 標題 -->
  <div
    class="flex justify-between items-center mb-6 pb-4 border-b border-primary"
  >
    <div class="flex justify-between gap-3 w-full">
      <div>
        <div class="text-3xl font-bold text-primary">QUOTATION</div>
        <div class="text-lg text-base-content/70">報價單</div>
      </div>
      <!-- 日期資訊 -->
      <div class="gap-4 mt-4">
        @if (form().get('startDate')?.value) {
          <div class="flex pb-1">
            <span class="text-base-content/70">報價日期：</span>
            <span class="font-semibold">{{
              form().get('startDate')?.value
            }}</span>
          </div>
        }
        @if (form().get('endDate')?.value) {
          <div class="flex pb-1">
            <span class="text-base-content/70">有效期限：</span>
            <span class="font-semibold">{{
              form().get('endDate')?.value
            }}</span>
          </div>
        }
      </div>
    </div>
  </div>

  <!-- 賣方資訊（左）+ 客戶資訊（右）-->
  <div class="grid grid-cols-2 gap-8 mb-6">
    <!-- 賣方資訊 FROM -->
    <div>
      <div class="font-bold mb-2 tracking-wider">
        FORM {{ form().get('quoterName')?.value || '[公司名稱]' }}
      </div>
      <div class="bg-base-50 rounded space-y-1">
        <!-- <div class="font-bold text-base text-base-content">
          {{ form().get('quoterName')?.value || '[公司名稱]' }}
        </div> -->
        @if (form().get('quoterTaxID')?.value) {
          <div class="text-base-content/70">
            統編：{{ form().get('quoterTaxID')?.value }}
          </div>
        }
        @if (form().get('quoterAddress')?.value) {
          <div class="text-base-content/70">
            地址：{{ form().get('quoterAddress')?.value }}
          </div>
        }
        @if (form().get('quoterPhone')?.value) {
          <div class="text-base-content/70">
            電話：{{ form().get('quoterPhone')?.value }}
            @if (form().get('quoterPhoneExt')?.value) {
              #{{ form().get('quoterPhoneExt')?.value }}
            }
          </div>
        }
        @if (form().get('quoterEmail')?.value) {
          <div class="text-base-content/70">
            Email：{{ form().get('quoterEmail')?.value }}
          </div>
        }
      </div>
    </div>

    <!-- 客戶資訊 TO -->
    <div>
      <div class="font-bold mb-2 tracking-wider">
        TO {{ form().get('customerCompany')?.value || '[客戶名稱]' }}
      </div>
      <div class="bg-base-50 rounded space-y-1">
        <div class="flex items-center gap-2">
          <!-- @if (customerLogo()) {
            <img
              [src]="customerLogo()"
              class="h-8 object-contain"
              alt="Customer Logo"
            />
          } -->
          <!-- <div class="font-bold text-base text-base-content">
            {{ form().get('customerCompany')?.value || '[客戶名稱]' }}
          </div> -->
        </div>
        @if (form().get('customerContact')?.value) {
          <div class="text-base-content/70">
            聯絡人：{{ form().get('customerContact')?.value }}
          </div>
        }
        @if (form().get('customerTaxID')?.value) {
          <div class="text-base-content/70">
            統編：{{ form().get('customerTaxID')?.value }}
          </div>
        }
        @if (form().get('customerAddress')?.value) {
          <div class="text-base-content/70">
            地址：{{ form().get('customerAddress')?.value }}
          </div>
        }
        @if (form().get('customerPhone')?.value) {
          <div class="text-base-content/70">
            電話：{{ form().get('customerPhone')?.value }}
            @if (form().get('customerPhoneExt')?.value) {
              #{{ form().get('customerPhoneExt')?.value }}
            }
          </div>
        }
        @if (form().get('customerEmail')?.value) {
          <div class="text-base-content/70">
            Email：{{ form().get('customerEmail')?.value }}
          </div>
        }
      </div>
    </div>
  </div>

  <!-- 服務項目表格 -->
  <div class="mb-3">
    <table class="w-full border-collapse border border-base-300">
      <thead>
        <tr class="bg-base-300">
          <th
            class="py-1 px-2 text-left font-bold border-r border-base-300 w-1/2"
          >
            類別 / 項目
          </th>
          <th
            class="py-1 px-2 text-right font-bold border-r border-base-300 w-24"
          >
            單價
          </th>
          <th
            class="py-1 px-2 text-center font-bold border-r border-base-300 w-20"
          >
            數量
          </th>
          <th class="py-1 px-2 text-right font-bold w-28">金額</th>
        </tr>
      </thead>
      <tbody>
        @if (serviceItems().controls.length === 0) {
          <tr>
            <td
              colspan="6"
              class="p-6 text-center text-sm text-base-content/50 border-t border-base-300"
            >
              尚無服務項目
            </td>
          </tr>
        } @else {
          @for (
            item of serviceItems().controls;
            track item.value;
            let idx = $index
          ) {
            <tr class="border-t border-base-300">
              <td class="p-2 border-r border-base-300 flex items-center">
                @if (item.value.category) {
                  <div class="text-base-content/60">
                    {{ item.value.category }}
                  </div>
                }
                <div class="font-semibold ml-2">
                  {{ item.value.item || '-' }}
                </div>
              </td>
              <td class="p-2 text-right border-r border-base-300">
                ${{ item.value.price || 0 | number }}
              </td>
              <td class="p-2 border-r border-base-300">
                {{ item.value.count || 0 }}
                {{ !!item.value.unit ? '/' : '' }}
                {{ item.value.unit }}
              </td>

              <td class="p-2 text-right font-semibold">
                ${{ item.value.amount || 0 | number }}
              </td>
            </tr>
          }
        }
      </tbody>
    </table>
  </div>

  <!-- 金額計算區 -->
  <div class="flex mb-3">
    <div class="w-1/2">
      @if (stamp()) {
        <img
          [src]="stamp()"
          class="max-w-11/12 max-h-32 object-contain m-auto"
          alt="公司章"
        />
      }
    </div>
    <div class="w-1/2">
      <div
        class="flex justify-between items-center py-1.5 border-b border-base-300"
      >
        <span class="text-base text-base-content">小計：</span>
        <span class="font-semibold text-base-content text-sm">
          ${{ form().get('excludingTax')?.value || 0 | number }}
        </span>
      </div>

      <!-- 折扣 -->
      @if (form().get('discountValue')?.value > 0) {
        <div
          class="flex justify-between items-center py-1.5 border-b border-base-300"
        >
          <span class="text-base-content/70 text-sm">
            折扣
            @if (form().get('discountType')?.value === 'percentage') {
              ({{ form().get('discountValue')?.value }} 折)
            }
            ：
          </span>
          <span class="text-green-600 text-sm">
            -${{ form().get('discountAmount')?.value || 0 | number }}
          </span>
        </div>
      }

      @if (
        !!form().get('taxName')?.value || !!form().get('customTaxName')?.value
      ) {
        <div
          class="flex justify-between items-center py-1.5 border-b border-base-300"
        >
          <span class="text-sm text-base-content">
            @if (
              form().get('taxName')?.value === '自訂' &&
              form().get('customTaxName')?.value
            ) {
              {{ form().get('customTaxName')?.value }}
            } @else {
              {{ form().get('taxName')?.value || '稅額' }}
            }
            @if (form().get('percentage')?.value) {
              ({{ form().get('percentage')?.value }}%)
            }
            :
          </span>

          <span class="text-rose-500 text-sm">
            ${{ form().get('tax')?.value || 0 | number }}
          </span>
        </div>
      }
      <div
        class="flex justify-between items-center text-primary-content rounded py-1 mt-1"
      >
        <span class="font-bold text-xl">總計：</span>
        <span class="text-xl font-bold text-red-500">
          ${{ form().get('includingTax')?.value || 0 | number }}
        </span>
      </div>
    </div>
  </div>

  <!-- 備註說明 -->
  @if (form().get('desc')?.value) {
    <div class="mb-3 border-t border-base-300 pt-3">
      <h3 class="font-bold text-base-content mb-2">備註</h3>
      <div
        class="bg-base-50 border border-base-300 rounded p-2 text-base-content whitespace-pre-wrap leading-normal"
      >
        {{ form().get('desc')?.value }}
      </div>
    </div>
  }

  <!-- 簽章區 -->
  @if (form().get('isSign')?.value) {
    <div class="grid grid-cols-2 gap-3 pt-3 border-t border-base-300 mt-3">
      <!-- 報價人簽章 -->
      <div class="border border-base-300 rounded p-2">
        <div class="font-semibold text-base-content mb-2">報價人簽章：</div>
        <div class="flex flex-col">
          <div class="w-full">
            <div class="text-base-content/50 text-sm">簽章：______________</div>
            <div class="text-base-content/50 text-sm mt-1">
              日期：______________
            </div>
          </div>
        </div>
      </div>

      <!-- 客戶簽章確認 -->
      <div class="border border-base-300 rounded p-2">
        <div class="font-semibold text-base-content mb-2">客戶簽章確認：</div>
        <div class="flex flex-col">
          <div class="w-full">
            <div class="text-base-content/50 text-sm">簽章：______________</div>
            <div class="text-base-content/50 text-sm mt-1">
              日期：______________
            </div>
          </div>
        </div>
      </div>
    </div>
  }

  <!-- 頁尾資訊 -->
  <div
    class="mt-6 pt-4 border-t border-base-300 text-center text-xs text-base-content/50"
  >
    <p>
      本報價單由 {{ form().get('quoterName')?.value || '[公司名稱]' }} 提供
      @if (form().get('quoterAddress')?.value) {
        | 地址：{{ form().get('quoterAddress')?.value }}
      }
      @if (form().get('quoterPhone')?.value) {
        | 電話：{{ form().get('quoterPhone')?.value }}
        @if (form().get('quoterPhoneExt')?.value) {
          #{{ form().get('quoterPhoneExt')?.value }}
        }
      }
    </p>
  </div>
</div>
