import{Ca as Sr,Da as W,Hb as Pe,Ia as ki,Ja as re,La as me,Oa as Rn,P as Ni,Q as Re,Qa as Bh,R as Ke,Rb as Nt,S as Vi,Sa as qh,Sb as De,U as nn,Va as jh,W as Dt,Wa as Oi,Yb as Yo,_b as Gh,bc as Xo,da as Uh,g as Mh,ha as Fe,k as xh,ka as Ar,la as Qe,na as br,nb as rn,r as Fh,x as Lh,xb as Jo}from"./chunk-SGJ3NYEE.js";import{a as L,b as Z,d as Di,g as Pt,h as _}from"./chunk-FJYW2LMB.js";var ed=(()=>{class n{_renderer;_elementRef;onChange=t=>{};onTouched=()=>{};constructor(t,r){this._renderer=t,this._elementRef=r}setProperty(t,r){this._renderer.setProperty(this._elementRef.nativeElement,t,r)}registerOnTouched(t){this.onTouched=t}registerOnChange(t){this.onChange=t}setDisabledState(t){this.setProperty("disabled",t)}static \u0275fac=function(r){return new(r||n)(W(Sr),W(br))};static \u0275dir=re({type:n})}return n})(),kr=(()=>{class n extends ed{static \u0275fac=(()=>{let t;return function(i){return(t||(t=Qe(n)))(i||n)}})();static \u0275dir=re({type:n,features:[me]})}return n})(),on=new nn(""),s_={provide:on,useExisting:Re(()=>o_),multi:!0},o_=(()=>{class n extends kr{writeValue(t){this.setProperty("checked",t)}static \u0275fac=(()=>{let t;return function(i){return(t||(t=Qe(n)))(i||n)}})();static \u0275dir=re({type:n,selectors:[["input","type","checkbox","formControlName",""],["input","type","checkbox","formControl",""],["input","type","checkbox","ngModel",""]],hostBindings:function(r,i){r&1&&rn("change",function(a){return i.onChange(a.target.checked)})("blur",function(){return i.onTouched()})},standalone:!1,features:[Pe([s_]),me]})}return n})(),a_={provide:on,useExisting:Re(()=>td),multi:!0};function c_(){let n=Xo()?Xo().getUserAgent():"";return/android (\d+)/.test(n.toLowerCase())}var u_=new nn(""),td=(()=>{class n extends ed{_compositionMode;_composing=!1;constructor(t,r,i){super(t,r),this._compositionMode=i,this._compositionMode==null&&(this._compositionMode=!c_())}writeValue(t){let r=t??"";this.setProperty("value",r)}_handleInput(t){(!this._compositionMode||this._compositionMode&&!this._composing)&&this.onChange(t)}_compositionStart(){this._composing=!0}_compositionEnd(t){this._composing=!1,this._compositionMode&&this.onChange(t)}static \u0275fac=function(r){return new(r||n)(W(Sr),W(br),W(u_,8))};static \u0275dir=re({type:n,selectors:[["input","formControlName","",3,"type","checkbox"],["textarea","formControlName",""],["input","formControl","",3,"type","checkbox"],["textarea","formControl",""],["input","ngModel","",3,"type","checkbox"],["textarea","ngModel",""],["","ngDefaultControl",""]],hostBindings:function(r,i){r&1&&rn("input",function(a){return i._handleInput(a.target.value)})("blur",function(){return i.onTouched()})("compositionstart",function(){return i._compositionStart()})("compositionend",function(a){return i._compositionEnd(a.target.value)})},standalone:!1,features:[Pe([a_]),me]})}return n})();function ia(n){return n==null||sa(n)===0}function sa(n){return n==null?null:Array.isArray(n)||typeof n=="string"?n.length:n instanceof Set?n.size:null}var kt=new nn(""),Or=new nn(""),l_=/^(?=.{1,254}$)(?=.{1,64}@)[a-zA-Z0-9!#$%&'*+/=?^_`{|}~-]+(?:\.[a-zA-Z0-9!#$%&'*+/=?^_`{|}~-]+)*@[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)*$/,zh=class{static min(e){return nd(e)}static max(e){return rd(e)}static required(e){return h_(e)}static requiredTrue(e){return d_(e)}static email(e){return f_(e)}static minLength(e){return p_(e)}static maxLength(e){return id(e)}static pattern(e){return m_(e)}static nullValidator(e){return xi()}static compose(e){return ld(e)}static composeAsync(e){return dd(e)}};function nd(n){return e=>{if(e.value==null||n==null)return null;let t=parseFloat(e.value);return!isNaN(t)&&t<n?{min:{min:n,actual:e.value}}:null}}function rd(n){return e=>{if(e.value==null||n==null)return null;let t=parseFloat(e.value);return!isNaN(t)&&t>n?{max:{max:n,actual:e.value}}:null}}function h_(n){return ia(n.value)?{required:!0}:null}function d_(n){return n.value===!0?null:{required:!0}}function f_(n){return ia(n.value)||l_.test(n.value)?null:{email:!0}}function p_(n){return e=>{let t=e.value?.length??sa(e.value);return t===null||t===0?null:t<n?{minlength:{requiredLength:n,actualLength:t}}:null}}function id(n){return e=>{let t=e.value?.length??sa(e.value);return t!==null&&t>n?{maxlength:{requiredLength:n,actualLength:t}}:null}}function m_(n){if(!n)return xi;let e,t;return typeof n=="string"?(t="",n.charAt(0)!=="^"&&(t+="^"),t+=n,n.charAt(n.length-1)!=="$"&&(t+="$"),e=new RegExp(t)):(t=n.toString(),e=n),r=>{if(ia(r.value))return null;let i=r.value;return e.test(i)?null:{pattern:{requiredPattern:t,actualValue:i}}}}function xi(n){return null}function sd(n){return n!=null}function od(n){return qh(n)?xh(n):n}function ad(n){let e={};return n.forEach(t=>{e=t!=null?L(L({},e),t):e}),Object.keys(e).length===0?null:e}function cd(n,e){return e.map(t=>t(n))}function g_(n){return!n.validate}function ud(n){return n.map(e=>g_(e)?e:t=>e.validate(t))}function ld(n){if(!n)return null;let e=n.filter(sd);return e.length==0?null:function(t){return ad(cd(t,e))}}function hd(n){return n!=null?ld(ud(n)):null}function dd(n){if(!n)return null;let e=n.filter(sd);return e.length==0?null:function(t){let r=cd(t,e).map(od);return Lh(r).pipe(Fh(ad))}}function fd(n){return n!=null?dd(ud(n)):null}function $h(n,e){return n===null?[e]:Array.isArray(n)?[...n,e]:[n,e]}function pd(n){return n._rawValidators}function md(n){return n._rawAsyncValidators}function Zo(n){return n?Array.isArray(n)?n:[n]:[]}function Fi(n,e){return Array.isArray(n)?n.includes(e):n===e}function Hh(n,e){let t=Zo(e);return Zo(n).forEach(i=>{Fi(t,i)||t.push(i)}),t}function Wh(n,e){return Zo(e).filter(t=>!Fi(n,t))}var Li=class{get value(){return this.control?this.control.value:null}get valid(){return this.control?this.control.valid:null}get invalid(){return this.control?this.control.invalid:null}get pending(){return this.control?this.control.pending:null}get disabled(){return this.control?this.control.disabled:null}get enabled(){return this.control?this.control.enabled:null}get errors(){return this.control?this.control.errors:null}get pristine(){return this.control?this.control.pristine:null}get dirty(){return this.control?this.control.dirty:null}get touched(){return this.control?this.control.touched:null}get status(){return this.control?this.control.status:null}get untouched(){return this.control?this.control.untouched:null}get statusChanges(){return this.control?this.control.statusChanges:null}get valueChanges(){return this.control?this.control.valueChanges:null}get path(){return null}_composedValidatorFn;_composedAsyncValidatorFn;_rawValidators=[];_rawAsyncValidators=[];_setValidators(e){this._rawValidators=e||[],this._composedValidatorFn=hd(this._rawValidators)}_setAsyncValidators(e){this._rawAsyncValidators=e||[],this._composedAsyncValidatorFn=fd(this._rawAsyncValidators)}get validator(){return this._composedValidatorFn||null}get asyncValidator(){return this._composedAsyncValidatorFn||null}_onDestroyCallbacks=[];_registerOnDestroy(e){this._onDestroyCallbacks.push(e)}_invokeOnDestroyCallbacks(){this._onDestroyCallbacks.forEach(e=>e()),this._onDestroyCallbacks=[]}reset(e=void 0){this.control&&this.control.reset(e)}hasError(e,t){return this.control?this.control.hasError(e,t):!1}getError(e,t){return this.control?this.control.getError(e,t):null}},Ve=class extends Li{name;get formDirective(){return null}get path(){return null}},sn=class extends Li{_parent=null;name=null;valueAccessor=null},Ui=class{_cd;constructor(e){this._cd=e}get isTouched(){return this._cd?.control?._touched?.(),!!this._cd?.control?.touched}get isUntouched(){return!!this._cd?.control?.untouched}get isPristine(){return this._cd?.control?._pristine?.(),!!this._cd?.control?.pristine}get isDirty(){return!!this._cd?.control?.dirty}get isValid(){return this._cd?.control?._status?.(),!!this._cd?.control?.valid}get isInvalid(){return!!this._cd?.control?.invalid}get isPending(){return!!this._cd?.control?.pending}get isSubmitted(){return this._cd?._submitted?.(),!!this._cd?.submitted}},__={"[class.ng-untouched]":"isUntouched","[class.ng-touched]":"isTouched","[class.ng-pristine]":"isPristine","[class.ng-dirty]":"isDirty","[class.ng-valid]":"isValid","[class.ng-invalid]":"isInvalid","[class.ng-pending]":"isPending"},vT=Z(L({},__),{"[class.ng-submitted]":"isSubmitted"}),IT=(()=>{class n extends Ui{constructor(t){super(t)}static \u0275fac=function(r){return new(r||n)(W(sn,2))};static \u0275dir=re({type:n,selectors:[["","formControlName",""],["","ngModel",""],["","formControl",""]],hostVars:14,hostBindings:function(r,i){r&2&&Jo("ng-untouched",i.isUntouched)("ng-touched",i.isTouched)("ng-pristine",i.isPristine)("ng-dirty",i.isDirty)("ng-valid",i.isValid)("ng-invalid",i.isInvalid)("ng-pending",i.isPending)},standalone:!1,features:[me]})}return n})(),wT=(()=>{class n extends Ui{constructor(t){super(t)}static \u0275fac=function(r){return new(r||n)(W(Ve,10))};static \u0275dir=re({type:n,selectors:[["","formGroupName",""],["","formArrayName",""],["","ngModelGroup",""],["","formGroup",""],["form",3,"ngNoForm",""],["","ngForm",""]],hostVars:16,hostBindings:function(r,i){r&2&&Jo("ng-untouched",i.isUntouched)("ng-touched",i.isTouched)("ng-pristine",i.isPristine)("ng-dirty",i.isDirty)("ng-valid",i.isValid)("ng-invalid",i.isInvalid)("ng-pending",i.isPending)("ng-submitted",i.isSubmitted)},standalone:!1,features:[me]})}return n})();var Cr="VALID",Mi="INVALID",Pn="PENDING",Rr="DISABLED",Vt=class{},Bi=class extends Vt{value;source;constructor(e,t){super(),this.value=e,this.source=t}},Pr=class extends Vt{pristine;source;constructor(e,t){super(),this.pristine=e,this.source=t}},Dr=class extends Vt{touched;source;constructor(e,t){super(),this.touched=e,this.source=t}},Dn=class extends Vt{status;source;constructor(e,t){super(),this.status=e,this.source=t}},ea=class extends Vt{source;constructor(e){super(),this.source=e}},Vr=class extends Vt{source;constructor(e){super(),this.source=e}};function oa(n){return($i(n)?n.validators:n)||null}function y_(n){return Array.isArray(n)?hd(n):n||null}function aa(n,e){return($i(e)?e.asyncValidators:n)||null}function v_(n){return Array.isArray(n)?fd(n):n||null}function $i(n){return n!=null&&!Array.isArray(n)&&typeof n=="object"}function gd(n,e,t){let r=n.controls;if(!(e?Object.keys(r):r).length)throw new Ni(1e3,"");if(!r[t])throw new Ni(1001,"")}function _d(n,e,t){n._forEachChild((r,i)=>{if(t[i]===void 0)throw new Ni(1002,"")})}var Nn=class{_pendingDirty=!1;_hasOwnPendingAsyncValidator=null;_pendingTouched=!1;_onCollectionChange=()=>{};_updateOn;_parent=null;_asyncValidationSubscription;_composedValidatorFn;_composedAsyncValidatorFn;_rawValidators;_rawAsyncValidators;value;constructor(e,t){this._assignValidators(e),this._assignAsyncValidators(t)}get validator(){return this._composedValidatorFn}set validator(e){this._rawValidators=this._composedValidatorFn=e}get asyncValidator(){return this._composedAsyncValidatorFn}set asyncValidator(e){this._rawAsyncValidators=this._composedAsyncValidatorFn=e}get parent(){return this._parent}get status(){return Nt(this.statusReactive)}set status(e){Nt(()=>this.statusReactive.set(e))}_status=De(()=>this.statusReactive());statusReactive=Fe(void 0);get valid(){return this.status===Cr}get invalid(){return this.status===Mi}get pending(){return this.status==Pn}get disabled(){return this.status===Rr}get enabled(){return this.status!==Rr}errors;get pristine(){return Nt(this.pristineReactive)}set pristine(e){Nt(()=>this.pristineReactive.set(e))}_pristine=De(()=>this.pristineReactive());pristineReactive=Fe(!0);get dirty(){return!this.pristine}get touched(){return Nt(this.touchedReactive)}set touched(e){Nt(()=>this.touchedReactive.set(e))}_touched=De(()=>this.touchedReactive());touchedReactive=Fe(!1);get untouched(){return!this.touched}_events=new Mh;events=this._events.asObservable();valueChanges;statusChanges;get updateOn(){return this._updateOn?this._updateOn:this.parent?this.parent.updateOn:"change"}setValidators(e){this._assignValidators(e)}setAsyncValidators(e){this._assignAsyncValidators(e)}addValidators(e){this.setValidators(Hh(e,this._rawValidators))}addAsyncValidators(e){this.setAsyncValidators(Hh(e,this._rawAsyncValidators))}removeValidators(e){this.setValidators(Wh(e,this._rawValidators))}removeAsyncValidators(e){this.setAsyncValidators(Wh(e,this._rawAsyncValidators))}hasValidator(e){return Fi(this._rawValidators,e)}hasAsyncValidator(e){return Fi(this._rawAsyncValidators,e)}clearValidators(){this.validator=null}clearAsyncValidators(){this.asyncValidator=null}markAsTouched(e={}){let t=this.touched===!1;this.touched=!0;let r=e.sourceControl??this;this._parent&&!e.onlySelf&&this._parent.markAsTouched(Z(L({},e),{sourceControl:r})),t&&e.emitEvent!==!1&&this._events.next(new Dr(!0,r))}markAllAsDirty(e={}){this.markAsDirty({onlySelf:!0,emitEvent:e.emitEvent,sourceControl:this}),this._forEachChild(t=>t.markAllAsDirty(e))}markAllAsTouched(e={}){this.markAsTouched({onlySelf:!0,emitEvent:e.emitEvent,sourceControl:this}),this._forEachChild(t=>t.markAllAsTouched(e))}markAsUntouched(e={}){let t=this.touched===!0;this.touched=!1,this._pendingTouched=!1;let r=e.sourceControl??this;this._forEachChild(i=>{i.markAsUntouched({onlySelf:!0,emitEvent:e.emitEvent,sourceControl:r})}),this._parent&&!e.onlySelf&&this._parent._updateTouched(e,r),t&&e.emitEvent!==!1&&this._events.next(new Dr(!1,r))}markAsDirty(e={}){let t=this.pristine===!0;this.pristine=!1;let r=e.sourceControl??this;this._parent&&!e.onlySelf&&this._parent.markAsDirty(Z(L({},e),{sourceControl:r})),t&&e.emitEvent!==!1&&this._events.next(new Pr(!1,r))}markAsPristine(e={}){let t=this.pristine===!1;this.pristine=!0,this._pendingDirty=!1;let r=e.sourceControl??this;this._forEachChild(i=>{i.markAsPristine({onlySelf:!0,emitEvent:e.emitEvent})}),this._parent&&!e.onlySelf&&this._parent._updatePristine(e,r),t&&e.emitEvent!==!1&&this._events.next(new Pr(!0,r))}markAsPending(e={}){this.status=Pn;let t=e.sourceControl??this;e.emitEvent!==!1&&(this._events.next(new Dn(this.status,t)),this.statusChanges.emit(this.status)),this._parent&&!e.onlySelf&&this._parent.markAsPending(Z(L({},e),{sourceControl:t}))}disable(e={}){let t=this._parentMarkedDirty(e.onlySelf);this.status=Rr,this.errors=null,this._forEachChild(i=>{i.disable(Z(L({},e),{onlySelf:!0}))}),this._updateValue();let r=e.sourceControl??this;e.emitEvent!==!1&&(this._events.next(new Bi(this.value,r)),this._events.next(new Dn(this.status,r)),this.valueChanges.emit(this.value),this.statusChanges.emit(this.status)),this._updateAncestors(Z(L({},e),{skipPristineCheck:t}),this),this._onDisabledChange.forEach(i=>i(!0))}enable(e={}){let t=this._parentMarkedDirty(e.onlySelf);this.status=Cr,this._forEachChild(r=>{r.enable(Z(L({},e),{onlySelf:!0}))}),this.updateValueAndValidity({onlySelf:!0,emitEvent:e.emitEvent}),this._updateAncestors(Z(L({},e),{skipPristineCheck:t}),this),this._onDisabledChange.forEach(r=>r(!1))}_updateAncestors(e,t){this._parent&&!e.onlySelf&&(this._parent.updateValueAndValidity(e),e.skipPristineCheck||this._parent._updatePristine({},t),this._parent._updateTouched({},t))}setParent(e){this._parent=e}getRawValue(){return this.value}updateValueAndValidity(e={}){if(this._setInitialStatus(),this._updateValue(),this.enabled){let r=this._cancelExistingSubscription();this.errors=this._runValidator(),this.status=this._calculateStatus(),(this.status===Cr||this.status===Pn)&&this._runAsyncValidator(r,e.emitEvent)}let t=e.sourceControl??this;e.emitEvent!==!1&&(this._events.next(new Bi(this.value,t)),this._events.next(new Dn(this.status,t)),this.valueChanges.emit(this.value),this.statusChanges.emit(this.status)),this._parent&&!e.onlySelf&&this._parent.updateValueAndValidity(Z(L({},e),{sourceControl:t}))}_updateTreeValidity(e={emitEvent:!0}){this._forEachChild(t=>t._updateTreeValidity(e)),this.updateValueAndValidity({onlySelf:!0,emitEvent:e.emitEvent})}_setInitialStatus(){this.status=this._allControlsDisabled()?Rr:Cr}_runValidator(){return this.validator?this.validator(this):null}_runAsyncValidator(e,t){if(this.asyncValidator){this.status=Pn,this._hasOwnPendingAsyncValidator={emitEvent:t!==!1,shouldHaveEmitted:e!==!1};let r=od(this.asyncValidator(this));this._asyncValidationSubscription=r.subscribe(i=>{this._hasOwnPendingAsyncValidator=null,this.setErrors(i,{emitEvent:t,shouldHaveEmitted:e})})}}_cancelExistingSubscription(){if(this._asyncValidationSubscription){this._asyncValidationSubscription.unsubscribe();let e=(this._hasOwnPendingAsyncValidator?.emitEvent||this._hasOwnPendingAsyncValidator?.shouldHaveEmitted)??!1;return this._hasOwnPendingAsyncValidator=null,e}return!1}setErrors(e,t={}){this.errors=e,this._updateControlsErrors(t.emitEvent!==!1,this,t.shouldHaveEmitted)}get(e){let t=e;return t==null||(Array.isArray(t)||(t=t.split(".")),t.length===0)?null:t.reduce((r,i)=>r&&r._find(i),this)}getError(e,t){let r=t?this.get(t):this;return r&&r.errors?r.errors[e]:null}hasError(e,t){return!!this.getError(e,t)}get root(){let e=this;for(;e._parent;)e=e._parent;return e}_updateControlsErrors(e,t,r){this.status=this._calculateStatus(),e&&this.statusChanges.emit(this.status),(e||r)&&this._events.next(new Dn(this.status,t)),this._parent&&this._parent._updateControlsErrors(e,t,r)}_initObservables(){this.valueChanges=new Rn,this.statusChanges=new Rn}_calculateStatus(){return this._allControlsDisabled()?Rr:this.errors?Mi:this._hasOwnPendingAsyncValidator||this._anyControlsHaveStatus(Pn)?Pn:this._anyControlsHaveStatus(Mi)?Mi:Cr}_anyControlsHaveStatus(e){return this._anyControls(t=>t.status===e)}_anyControlsDirty(){return this._anyControls(e=>e.dirty)}_anyControlsTouched(){return this._anyControls(e=>e.touched)}_updatePristine(e,t){let r=!this._anyControlsDirty(),i=this.pristine!==r;this.pristine=r,this._parent&&!e.onlySelf&&this._parent._updatePristine(e,t),i&&this._events.next(new Pr(this.pristine,t))}_updateTouched(e={},t){this.touched=this._anyControlsTouched(),this._events.next(new Dr(this.touched,t)),this._parent&&!e.onlySelf&&this._parent._updateTouched(e,t)}_onDisabledChange=[];_registerOnCollectionChange(e){this._onCollectionChange=e}_setUpdateStrategy(e){$i(e)&&e.updateOn!=null&&(this._updateOn=e.updateOn)}_parentMarkedDirty(e){let t=this._parent&&this._parent.dirty;return!e&&!!t&&!this._parent._anyControlsDirty()}_find(e){return null}_assignValidators(e){this._rawValidators=Array.isArray(e)?e.slice():e,this._composedValidatorFn=y_(this._rawValidators)}_assignAsyncValidators(e){this._rawAsyncValidators=Array.isArray(e)?e.slice():e,this._composedAsyncValidatorFn=v_(this._rawAsyncValidators)}},qi=class extends Nn{constructor(e,t,r){super(oa(t),aa(r,t)),this.controls=e,this._initObservables(),this._setUpdateStrategy(t),this._setUpControls(),this.updateValueAndValidity({onlySelf:!0,emitEvent:!!this.asyncValidator})}controls;registerControl(e,t){return this.controls[e]?this.controls[e]:(this.controls[e]=t,t.setParent(this),t._registerOnCollectionChange(this._onCollectionChange),t)}addControl(e,t,r={}){this.registerControl(e,t),this.updateValueAndValidity({emitEvent:r.emitEvent}),this._onCollectionChange()}removeControl(e,t={}){this.controls[e]&&this.controls[e]._registerOnCollectionChange(()=>{}),delete this.controls[e],this.updateValueAndValidity({emitEvent:t.emitEvent}),this._onCollectionChange()}setControl(e,t,r={}){this.controls[e]&&this.controls[e]._registerOnCollectionChange(()=>{}),delete this.controls[e],t&&this.registerControl(e,t),this.updateValueAndValidity({emitEvent:r.emitEvent}),this._onCollectionChange()}contains(e){return this.controls.hasOwnProperty(e)&&this.controls[e].enabled}setValue(e,t={}){_d(this,!0,e),Object.keys(e).forEach(r=>{gd(this,!0,r),this.controls[r].setValue(e[r],{onlySelf:!0,emitEvent:t.emitEvent})}),this.updateValueAndValidity(t)}patchValue(e,t={}){e!=null&&(Object.keys(e).forEach(r=>{let i=this.controls[r];i&&i.patchValue(e[r],{onlySelf:!0,emitEvent:t.emitEvent})}),this.updateValueAndValidity(t))}reset(e={},t={}){this._forEachChild((r,i)=>{r.reset(e?e[i]:null,{onlySelf:!0,emitEvent:t.emitEvent})}),this._updatePristine(t,this),this._updateTouched(t,this),this.updateValueAndValidity(t),t?.emitEvent!==!1&&this._events.next(new Vr(this))}getRawValue(){return this._reduceChildren({},(e,t,r)=>(e[r]=t.getRawValue(),e))}_syncPendingControls(){let e=this._reduceChildren(!1,(t,r)=>r._syncPendingControls()?!0:t);return e&&this.updateValueAndValidity({onlySelf:!0}),e}_forEachChild(e){Object.keys(this.controls).forEach(t=>{let r=this.controls[t];r&&e(r,t)})}_setUpControls(){this._forEachChild(e=>{e.setParent(this),e._registerOnCollectionChange(this._onCollectionChange)})}_updateValue(){this.value=this._reduceValue()}_anyControls(e){for(let[t,r]of Object.entries(this.controls))if(this.contains(t)&&e(r))return!0;return!1}_reduceValue(){let e={};return this._reduceChildren(e,(t,r,i)=>((r.enabled||this.disabled)&&(t[i]=r.value),t))}_reduceChildren(e,t){let r=e;return this._forEachChild((i,o)=>{r=t(r,i,o)}),r}_allControlsDisabled(){for(let e of Object.keys(this.controls))if(this.controls[e].enabled)return!1;return Object.keys(this.controls).length>0||this.disabled}_find(e){return this.controls.hasOwnProperty(e)?this.controls[e]:null}};var ta=class extends qi{};var Hi=new nn("",{providedIn:"root",factory:()=>Wi}),Wi="always";function Ki(n,e){return[...e.path,n]}function na(n,e,t=Wi){ca(n,e),e.valueAccessor.writeValue(n.value),(n.disabled||t==="always")&&e.valueAccessor.setDisabledState?.(n.disabled),w_(n,e),T_(n,e),E_(n,e),I_(n,e)}function Kh(n,e,t=!0){let r=()=>{};e.valueAccessor&&(e.valueAccessor.registerOnChange(r),e.valueAccessor.registerOnTouched(r)),Gi(n,e),n&&(e._invokeOnDestroyCallbacks(),n._registerOnCollectionChange(()=>{}))}function ji(n,e){n.forEach(t=>{t.registerOnValidatorChange&&t.registerOnValidatorChange(e)})}function I_(n,e){if(e.valueAccessor.setDisabledState){let t=r=>{e.valueAccessor.setDisabledState(r)};n.registerOnDisabledChange(t),e._registerOnDestroy(()=>{n._unregisterOnDisabledChange(t)})}}function ca(n,e){let t=pd(n);e.validator!==null?n.setValidators($h(t,e.validator)):typeof t=="function"&&n.setValidators([t]);let r=md(n);e.asyncValidator!==null?n.setAsyncValidators($h(r,e.asyncValidator)):typeof r=="function"&&n.setAsyncValidators([r]);let i=()=>n.updateValueAndValidity();ji(e._rawValidators,i),ji(e._rawAsyncValidators,i)}function Gi(n,e){let t=!1;if(n!==null){if(e.validator!==null){let i=pd(n);if(Array.isArray(i)&&i.length>0){let o=i.filter(a=>a!==e.validator);o.length!==i.length&&(t=!0,n.setValidators(o))}}if(e.asyncValidator!==null){let i=md(n);if(Array.isArray(i)&&i.length>0){let o=i.filter(a=>a!==e.asyncValidator);o.length!==i.length&&(t=!0,n.setAsyncValidators(o))}}}let r=()=>{};return ji(e._rawValidators,r),ji(e._rawAsyncValidators,r),t}function w_(n,e){e.valueAccessor.registerOnChange(t=>{n._pendingValue=t,n._pendingChange=!0,n._pendingDirty=!0,n.updateOn==="change"&&yd(n,e)})}function E_(n,e){e.valueAccessor.registerOnTouched(()=>{n._pendingTouched=!0,n.updateOn==="blur"&&n._pendingChange&&yd(n,e),n.updateOn!=="submit"&&n.markAsTouched()})}function yd(n,e){n._pendingDirty&&n.markAsDirty(),n.setValue(n._pendingValue,{emitModelToViewChange:!1}),e.viewToModelUpdate(n._pendingValue),n._pendingChange=!1}function T_(n,e){let t=(r,i)=>{e.valueAccessor.writeValue(r),i&&e.viewToModelUpdate(r)};n.registerOnChange(t),e._registerOnDestroy(()=>{n._unregisterOnChange(t)})}function A_(n,e){n==null,ca(n,e)}function b_(n,e){return Gi(n,e)}function vd(n,e){if(!n.hasOwnProperty("model"))return!1;let t=n.model;return t.isFirstChange()?!0:!Object.is(e,t.currentValue)}function S_(n){return Object.getPrototypeOf(n.constructor)===kr}function C_(n,e){n._syncPendingControls(),e.forEach(t=>{let r=t.control;r.updateOn==="submit"&&r._pendingChange&&(t.viewToModelUpdate(r._pendingValue),r._pendingChange=!1)})}function Id(n,e){if(!e)return null;Array.isArray(e);let t,r,i;return e.forEach(o=>{o.constructor===td?t=o:S_(o)?r=o:i=o}),i||r||t||null}function R_(n,e){let t=n.indexOf(e);t>-1&&n.splice(t,1)}function Qh(n,e){let t=n.indexOf(e);t>-1&&n.splice(t,1)}function Jh(n){return typeof n=="object"&&n!==null&&Object.keys(n).length===2&&"value"in n&&"disabled"in n}var Nr=class extends Nn{defaultValue=null;_onChange=[];_pendingValue;_pendingChange=!1;constructor(e=null,t,r){super(oa(t),aa(r,t)),this._applyFormState(e),this._setUpdateStrategy(t),this._initObservables(),this.updateValueAndValidity({onlySelf:!0,emitEvent:!!this.asyncValidator}),$i(t)&&(t.nonNullable||t.initialValueIsDefault)&&(Jh(e)?this.defaultValue=e.value:this.defaultValue=e)}setValue(e,t={}){this.value=this._pendingValue=e,this._onChange.length&&t.emitModelToViewChange!==!1&&this._onChange.forEach(r=>r(this.value,t.emitViewToModelChange!==!1)),this.updateValueAndValidity(t)}patchValue(e,t={}){this.setValue(e,t)}reset(e=this.defaultValue,t={}){this._applyFormState(e),this.markAsPristine(t),this.markAsUntouched(t),this.setValue(this.value,t),this._pendingChange=!1,t?.emitEvent!==!1&&this._events.next(new Vr(this))}_updateValue(){}_anyControls(e){return!1}_allControlsDisabled(){return this.disabled}registerOnChange(e){this._onChange.push(e)}_unregisterOnChange(e){Qh(this._onChange,e)}registerOnDisabledChange(e){this._onDisabledChange.push(e)}_unregisterOnDisabledChange(e){Qh(this._onDisabledChange,e)}_forEachChild(e){}_syncPendingControls(){return this.updateOn==="submit"&&(this._pendingDirty&&this.markAsDirty(),this._pendingTouched&&this.markAsTouched(),this._pendingChange)?(this.setValue(this._pendingValue,{onlySelf:!0,emitModelToViewChange:!1}),!0):!1}_applyFormState(e){Jh(e)?(this.value=this._pendingValue=e.value,e.disabled?this.disable({onlySelf:!0,emitEvent:!1}):this.enable({onlySelf:!0,emitEvent:!1})):this.value=this._pendingValue=e}};var P_=n=>n instanceof Nr,D_=(()=>{class n extends Ve{_parent;ngOnInit(){this._checkParentType(),this.formDirective.addFormGroup(this)}ngOnDestroy(){this.formDirective&&this.formDirective.removeFormGroup(this)}get control(){return this.formDirective.getFormGroup(this)}get path(){return Ki(this.name==null?this.name:this.name.toString(),this._parent)}get formDirective(){return this._parent?this._parent.formDirective:null}_checkParentType(){}static \u0275fac=(()=>{let t;return function(i){return(t||(t=Qe(n)))(i||n)}})();static \u0275dir=re({type:n,standalone:!1,features:[me]})}return n})();var N_={provide:sn,useExisting:Re(()=>V_)},Yh=Promise.resolve(),V_=(()=>{class n extends sn{_changeDetectorRef;callSetDisabledState;control=new Nr;static ngAcceptInputType_isDisabled;_registered=!1;viewModel;name="";isDisabled;model;options;update=new Rn;constructor(t,r,i,o,a,u){super(),this._changeDetectorRef=a,this.callSetDisabledState=u,this._parent=t,this._setValidators(r),this._setAsyncValidators(i),this.valueAccessor=Id(this,o)}ngOnChanges(t){if(this._checkForErrors(),!this._registered||"name"in t){if(this._registered&&(this._checkName(),this.formDirective)){let r=t.name.previousValue;this.formDirective.removeControl({name:r,path:this._getPath(r)})}this._setUpControl()}"isDisabled"in t&&this._updateDisabled(t),vd(t,this.viewModel)&&(this._updateValue(this.model),this.viewModel=this.model)}ngOnDestroy(){this.formDirective&&this.formDirective.removeControl(this)}get path(){return this._getPath(this.name)}get formDirective(){return this._parent?this._parent.formDirective:null}viewToModelUpdate(t){this.viewModel=t,this.update.emit(t)}_setUpControl(){this._setUpdateStrategy(),this._isStandalone()?this._setUpStandalone():this.formDirective.addControl(this),this._registered=!0}_setUpdateStrategy(){this.options&&this.options.updateOn!=null&&(this.control._updateOn=this.options.updateOn)}_isStandalone(){return!this._parent||!!(this.options&&this.options.standalone)}_setUpStandalone(){na(this.control,this,this.callSetDisabledState),this.control.updateValueAndValidity({emitEvent:!1})}_checkForErrors(){this._checkName()}_checkName(){this.options&&this.options.name&&(this.name=this.options.name),!this._isStandalone()&&this.name}_updateValue(t){Yh.then(()=>{this.control.setValue(t,{emitViewToModelChange:!1}),this._changeDetectorRef?.markForCheck()})}_updateDisabled(t){let r=t.isDisabled.currentValue,i=r!==0&&Gh(r);Yh.then(()=>{i&&!this.control.disabled?this.control.disable():!i&&this.control.disabled&&this.control.enable(),this._changeDetectorRef?.markForCheck()})}_getPath(t){return this._parent?Ki(t,this._parent):[t]}static \u0275fac=function(r){return new(r||n)(W(Ve,9),W(kt,10),W(Or,10),W(on,10),W(Yo,8),W(Hi,8))};static \u0275dir=re({type:n,selectors:[["","ngModel","",3,"formControlName","",3,"formControl",""]],inputs:{name:"name",isDisabled:[0,"disabled","isDisabled"],model:[0,"ngModel","model"],options:[0,"ngModelOptions","options"]},outputs:{update:"ngModelChange"},exportAs:["ngModel"],standalone:!1,features:[Pe([N_]),me,Ar]})}return n})();var TT=(()=>{class n{static \u0275fac=function(r){return new(r||n)};static \u0275dir=re({type:n,selectors:[["form",3,"ngNoForm","",3,"ngNativeValidate",""]],hostAttrs:["novalidate",""],standalone:!1})}return n})(),k_={provide:on,useExisting:Re(()=>O_),multi:!0},O_=(()=>{class n extends kr{writeValue(t){let r=t??"";this.setProperty("value",r)}registerOnChange(t){this.onChange=r=>{t(r==""?null:parseFloat(r))}}static \u0275fac=(()=>{let t;return function(i){return(t||(t=Qe(n)))(i||n)}})();static \u0275dir=re({type:n,selectors:[["input","type","number","formControlName",""],["input","type","number","formControl",""],["input","type","number","ngModel",""]],hostBindings:function(r,i){r&1&&rn("input",function(a){return i.onChange(a.target.value)})("blur",function(){return i.onTouched()})},standalone:!1,features:[Pe([k_]),me]})}return n})();var wd=new nn("");var M_={provide:Ve,useExisting:Re(()=>Ed)},Ed=(()=>{class n extends Ve{callSetDisabledState;get submitted(){return Nt(this._submittedReactive)}set submitted(t){this._submittedReactive.set(t)}_submitted=De(()=>this._submittedReactive());_submittedReactive=Fe(!1);_oldForm;_onCollectionChange=()=>this._updateDomValue();directives=[];form=null;ngSubmit=new Rn;constructor(t,r,i){super(),this.callSetDisabledState=i,this._setValidators(t),this._setAsyncValidators(r)}ngOnChanges(t){t.hasOwnProperty("form")&&(this._updateValidators(),this._updateDomValue(),this._updateRegistrations(),this._oldForm=this.form)}ngOnDestroy(){this.form&&(Gi(this.form,this),this.form._onCollectionChange===this._onCollectionChange&&this.form._registerOnCollectionChange(()=>{}))}get formDirective(){return this}get control(){return this.form}get path(){return[]}addControl(t){let r=this.form.get(t.path);return na(r,t,this.callSetDisabledState),r.updateValueAndValidity({emitEvent:!1}),this.directives.push(t),r}getControl(t){return this.form.get(t.path)}removeControl(t){Kh(t.control||null,t,!1),R_(this.directives,t)}addFormGroup(t){this._setUpFormContainer(t)}removeFormGroup(t){this._cleanUpFormContainer(t)}getFormGroup(t){return this.form.get(t.path)}addFormArray(t){this._setUpFormContainer(t)}removeFormArray(t){this._cleanUpFormContainer(t)}getFormArray(t){return this.form.get(t.path)}updateModel(t,r){this.form.get(t.path).setValue(r)}onSubmit(t){return this._submittedReactive.set(!0),C_(this.form,this.directives),this.ngSubmit.emit(t),this.form._events.next(new ea(this.control)),t?.target?.method==="dialog"}onReset(){this.resetForm()}resetForm(t=void 0,r={}){this.form.reset(t,r),this._submittedReactive.set(!1)}_updateDomValue(){this.directives.forEach(t=>{let r=t.control,i=this.form.get(t.path);r!==i&&(Kh(r||null,t),P_(i)&&(na(i,t,this.callSetDisabledState),t.control=i))}),this.form._updateTreeValidity({emitEvent:!1})}_setUpFormContainer(t){let r=this.form.get(t.path);A_(r,t),r.updateValueAndValidity({emitEvent:!1})}_cleanUpFormContainer(t){if(this.form){let r=this.form.get(t.path);r&&b_(r,t)&&r.updateValueAndValidity({emitEvent:!1})}}_updateRegistrations(){this.form._registerOnCollectionChange(this._onCollectionChange),this._oldForm&&this._oldForm._registerOnCollectionChange(()=>{})}_updateValidators(){ca(this.form,this),this._oldForm&&Gi(this._oldForm,this)}static \u0275fac=function(r){return new(r||n)(W(kt,10),W(Or,10),W(Hi,8))};static \u0275dir=re({type:n,selectors:[["","formGroup",""]],hostBindings:function(r,i){r&1&&rn("submit",function(a){return i.onSubmit(a)})("reset",function(){return i.onReset()})},inputs:{form:[0,"formGroup","form"]},outputs:{ngSubmit:"ngSubmit"},exportAs:["ngForm"],standalone:!1,features:[Pe([M_]),me,Ar]})}return n})(),x_={provide:Ve,useExisting:Re(()=>Td)},Td=(()=>{class n extends D_{name=null;constructor(t,r,i){super(),this._parent=t,this._setValidators(r),this._setAsyncValidators(i)}_checkParentType(){bd(this._parent)}static \u0275fac=function(r){return new(r||n)(W(Ve,13),W(kt,10),W(Or,10))};static \u0275dir=re({type:n,selectors:[["","formGroupName",""]],inputs:{name:[0,"formGroupName","name"]},standalone:!1,features:[Pe([x_]),me]})}return n})(),F_={provide:Ve,useExisting:Re(()=>Ad)},Ad=(()=>{class n extends Ve{_parent;name=null;constructor(t,r,i){super(),this._parent=t,this._setValidators(r),this._setAsyncValidators(i)}ngOnInit(){bd(this._parent),this.formDirective.addFormArray(this)}ngOnDestroy(){this.formDirective?.removeFormArray(this)}get control(){return this.formDirective.getFormArray(this)}get formDirective(){return this._parent?this._parent.formDirective:null}get path(){return Ki(this.name==null?this.name:this.name.toString(),this._parent)}static \u0275fac=function(r){return new(r||n)(W(Ve,13),W(kt,10),W(Or,10))};static \u0275dir=re({type:n,selectors:[["","formArrayName",""]],inputs:{name:[0,"formArrayName","name"]},standalone:!1,features:[Pe([F_]),me]})}return n})();function bd(n){return!(n instanceof Td)&&!(n instanceof Ed)&&!(n instanceof Ad)}var L_={provide:sn,useExisting:Re(()=>U_)},U_=(()=>{class n extends sn{_ngModelWarningConfig;_added=!1;viewModel;control;name=null;set isDisabled(t){}model;update=new Rn;static _ngModelWarningSentOnce=!1;_ngModelWarningSent=!1;constructor(t,r,i,o,a){super(),this._ngModelWarningConfig=a,this._parent=t,this._setValidators(r),this._setAsyncValidators(i),this.valueAccessor=Id(this,o)}ngOnChanges(t){this._added||this._setUpControl(),vd(t,this.viewModel)&&(this.viewModel=this.model,this.formDirective.updateModel(this,this.model))}ngOnDestroy(){this.formDirective&&this.formDirective.removeControl(this)}viewToModelUpdate(t){this.viewModel=t,this.update.emit(t)}get path(){return Ki(this.name==null?this.name:this.name.toString(),this._parent)}get formDirective(){return this._parent?this._parent.formDirective:null}_setUpControl(){this.control=this.formDirective.addControl(this),this._added=!0}static \u0275fac=function(r){return new(r||n)(W(Ve,13),W(kt,10),W(Or,10),W(on,10),W(wd,8))};static \u0275dir=re({type:n,selectors:[["","formControlName",""]],inputs:{name:[0,"formControlName","name"],isDisabled:[0,"disabled","isDisabled"],model:[0,"ngModel","model"]},outputs:{update:"ngModelChange"},standalone:!1,features:[Pe([L_]),me,Ar]})}return n})();var B_={provide:on,useExisting:Re(()=>Cd),multi:!0};function Sd(n,e){return n==null?`${e}`:(e&&typeof e=="object"&&(e="Object"),`${n}: ${e}`.slice(0,50))}function q_(n){return n.split(":")[0]}var Cd=(()=>{class n extends kr{value;_optionMap=new Map;_idCounter=0;set compareWith(t){this._compareWith=t}_compareWith=Object.is;appRefInjector=Dt(jh).injector;destroyRef=Dt(Uh);cdr=Dt(Yo);_queuedWrite=!1;_writeValueAfterRender(){this._queuedWrite||this.appRefInjector.destroyed||(this._queuedWrite=!0,Bh({write:()=>{this.destroyRef.destroyed||(this._queuedWrite=!1,this.writeValue(this.value))}},{injector:this.appRefInjector}))}writeValue(t){this.cdr.markForCheck(),this.value=t;let r=this._getOptionId(t),i=Sd(r,t);this.setProperty("value",i)}registerOnChange(t){this.onChange=r=>{this.value=this._getOptionValue(r),t(this.value)}}_registerOption(){return(this._idCounter++).toString()}_getOptionId(t){for(let r of this._optionMap.keys())if(this._compareWith(this._optionMap.get(r),t))return r;return null}_getOptionValue(t){let r=q_(t);return this._optionMap.has(r)?this._optionMap.get(r):t}static \u0275fac=(()=>{let t;return function(i){return(t||(t=Qe(n)))(i||n)}})();static \u0275dir=re({type:n,selectors:[["select","formControlName","",3,"multiple",""],["select","formControl","",3,"multiple",""],["select","ngModel","",3,"multiple",""]],hostBindings:function(r,i){r&1&&rn("change",function(a){return i.onChange(a.target.value)})("blur",function(){return i.onTouched()})},inputs:{compareWith:"compareWith"},standalone:!1,features:[Pe([B_]),me]})}return n})(),AT=(()=>{class n{_element;_renderer;_select;id;constructor(t,r,i){this._element=t,this._renderer=r,this._select=i,this._select&&(this.id=this._select._registerOption())}set ngValue(t){this._select!=null&&(this._select._optionMap.set(this.id,t),this._setElementValue(Sd(this.id,t)),this._select._writeValueAfterRender())}set value(t){this._setElementValue(t),this._select&&this._select._writeValueAfterRender()}_setElementValue(t){this._renderer.setProperty(this._element.nativeElement,"value",t)}ngOnDestroy(){this._select&&(this._select._optionMap.delete(this.id),this._select._writeValueAfterRender())}static \u0275fac=function(r){return new(r||n)(W(br),W(Sr),W(Cd,9))};static \u0275dir=re({type:n,selectors:[["option"]],inputs:{ngValue:"ngValue",value:"value"},standalone:!1})}return n})(),j_={provide:on,useExisting:Re(()=>Rd),multi:!0};function Xh(n,e){return n==null?`${e}`:(typeof e=="string"&&(e=`'${e}'`),e&&typeof e=="object"&&(e="Object"),`${n}: ${e}`.slice(0,50))}function G_(n){return n.split(":")[0]}var Rd=(()=>{class n extends kr{value;_optionMap=new Map;_idCounter=0;set compareWith(t){this._compareWith=t}_compareWith=Object.is;writeValue(t){this.value=t;let r;if(Array.isArray(t)){let i=t.map(o=>this._getOptionId(o));r=(o,a)=>{o._setSelected(i.indexOf(a.toString())>-1)}}else r=(i,o)=>{i._setSelected(!1)};this._optionMap.forEach(r)}registerOnChange(t){this.onChange=r=>{let i=[],o=r.selectedOptions;if(o!==void 0){let a=o;for(let u=0;u<a.length;u++){let h=a[u],d=this._getOptionValue(h.value);i.push(d)}}else{let a=r.options;for(let u=0;u<a.length;u++){let h=a[u];if(h.selected){let d=this._getOptionValue(h.value);i.push(d)}}}this.value=i,t(i)}}_registerOption(t){let r=(this._idCounter++).toString();return this._optionMap.set(r,t),r}_getOptionId(t){for(let r of this._optionMap.keys())if(this._compareWith(this._optionMap.get(r)._value,t))return r;return null}_getOptionValue(t){let r=G_(t);return this._optionMap.has(r)?this._optionMap.get(r)._value:t}static \u0275fac=(()=>{let t;return function(i){return(t||(t=Qe(n)))(i||n)}})();static \u0275dir=re({type:n,selectors:[["select","multiple","","formControlName",""],["select","multiple","","formControl",""],["select","multiple","","ngModel",""]],hostBindings:function(r,i){r&1&&rn("change",function(a){return i.onChange(a.target)})("blur",function(){return i.onTouched()})},inputs:{compareWith:"compareWith"},standalone:!1,features:[Pe([j_]),me]})}return n})(),bT=(()=>{class n{_element;_renderer;_select;id;_value;constructor(t,r,i){this._element=t,this._renderer=r,this._select=i,this._select&&(this.id=this._select._registerOption(this))}set ngValue(t){this._select!=null&&(this._value=t,this._setElementValue(Xh(this.id,t)),this._select.writeValue(this._select.value))}set value(t){this._select?(this._value=t,this._setElementValue(Xh(this.id,t)),this._select.writeValue(this._select.value)):this._setElementValue(t)}_setElementValue(t){this._renderer.setProperty(this._element.nativeElement,"value",t)}_setSelected(t){this._renderer.setProperty(this._element.nativeElement,"selected",t)}ngOnDestroy(){this._select&&(this._select._optionMap.delete(this.id),this._select.writeValue(this._select.value))}static \u0275fac=function(r){return new(r||n)(W(br),W(Sr),W(Rd,9))};static \u0275dir=re({type:n,selectors:[["option"]],inputs:{ngValue:"ngValue",value:"value"},standalone:!1})}return n})();function z_(n){return typeof n=="number"?n:parseInt(n,10)}function Pd(n){return typeof n=="number"?n:parseFloat(n)}var ua=(()=>{class n{_validator=xi;_onChange;_enabled;ngOnChanges(t){if(this.inputName in t){let r=this.normalizeInput(t[this.inputName].currentValue);this._enabled=this.enabled(r),this._validator=this._enabled?this.createValidator(r):xi,this._onChange&&this._onChange()}}validate(t){return this._validator(t)}registerOnValidatorChange(t){this._onChange=t}enabled(t){return t!=null}static \u0275fac=function(r){return new(r||n)};static \u0275dir=re({type:n,features:[Ar]})}return n})(),$_={provide:kt,useExisting:Re(()=>H_),multi:!0},H_=(()=>{class n extends ua{max;inputName="max";normalizeInput=t=>Pd(t);createValidator=t=>rd(t);static \u0275fac=(()=>{let t;return function(i){return(t||(t=Qe(n)))(i||n)}})();static \u0275dir=re({type:n,selectors:[["input","type","number","max","","formControlName",""],["input","type","number","max","","formControl",""],["input","type","number","max","","ngModel",""]],hostVars:1,hostBindings:function(r,i){r&2&&Oi("max",i._enabled?i.max:null)},inputs:{max:"max"},standalone:!1,features:[Pe([$_]),me]})}return n})(),W_={provide:kt,useExisting:Re(()=>K_),multi:!0},K_=(()=>{class n extends ua{min;inputName="min";normalizeInput=t=>Pd(t);createValidator=t=>nd(t);static \u0275fac=(()=>{let t;return function(i){return(t||(t=Qe(n)))(i||n)}})();static \u0275dir=re({type:n,selectors:[["input","type","number","min","","formControlName",""],["input","type","number","min","","formControl",""],["input","type","number","min","","ngModel",""]],hostVars:1,hostBindings:function(r,i){r&2&&Oi("min",i._enabled?i.min:null)},inputs:{min:"min"},standalone:!1,features:[Pe([W_]),me]})}return n})();var Q_={provide:kt,useExisting:Re(()=>J_),multi:!0},J_=(()=>{class n extends ua{maxlength;inputName="maxlength";normalizeInput=t=>z_(t);createValidator=t=>id(t);static \u0275fac=(()=>{let t;return function(i){return(t||(t=Qe(n)))(i||n)}})();static \u0275dir=re({type:n,selectors:[["","maxlength","","formControlName",""],["","maxlength","","formControl",""],["","maxlength","","ngModel",""]],hostVars:1,hostBindings:function(r,i){r&2&&Oi("maxlength",i._enabled?i.maxlength:null)},inputs:{maxlength:"maxlength"},standalone:!1,features:[Pe([Q_]),me]})}return n})();var Dd=(()=>{class n{static \u0275fac=function(r){return new(r||n)};static \u0275mod=ki({type:n});static \u0275inj=Vi({})}return n})(),ra=class extends Nn{constructor(e,t,r){super(oa(t),aa(r,t)),this.controls=e,this._initObservables(),this._setUpdateStrategy(t),this._setUpControls(),this.updateValueAndValidity({onlySelf:!0,emitEvent:!!this.asyncValidator})}controls;at(e){return this.controls[this._adjustIndex(e)]}push(e,t={}){Array.isArray(e)?e.forEach(r=>{this.controls.push(r),this._registerControl(r)}):(this.controls.push(e),this._registerControl(e)),this.updateValueAndValidity({emitEvent:t.emitEvent}),this._onCollectionChange()}insert(e,t,r={}){this.controls.splice(e,0,t),this._registerControl(t),this.updateValueAndValidity({emitEvent:r.emitEvent})}removeAt(e,t={}){let r=this._adjustIndex(e);r<0&&(r=0),this.controls[r]&&this.controls[r]._registerOnCollectionChange(()=>{}),this.controls.splice(r,1),this.updateValueAndValidity({emitEvent:t.emitEvent})}setControl(e,t,r={}){let i=this._adjustIndex(e);i<0&&(i=0),this.controls[i]&&this.controls[i]._registerOnCollectionChange(()=>{}),this.controls.splice(i,1),t&&(this.controls.splice(i,0,t),this._registerControl(t)),this.updateValueAndValidity({emitEvent:r.emitEvent}),this._onCollectionChange()}get length(){return this.controls.length}setValue(e,t={}){_d(this,!1,e),e.forEach((r,i)=>{gd(this,!1,i),this.at(i).setValue(r,{onlySelf:!0,emitEvent:t.emitEvent})}),this.updateValueAndValidity(t)}patchValue(e,t={}){e!=null&&(e.forEach((r,i)=>{this.at(i)&&this.at(i).patchValue(r,{onlySelf:!0,emitEvent:t.emitEvent})}),this.updateValueAndValidity(t))}reset(e=[],t={}){this._forEachChild((r,i)=>{r.reset(e[i],{onlySelf:!0,emitEvent:t.emitEvent})}),this._updatePristine(t,this),this._updateTouched(t,this),this.updateValueAndValidity(t),t?.emitEvent!==!1&&this._events.next(new Vr(this))}getRawValue(){return this.controls.map(e=>e.getRawValue())}clear(e={}){this.controls.length<1||(this._forEachChild(t=>t._registerOnCollectionChange(()=>{})),this.controls.splice(0),this.updateValueAndValidity({emitEvent:e.emitEvent}))}_adjustIndex(e){return e<0?e+this.length:e}_syncPendingControls(){let e=this.controls.reduce((t,r)=>r._syncPendingControls()?!0:t,!1);return e&&this.updateValueAndValidity({onlySelf:!0}),e}_forEachChild(e){this.controls.forEach((t,r)=>{e(t,r)})}_updateValue(){this.value=this.controls.filter(e=>e.enabled||this.disabled).map(e=>e.value)}_anyControls(e){return this.controls.some(t=>t.enabled&&e(t))}_setUpControls(){this._forEachChild(e=>this._registerControl(e))}_allControlsDisabled(){for(let e of this.controls)if(e.enabled)return!1;return this.controls.length>0||this.disabled}_registerControl(e){e.setParent(this),e._registerOnCollectionChange(this._onCollectionChange)}_find(e){return this.at(e)??null}};function Zh(n){return!!n&&(n.asyncValidators!==void 0||n.validators!==void 0||n.updateOn!==void 0)}var ST=(()=>{class n{useNonNullable=!1;get nonNullable(){let t=new n;return t.useNonNullable=!0,t}group(t,r=null){let i=this._reduceControls(t),o={};return Zh(r)?o=r:r!==null&&(o.validators=r.validator,o.asyncValidators=r.asyncValidator),new qi(i,o)}record(t,r=null){let i=this._reduceControls(t);return new ta(i,r)}control(t,r,i){let o={};return this.useNonNullable?(Zh(r)?o=r:(o.validators=r,o.asyncValidators=i),new Nr(t,Z(L({},o),{nonNullable:!0}))):new Nr(t,r,i)}array(t,r,i){let o=t.map(a=>this._createControl(a));return new ra(o,r,i)}_reduceControls(t){let r={};return Object.keys(t).forEach(i=>{r[i]=this._createControl(t[i])}),r}_createControl(t){if(t instanceof Nr)return t;if(t instanceof Nn)return t;if(Array.isArray(t)){let r=t[0],i=t.length>1?t[1]:null,o=t.length>2?t[2]:null;return this.control(r,i,o)}else return this.control(t)}static \u0275fac=function(r){return new(r||n)};static \u0275prov=Ke({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})();var CT=(()=>{class n{static withConfig(t){return{ngModule:n,providers:[{provide:Hi,useValue:t.callSetDisabledState??Wi}]}}static \u0275fac=function(r){return new(r||n)};static \u0275mod=ki({type:n});static \u0275inj=Vi({imports:[Dd]})}return n})(),RT=(()=>{class n{static withConfig(t){return{ngModule:n,providers:[{provide:wd,useValue:t.warnOnNgModelWithFormControl??"always"},{provide:Hi,useValue:t.callSetDisabledState??Wi}]}}static \u0275fac=function(r){return new(r||n)};static \u0275mod=ki({type:n});static \u0275inj=Vi({imports:[Dd]})}return n})();var Nd=(()=>{let e=class e{trackEvent(r,i){typeof window.gtag=="function"&&window.gtag("event",r,i)}trackQuotationGenerated(){this.trackEvent("quotation_generated",{event_category:"quotation",event_label:"generate"})}trackQuotationPreviewed(){this.trackEvent("quotation_previewed",{event_category:"quotation",event_label:"preview"})}trackExport(r){this.trackEvent("export",{event_category:"export",event_label:r,export_format:r})}trackHistoryLoaded(r){this.trackEvent("history_loaded",{event_category:"history",event_label:"load",history_index:r})}trackHistoryDeleted(r){this.trackEvent("history_deleted",{event_category:"history",event_label:"delete",history_index:r})}trackDonateClick(){this.trackEvent("donate_click",{event_category:"engagement",event_label:"donate"})}trackTabChange(r){this.trackEvent("tab_change",{event_category:"navigation",event_label:r})}trackError(r,i){this.trackEvent("error",{event_category:"error",event_label:i||"unknown",error_message:r.message,error_stack:r.stack?.substring(0,150)})}};e.\u0275fac=function(i){return new(i||e)},e.\u0275prov=Ke({token:e,factory:e.\u0275fac,providedIn:"root"});let n=e;return n})();var Vd=(()=>{let e=class e{constructor(){this.DEFAULT_DURATION_MS=3e3,this.visible=Fe(!1),this.message=Fe(""),this.type=Fe("success")}success(r="\u64CD\u4F5C\u6210\u529F",i){this.show(r,"success",i)}error(r="\u64CD\u4F5C\u5931\u6557",i){this.show(r,"error",i)}info(r,i){this.show(r,"info",i)}warning(r,i){this.show(r,"warning",i)}show(r,i,o){this.timeoutId&&window.clearTimeout(this.timeoutId),this.message.set(r),this.type.set(i),this.visible.set(!0);let a=o??this.DEFAULT_DURATION_MS;this.timeoutId=window.setTimeout(()=>{this.hide()},a)}hide(){this.visible.set(!1),this.timeoutId&&(window.clearTimeout(this.timeoutId),this.timeoutId=void 0)}};e.\u0275fac=function(i){return new(i||e)},e.\u0275prov=Ke({token:e,factory:e.\u0275fac,providedIn:"root"});let n=e;return n})();var kd=()=>{};var xd=function(n){let e=[],t=0;for(let r=0;r<n.length;r++){let i=n.charCodeAt(r);i<128?e[t++]=i:i<2048?(e[t++]=i>>6|192,e[t++]=i&63|128):(i&64512)===55296&&r+1<n.length&&(n.charCodeAt(r+1)&64512)===56320?(i=65536+((i&1023)<<10)+(n.charCodeAt(++r)&1023),e[t++]=i>>18|240,e[t++]=i>>12&63|128,e[t++]=i>>6&63|128,e[t++]=i&63|128):(e[t++]=i>>12|224,e[t++]=i>>6&63|128,e[t++]=i&63|128)}return e},Y_=function(n){let e=[],t=0,r=0;for(;t<n.length;){let i=n[t++];if(i<128)e[r++]=String.fromCharCode(i);else if(i>191&&i<224){let o=n[t++];e[r++]=String.fromCharCode((i&31)<<6|o&63)}else if(i>239&&i<365){let o=n[t++],a=n[t++],u=n[t++],h=((i&7)<<18|(o&63)<<12|(a&63)<<6|u&63)-65536;e[r++]=String.fromCharCode(55296+(h>>10)),e[r++]=String.fromCharCode(56320+(h&1023))}else{let o=n[t++],a=n[t++];e[r++]=String.fromCharCode((i&15)<<12|(o&63)<<6|a&63)}}return e.join("")},Fd={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:typeof atob=="function",encodeByteArray(n,e){if(!Array.isArray(n))throw Error("encodeByteArray takes an array as a parameter");this.init_();let t=e?this.byteToCharMapWebSafe_:this.byteToCharMap_,r=[];for(let i=0;i<n.length;i+=3){let o=n[i],a=i+1<n.length,u=a?n[i+1]:0,h=i+2<n.length,d=h?n[i+2]:0,p=o>>2,v=(o&3)<<4|u>>4,w=(u&15)<<2|d>>6,R=d&63;h||(R=64,a||(w=64)),r.push(t[p],t[v],t[w],t[R])}return r.join("")},encodeString(n,e){return this.HAS_NATIVE_SUPPORT&&!e?btoa(n):this.encodeByteArray(xd(n),e)},decodeString(n,e){return this.HAS_NATIVE_SUPPORT&&!e?atob(n):Y_(this.decodeStringToByteArray(n,e))},decodeStringToByteArray(n,e){this.init_();let t=e?this.charToByteMapWebSafe_:this.charToByteMap_,r=[];for(let i=0;i<n.length;){let o=t[n.charAt(i++)],u=i<n.length?t[n.charAt(i)]:0;++i;let d=i<n.length?t[n.charAt(i)]:64;++i;let v=i<n.length?t[n.charAt(i)]:64;if(++i,o==null||u==null||d==null||v==null)throw new ha;let w=o<<2|u>>4;if(r.push(w),d!==64){let R=u<<4&240|d>>2;if(r.push(R),v!==64){let k=d<<6&192|v;r.push(k)}}}return r},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let n=0;n<this.ENCODED_VALS.length;n++)this.byteToCharMap_[n]=this.ENCODED_VALS.charAt(n),this.charToByteMap_[this.byteToCharMap_[n]]=n,this.byteToCharMapWebSafe_[n]=this.ENCODED_VALS_WEBSAFE.charAt(n),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[n]]=n,n>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(n)]=n,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(n)]=n)}}},ha=class extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}},X_=function(n){let e=xd(n);return Fd.encodeByteArray(e,!0)},xr=function(n){return X_(n).replace(/\./g,"")},Ji=function(n){try{return Fd.decodeString(n,!0)}catch(e){console.error("base64Decode failed: ",e)}return null};function Ld(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("Unable to locate global object.")}var Z_=()=>Ld().__FIREBASE_DEFAULTS__,ey=()=>{if(typeof process>"u"||typeof process.env>"u")return;let n=process.env.__FIREBASE_DEFAULTS__;if(n)return JSON.parse(n)},ty=()=>{if(typeof document>"u")return;let n;try{n=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch{return}let e=n&&Ji(n[1]);return e&&JSON.parse(e)},Yi=()=>{try{return kd()||Z_()||ey()||ty()}catch(n){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${n}`);return}},fa=n=>Yi()?.emulatorHosts?.[n],Ud=n=>{let e=fa(n);if(!e)return;let t=e.lastIndexOf(":");if(t<=0||t+1===e.length)throw new Error(`Invalid host ${e} with no separate hostname and port!`);let r=parseInt(e.substring(t+1),10);return e[0]==="["?[e.substring(1,t-1),r]:[e.substring(0,t),r]},pa=()=>Yi()?.config,ma=n=>Yi()?.[`_${n}`];var Qi=class{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}wrapCallback(e){return(t,r)=>{t?this.reject(t):this.resolve(r),typeof e=="function"&&(this.promise.catch(()=>{}),e.length===1?e(t):e(t,r))}}};function Ot(n){try{return(n.startsWith("http://")||n.startsWith("https://")?new URL(n).hostname:n).endsWith(".cloudworkstations.dev")}catch{return!1}}function Xi(n){return _(this,null,function*(){return(yield fetch(n,{credentials:"include"})).ok})}function Bd(n,e){if(n.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');let t={alg:"none",type:"JWT"},r=e||"demo-project",i=n.iat||0,o=n.sub||n.user_id;if(!o)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");let a=L({iss:`https://securetoken.google.com/${r}`,aud:r,iat:i,exp:i+3600,auth_time:i,sub:o,user_id:o,firebase:{sign_in_provider:"custom",identities:{}}},n);return[xr(JSON.stringify(t)),xr(JSON.stringify(a)),""].join(".")}var Mr={};function ny(){let n={prod:[],emulator:[]};for(let e of Object.keys(Mr))Mr[e]?n.emulator.push(e):n.prod.push(e);return n}function ry(n){let e=document.getElementById(n),t=!1;return e||(e=document.createElement("div"),e.setAttribute("id",n),t=!0),{created:t,element:e}}var Od=!1;function Zi(n,e){if(typeof window>"u"||typeof document>"u"||!Ot(window.location.host)||Mr[n]===e||Mr[n]||Od)return;Mr[n]=e;function t(w){return`__firebase__banner__${w}`}let r="__firebase__banner",o=ny().prod.length>0;function a(){let w=document.getElementById(r);w&&w.remove()}function u(w){w.style.display="flex",w.style.background="#7faaf0",w.style.position="fixed",w.style.bottom="5px",w.style.left="5px",w.style.padding=".5em",w.style.borderRadius="5px",w.style.alignItems="center"}function h(w,R){w.setAttribute("width","24"),w.setAttribute("id",R),w.setAttribute("height","24"),w.setAttribute("viewBox","0 0 24 24"),w.setAttribute("fill","none"),w.style.marginLeft="-6px"}function d(){let w=document.createElement("span");return w.style.cursor="pointer",w.style.marginLeft="16px",w.style.fontSize="24px",w.innerHTML=" &times;",w.onclick=()=>{Od=!0,a()},w}function p(w,R){w.setAttribute("id",R),w.innerText="Learn more",w.href="https://firebase.google.com/docs/studio/preview-apps#preview-backend",w.setAttribute("target","__blank"),w.style.paddingLeft="5px",w.style.textDecoration="underline"}function v(){let w=ry(r),R=t("text"),k=document.getElementById(R)||document.createElement("span"),M=t("learnmore"),N=document.getElementById(M)||document.createElement("a"),G=t("preprendIcon"),Q=document.getElementById(G)||document.createElementNS("http://www.w3.org/2000/svg","svg");if(w.created){let J=w.element;u(J),p(N,M);let Te=d();h(Q,G),J.append(Q,k,N,Te),document.body.appendChild(J)}o?(k.innerText="Preview backend disconnected.",Q.innerHTML=`<g clip-path="url(#clip0_6013_33858)">
<path d="M4.8 17.6L12 5.6L19.2 17.6H4.8ZM6.91667 16.4H17.0833L12 7.93333L6.91667 16.4ZM12 15.6C12.1667 15.6 12.3056 15.5444 12.4167 15.4333C12.5389 15.3111 12.6 15.1667 12.6 15C12.6 14.8333 12.5389 14.6944 12.4167 14.5833C12.3056 14.4611 12.1667 14.4 12 14.4C11.8333 14.4 11.6889 14.4611 11.5667 14.5833C11.4556 14.6944 11.4 14.8333 11.4 15C11.4 15.1667 11.4556 15.3111 11.5667 15.4333C11.6889 15.5444 11.8333 15.6 12 15.6ZM11.4 13.6H12.6V10.4H11.4V13.6Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6013_33858">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`):(Q.innerHTML=`<g clip-path="url(#clip0_6083_34804)">
<path d="M11.4 15.2H12.6V11.2H11.4V15.2ZM12 10C12.1667 10 12.3056 9.94444 12.4167 9.83333C12.5389 9.71111 12.6 9.56667 12.6 9.4C12.6 9.23333 12.5389 9.09444 12.4167 8.98333C12.3056 8.86111 12.1667 8.8 12 8.8C11.8333 8.8 11.6889 8.86111 11.5667 8.98333C11.4556 9.09444 11.4 9.23333 11.4 9.4C11.4 9.56667 11.4556 9.71111 11.5667 9.83333C11.6889 9.94444 11.8333 10 12 10ZM12 18.4C11.1222 18.4 10.2944 18.2333 9.51667 17.9C8.73889 17.5667 8.05556 17.1111 7.46667 16.5333C6.88889 15.9444 6.43333 15.2611 6.1 14.4833C5.76667 13.7056 5.6 12.8778 5.6 12C5.6 11.1111 5.76667 10.2833 6.1 9.51667C6.43333 8.73889 6.88889 8.06111 7.46667 7.48333C8.05556 6.89444 8.73889 6.43333 9.51667 6.1C10.2944 5.76667 11.1222 5.6 12 5.6C12.8889 5.6 13.7167 5.76667 14.4833 6.1C15.2611 6.43333 15.9389 6.89444 16.5167 7.48333C17.1056 8.06111 17.5667 8.73889 17.9 9.51667C18.2333 10.2833 18.4 11.1111 18.4 12C18.4 12.8778 18.2333 13.7056 17.9 14.4833C17.5667 15.2611 17.1056 15.9444 16.5167 16.5333C15.9389 17.1111 15.2611 17.5667 14.4833 17.9C13.7167 18.2333 12.8889 18.4 12 18.4ZM12 17.2C13.4444 17.2 14.6722 16.6944 15.6833 15.6833C16.6944 14.6722 17.2 13.4444 17.2 12C17.2 10.5556 16.6944 9.32778 15.6833 8.31667C14.6722 7.30555 13.4444 6.8 12 6.8C10.5556 6.8 9.32778 7.30555 8.31667 8.31667C7.30556 9.32778 6.8 10.5556 6.8 12C6.8 13.4444 7.30556 14.6722 8.31667 15.6833C9.32778 16.6944 10.5556 17.2 12 17.2Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6083_34804">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`,k.innerText="Preview backend running in this workspace."),k.setAttribute("id",R)}document.readyState==="loading"?window.addEventListener("DOMContentLoaded",v):v()}function ge(){return typeof navigator<"u"&&typeof navigator.userAgent=="string"?navigator.userAgent:""}function qd(){return typeof window<"u"&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(ge())}function iy(){let n=Yi()?.forceEnvironment;if(n==="node")return!0;if(n==="browser")return!1;try{return Object.prototype.toString.call(global.process)==="[object process]"}catch{return!1}}function jd(){return typeof navigator<"u"&&navigator.userAgent==="Cloudflare-Workers"}function Gd(){let n=typeof chrome=="object"?chrome.runtime:typeof browser=="object"?browser.runtime:void 0;return typeof n=="object"&&n.id!==void 0}function zd(){return typeof navigator=="object"&&navigator.product==="ReactNative"}function $d(){let n=ge();return n.indexOf("MSIE ")>=0||n.indexOf("Trident/")>=0}function Hd(){return!iy()&&!!navigator.userAgent&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}function ga(){try{return typeof indexedDB=="object"}catch{return!1}}function Wd(){return new Promise((n,e)=>{try{let t=!0,r="validate-browser-context-for-indexeddb-analytics-module",i=self.indexedDB.open(r);i.onsuccess=()=>{i.result.close(),t||self.indexedDB.deleteDatabase(r),n(!0)},i.onupgradeneeded=()=>{t=!1},i.onerror=()=>{e(i.error?.message||"")}}catch(t){e(t)}})}var sy="FirebaseError",ke=class n extends Error{constructor(e,t,r){super(t),this.code=e,this.customData=r,this.name=sy,Object.setPrototypeOf(this,n.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,at.prototype.create)}},at=class{constructor(e,t,r){this.service=e,this.serviceName=t,this.errors=r}create(e,...t){let r=t[0]||{},i=`${this.service}/${e}`,o=this.errors[e],a=o?oy(o,r):"Error",u=`${this.serviceName}: ${a} (${i}).`;return new ke(i,u,r)}};function oy(n,e){return n.replace(ay,(t,r)=>{let i=e[r];return i!=null?String(i):`<${r}?>`})}var ay=/\{\$([^}]+)}/g;function Kd(n){for(let e in n)if(Object.prototype.hasOwnProperty.call(n,e))return!1;return!0}function Je(n,e){if(n===e)return!0;let t=Object.keys(n),r=Object.keys(e);for(let i of t){if(!r.includes(i))return!1;let o=n[i],a=e[i];if(Md(o)&&Md(a)){if(!Je(o,a))return!1}else if(o!==a)return!1}for(let i of r)if(!t.includes(i))return!1;return!0}function Md(n){return n!==null&&typeof n=="object"}function Vn(n){let e=[];for(let[t,r]of Object.entries(n))Array.isArray(r)?r.forEach(i=>{e.push(encodeURIComponent(t)+"="+encodeURIComponent(i))}):e.push(encodeURIComponent(t)+"="+encodeURIComponent(r));return e.length?"&"+e.join("&"):""}function Qd(n,e){let t=new da(n,e);return t.subscribe.bind(t)}var da=class{constructor(e,t){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=t,this.task.then(()=>{e(this)}).catch(r=>{this.error(r)})}next(e){this.forEachObserver(t=>{t.next(e)})}error(e){this.forEachObserver(t=>{t.error(e)}),this.close(e)}complete(){this.forEachObserver(e=>{e.complete()}),this.close()}subscribe(e,t,r){let i;if(e===void 0&&t===void 0&&r===void 0)throw new Error("Missing Observer.");cy(e,["next","error","complete"])?i=e:i={next:e,error:t,complete:r},i.next===void 0&&(i.next=la),i.error===void 0&&(i.error=la),i.complete===void 0&&(i.complete=la);let o=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(()=>{try{this.finalError?i.error(this.finalError):i.complete()}catch{}}),this.observers.push(i),o}unsubscribeOne(e){this.observers===void 0||this.observers[e]===void 0||(delete this.observers[e],this.observerCount-=1,this.observerCount===0&&this.onNoObservers!==void 0&&this.onNoObservers(this))}forEachObserver(e){if(!this.finalized)for(let t=0;t<this.observers.length;t++)this.sendOne(t,e)}sendOne(e,t){this.task.then(()=>{if(this.observers!==void 0&&this.observers[e]!==void 0)try{t(this.observers[e])}catch(r){typeof console<"u"&&console.error&&console.error(r)}})}close(e){this.finalized||(this.finalized=!0,e!==void 0&&(this.finalError=e),this.task.then(()=>{this.observers=void 0,this.onNoObservers=void 0}))}};function cy(n,e){if(typeof n!="object"||n===null)return!1;for(let t of e)if(t in n&&typeof n[t]=="function")return!0;return!1}function la(){}var FT=14400*1e3;function ae(n){return n&&n._delegate?n._delegate:n}var Le=class{constructor(e,t,r){this.name=e,this.instanceFactory=t,this.type=r,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}};var an="[DEFAULT]";var _a=class{constructor(e,t){this.name=e,this.container=t,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){let t=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(t)){let r=new Qi;if(this.instancesDeferred.set(t,r),this.isInitialized(t)||this.shouldAutoInitialize())try{let i=this.getOrInitializeService({instanceIdentifier:t});i&&r.resolve(i)}catch{}}return this.instancesDeferred.get(t).promise}getImmediate(e){let t=this.normalizeInstanceIdentifier(e?.identifier),r=e?.optional??!1;if(this.isInitialized(t)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:t})}catch(i){if(r)return null;throw i}else{if(r)return null;throw Error(`Service ${this.name} is not available`)}}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,!!this.shouldAutoInitialize()){if(ly(e))try{this.getOrInitializeService({instanceIdentifier:an})}catch{}for(let[t,r]of this.instancesDeferred.entries()){let i=this.normalizeInstanceIdentifier(t);try{let o=this.getOrInitializeService({instanceIdentifier:i});r.resolve(o)}catch{}}}}clearInstance(e=an){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}delete(){return _(this,null,function*(){let e=Array.from(this.instances.values());yield Promise.all([...e.filter(t=>"INTERNAL"in t).map(t=>t.INTERNAL.delete()),...e.filter(t=>"_delete"in t).map(t=>t._delete())])})}isComponentSet(){return this.component!=null}isInitialized(e=an){return this.instances.has(e)}getOptions(e=an){return this.instancesOptions.get(e)||{}}initialize(e={}){let{options:t={}}=e,r=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(r))throw Error(`${this.name}(${r}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);let i=this.getOrInitializeService({instanceIdentifier:r,options:t});for(let[o,a]of this.instancesDeferred.entries()){let u=this.normalizeInstanceIdentifier(o);r===u&&a.resolve(i)}return i}onInit(e,t){let r=this.normalizeInstanceIdentifier(t),i=this.onInitCallbacks.get(r)??new Set;i.add(e),this.onInitCallbacks.set(r,i);let o=this.instances.get(r);return o&&e(o,r),()=>{i.delete(e)}}invokeOnInitCallbacks(e,t){let r=this.onInitCallbacks.get(t);if(r)for(let i of r)try{i(e,t)}catch{}}getOrInitializeService({instanceIdentifier:e,options:t={}}){let r=this.instances.get(e);if(!r&&this.component&&(r=this.component.instanceFactory(this.container,{instanceIdentifier:uy(e),options:t}),this.instances.set(e,r),this.instancesOptions.set(e,t),this.invokeOnInitCallbacks(r,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,r)}catch{}return r||null}normalizeInstanceIdentifier(e=an){return this.component?this.component.multipleInstances?e:an:e}shouldAutoInitialize(){return!!this.component&&this.component.instantiationMode!=="EXPLICIT"}};function uy(n){return n===an?void 0:n}function ly(n){return n.instantiationMode==="EAGER"}var es=class{constructor(e){this.name=e,this.providers=new Map}addComponent(e){let t=this.getProvider(e.name);if(t.isComponentSet())throw new Error(`Component ${e.name} has already been registered with ${this.name}`);t.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);let t=new _a(e,this);return this.providers.set(e,t),t}getProviders(){return Array.from(this.providers.values())}};var hy=[],z=(function(n){return n[n.DEBUG=0]="DEBUG",n[n.VERBOSE=1]="VERBOSE",n[n.INFO=2]="INFO",n[n.WARN=3]="WARN",n[n.ERROR=4]="ERROR",n[n.SILENT=5]="SILENT",n})(z||{}),dy={debug:z.DEBUG,verbose:z.VERBOSE,info:z.INFO,warn:z.WARN,error:z.ERROR,silent:z.SILENT},fy=z.INFO,py={[z.DEBUG]:"log",[z.VERBOSE]:"log",[z.INFO]:"info",[z.WARN]:"warn",[z.ERROR]:"error"},my=(n,e,...t)=>{if(e<n.logLevel)return;let r=new Date().toISOString(),i=py[e];if(i)console[i](`[${r}]  ${n.name}:`,...t);else throw new Error(`Attempted to log a message with an invalid logType (value: ${e})`)},Mt=class{constructor(e){this.name=e,this._logLevel=fy,this._logHandler=my,this._userLogHandler=null,hy.push(this)}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in z))throw new TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel=typeof e=="string"?dy[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if(typeof e!="function")throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,z.DEBUG,...e),this._logHandler(this,z.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,z.VERBOSE,...e),this._logHandler(this,z.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,z.INFO,...e),this._logHandler(this,z.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,z.WARN,...e),this._logHandler(this,z.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,z.ERROR,...e),this._logHandler(this,z.ERROR,...e)}};var gy=(n,e)=>e.some(t=>n instanceof t),Jd,Yd;function _y(){return Jd||(Jd=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function yy(){return Yd||(Yd=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}var Xd=new WeakMap,va=new WeakMap,Zd=new WeakMap,ya=new WeakMap,wa=new WeakMap;function vy(n){let e=new Promise((t,r)=>{let i=()=>{n.removeEventListener("success",o),n.removeEventListener("error",a)},o=()=>{t(Ye(n.result)),i()},a=()=>{r(n.error),i()};n.addEventListener("success",o),n.addEventListener("error",a)});return e.then(t=>{t instanceof IDBCursor&&Xd.set(t,n)}).catch(()=>{}),wa.set(e,n),e}function Iy(n){if(va.has(n))return;let e=new Promise((t,r)=>{let i=()=>{n.removeEventListener("complete",o),n.removeEventListener("error",a),n.removeEventListener("abort",a)},o=()=>{t(),i()},a=()=>{r(n.error||new DOMException("AbortError","AbortError")),i()};n.addEventListener("complete",o),n.addEventListener("error",a),n.addEventListener("abort",a)});va.set(n,e)}var Ia={get(n,e,t){if(n instanceof IDBTransaction){if(e==="done")return va.get(n);if(e==="objectStoreNames")return n.objectStoreNames||Zd.get(n);if(e==="store")return t.objectStoreNames[1]?void 0:t.objectStore(t.objectStoreNames[0])}return Ye(n[e])},set(n,e,t){return n[e]=t,!0},has(n,e){return n instanceof IDBTransaction&&(e==="done"||e==="store")?!0:e in n}};function ef(n){Ia=n(Ia)}function wy(n){return n===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(e,...t){let r=n.call(ts(this),e,...t);return Zd.set(r,e.sort?e.sort():[e]),Ye(r)}:yy().includes(n)?function(...e){return n.apply(ts(this),e),Ye(Xd.get(this))}:function(...e){return Ye(n.apply(ts(this),e))}}function Ey(n){return typeof n=="function"?wy(n):(n instanceof IDBTransaction&&Iy(n),gy(n,_y())?new Proxy(n,Ia):n)}function Ye(n){if(n instanceof IDBRequest)return vy(n);if(ya.has(n))return ya.get(n);let e=Ey(n);return e!==n&&(ya.set(n,e),wa.set(e,n)),e}var ts=n=>wa.get(n);function nf(n,e,{blocked:t,upgrade:r,blocking:i,terminated:o}={}){let a=indexedDB.open(n,e),u=Ye(a);return r&&a.addEventListener("upgradeneeded",h=>{r(Ye(a.result),h.oldVersion,h.newVersion,Ye(a.transaction),h)}),t&&a.addEventListener("blocked",h=>t(h.oldVersion,h.newVersion,h)),u.then(h=>{o&&h.addEventListener("close",()=>o()),i&&h.addEventListener("versionchange",d=>i(d.oldVersion,d.newVersion,d))}).catch(()=>{}),u}var Ty=["get","getKey","getAll","getAllKeys","count"],Ay=["put","add","delete","clear"],Ea=new Map;function tf(n,e){if(!(n instanceof IDBDatabase&&!(e in n)&&typeof e=="string"))return;if(Ea.get(e))return Ea.get(e);let t=e.replace(/FromIndex$/,""),r=e!==t,i=Ay.includes(t);if(!(t in(r?IDBIndex:IDBObjectStore).prototype)||!(i||Ty.includes(t)))return;let o=function(a,...u){return _(this,null,function*(){let h=this.transaction(a,i?"readwrite":"readonly"),d=h.store;return r&&(d=d.index(u.shift())),(yield Promise.all([d[t](...u),i&&h.done]))[0]})};return Ea.set(e,o),o}ef(n=>Z(L({},n),{get:(e,t,r)=>tf(e,t)||n.get(e,t,r),has:(e,t)=>!!tf(e,t)||n.has(e,t)}));var Aa=class{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map(t=>{if(by(t)){let r=t.getImmediate();return`${r.library}/${r.version}`}else return null}).filter(t=>t).join(" ")}};function by(n){return n.getComponent()?.type==="VERSION"}var ba="@firebase/app",rf="0.14.6";var ut=new Mt("@firebase/app"),Sy="@firebase/app-compat",Cy="@firebase/analytics-compat",Ry="@firebase/analytics",Py="@firebase/app-check-compat",Dy="@firebase/app-check",Ny="@firebase/auth",Vy="@firebase/auth-compat",ky="@firebase/database",Oy="@firebase/data-connect",My="@firebase/database-compat",xy="@firebase/functions",Fy="@firebase/functions-compat",Ly="@firebase/installations",Uy="@firebase/installations-compat",By="@firebase/messaging",qy="@firebase/messaging-compat",jy="@firebase/performance",Gy="@firebase/performance-compat",zy="@firebase/remote-config",$y="@firebase/remote-config-compat",Hy="@firebase/storage",Wy="@firebase/storage-compat",Ky="@firebase/firestore",Qy="@firebase/ai",Jy="@firebase/firestore-compat",Yy="firebase",Xy="12.6.0";var Sa="[DEFAULT]",Zy={[ba]:"fire-core",[Sy]:"fire-core-compat",[Ry]:"fire-analytics",[Cy]:"fire-analytics-compat",[Dy]:"fire-app-check",[Py]:"fire-app-check-compat",[Ny]:"fire-auth",[Vy]:"fire-auth-compat",[ky]:"fire-rtdb",[Oy]:"fire-data-connect",[My]:"fire-rtdb-compat",[xy]:"fire-fn",[Fy]:"fire-fn-compat",[Ly]:"fire-iid",[Uy]:"fire-iid-compat",[By]:"fire-fcm",[qy]:"fire-fcm-compat",[jy]:"fire-perf",[Gy]:"fire-perf-compat",[zy]:"fire-rc",[$y]:"fire-rc-compat",[Hy]:"fire-gcs",[Wy]:"fire-gcs-compat",[Ky]:"fire-fst",[Jy]:"fire-fst-compat",[Qy]:"fire-vertex","fire-js":"fire-js",[Yy]:"fire-js-all"};var ns=new Map,ev=new Map,Ca=new Map;function sf(n,e){try{n.container.addComponent(e)}catch(t){ut.debug(`Component ${e.name} failed to register with FirebaseApp ${n.name}`,t)}}function Ft(n){let e=n.name;if(Ca.has(e))return ut.debug(`There were multiple attempts to register component ${e}.`),!1;Ca.set(e,n);for(let t of ns.values())sf(t,n);for(let t of ev.values())sf(t,n);return!0}function Lr(n,e){let t=n.container.getProvider("heartbeat").getImmediate({optional:!0});return t&&t.triggerHeartbeat(),n.container.getProvider(e)}function Oe(n){return n==null?!1:n.settings!==void 0}var tv={"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."},xt=new at("app","Firebase",tv);var Ra=class{constructor(e,t,r){this._isDeleted=!1,this._options=L({},e),this._config=L({},t),this._name=t.name,this._automaticDataCollectionEnabled=t.automaticDataCollectionEnabled,this._container=r,this.container.addComponent(new Le("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw xt.create("app-deleted",{appName:this._name})}};var Lt=Xy;function nv(n,e={}){let t=n;typeof e!="object"&&(e={name:e});let r=L({name:Sa,automaticDataCollectionEnabled:!0},e),i=r.name;if(typeof i!="string"||!i)throw xt.create("bad-app-name",{appName:String(i)});if(t||(t=pa()),!t)throw xt.create("no-options");let o=ns.get(i);if(o){if(Je(t,o.options)&&Je(r,o.config))return o;throw xt.create("duplicate-app",{appName:i})}let a=new es(i);for(let h of Ca.values())a.addComponent(h);let u=new Ra(t,r,a);return ns.set(i,u),u}function rs(n=Sa){let e=ns.get(n);if(!e&&n===Sa&&pa())return nv();if(!e)throw xt.create("no-app",{appName:n});return e}function ct(n,e,t){let r=Zy[n]??n;t&&(r+=`-${t}`);let i=r.match(/\s|\//),o=e.match(/\s|\//);if(i||o){let a=[`Unable to register library "${r}" with version "${e}":`];i&&a.push(`library name "${r}" contains illegal characters (whitespace or "/")`),i&&o&&a.push("and"),o&&a.push(`version name "${e}" contains illegal characters (whitespace or "/")`),ut.warn(a.join(" "));return}Ft(new Le(`${r}-version`,()=>({library:r,version:e}),"VERSION"))}var rv="firebase-heartbeat-database",iv=1,Fr="firebase-heartbeat-store",Ta=null;function uf(){return Ta||(Ta=nf(rv,iv,{upgrade:(n,e)=>{switch(e){case 0:try{n.createObjectStore(Fr)}catch(t){console.warn(t)}}}}).catch(n=>{throw xt.create("idb-open",{originalErrorMessage:n.message})})),Ta}function sv(n){return _(this,null,function*(){try{let t=(yield uf()).transaction(Fr),r=yield t.objectStore(Fr).get(lf(n));return yield t.done,r}catch(e){if(e instanceof ke)ut.warn(e.message);else{let t=xt.create("idb-get",{originalErrorMessage:e?.message});ut.warn(t.message)}}})}function of(n,e){return _(this,null,function*(){try{let r=(yield uf()).transaction(Fr,"readwrite");yield r.objectStore(Fr).put(e,lf(n)),yield r.done}catch(t){if(t instanceof ke)ut.warn(t.message);else{let r=xt.create("idb-set",{originalErrorMessage:t?.message});ut.warn(r.message)}}})}function lf(n){return`${n.name}!${n.options.appId}`}var ov=1024,av=30,Pa=class{constructor(e){this.container=e,this._heartbeatsCache=null;let t=this.container.getProvider("app").getImmediate();this._storage=new Da(t),this._heartbeatsCachePromise=this._storage.read().then(r=>(this._heartbeatsCache=r,r))}triggerHeartbeat(){return _(this,null,function*(){try{let t=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),r=af();if(this._heartbeatsCache?.heartbeats==null&&(this._heartbeatsCache=yield this._heartbeatsCachePromise,this._heartbeatsCache?.heartbeats==null)||this._heartbeatsCache.lastSentHeartbeatDate===r||this._heartbeatsCache.heartbeats.some(i=>i.date===r))return;if(this._heartbeatsCache.heartbeats.push({date:r,agent:t}),this._heartbeatsCache.heartbeats.length>av){let i=uv(this._heartbeatsCache.heartbeats);this._heartbeatsCache.heartbeats.splice(i,1)}return this._storage.overwrite(this._heartbeatsCache)}catch(e){ut.warn(e)}})}getHeartbeatsHeader(){return _(this,null,function*(){try{if(this._heartbeatsCache===null&&(yield this._heartbeatsCachePromise),this._heartbeatsCache?.heartbeats==null||this._heartbeatsCache.heartbeats.length===0)return"";let e=af(),{heartbeatsToSend:t,unsentEntries:r}=cv(this._heartbeatsCache.heartbeats),i=xr(JSON.stringify({version:2,heartbeats:t}));return this._heartbeatsCache.lastSentHeartbeatDate=e,r.length>0?(this._heartbeatsCache.heartbeats=r,yield this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),i}catch(e){return ut.warn(e),""}})}};function af(){return new Date().toISOString().substring(0,10)}function cv(n,e=ov){let t=[],r=n.slice();for(let i of n){let o=t.find(a=>a.agent===i.agent);if(o){if(o.dates.push(i.date),cf(t)>e){o.dates.pop();break}}else if(t.push({agent:i.agent,dates:[i.date]}),cf(t)>e){t.pop();break}r=r.slice(1)}return{heartbeatsToSend:t,unsentEntries:r}}var Da=class{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}runIndexedDBEnvironmentCheck(){return _(this,null,function*(){return ga()?Wd().then(()=>!0).catch(()=>!1):!1})}read(){return _(this,null,function*(){if(yield this._canUseIndexedDBPromise){let t=yield sv(this.app);return t?.heartbeats?t:{heartbeats:[]}}else return{heartbeats:[]}})}overwrite(e){return _(this,null,function*(){if(yield this._canUseIndexedDBPromise){let r=yield this.read();return of(this.app,{lastSentHeartbeatDate:e.lastSentHeartbeatDate??r.lastSentHeartbeatDate,heartbeats:e.heartbeats})}else return})}add(e){return _(this,null,function*(){if(yield this._canUseIndexedDBPromise){let r=yield this.read();return of(this.app,{lastSentHeartbeatDate:e.lastSentHeartbeatDate??r.lastSentHeartbeatDate,heartbeats:[...r.heartbeats,...e.heartbeats]})}else return})}};function cf(n){return xr(JSON.stringify({version:2,heartbeats:n})).length}function uv(n){if(n.length===0)return-1;let e=0,t=n[0].date;for(let r=1;r<n.length;r++)n[r].date<t&&(t=n[r].date,e=r);return e}function lv(n){Ft(new Le("platform-logger",e=>new Aa(e),"PRIVATE")),Ft(new Le("heartbeat",e=>new Pa(e),"PRIVATE")),ct(ba,rf,n),ct(ba,rf,"esm2020"),ct("fire-js","")}lv("");function bf(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}}var Sf=bf,Cf=new at("auth","Firebase",bf());var us=new Mt("@firebase/auth");function hv(n,...e){us.logLevel<=z.WARN&&us.warn(`Auth (${Lt}): ${n}`,...e)}function ss(n,...e){us.logLevel<=z.ERROR&&us.error(`Auth (${Lt}): ${n}`,...e)}function Ze(n,...e){throw Ka(n,...e)}function qe(n,...e){return Ka(n,...e)}function Wa(n,e,t){let r=Z(L({},Sf()),{[e]:t});return new at("auth","Firebase",r).create(e,{appName:n.name})}function cn(n){return Wa(n,"operation-not-supported-in-this-environment","Operations that alter the current user are not supported in conjunction with FirebaseServerApp")}function dv(n,e,t){let r=t;if(!(e instanceof r))throw r.name!==e.constructor.name&&Ze(n,"argument-error"),Wa(n,"argument-error",`Type of ${e.constructor.name} does not match expected instance.Did you pass a reference from a different Auth SDK?`)}function Ka(n,...e){if(typeof n!="string"){let t=e[0],r=[...e.slice(1)];return r[0]&&(r[0].appName=n.name),n._errorFactory.create(t,...r)}return Cf.create(n,...e)}function U(n,e,...t){if(!n)throw Ka(e,...t)}function lt(n){let e="INTERNAL ASSERTION FAILED: "+n;throw ss(e),new Error(e)}function dt(n,e){n||lt(e)}function ka(){return typeof self<"u"&&self.location?.href||""}function fv(){return hf()==="http:"||hf()==="https:"}function hf(){return typeof self<"u"&&self.location?.protocol||null}function pv(){return typeof navigator<"u"&&navigator&&"onLine"in navigator&&typeof navigator.onLine=="boolean"&&(fv()||Gd()||"connection"in navigator)?navigator.onLine:!0}function mv(){if(typeof navigator>"u")return null;let n=navigator;return n.languages&&n.languages[0]||n.language||null}var un=class{constructor(e,t){this.shortDelay=e,this.longDelay=t,dt(t>e,"Short delay should be less than long delay!"),this.isMobile=qd()||zd()}get(){return pv()?this.isMobile?this.longDelay:this.shortDelay:Math.min(5e3,this.shortDelay)}};function Qa(n,e){dt(n.emulator,"Emulator should always be set here");let{url:t}=n.emulator;return e?`${t}${e.startsWith("/")?e.slice(1):e}`:t}var ls=class{static initialize(e,t,r){this.fetchImpl=e,t&&(this.headersImpl=t),r&&(this.responseImpl=r)}static fetch(){if(this.fetchImpl)return this.fetchImpl;if(typeof self<"u"&&"fetch"in self)return self.fetch;if(typeof globalThis<"u"&&globalThis.fetch)return globalThis.fetch;if(typeof fetch<"u")return fetch;lt("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){if(this.headersImpl)return this.headersImpl;if(typeof self<"u"&&"Headers"in self)return self.Headers;if(typeof globalThis<"u"&&globalThis.Headers)return globalThis.Headers;if(typeof Headers<"u")return Headers;lt("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){if(this.responseImpl)return this.responseImpl;if(typeof self<"u"&&"Response"in self)return self.Response;if(typeof globalThis<"u"&&globalThis.Response)return globalThis.Response;if(typeof Response<"u")return Response;lt("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}};var gv={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"missing-password",INVALID_LOGIN_CREDENTIALS:"invalid-credential",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",PASSWORD_DOES_NOT_MEET_REQUIREMENTS:"password-does-not-meet-requirements",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error",RECAPTCHA_NOT_ENABLED:"recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"invalid-recaptcha-action",MISSING_CLIENT_TYPE:"missing-client-type",MISSING_RECAPTCHA_VERSION:"missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"invalid-recaptcha-version",INVALID_REQ_TYPE:"invalid-req-type"};var _v=["/v1/accounts:signInWithCustomToken","/v1/accounts:signInWithEmailLink","/v1/accounts:signInWithIdp","/v1/accounts:signInWithPassword","/v1/accounts:signInWithPhoneNumber","/v1/token"],yv=new un(3e4,6e4);function Ja(n,e){return n.tenantId&&!e.tenantId?Z(L({},e),{tenantId:n.tenantId}):e}function hn(o,a,u,h){return _(this,arguments,function*(n,e,t,r,i={}){return Rf(n,i,()=>_(null,null,function*(){let d={},p={};r&&(e==="GET"?p=r:d={body:JSON.stringify(r)});let v=Vn(L({key:n.config.apiKey},p)).slice(1),w=yield n._getAdditionalHeaders();w["Content-Type"]="application/json",n.languageCode&&(w["X-Firebase-Locale"]=n.languageCode);let R=L({method:e,headers:w},d);return jd()||(R.referrerPolicy="no-referrer"),n.emulatorConfig&&Ot(n.emulatorConfig.host)&&(R.credentials="include"),ls.fetch()(yield Pf(n,n.config.apiHost,t,v),R)}))})}function Rf(n,e,t){return _(this,null,function*(){n._canInitEmulator=!1;let r=L(L({},gv),e);try{let i=new Oa(n),o=yield Promise.race([t(),i.promise]);i.clearNetworkTimeout();let a=yield o.json();if("needConfirmation"in a)throw is(n,"account-exists-with-different-credential",a);if(o.ok&&!("errorMessage"in a))return a;{let u=o.ok?a.errorMessage:a.error.message,[h,d]=u.split(" : ");if(h==="FEDERATED_USER_ID_ALREADY_LINKED")throw is(n,"credential-already-in-use",a);if(h==="EMAIL_EXISTS")throw is(n,"email-already-in-use",a);if(h==="USER_DISABLED")throw is(n,"user-disabled",a);let p=r[h]||h.toLowerCase().replace(/[_\s]+/g,"-");if(d)throw Wa(n,p,d);Ze(n,p)}}catch(i){if(i instanceof ke)throw i;Ze(n,"network-request-failed",{message:String(i)})}})}function vv(o,a,u,h){return _(this,arguments,function*(n,e,t,r,i={}){let d=yield hn(n,e,t,r,i);return"mfaPendingCredential"in d&&Ze(n,"multi-factor-auth-required",{_serverResponse:d}),d})}function Pf(n,e,t,r){return _(this,null,function*(){let i=`${e}${t}?${r}`,o=n,a=o.config.emulator?Qa(n.config,i):`${n.config.apiScheme}://${i}`;return _v.includes(t)&&(yield o._persistenceManagerAvailable,o._getPersistenceType()==="COOKIE")?o._getPersistence()._getFinalTarget(a).toString():a})}var Oa=class{clearNetworkTimeout(){clearTimeout(this.timer)}constructor(e){this.auth=e,this.timer=null,this.promise=new Promise((t,r)=>{this.timer=setTimeout(()=>r(qe(this.auth,"network-request-failed")),yv.get())})}};function is(n,e,t){let r={appName:n.name};t.email&&(r.email=t.email),t.phoneNumber&&(r.phoneNumber=t.phoneNumber);let i=qe(n,e,r);return i.customData._tokenResponse=t,i}function Iv(n,e){return _(this,null,function*(){return hn(n,"POST","/v1/accounts:delete",e)})}function hs(n,e){return _(this,null,function*(){return hn(n,"POST","/v1/accounts:lookup",e)})}function Ur(n){if(n)try{let e=new Date(Number(n));if(!isNaN(e.getTime()))return e.toUTCString()}catch{}}function Df(n,e=!1){return _(this,null,function*(){let t=ae(n),r=yield t.getIdToken(e),i=Ya(r);U(i&&i.exp&&i.auth_time&&i.iat,t.auth,"internal-error");let o=typeof i.firebase=="object"?i.firebase:void 0,a=o?.sign_in_provider;return{claims:i,token:r,authTime:Ur(Na(i.auth_time)),issuedAtTime:Ur(Na(i.iat)),expirationTime:Ur(Na(i.exp)),signInProvider:a||null,signInSecondFactor:o?.sign_in_second_factor||null}})}function Na(n){return Number(n)*1e3}function Ya(n){let[e,t,r]=n.split(".");if(e===void 0||t===void 0||r===void 0)return ss("JWT malformed, contained fewer than 3 sections"),null;try{let i=Ji(t);return i?JSON.parse(i):(ss("Failed to decode base64 JWT payload"),null)}catch(i){return ss("Caught error parsing JWT payload as JSON",i?.toString()),null}}function df(n){let e=Ya(n);return U(e,"internal-error"),U(typeof e.exp<"u","internal-error"),U(typeof e.iat<"u","internal-error"),Number(e.exp)-Number(e.iat)}function On(n,e,t=!1){return _(this,null,function*(){if(t)return e;try{return yield e}catch(r){throw r instanceof ke&&wv(r)&&n.auth.currentUser===n&&(yield n.auth.signOut()),r}})}function wv({code:n}){return n==="auth/user-disabled"||n==="auth/user-token-expired"}var Ma=class{constructor(e){this.user=e,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,this.timerId!==null&&clearTimeout(this.timerId))}getInterval(e){if(e){let t=this.errorBackoff;return this.errorBackoff=Math.min(this.errorBackoff*2,96e4),t}else{this.errorBackoff=3e4;let r=(this.user.stsTokenManager.expirationTime??0)-Date.now()-3e5;return Math.max(0,r)}}schedule(e=!1){if(!this.isRunning)return;let t=this.getInterval(e);this.timerId=setTimeout(()=>_(this,null,function*(){yield this.iteration()}),t)}iteration(){return _(this,null,function*(){try{yield this.user.getIdToken(!0)}catch(e){e?.code==="auth/network-request-failed"&&this.schedule(!0);return}this.schedule()})}};var qr=class{constructor(e,t){this.createdAt=e,this.lastLoginAt=t,this._initializeTime()}_initializeTime(){this.lastSignInTime=Ur(this.lastLoginAt),this.creationTime=Ur(this.createdAt)}_copy(e){this.createdAt=e.createdAt,this.lastLoginAt=e.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}};function ds(n){return _(this,null,function*(){let e=n.auth,t=yield n.getIdToken(),r=yield On(n,hs(e,{idToken:t}));U(r?.users.length,e,"internal-error");let i=r.users[0];n._notifyReloadListener(i);let o=i.providerUserInfo?.length?Vf(i.providerUserInfo):[],a=Ev(n.providerData,o),u=n.isAnonymous,h=!(n.email&&i.passwordHash)&&!a?.length,d=u?h:!1,p={uid:i.localId,displayName:i.displayName||null,photoURL:i.photoUrl||null,email:i.email||null,emailVerified:i.emailVerified||!1,phoneNumber:i.phoneNumber||null,tenantId:i.tenantId||null,providerData:a,metadata:new qr(i.createdAt,i.lastLoginAt),isAnonymous:d};Object.assign(n,p)})}function Nf(n){return _(this,null,function*(){let e=ae(n);yield ds(e),yield e.auth._persistUserIfCurrent(e),e.auth._notifyListenersIfCurrent(e)})}function Ev(n,e){return[...n.filter(r=>!e.some(i=>i.providerId===r.providerId)),...e]}function Vf(n){return n.map(r=>{var i=r,{providerId:e}=i,t=Di(i,["providerId"]);return{providerId:e,uid:t.rawId||"",displayName:t.displayName||null,email:t.email||null,phoneNumber:t.phoneNumber||null,photoURL:t.photoUrl||null}})}function Tv(n,e){return _(this,null,function*(){let t=yield Rf(n,{},()=>_(null,null,function*(){let r=Vn({grant_type:"refresh_token",refresh_token:e}).slice(1),{tokenApiHost:i,apiKey:o}=n.config,a=yield Pf(n,i,"/v1/token",`key=${o}`),u=yield n._getAdditionalHeaders();u["Content-Type"]="application/x-www-form-urlencoded";let h={method:"POST",headers:u,body:r};return n.emulatorConfig&&Ot(n.emulatorConfig.host)&&(h.credentials="include"),ls.fetch()(a,h)}));return{accessToken:t.access_token,expiresIn:t.expires_in,refreshToken:t.refresh_token}})}function Av(n,e){return _(this,null,function*(){return hn(n,"POST","/v2/accounts:revokeToken",Ja(n,e))})}var Br=class n{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(e){U(e.idToken,"internal-error"),U(typeof e.idToken<"u","internal-error"),U(typeof e.refreshToken<"u","internal-error");let t="expiresIn"in e&&typeof e.expiresIn<"u"?Number(e.expiresIn):df(e.idToken);this.updateTokensAndExpiration(e.idToken,e.refreshToken,t)}updateFromIdToken(e){U(e.length!==0,"internal-error");let t=df(e);this.updateTokensAndExpiration(e,null,t)}getToken(e,t=!1){return _(this,null,function*(){return!t&&this.accessToken&&!this.isExpired?this.accessToken:(U(this.refreshToken,e,"user-token-expired"),this.refreshToken?(yield this.refresh(e,this.refreshToken),this.accessToken):null)})}clearRefreshToken(){this.refreshToken=null}refresh(e,t){return _(this,null,function*(){let{accessToken:r,refreshToken:i,expiresIn:o}=yield Tv(e,t);this.updateTokensAndExpiration(r,i,Number(o))})}updateTokensAndExpiration(e,t,r){this.refreshToken=t||null,this.accessToken=e||null,this.expirationTime=Date.now()+r*1e3}static fromJSON(e,t){let{refreshToken:r,accessToken:i,expirationTime:o}=t,a=new n;return r&&(U(typeof r=="string","internal-error",{appName:e}),a.refreshToken=r),i&&(U(typeof i=="string","internal-error",{appName:e}),a.accessToken=i),o&&(U(typeof o=="number","internal-error",{appName:e}),a.expirationTime=o),a}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(e){this.accessToken=e.accessToken,this.refreshToken=e.refreshToken,this.expirationTime=e.expirationTime}_clone(){return Object.assign(new n,this.toJSON())}_performRefresh(){return lt("not implemented")}};function Ut(n,e){U(typeof n=="string"||typeof n>"u","internal-error",{appName:e})}var Bt=class n{constructor(o){var a=o,{uid:e,auth:t,stsTokenManager:r}=a,i=Di(a,["uid","auth","stsTokenManager"]);this.providerId="firebase",this.proactiveRefresh=new Ma(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=e,this.auth=t,this.stsTokenManager=r,this.accessToken=r.accessToken,this.displayName=i.displayName||null,this.email=i.email||null,this.emailVerified=i.emailVerified||!1,this.phoneNumber=i.phoneNumber||null,this.photoURL=i.photoURL||null,this.isAnonymous=i.isAnonymous||!1,this.tenantId=i.tenantId||null,this.providerData=i.providerData?[...i.providerData]:[],this.metadata=new qr(i.createdAt||void 0,i.lastLoginAt||void 0)}getIdToken(e){return _(this,null,function*(){let t=yield On(this,this.stsTokenManager.getToken(this.auth,e));return U(t,this.auth,"internal-error"),this.accessToken!==t&&(this.accessToken=t,yield this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),t})}getIdTokenResult(e){return Df(this,e)}reload(){return Nf(this)}_assign(e){this!==e&&(U(this.uid===e.uid,this.auth,"internal-error"),this.displayName=e.displayName,this.photoURL=e.photoURL,this.email=e.email,this.emailVerified=e.emailVerified,this.phoneNumber=e.phoneNumber,this.isAnonymous=e.isAnonymous,this.tenantId=e.tenantId,this.providerData=e.providerData.map(t=>L({},t)),this.metadata._copy(e.metadata),this.stsTokenManager._assign(e.stsTokenManager))}_clone(e){let t=new n(Z(L({},this),{auth:e,stsTokenManager:this.stsTokenManager._clone()}));return t.metadata._copy(this.metadata),t}_onReload(e){U(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=e,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(e){this.reloadListener?this.reloadListener(e):this.reloadUserInfo=e}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}_updateTokensIfNecessary(e,t=!1){return _(this,null,function*(){let r=!1;e.idToken&&e.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(e),r=!0),t&&(yield ds(this)),yield this.auth._persistUserIfCurrent(this),r&&this.auth._notifyListenersIfCurrent(this)})}delete(){return _(this,null,function*(){if(Oe(this.auth.app))return Promise.reject(cn(this.auth));let e=yield this.getIdToken();return yield On(this,Iv(this.auth,{idToken:e})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()})}toJSON(){return Z(L({uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map(e=>L({},e)),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId},this.metadata.toJSON()),{apiKey:this.auth.config.apiKey,appName:this.auth.name})}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(e,t){let r=t.displayName??void 0,i=t.email??void 0,o=t.phoneNumber??void 0,a=t.photoURL??void 0,u=t.tenantId??void 0,h=t._redirectEventId??void 0,d=t.createdAt??void 0,p=t.lastLoginAt??void 0,{uid:v,emailVerified:w,isAnonymous:R,providerData:k,stsTokenManager:M}=t;U(v&&M,e,"internal-error");let N=Br.fromJSON(this.name,M);U(typeof v=="string",e,"internal-error"),Ut(r,e.name),Ut(i,e.name),U(typeof w=="boolean",e,"internal-error"),U(typeof R=="boolean",e,"internal-error"),Ut(o,e.name),Ut(a,e.name),Ut(u,e.name),Ut(h,e.name),Ut(d,e.name),Ut(p,e.name);let G=new n({uid:v,auth:e,email:i,emailVerified:w,displayName:r,isAnonymous:R,photoURL:a,phoneNumber:o,tenantId:u,stsTokenManager:N,createdAt:d,lastLoginAt:p});return k&&Array.isArray(k)&&(G.providerData=k.map(Q=>L({},Q))),h&&(G._redirectEventId=h),G}static _fromIdTokenResponse(e,t,r=!1){return _(this,null,function*(){let i=new Br;i.updateFromServerResponse(t);let o=new n({uid:t.localId,auth:e,stsTokenManager:i,isAnonymous:r});return yield ds(o),o})}static _fromGetAccountInfoResponse(e,t,r){return _(this,null,function*(){let i=t.users[0];U(i.localId!==void 0,"internal-error");let o=i.providerUserInfo!==void 0?Vf(i.providerUserInfo):[],a=!(i.email&&i.passwordHash)&&!o?.length,u=new Br;u.updateFromIdToken(r);let h=new n({uid:i.localId,auth:e,stsTokenManager:u,isAnonymous:a}),d={uid:i.localId,displayName:i.displayName||null,photoURL:i.photoUrl||null,email:i.email||null,emailVerified:i.emailVerified||!1,phoneNumber:i.phoneNumber||null,tenantId:i.tenantId||null,providerData:o,metadata:new qr(i.createdAt,i.lastLoginAt),isAnonymous:!(i.email&&i.passwordHash)&&!o?.length};return Object.assign(h,d),h})}};var ff=new Map;function ht(n){dt(n instanceof Function,"Expected a class definition");let e=ff.get(n);return e?(dt(e instanceof n,"Instance stored in cache mismatched with class"),e):(e=new n,ff.set(n,e),e)}var bv=(()=>{class n{constructor(){this.type="NONE",this.storage={}}_isAvailable(){return _(this,null,function*(){return!0})}_set(t,r){return _(this,null,function*(){this.storage[t]=r})}_get(t){return _(this,null,function*(){let r=this.storage[t];return r===void 0?null:r})}_remove(t){return _(this,null,function*(){delete this.storage[t]})}_addListener(t,r){}_removeListener(t,r){}}return n.type="NONE",n})(),xa=bv;function os(n,e,t){return`firebase:${n}:${e}:${t}`}var fs=class n{constructor(e,t,r){this.persistence=e,this.auth=t,this.userKey=r;let{config:i,name:o}=this.auth;this.fullUserKey=os(this.userKey,i.apiKey,o),this.fullPersistenceKey=os("persistence",i.apiKey,o),this.boundEventHandler=t._onStorageEvent.bind(t),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(e){return this.persistence._set(this.fullUserKey,e.toJSON())}getCurrentUser(){return _(this,null,function*(){let e=yield this.persistence._get(this.fullUserKey);if(!e)return null;if(typeof e=="string"){let t=yield hs(this.auth,{idToken:e}).catch(()=>{});return t?Bt._fromGetAccountInfoResponse(this.auth,t,e):null}return Bt._fromJSON(this.auth,e)})}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}setPersistence(e){return _(this,null,function*(){if(this.persistence===e)return;let t=yield this.getCurrentUser();if(yield this.removeCurrentUser(),this.persistence=e,t)return this.setCurrentUser(t)})}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static create(e,t,r="authUser"){return _(this,null,function*(){if(!t.length)return new n(ht(xa),e,r);let i=(yield Promise.all(t.map(d=>_(null,null,function*(){if(yield d._isAvailable())return d})))).filter(d=>d),o=i[0]||ht(xa),a=os(r,e.config.apiKey,e.name),u=null;for(let d of t)try{let p=yield d._get(a);if(p){let v;if(typeof p=="string"){let w=yield hs(e,{idToken:p}).catch(()=>{});if(!w)break;v=yield Bt._fromGetAccountInfoResponse(e,w,p)}else v=Bt._fromJSON(e,p);d!==o&&(u=v),o=d;break}}catch{}let h=i.filter(d=>d._shouldAllowMigration);return!o._shouldAllowMigration||!h.length?new n(o,e,r):(o=h[0],u&&(yield o._set(a,u.toJSON())),yield Promise.all(t.map(d=>_(null,null,function*(){if(d!==o)try{yield d._remove(a)}catch{}}))),new n(o,e,r))})}};function pf(n){let e=n.toLowerCase();if(e.includes("opera/")||e.includes("opr/")||e.includes("opios/"))return"Opera";if(xf(e))return"IEMobile";if(e.includes("msie")||e.includes("trident/"))return"IE";if(e.includes("edge/"))return"Edge";if(kf(e))return"Firefox";if(e.includes("silk/"))return"Silk";if(Lf(e))return"Blackberry";if(Uf(e))return"Webos";if(Of(e))return"Safari";if((e.includes("chrome/")||Mf(e))&&!e.includes("edge/"))return"Chrome";if(Ff(e))return"Android";{let t=/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/,r=n.match(t);if(r?.length===2)return r[1]}return"Other"}function kf(n=ge()){return/firefox\//i.test(n)}function Of(n=ge()){let e=n.toLowerCase();return e.includes("safari/")&&!e.includes("chrome/")&&!e.includes("crios/")&&!e.includes("android")}function Mf(n=ge()){return/crios\//i.test(n)}function xf(n=ge()){return/iemobile/i.test(n)}function Ff(n=ge()){return/android/i.test(n)}function Lf(n=ge()){return/blackberry/i.test(n)}function Uf(n=ge()){return/webos/i.test(n)}function Xa(n=ge()){return/iphone|ipad|ipod/i.test(n)||/macintosh/i.test(n)&&/mobile/i.test(n)}function Sv(n=ge()){return Xa(n)&&!!window.navigator?.standalone}function Cv(){return $d()&&document.documentMode===10}function Bf(n=ge()){return Xa(n)||Ff(n)||Uf(n)||Lf(n)||/windows phone/i.test(n)||xf(n)}function qf(n,e=[]){let t;switch(n){case"Browser":t=pf(ge());break;case"Worker":t=`${pf(ge())}-${n}`;break;default:t=n}let r=e.length?e.join(","):"FirebaseCore-web";return`${t}/JsCore/${Lt}/${r}`}var Fa=class{constructor(e){this.auth=e,this.queue=[]}pushCallback(e,t){let r=o=>new Promise((a,u)=>{try{let h=e(o);a(h)}catch(h){u(h)}});r.onAbort=t,this.queue.push(r);let i=this.queue.length-1;return()=>{this.queue[i]=()=>Promise.resolve()}}runMiddleware(e){return _(this,null,function*(){if(this.auth.currentUser===e)return;let t=[];try{for(let r of this.queue)yield r(e),r.onAbort&&t.push(r.onAbort)}catch(r){t.reverse();for(let i of t)try{i()}catch{}throw this.auth._errorFactory.create("login-blocked",{originalMessage:r?.message})}})}};function Rv(t){return _(this,arguments,function*(n,e={}){return hn(n,"GET","/v2/passwordPolicy",Ja(n,e))})}var Pv=6,La=class{constructor(e){let t=e.customStrengthOptions;this.customStrengthOptions={},this.customStrengthOptions.minPasswordLength=t.minPasswordLength??Pv,t.maxPasswordLength&&(this.customStrengthOptions.maxPasswordLength=t.maxPasswordLength),t.containsLowercaseCharacter!==void 0&&(this.customStrengthOptions.containsLowercaseLetter=t.containsLowercaseCharacter),t.containsUppercaseCharacter!==void 0&&(this.customStrengthOptions.containsUppercaseLetter=t.containsUppercaseCharacter),t.containsNumericCharacter!==void 0&&(this.customStrengthOptions.containsNumericCharacter=t.containsNumericCharacter),t.containsNonAlphanumericCharacter!==void 0&&(this.customStrengthOptions.containsNonAlphanumericCharacter=t.containsNonAlphanumericCharacter),this.enforcementState=e.enforcementState,this.enforcementState==="ENFORCEMENT_STATE_UNSPECIFIED"&&(this.enforcementState="OFF"),this.allowedNonAlphanumericCharacters=e.allowedNonAlphanumericCharacters?.join("")??"",this.forceUpgradeOnSignin=e.forceUpgradeOnSignin??!1,this.schemaVersion=e.schemaVersion}validatePassword(e){let t={isValid:!0,passwordPolicy:this};return this.validatePasswordLengthOptions(e,t),this.validatePasswordCharacterOptions(e,t),t.isValid&&(t.isValid=t.meetsMinPasswordLength??!0),t.isValid&&(t.isValid=t.meetsMaxPasswordLength??!0),t.isValid&&(t.isValid=t.containsLowercaseLetter??!0),t.isValid&&(t.isValid=t.containsUppercaseLetter??!0),t.isValid&&(t.isValid=t.containsNumericCharacter??!0),t.isValid&&(t.isValid=t.containsNonAlphanumericCharacter??!0),t}validatePasswordLengthOptions(e,t){let r=this.customStrengthOptions.minPasswordLength,i=this.customStrengthOptions.maxPasswordLength;r&&(t.meetsMinPasswordLength=e.length>=r),i&&(t.meetsMaxPasswordLength=e.length<=i)}validatePasswordCharacterOptions(e,t){this.updatePasswordCharacterOptionsStatuses(t,!1,!1,!1,!1);let r;for(let i=0;i<e.length;i++)r=e.charAt(i),this.updatePasswordCharacterOptionsStatuses(t,r>="a"&&r<="z",r>="A"&&r<="Z",r>="0"&&r<="9",this.allowedNonAlphanumericCharacters.includes(r))}updatePasswordCharacterOptionsStatuses(e,t,r,i,o){this.customStrengthOptions.containsLowercaseLetter&&(e.containsLowercaseLetter||(e.containsLowercaseLetter=t)),this.customStrengthOptions.containsUppercaseLetter&&(e.containsUppercaseLetter||(e.containsUppercaseLetter=r)),this.customStrengthOptions.containsNumericCharacter&&(e.containsNumericCharacter||(e.containsNumericCharacter=i)),this.customStrengthOptions.containsNonAlphanumericCharacter&&(e.containsNonAlphanumericCharacter||(e.containsNonAlphanumericCharacter=o))}};var Ua=class{constructor(e,t,r,i){this.app=e,this.heartbeatServiceProvider=t,this.appCheckServiceProvider=r,this.config=i,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new ps(this),this.idTokenSubscription=new ps(this),this.beforeStateQueue=new Fa(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION=1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=Cf,this._agentRecaptchaConfig=null,this._tenantRecaptchaConfigs={},this._projectPasswordPolicy=null,this._tenantPasswordPolicies={},this._resolvePersistenceManagerAvailable=void 0,this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=e.name,this.clientVersion=i.sdkClientVersion,this._persistenceManagerAvailable=new Promise(o=>this._resolvePersistenceManagerAvailable=o)}_initializeWithPersistence(e,t){return t&&(this._popupRedirectResolver=ht(t)),this._initializationPromise=this.queue(()=>_(this,null,function*(){if(!this._deleted&&(this.persistenceManager=yield fs.create(this,e),this._resolvePersistenceManagerAvailable?.(),!this._deleted)){if(this._popupRedirectResolver?._shouldInitProactively)try{yield this._popupRedirectResolver._initialize(this)}catch{}yield this.initializeCurrentUser(t),this.lastNotifiedUid=this.currentUser?.uid||null,!this._deleted&&(this._isInitialized=!0)}})),this._initializationPromise}_onStorageEvent(){return _(this,null,function*(){if(this._deleted)return;let e=yield this.assertedPersistence.getCurrentUser();if(!(!this.currentUser&&!e)){if(this.currentUser&&e&&this.currentUser.uid===e.uid){this._currentUser._assign(e),yield this.currentUser.getIdToken();return}yield this._updateCurrentUser(e,!0)}})}initializeCurrentUserFromIdToken(e){return _(this,null,function*(){try{let t=yield hs(this,{idToken:e}),r=yield Bt._fromGetAccountInfoResponse(this,t,e);yield this.directlySetCurrentUser(r)}catch(t){console.warn("FirebaseServerApp could not login user with provided authIdToken: ",t),yield this.directlySetCurrentUser(null)}})}initializeCurrentUser(e){return _(this,null,function*(){if(Oe(this.app)){let o=this.app.settings.authIdToken;return o?new Promise(a=>{setTimeout(()=>this.initializeCurrentUserFromIdToken(o).then(a,a))}):this.directlySetCurrentUser(null)}let t=yield this.assertedPersistence.getCurrentUser(),r=t,i=!1;if(e&&this.config.authDomain){yield this.getOrInitRedirectPersistenceManager();let o=this.redirectUser?._redirectEventId,a=r?._redirectEventId,u=yield this.tryRedirectSignIn(e);(!o||o===a)&&u?.user&&(r=u.user,i=!0)}if(!r)return this.directlySetCurrentUser(null);if(!r._redirectEventId){if(i)try{yield this.beforeStateQueue.runMiddleware(r)}catch(o){r=t,this._popupRedirectResolver._overrideRedirectResult(this,()=>Promise.reject(o))}return r?this.reloadAndSetCurrentUserOrClear(r):this.directlySetCurrentUser(null)}return U(this._popupRedirectResolver,this,"argument-error"),yield this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===r._redirectEventId?this.directlySetCurrentUser(r):this.reloadAndSetCurrentUserOrClear(r)})}tryRedirectSignIn(e){return _(this,null,function*(){let t=null;try{t=yield this._popupRedirectResolver._completeRedirectFn(this,e,!0)}catch{yield this._setRedirectUser(null)}return t})}reloadAndSetCurrentUserOrClear(e){return _(this,null,function*(){try{yield ds(e)}catch(t){if(t?.code!=="auth/network-request-failed")return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(e)})}useDeviceLanguage(){this.languageCode=mv()}_delete(){return _(this,null,function*(){this._deleted=!0})}updateCurrentUser(e){return _(this,null,function*(){if(Oe(this.app))return Promise.reject(cn(this));let t=e?ae(e):null;return t&&U(t.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(t&&t._clone(this))})}_updateCurrentUser(e,t=!1){return _(this,null,function*(){if(!this._deleted)return e&&U(this.tenantId===e.tenantId,this,"tenant-id-mismatch"),t||(yield this.beforeStateQueue.runMiddleware(e)),this.queue(()=>_(this,null,function*(){yield this.directlySetCurrentUser(e),this.notifyAuthListeners()}))})}signOut(){return _(this,null,function*(){return Oe(this.app)?Promise.reject(cn(this)):(yield this.beforeStateQueue.runMiddleware(null),(this.redirectPersistenceManager||this._popupRedirectResolver)&&(yield this._setRedirectUser(null)),this._updateCurrentUser(null,!0))})}setPersistence(e){return Oe(this.app)?Promise.reject(cn(this)):this.queue(()=>_(this,null,function*(){yield this.assertedPersistence.setPersistence(ht(e))}))}_getRecaptchaConfig(){return this.tenantId==null?this._agentRecaptchaConfig:this._tenantRecaptchaConfigs[this.tenantId]}validatePassword(e){return _(this,null,function*(){this._getPasswordPolicyInternal()||(yield this._updatePasswordPolicy());let t=this._getPasswordPolicyInternal();return t.schemaVersion!==this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION?Promise.reject(this._errorFactory.create("unsupported-password-policy-schema-version",{})):t.validatePassword(e)})}_getPasswordPolicyInternal(){return this.tenantId===null?this._projectPasswordPolicy:this._tenantPasswordPolicies[this.tenantId]}_updatePasswordPolicy(){return _(this,null,function*(){let e=yield Rv(this),t=new La(e);this.tenantId===null?this._projectPasswordPolicy=t:this._tenantPasswordPolicies[this.tenantId]=t})}_getPersistenceType(){return this.assertedPersistence.persistence.type}_getPersistence(){return this.assertedPersistence.persistence}_updateErrorMap(e){this._errorFactory=new at("auth","Firebase",e())}onAuthStateChanged(e,t,r){return this.registerStateListener(this.authStateSubscription,e,t,r)}beforeAuthStateChanged(e,t){return this.beforeStateQueue.pushCallback(e,t)}onIdTokenChanged(e,t,r){return this.registerStateListener(this.idTokenSubscription,e,t,r)}authStateReady(){return new Promise((e,t)=>{if(this.currentUser)e();else{let r=this.onAuthStateChanged(()=>{r(),e()},t)}})}revokeAccessToken(e){return _(this,null,function*(){if(this.currentUser){let t=yield this.currentUser.getIdToken(),r={providerId:"apple.com",tokenType:"ACCESS_TOKEN",token:e,idToken:t};this.tenantId!=null&&(r.tenantId=this.tenantId),yield Av(this,r)}})}toJSON(){return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:this._currentUser?.toJSON()}}_setRedirectUser(e,t){return _(this,null,function*(){let r=yield this.getOrInitRedirectPersistenceManager(t);return e===null?r.removeCurrentUser():r.setCurrentUser(e)})}getOrInitRedirectPersistenceManager(e){return _(this,null,function*(){if(!this.redirectPersistenceManager){let t=e&&ht(e)||this._popupRedirectResolver;U(t,this,"argument-error"),this.redirectPersistenceManager=yield fs.create(this,[ht(t._redirectPersistence)],"redirectUser"),this.redirectUser=yield this.redirectPersistenceManager.getCurrentUser()}return this.redirectPersistenceManager})}_redirectUserForId(e){return _(this,null,function*(){return this._isInitialized&&(yield this.queue(()=>_(this,null,function*(){}))),this._currentUser?._redirectEventId===e?this._currentUser:this.redirectUser?._redirectEventId===e?this.redirectUser:null})}_persistUserIfCurrent(e){return _(this,null,function*(){if(e===this.currentUser)return this.queue(()=>_(this,null,function*(){return this.directlySetCurrentUser(e)}))})}_notifyListenersIfCurrent(e){e===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);let e=this.currentUser?.uid??null;this.lastNotifiedUid!==e&&(this.lastNotifiedUid=e,this.authStateSubscription.next(this.currentUser))}registerStateListener(e,t,r,i){if(this._deleted)return()=>{};let o=typeof t=="function"?t:t.next.bind(t),a=!1,u=this._isInitialized?Promise.resolve():this._initializationPromise;if(U(u,this,"internal-error"),u.then(()=>{a||o(this.currentUser)}),typeof t=="function"){let h=e.addObserver(t,r,i);return()=>{a=!0,h()}}else{let h=e.addObserver(t);return()=>{a=!0,h()}}}directlySetCurrentUser(e){return _(this,null,function*(){this.currentUser&&this.currentUser!==e&&this._currentUser._stopProactiveRefresh(),e&&this.isProactiveRefreshEnabled&&e._startProactiveRefresh(),this.currentUser=e,e?yield this.assertedPersistence.setCurrentUser(e):yield this.assertedPersistence.removeCurrentUser()})}queue(e){return this.operations=this.operations.then(e,e),this.operations}get assertedPersistence(){return U(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(e){!e||this.frameworks.includes(e)||(this.frameworks.push(e),this.frameworks.sort(),this.clientVersion=qf(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}_getAdditionalHeaders(){return _(this,null,function*(){let e={"X-Client-Version":this.clientVersion};this.app.options.appId&&(e["X-Firebase-gmpid"]=this.app.options.appId);let t=yield this.heartbeatServiceProvider.getImmediate({optional:!0})?.getHeartbeatsHeader();t&&(e["X-Firebase-Client"]=t);let r=yield this._getAppCheckToken();return r&&(e["X-Firebase-AppCheck"]=r),e})}_getAppCheckToken(){return _(this,null,function*(){if(Oe(this.app)&&this.app.settings.appCheckToken)return this.app.settings.appCheckToken;let e=yield this.appCheckServiceProvider.getImmediate({optional:!0})?.getToken();return e?.error&&hv(`Error while retrieving App Check token: ${e.error}`),e?.token})}};function Es(n){return ae(n)}var ps=class{constructor(e){this.auth=e,this.observer=null,this.addObserver=Qd(t=>this.observer=t)}get next(){return U(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}};var Za={loadJS(){return _(this,null,function*(){throw new Error("Unable to load external scripts")})},recaptchaV2Script:"",recaptchaEnterpriseScript:"",gapiScript:""};function Dv(n){Za=n}function Nv(n){return Za.loadJS(n)}function Vv(){return Za.gapiScript}function jf(n){return`__${n}${Math.floor(Math.random()*1e6)}`}function Gf(n,e){let t=Lr(n,"auth");if(t.isInitialized()){let i=t.getImmediate(),o=t.getOptions();if(Je(o,e??{}))return i;Ze(i,"already-initialized")}return t.initialize({options:e})}function kv(n,e){let t=e?.persistence||[],r=(Array.isArray(t)?t:[t]).map(ht);e?.errorMap&&n._updateErrorMap(e.errorMap),n._initializeWithPersistence(r,e?.popupRedirectResolver)}function zf(n,e,t){let r=Es(n);U(/^https?:\/\//.test(e),r,"invalid-emulator-scheme");let i=!!t?.disableWarnings,o=$f(e),{host:a,port:u}=Ov(e),h=u===null?"":`:${u}`,d={url:`${o}//${a}${h}/`},p=Object.freeze({host:a,port:u,protocol:o.replace(":",""),options:Object.freeze({disableWarnings:i})});if(!r._canInitEmulator){U(r.config.emulator&&r.emulatorConfig,r,"emulator-config-failed"),U(Je(d,r.config.emulator)&&Je(p,r.emulatorConfig),r,"emulator-config-failed");return}r.config.emulator=d,r.emulatorConfig=p,r.settings.appVerificationDisabledForTesting=!0,Ot(a)?(Xi(`${o}//${a}${h}`),Zi("Auth",!0)):i||Mv()}function $f(n){let e=n.indexOf(":");return e<0?"":n.substr(0,e+1)}function Ov(n){let e=$f(n),t=/(\/\/)?([^?#/]+)/.exec(n.substr(e.length));if(!t)return{host:"",port:null};let r=t[2].split("@").pop()||"",i=/^(\[[^\]]+\])(:|$)/.exec(r);if(i){let o=i[1];return{host:o,port:mf(r.substr(o.length+1))}}else{let[o,a]=r.split(":");return{host:o,port:mf(a)}}}function mf(n){if(!n)return null;let e=Number(n);return isNaN(e)?null:e}function Mv(){function n(){let e=document.createElement("p"),t=e.style;e.innerText="Running in emulator mode. Do not use with production credentials.",t.position="fixed",t.width="100%",t.backgroundColor="#ffffff",t.border=".1em solid #000000",t.color="#b50000",t.bottom="0px",t.left="0px",t.margin="0px",t.zIndex="10000",t.textAlign="center",e.classList.add("firebase-emulator-warning"),document.body.appendChild(e)}typeof console<"u"&&typeof console.info=="function"&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials."),typeof window<"u"&&typeof document<"u"&&(document.readyState==="loading"?window.addEventListener("DOMContentLoaded",n):n())}var jr=class{constructor(e,t){this.providerId=e,this.signInMethod=t}toJSON(){return lt("not implemented")}_getIdTokenResponse(e){return lt("not implemented")}_linkToIdToken(e,t){return lt("not implemented")}_getReauthenticationResolver(e){return lt("not implemented")}};function kn(n,e){return _(this,null,function*(){return vv(n,"POST","/v1/accounts:signInWithIdp",Ja(n,e))})}var xv="http://localhost",ms=class n extends jr{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(e){let t=new n(e.providerId,e.signInMethod);return e.idToken||e.accessToken?(e.idToken&&(t.idToken=e.idToken),e.accessToken&&(t.accessToken=e.accessToken),e.nonce&&!e.pendingToken&&(t.nonce=e.nonce),e.pendingToken&&(t.pendingToken=e.pendingToken)):e.oauthToken&&e.oauthTokenSecret?(t.accessToken=e.oauthToken,t.secret=e.oauthTokenSecret):Ze("argument-error"),t}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(e){let u=typeof e=="string"?JSON.parse(e):e,{providerId:r,signInMethod:i}=u,o=Di(u,["providerId","signInMethod"]);if(!r||!i)return null;let a=new n(r,i);return a.idToken=o.idToken||void 0,a.accessToken=o.accessToken||void 0,a.secret=o.secret,a.nonce=o.nonce,a.pendingToken=o.pendingToken||null,a}_getIdTokenResponse(e){let t=this.buildRequest();return kn(e,t)}_linkToIdToken(e,t){let r=this.buildRequest();return r.idToken=t,kn(e,r)}_getReauthenticationResolver(e){let t=this.buildRequest();return t.autoCreate=!1,kn(e,t)}buildRequest(){let e={requestUri:xv,returnSecureToken:!0};if(this.pendingToken)e.pendingToken=this.pendingToken;else{let t={};this.idToken&&(t.id_token=this.idToken),this.accessToken&&(t.access_token=this.accessToken),this.secret&&(t.oauth_token_secret=this.secret),t.providerId=this.providerId,this.nonce&&!this.pendingToken&&(t.nonce=this.nonce),e.postBody=Vn(t)}return e}};var Gr=class{constructor(e){this.providerId=e,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(e){this.defaultLanguageCode=e}setCustomParameters(e){return this.customParameters=e,this}getCustomParameters(){return this.customParameters}};var gs=class extends Gr{constructor(){super(...arguments),this.scopes=[]}addScope(e){return this.scopes.includes(e)||this.scopes.push(e),this}getScopes(){return[...this.scopes]}};var ec=(()=>{class n extends gs{constructor(){super("google.com"),this.addScope("profile")}static credential(t,r){return ms._fromParams({providerId:n.PROVIDER_ID,signInMethod:n.GOOGLE_SIGN_IN_METHOD,idToken:t,accessToken:r})}static credentialFromResult(t){return n.credentialFromTaggedObject(t)}static credentialFromError(t){return n.credentialFromTaggedObject(t.customData||{})}static credentialFromTaggedObject({_tokenResponse:t}){if(!t)return null;let{oauthIdToken:r,oauthAccessToken:i}=t;if(!r&&!i)return null;try{return n.credential(r,i)}catch{return null}}}n.GOOGLE_SIGN_IN_METHOD="google.com",n.PROVIDER_ID="google.com";return n})();var zr=class n{constructor(e){this.user=e.user,this.providerId=e.providerId,this._tokenResponse=e._tokenResponse,this.operationType=e.operationType}static _fromIdTokenResponse(e,t,r,i=!1){return _(this,null,function*(){let o=yield Bt._fromIdTokenResponse(e,r,i),a=gf(r);return new n({user:o,providerId:a,_tokenResponse:r,operationType:t})})}static _forOperation(e,t,r){return _(this,null,function*(){yield e._updateTokensIfNecessary(r,!0);let i=gf(r);return new n({user:e,providerId:i,_tokenResponse:r,operationType:t})})}};function gf(n){return n.providerId?n.providerId:"phoneNumber"in n?"phone":null}var Ba=class n extends ke{constructor(e,t,r,i){super(t.code,t.message),this.operationType=r,this.user=i,Object.setPrototypeOf(this,n.prototype),this.customData={appName:e.name,tenantId:e.tenantId??void 0,_serverResponse:t.customData._serverResponse,operationType:r}}static _fromErrorAndOperation(e,t,r,i){return new n(e,t,r,i)}};function Hf(n,e,t,r){return(e==="reauthenticate"?t._getReauthenticationResolver(n):t._getIdTokenResponse(n)).catch(o=>{throw o.code==="auth/multi-factor-auth-required"?Ba._fromErrorAndOperation(n,o,e,r):o})}function Fv(n,e,t=!1){return _(this,null,function*(){let r=yield On(n,e._linkToIdToken(n.auth,yield n.getIdToken()),t);return zr._forOperation(n,"link",r)})}function Lv(n,e,t=!1){return _(this,null,function*(){let{auth:r}=n;if(Oe(r.app))return Promise.reject(cn(r));let i="reauthenticate";try{let o=yield On(n,Hf(r,i,e,n),t);U(o.idToken,r,"internal-error");let a=Ya(o.idToken);U(a,r,"internal-error");let{sub:u}=a;return U(n.uid===u,r,"user-mismatch"),zr._forOperation(n,i,o)}catch(o){throw o?.code==="auth/user-not-found"&&Ze(r,"user-mismatch"),o}})}function Uv(n,e,t=!1){return _(this,null,function*(){if(Oe(n.app))return Promise.reject(cn(n));let r="signIn",i=yield Hf(n,r,e),o=yield zr._fromIdTokenResponse(n,r,i);return t||(yield n._updateCurrentUser(o.user)),o})}function Bv(n,e){return _(this,null,function*(){return hn(n,"POST","/v1/accounts:update",e)})}function tc(r,i){return _(this,arguments,function*(n,{displayName:e,photoURL:t}){if(e===void 0&&t===void 0)return;let o=ae(n),u={idToken:yield o.getIdToken(),displayName:e,photoUrl:t,returnSecureToken:!0},h=yield On(o,Bv(o.auth,u));o.displayName=h.displayName||null,o.photoURL=h.photoUrl||null;let d=o.providerData.find(({providerId:p})=>p==="password");d&&(d.displayName=o.displayName,d.photoURL=o.photoURL),yield o._updateTokensIfNecessary(h)})}function Wf(n,e,t,r){return ae(n).onIdTokenChanged(e,t,r)}function Kf(n,e,t){return ae(n).beforeAuthStateChanged(e,t)}function nc(n,e,t,r){return ae(n).onAuthStateChanged(e,t,r)}function rc(n){return ae(n).signOut()}var _s="__sak";var ys=class{constructor(e,t){this.storageRetriever=e,this.type=t}_isAvailable(){try{return this.storage?(this.storage.setItem(_s,"1"),this.storage.removeItem(_s),Promise.resolve(!0)):Promise.resolve(!1)}catch{return Promise.resolve(!1)}}_set(e,t){return this.storage.setItem(e,JSON.stringify(t)),Promise.resolve()}_get(e){let t=this.storage.getItem(e);return Promise.resolve(t?JSON.parse(t):null)}_remove(e){return this.storage.removeItem(e),Promise.resolve()}get storage(){return this.storageRetriever()}};var qv=1e3,jv=10,Gv=(()=>{class n extends ys{constructor(){super(()=>window.localStorage,"LOCAL"),this.boundEventHandler=(t,r)=>this.onStorageEvent(t,r),this.listeners={},this.localCache={},this.pollTimer=null,this.fallbackToPolling=Bf(),this._shouldAllowMigration=!0}forAllChangedKeys(t){for(let r of Object.keys(this.listeners)){let i=this.storage.getItem(r),o=this.localCache[r];i!==o&&t(r,o,i)}}onStorageEvent(t,r=!1){if(!t.key){this.forAllChangedKeys((u,h,d)=>{this.notifyListeners(u,d)});return}let i=t.key;r?this.detachListener():this.stopPolling();let o=()=>{let u=this.storage.getItem(i);!r&&this.localCache[i]===u||this.notifyListeners(i,u)},a=this.storage.getItem(i);Cv()&&a!==t.newValue&&t.newValue!==t.oldValue?setTimeout(o,jv):o()}notifyListeners(t,r){this.localCache[t]=r;let i=this.listeners[t];if(i)for(let o of Array.from(i))o(r&&JSON.parse(r))}startPolling(){this.stopPolling(),this.pollTimer=setInterval(()=>{this.forAllChangedKeys((t,r,i)=>{this.onStorageEvent(new StorageEvent("storage",{key:t,oldValue:r,newValue:i}),!0)})},qv)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(t,r){Object.keys(this.listeners).length===0&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[t]||(this.listeners[t]=new Set,this.localCache[t]=this.storage.getItem(t)),this.listeners[t].add(r)}_removeListener(t,r){this.listeners[t]&&(this.listeners[t].delete(r),this.listeners[t].size===0&&delete this.listeners[t]),Object.keys(this.listeners).length===0&&(this.detachListener(),this.stopPolling())}_set(t,r){return _(this,null,function*(){yield Pt(n.prototype,this,"_set").call(this,t,r),this.localCache[t]=JSON.stringify(r)})}_get(t){return _(this,null,function*(){let r=yield Pt(n.prototype,this,"_get").call(this,t);return this.localCache[t]=JSON.stringify(r),r})}_remove(t){return _(this,null,function*(){yield Pt(n.prototype,this,"_remove").call(this,t),delete this.localCache[t]})}}return n.type="LOCAL",n})(),Qf=Gv;var zv=(()=>{class n extends ys{constructor(){super(()=>window.sessionStorage,"SESSION")}_addListener(t,r){}_removeListener(t,r){}}return n.type="SESSION",n})(),ic=zv;function $v(n){return Promise.all(n.map(e=>_(null,null,function*(){try{return{fulfilled:!0,value:yield e}}catch(t){return{fulfilled:!1,reason:t}}})))}var Hv=(()=>{class n{constructor(t){this.eventTarget=t,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(t){let r=this.receivers.find(o=>o.isListeningto(t));if(r)return r;let i=new n(t);return this.receivers.push(i),i}isListeningto(t){return this.eventTarget===t}handleEvent(t){return _(this,null,function*(){let r=t,{eventId:i,eventType:o,data:a}=r.data,u=this.handlersMap[o];if(!u?.size)return;r.ports[0].postMessage({status:"ack",eventId:i,eventType:o});let h=Array.from(u).map(p=>_(this,null,function*(){return p(r.origin,a)})),d=yield $v(h);r.ports[0].postMessage({status:"done",eventId:i,eventType:o,response:d})})}_subscribe(t,r){Object.keys(this.handlersMap).length===0&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[t]||(this.handlersMap[t]=new Set),this.handlersMap[t].add(r)}_unsubscribe(t,r){this.handlersMap[t]&&r&&this.handlersMap[t].delete(r),(!r||this.handlersMap[t].size===0)&&delete this.handlersMap[t],Object.keys(this.handlersMap).length===0&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}n.receivers=[];return n})();function sc(n="",e=10){let t="";for(let r=0;r<e;r++)t+=Math.floor(Math.random()*10);return n+t}var qa=class{constructor(e){this.target=e,this.handlers=new Set}removeMessageHandler(e){e.messageChannel&&(e.messageChannel.port1.removeEventListener("message",e.onMessage),e.messageChannel.port1.close()),this.handlers.delete(e)}_send(e,t,r=50){return _(this,null,function*(){let i=typeof MessageChannel<"u"?new MessageChannel:null;if(!i)throw new Error("connection_unavailable");let o,a;return new Promise((u,h)=>{let d=sc("",20);i.port1.start();let p=setTimeout(()=>{h(new Error("unsupported_event"))},r);a={messageChannel:i,onMessage(v){let w=v;if(w.data.eventId===d)switch(w.data.status){case"ack":clearTimeout(p),o=setTimeout(()=>{h(new Error("timeout"))},3e3);break;case"done":clearTimeout(o),u(w.data.response);break;default:clearTimeout(p),clearTimeout(o),h(new Error("invalid_response"));break}}},this.handlers.add(a),i.port1.addEventListener("message",a.onMessage),this.target.postMessage({eventType:e,eventId:d,data:t},[i.port2])}).finally(()=>{a&&this.removeMessageHandler(a)})})}};function Xe(){return window}function Wv(n){Xe().location.href=n}function Jf(){return typeof Xe().WorkerGlobalScope<"u"&&typeof Xe().importScripts=="function"}function Kv(){return _(this,null,function*(){if(!navigator?.serviceWorker)return null;try{return(yield navigator.serviceWorker.ready).active}catch{return null}})}function Qv(){return navigator?.serviceWorker?.controller||null}function Jv(){return Jf()?self:null}var Yf="firebaseLocalStorageDb",Yv=1,vs="firebaseLocalStorage",Xf="fbase_key",ln=class{constructor(e){this.request=e}toPromise(){return new Promise((e,t)=>{this.request.addEventListener("success",()=>{e(this.request.result)}),this.request.addEventListener("error",()=>{t(this.request.error)})})}};function Ts(n,e){return n.transaction([vs],e?"readwrite":"readonly").objectStore(vs)}function Xv(){let n=indexedDB.deleteDatabase(Yf);return new ln(n).toPromise()}function ja(){let n=indexedDB.open(Yf,Yv);return new Promise((e,t)=>{n.addEventListener("error",()=>{t(n.error)}),n.addEventListener("upgradeneeded",()=>{let r=n.result;try{r.createObjectStore(vs,{keyPath:Xf})}catch(i){t(i)}}),n.addEventListener("success",()=>_(null,null,function*(){let r=n.result;r.objectStoreNames.contains(vs)?e(r):(r.close(),yield Xv(),e(yield ja()))}))})}function _f(n,e,t){return _(this,null,function*(){let r=Ts(n,!0).put({[Xf]:e,value:t});return new ln(r).toPromise()})}function Zv(n,e){return _(this,null,function*(){let t=Ts(n,!1).get(e),r=yield new ln(t).toPromise();return r===void 0?null:r.value})}function yf(n,e){let t=Ts(n,!0).delete(e);return new ln(t).toPromise()}var eI=800,tI=3,nI=(()=>{class n{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then(()=>{},()=>{})}_openDb(){return _(this,null,function*(){return this.db?this.db:(this.db=yield ja(),this.db)})}_withRetries(t){return _(this,null,function*(){let r=0;for(;;)try{let i=yield this._openDb();return yield t(i)}catch(i){if(r++>tI)throw i;this.db&&(this.db.close(),this.db=void 0)}})}initializeServiceWorkerMessaging(){return _(this,null,function*(){return Jf()?this.initializeReceiver():this.initializeSender()})}initializeReceiver(){return _(this,null,function*(){this.receiver=Hv._getInstance(Jv()),this.receiver._subscribe("keyChanged",(t,r)=>_(this,null,function*(){return{keyProcessed:(yield this._poll()).includes(r.key)}})),this.receiver._subscribe("ping",(t,r)=>_(this,null,function*(){return["keyChanged"]}))})}initializeSender(){return _(this,null,function*(){if(this.activeServiceWorker=yield Kv(),!this.activeServiceWorker)return;this.sender=new qa(this.activeServiceWorker);let t=yield this.sender._send("ping",{},800);t&&t[0]?.fulfilled&&t[0]?.value.includes("keyChanged")&&(this.serviceWorkerReceiverAvailable=!0)})}notifyServiceWorker(t){return _(this,null,function*(){if(!(!this.sender||!this.activeServiceWorker||Qv()!==this.activeServiceWorker))try{yield this.sender._send("keyChanged",{key:t},this.serviceWorkerReceiverAvailable?800:50)}catch{}})}_isAvailable(){return _(this,null,function*(){try{if(!indexedDB)return!1;let t=yield ja();return yield _f(t,_s,"1"),yield yf(t,_s),!0}catch{}return!1})}_withPendingWrite(t){return _(this,null,function*(){this.pendingWrites++;try{yield t()}finally{this.pendingWrites--}})}_set(t,r){return _(this,null,function*(){return this._withPendingWrite(()=>_(this,null,function*(){return yield this._withRetries(i=>_f(i,t,r)),this.localCache[t]=r,this.notifyServiceWorker(t)}))})}_get(t){return _(this,null,function*(){let r=yield this._withRetries(i=>Zv(i,t));return this.localCache[t]=r,r})}_remove(t){return _(this,null,function*(){return this._withPendingWrite(()=>_(this,null,function*(){return yield this._withRetries(r=>yf(r,t)),delete this.localCache[t],this.notifyServiceWorker(t)}))})}_poll(){return _(this,null,function*(){let t=yield this._withRetries(o=>{let a=Ts(o,!1).getAll();return new ln(a).toPromise()});if(!t)return[];if(this.pendingWrites!==0)return[];let r=[],i=new Set;if(t.length!==0)for(let{fbase_key:o,value:a}of t)i.add(o),JSON.stringify(this.localCache[o])!==JSON.stringify(a)&&(this.notifyListeners(o,a),r.push(o));for(let o of Object.keys(this.localCache))this.localCache[o]&&!i.has(o)&&(this.notifyListeners(o,null),r.push(o));return r})}notifyListeners(t,r){this.localCache[t]=r;let i=this.listeners[t];if(i)for(let o of Array.from(i))o(r)}startPolling(){this.stopPolling(),this.pollTimer=setInterval(()=>_(this,null,function*(){return this._poll()}),eI)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(t,r){Object.keys(this.listeners).length===0&&this.startPolling(),this.listeners[t]||(this.listeners[t]=new Set,this._get(t)),this.listeners[t].add(r)}_removeListener(t,r){this.listeners[t]&&(this.listeners[t].delete(r),this.listeners[t].size===0&&delete this.listeners[t]),Object.keys(this.listeners).length===0&&this.stopPolling()}}return n.type="LOCAL",n})(),Zf=nI;var dA=jf("rcb"),fA=new un(3e4,6e4);function ep(n,e){return e?ht(e):(U(n._popupRedirectResolver,n,"argument-error"),n._popupRedirectResolver)}var $r=class extends jr{constructor(e){super("custom","custom"),this.params=e}_getIdTokenResponse(e){return kn(e,this._buildIdpRequest())}_linkToIdToken(e,t){return kn(e,this._buildIdpRequest(t))}_getReauthenticationResolver(e){return kn(e,this._buildIdpRequest())}_buildIdpRequest(e){let t={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return e&&(t.idToken=e),t}};function rI(n){return Uv(n.auth,new $r(n),n.bypassAuthState)}function iI(n){let{auth:e,user:t}=n;return U(t,e,"internal-error"),Lv(t,new $r(n),n.bypassAuthState)}function sI(n){return _(this,null,function*(){let{auth:e,user:t}=n;return U(t,e,"internal-error"),Fv(t,new $r(n),n.bypassAuthState)})}var Is=class{constructor(e,t,r,i,o=!1){this.auth=e,this.resolver=r,this.user=i,this.bypassAuthState=o,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(t)?t:[t]}execute(){return new Promise((e,t)=>_(this,null,function*(){this.pendingPromise={resolve:e,reject:t};try{this.eventManager=yield this.resolver._initialize(this.auth),yield this.onExecution(),this.eventManager.registerConsumer(this)}catch(r){this.reject(r)}}))}onAuthEvent(e){return _(this,null,function*(){let{urlResponse:t,sessionId:r,postBody:i,tenantId:o,error:a,type:u}=e;if(a){this.reject(a);return}let h={auth:this.auth,requestUri:t,sessionId:r,tenantId:o||void 0,postBody:i||void 0,user:this.user,bypassAuthState:this.bypassAuthState};try{this.resolve(yield this.getIdpTask(u)(h))}catch(d){this.reject(d)}})}onError(e){this.reject(e)}getIdpTask(e){switch(e){case"signInViaPopup":case"signInViaRedirect":return rI;case"linkViaPopup":case"linkViaRedirect":return sI;case"reauthViaPopup":case"reauthViaRedirect":return iI;default:Ze(this.auth,"internal-error")}}resolve(e){dt(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.resolve(e),this.unregisterAndCleanUp()}reject(e){dt(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.reject(e),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}};var oI=new un(2e3,1e4);function oc(n,e,t){return _(this,null,function*(){if(Oe(n.app))return Promise.reject(qe(n,"operation-not-supported-in-this-environment"));let r=Es(n);dv(n,e,Gr);let i=ep(r,t);return new aI(r,"signInViaPopup",e,i).executeNotNull()})}var aI=(()=>{class n extends Is{constructor(t,r,i,o,a){super(t,r,o,a),this.provider=i,this.authWindow=null,this.pollId=null,n.currentPopupAction&&n.currentPopupAction.cancel(),n.currentPopupAction=this}executeNotNull(){return _(this,null,function*(){let t=yield this.execute();return U(t,this.auth,"internal-error"),t})}onExecution(){return _(this,null,function*(){dt(this.filter.length===1,"Popup operations only handle one event");let t=sc();this.authWindow=yield this.resolver._openPopup(this.auth,this.provider,this.filter[0],t),this.authWindow.associatedEvent=t,this.resolver._originValidation(this.auth).catch(r=>{this.reject(r)}),this.resolver._isIframeWebStorageSupported(this.auth,r=>{r||this.reject(qe(this.auth,"web-storage-unsupported"))}),this.pollUserCancellation()})}get eventId(){return this.authWindow?.associatedEvent||null}cancel(){this.reject(qe(this.auth,"cancelled-popup-request"))}cleanUp(){this.authWindow&&this.authWindow.close(),this.pollId&&window.clearTimeout(this.pollId),this.authWindow=null,this.pollId=null,n.currentPopupAction=null}pollUserCancellation(){let t=()=>{if(this.authWindow?.window?.closed){this.pollId=window.setTimeout(()=>{this.pollId=null,this.reject(qe(this.auth,"popup-closed-by-user"))},8e3);return}this.pollId=window.setTimeout(t,oI.get())};t()}}n.currentPopupAction=null;return n})(),cI="pendingRedirect",as=new Map,Ga=class n extends Is{constructor(e,t,r=!1){super(e,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],t,void 0,r),this.eventId=null}execute(){return _(this,null,function*(){let e=as.get(this.auth._key());if(!e){try{let r=(yield uI(this.resolver,this.auth))?yield Pt(n.prototype,this,"execute").call(this):null;e=()=>Promise.resolve(r)}catch(t){e=()=>Promise.reject(t)}as.set(this.auth._key(),e)}return this.bypassAuthState||as.set(this.auth._key(),()=>Promise.resolve(null)),e()})}onAuthEvent(e){return _(this,null,function*(){if(e.type==="signInViaRedirect")return Pt(n.prototype,this,"onAuthEvent").call(this,e);if(e.type==="unknown"){this.resolve(null);return}if(e.eventId){let t=yield this.auth._redirectUserForId(e.eventId);if(t)return this.user=t,Pt(n.prototype,this,"onAuthEvent").call(this,e);this.resolve(null)}})}onExecution(){return _(this,null,function*(){})}cleanUp(){}};function uI(n,e){return _(this,null,function*(){let t=dI(e),r=hI(n);if(!(yield r._isAvailable()))return!1;let i=(yield r._get(t))==="true";return yield r._remove(t),i})}function lI(n,e){as.set(n._key(),e)}function hI(n){return ht(n._redirectPersistence)}function dI(n){return os(cI,n.config.apiKey,n.name)}function fI(n,e,t=!1){return _(this,null,function*(){if(Oe(n.app))return Promise.reject(cn(n));let r=Es(n),i=ep(r,e),a=yield new Ga(r,i,t).execute();return a&&!t&&(delete a.user._redirectEventId,yield r._persistUserIfCurrent(a.user),yield r._setRedirectUser(null,e)),a})}var pI=600*1e3,za=class{constructor(e){this.auth=e,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(e){this.consumers.add(e),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,e)&&(this.sendToConsumer(this.queuedRedirectEvent,e),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(e){this.consumers.delete(e)}onEvent(e){if(this.hasEventBeenHandled(e))return!1;let t=!1;return this.consumers.forEach(r=>{this.isEventForConsumer(e,r)&&(t=!0,this.sendToConsumer(e,r),this.saveEventToCache(e))}),this.hasHandledPotentialRedirect||!mI(e)||(this.hasHandledPotentialRedirect=!0,t||(this.queuedRedirectEvent=e,t=!0)),t}sendToConsumer(e,t){if(e.error&&!tp(e)){let r=e.error.code?.split("auth/")[1]||"internal-error";t.onError(qe(this.auth,r))}else t.onAuthEvent(e)}isEventForConsumer(e,t){let r=t.eventId===null||!!e.eventId&&e.eventId===t.eventId;return t.filter.includes(e.type)&&r}hasEventBeenHandled(e){return Date.now()-this.lastProcessedEventTime>=pI&&this.cachedEventUids.clear(),this.cachedEventUids.has(vf(e))}saveEventToCache(e){this.cachedEventUids.add(vf(e)),this.lastProcessedEventTime=Date.now()}};function vf(n){return[n.type,n.eventId,n.sessionId,n.tenantId].filter(e=>e).join("-")}function tp({type:n,error:e}){return n==="unknown"&&e?.code==="auth/no-auth-event"}function mI(n){switch(n.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return tp(n);default:return!1}}function gI(t){return _(this,arguments,function*(n,e={}){return hn(n,"GET","/v1/projects",e)})}var _I=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,yI=/^https?/;function vI(n){return _(this,null,function*(){if(n.config.emulator)return;let{authorizedDomains:e}=yield gI(n);for(let t of e)try{if(II(t))return}catch{}Ze(n,"unauthorized-domain")})}function II(n){let e=ka(),{protocol:t,hostname:r}=new URL(e);if(n.startsWith("chrome-extension://")){let a=new URL(n);return a.hostname===""&&r===""?t==="chrome-extension:"&&n.replace("chrome-extension://","")===e.replace("chrome-extension://",""):t==="chrome-extension:"&&a.hostname===r}if(!yI.test(t))return!1;if(_I.test(n))return r===n;let i=n.replace(/\./g,"\\.");return new RegExp("^(.+\\."+i+"|"+i+")$","i").test(r)}var wI=new un(3e4,6e4);function If(){let n=Xe().___jsl;if(n?.H){for(let e of Object.keys(n.H))if(n.H[e].r=n.H[e].r||[],n.H[e].L=n.H[e].L||[],n.H[e].r=[...n.H[e].L],n.CP)for(let t=0;t<n.CP.length;t++)n.CP[t]=null}}function EI(n){return new Promise((e,t)=>{function r(){If(),gapi.load("gapi.iframes",{callback:()=>{e(gapi.iframes.getContext())},ontimeout:()=>{If(),t(qe(n,"network-request-failed"))},timeout:wI.get()})}if(Xe().gapi?.iframes?.Iframe)e(gapi.iframes.getContext());else if(Xe().gapi?.load)r();else{let i=jf("iframefcb");return Xe()[i]=()=>{gapi.load?r():t(qe(n,"network-request-failed"))},Nv(`${Vv()}?onload=${i}`).catch(o=>t(o))}}).catch(e=>{throw cs=null,e})}var cs=null;function TI(n){return cs=cs||EI(n),cs}var AI=new un(5e3,15e3),bI="__/auth/iframe",SI="emulator/auth/iframe",CI={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},RI=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);function PI(n){let e=n.config;U(e.authDomain,n,"auth-domain-config-required");let t=e.emulator?Qa(e,SI):`https://${n.config.authDomain}/${bI}`,r={apiKey:e.apiKey,appName:n.name,v:Lt},i=RI.get(n.config.apiHost);i&&(r.eid=i);let o=n._getFrameworks();return o.length&&(r.fw=o.join(",")),`${t}?${Vn(r).slice(1)}`}function DI(n){return _(this,null,function*(){let e=yield TI(n),t=Xe().gapi;return U(t,n,"internal-error"),e.open({where:document.body,url:PI(n),messageHandlersFilter:t.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:CI,dontclear:!0},r=>new Promise((i,o)=>_(null,null,function*(){yield r.restyle({setHideOnLeave:!1});let a=qe(n,"network-request-failed"),u=Xe().setTimeout(()=>{o(a)},AI.get());function h(){Xe().clearTimeout(u),i(r)}r.ping(h).then(h,()=>{o(a)})})))})}var NI={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"},VI=500,kI=600,OI="_blank",MI="http://localhost",ws=class{constructor(e){this.window=e,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch{}}};function xI(n,e,t,r=VI,i=kI){let o=Math.max((window.screen.availHeight-i)/2,0).toString(),a=Math.max((window.screen.availWidth-r)/2,0).toString(),u="",h=Z(L({},NI),{width:r.toString(),height:i.toString(),top:o,left:a}),d=ge().toLowerCase();t&&(u=Mf(d)?OI:t),kf(d)&&(e=e||MI,h.scrollbars="yes");let p=Object.entries(h).reduce((w,[R,k])=>`${w}${R}=${k},`,"");if(Sv(d)&&u!=="_self")return FI(e||"",u),new ws(null);let v=window.open(e||"",u,p);U(v,n,"popup-blocked");try{v.focus()}catch{}return new ws(v)}function FI(n,e){let t=document.createElement("a");t.href=n,t.target=e;let r=document.createEvent("MouseEvent");r.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),t.dispatchEvent(r)}var LI="__/auth/handler",UI="emulator/auth/handler",BI=encodeURIComponent("fac");function wf(n,e,t,r,i,o){return _(this,null,function*(){U(n.config.authDomain,n,"auth-domain-config-required"),U(n.config.apiKey,n,"invalid-api-key");let a={apiKey:n.config.apiKey,appName:n.name,authType:t,redirectUrl:r,v:Lt,eventId:i};if(e instanceof Gr){e.setDefaultLanguage(n.languageCode),a.providerId=e.providerId||"",Kd(e.getCustomParameters())||(a.customParameters=JSON.stringify(e.getCustomParameters()));for(let[p,v]of Object.entries(o||{}))a[p]=v}if(e instanceof gs){let p=e.getScopes().filter(v=>v!=="");p.length>0&&(a.scopes=p.join(","))}n.tenantId&&(a.tid=n.tenantId);let u=a;for(let p of Object.keys(u))u[p]===void 0&&delete u[p];let h=yield n._getAppCheckToken(),d=h?`#${BI}=${encodeURIComponent(h)}`:"";return`${qI(n)}?${Vn(u).slice(1)}${d}`})}function qI({config:n}){return n.emulator?Qa(n,UI):`https://${n.authDomain}/${LI}`}var Va="webStorageSupport",$a=class{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=ic,this._completeRedirectFn=fI,this._overrideRedirectResult=lI}_openPopup(e,t,r,i){return _(this,null,function*(){dt(this.eventManagers[e._key()]?.manager,"_initialize() not called before _openPopup()");let o=yield wf(e,t,r,ka(),i);return xI(e,o,sc())})}_openRedirect(e,t,r,i){return _(this,null,function*(){yield this._originValidation(e);let o=yield wf(e,t,r,ka(),i);return Wv(o),new Promise(()=>{})})}_initialize(e){let t=e._key();if(this.eventManagers[t]){let{manager:i,promise:o}=this.eventManagers[t];return i?Promise.resolve(i):(dt(o,"If manager is not set, promise should be"),o)}let r=this.initAndGetManager(e);return this.eventManagers[t]={promise:r},r.catch(()=>{delete this.eventManagers[t]}),r}initAndGetManager(e){return _(this,null,function*(){let t=yield DI(e),r=new za(e);return t.register("authEvent",i=>(U(i?.authEvent,e,"invalid-auth-event"),{status:r.onEvent(i.authEvent)?"ACK":"ERROR"}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),this.eventManagers[e._key()]={manager:r},this.iframes[e._key()]=t,r})}_isIframeWebStorageSupported(e,t){this.iframes[e._key()].send(Va,{type:Va},i=>{let o=i?.[0]?.[Va];o!==void 0&&t(!!o),Ze(e,"internal-error")},gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(e){let t=e._key();return this.originValidationPromises[t]||(this.originValidationPromises[t]=vI(e)),this.originValidationPromises[t]}get _shouldInitProactively(){return Bf()||Of()||Xa()}},np=$a;var Ef="@firebase/auth",Tf="1.11.1";var Ha=class{constructor(e){this.auth=e,this.internalListeners=new Map}getUid(){return this.assertAuthConfigured(),this.auth.currentUser?.uid||null}getToken(e){return _(this,null,function*(){return this.assertAuthConfigured(),yield this.auth._initializationPromise,this.auth.currentUser?{accessToken:yield this.auth.currentUser.getIdToken(e)}:null})}addAuthTokenListener(e){if(this.assertAuthConfigured(),this.internalListeners.has(e))return;let t=this.auth.onIdTokenChanged(r=>{e(r?.stsTokenManager.accessToken||null)});this.internalListeners.set(e,t),this.updateProactiveRefresh()}removeAuthTokenListener(e){this.assertAuthConfigured();let t=this.internalListeners.get(e);t&&(this.internalListeners.delete(e),t(),this.updateProactiveRefresh())}assertAuthConfigured(){U(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}};function jI(n){switch(n){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";case"WebExtension":return"web-extension";default:return}}function GI(n){Ft(new Le("auth",(e,{options:t})=>{let r=e.getProvider("app").getImmediate(),i=e.getProvider("heartbeat"),o=e.getProvider("app-check-internal"),{apiKey:a,authDomain:u}=r.options;U(a&&!a.includes(":"),"invalid-api-key",{appName:r.name});let h={apiKey:a,authDomain:u,clientPlatform:n,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:qf(n)},d=new Ua(r,i,o,h);return kv(d,t),d},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((e,t,r)=>{e.getProvider("auth-internal").initialize()})),Ft(new Le("auth-internal",e=>{let t=Es(e.getProvider("auth").getImmediate());return(r=>new Ha(r))(t)},"PRIVATE").setInstantiationMode("EXPLICIT")),ct(Ef,Tf,jI(n)),ct(Ef,Tf,"esm2020")}var zI=300,$I=ma("authIdTokenMaxAge")||zI,Af=null,HI=n=>e=>_(null,null,function*(){let t=e&&(yield e.getIdTokenResult()),r=t&&(new Date().getTime()-Date.parse(t.issuedAtTime))/1e3;if(r&&r>$I)return;let i=t?.token;Af!==i&&(Af=i,yield fetch(n,{method:i?"POST":"DELETE",headers:i?{Authorization:`Bearer ${i}`}:{}}))});function ac(n=rs()){let e=Lr(n,"auth");if(e.isInitialized())return e.getImmediate();let t=Gf(n,{popupRedirectResolver:np,persistence:[Zf,Qf,ic]}),r=ma("authTokenSyncURL");if(r&&typeof isSecureContext=="boolean"&&isSecureContext){let o=new URL(r,location.origin);if(location.origin===o.origin){let a=HI(o.toString());Kf(t,a,()=>a(t.currentUser)),Wf(t,u=>a(u))}}let i=fa("auth");return i&&zf(t,`http://${i}`),t}function WI(){return document.getElementsByTagName("head")?.[0]??document}Dv({loadJS(n){return new Promise((e,t)=>{let r=document.createElement("script");r.setAttribute("src",n),r.onload=e,r.onerror=i=>{let o=qe("internal-error");o.customData=i,t(o)},r.type="text/javascript",r.charset="UTF-8",WI().appendChild(r)})},gapiScript:"https://apis.google.com/js/api.js",recaptchaV2Script:"https://www.google.com/recaptcha/api.js",recaptchaEnterpriseScript:"https://www.google.com/recaptcha/enterprise.js?render="});GI("Browser");var rp=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},ip={};var ft,cc;(function(){var n;function e(E,m){function y(){}y.prototype=m.prototype,E.F=m.prototype,E.prototype=new y,E.prototype.constructor=E,E.D=function(T,I,b){for(var g=Array(arguments.length-2),Ce=2;Ce<arguments.length;Ce++)g[Ce-2]=arguments[Ce];return m.prototype[I].apply(T,g)}}function t(){this.blockSize=-1}function r(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.C=Array(this.blockSize),this.o=this.h=0,this.u()}e(r,t),r.prototype.u=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0};function i(E,m,y){y||(y=0);let T=Array(16);if(typeof m=="string")for(var I=0;I<16;++I)T[I]=m.charCodeAt(y++)|m.charCodeAt(y++)<<8|m.charCodeAt(y++)<<16|m.charCodeAt(y++)<<24;else for(I=0;I<16;++I)T[I]=m[y++]|m[y++]<<8|m[y++]<<16|m[y++]<<24;m=E.g[0],y=E.g[1],I=E.g[2];let b=E.g[3],g;g=m+(b^y&(I^b))+T[0]+3614090360&4294967295,m=y+(g<<7&4294967295|g>>>25),g=b+(I^m&(y^I))+T[1]+3905402710&4294967295,b=m+(g<<12&4294967295|g>>>20),g=I+(y^b&(m^y))+T[2]+606105819&4294967295,I=b+(g<<17&4294967295|g>>>15),g=y+(m^I&(b^m))+T[3]+3250441966&4294967295,y=I+(g<<22&4294967295|g>>>10),g=m+(b^y&(I^b))+T[4]+4118548399&4294967295,m=y+(g<<7&4294967295|g>>>25),g=b+(I^m&(y^I))+T[5]+1200080426&4294967295,b=m+(g<<12&4294967295|g>>>20),g=I+(y^b&(m^y))+T[6]+2821735955&4294967295,I=b+(g<<17&4294967295|g>>>15),g=y+(m^I&(b^m))+T[7]+4249261313&4294967295,y=I+(g<<22&4294967295|g>>>10),g=m+(b^y&(I^b))+T[8]+1770035416&4294967295,m=y+(g<<7&4294967295|g>>>25),g=b+(I^m&(y^I))+T[9]+2336552879&4294967295,b=m+(g<<12&4294967295|g>>>20),g=I+(y^b&(m^y))+T[10]+4294925233&4294967295,I=b+(g<<17&4294967295|g>>>15),g=y+(m^I&(b^m))+T[11]+2304563134&4294967295,y=I+(g<<22&4294967295|g>>>10),g=m+(b^y&(I^b))+T[12]+1804603682&4294967295,m=y+(g<<7&4294967295|g>>>25),g=b+(I^m&(y^I))+T[13]+4254626195&4294967295,b=m+(g<<12&4294967295|g>>>20),g=I+(y^b&(m^y))+T[14]+2792965006&4294967295,I=b+(g<<17&4294967295|g>>>15),g=y+(m^I&(b^m))+T[15]+1236535329&4294967295,y=I+(g<<22&4294967295|g>>>10),g=m+(I^b&(y^I))+T[1]+4129170786&4294967295,m=y+(g<<5&4294967295|g>>>27),g=b+(y^I&(m^y))+T[6]+3225465664&4294967295,b=m+(g<<9&4294967295|g>>>23),g=I+(m^y&(b^m))+T[11]+643717713&4294967295,I=b+(g<<14&4294967295|g>>>18),g=y+(b^m&(I^b))+T[0]+3921069994&4294967295,y=I+(g<<20&4294967295|g>>>12),g=m+(I^b&(y^I))+T[5]+3593408605&4294967295,m=y+(g<<5&4294967295|g>>>27),g=b+(y^I&(m^y))+T[10]+38016083&4294967295,b=m+(g<<9&4294967295|g>>>23),g=I+(m^y&(b^m))+T[15]+3634488961&4294967295,I=b+(g<<14&4294967295|g>>>18),g=y+(b^m&(I^b))+T[4]+3889429448&4294967295,y=I+(g<<20&4294967295|g>>>12),g=m+(I^b&(y^I))+T[9]+568446438&4294967295,m=y+(g<<5&4294967295|g>>>27),g=b+(y^I&(m^y))+T[14]+3275163606&4294967295,b=m+(g<<9&4294967295|g>>>23),g=I+(m^y&(b^m))+T[3]+4107603335&4294967295,I=b+(g<<14&4294967295|g>>>18),g=y+(b^m&(I^b))+T[8]+1163531501&4294967295,y=I+(g<<20&4294967295|g>>>12),g=m+(I^b&(y^I))+T[13]+2850285829&4294967295,m=y+(g<<5&4294967295|g>>>27),g=b+(y^I&(m^y))+T[2]+4243563512&4294967295,b=m+(g<<9&4294967295|g>>>23),g=I+(m^y&(b^m))+T[7]+1735328473&4294967295,I=b+(g<<14&4294967295|g>>>18),g=y+(b^m&(I^b))+T[12]+2368359562&4294967295,y=I+(g<<20&4294967295|g>>>12),g=m+(y^I^b)+T[5]+4294588738&4294967295,m=y+(g<<4&4294967295|g>>>28),g=b+(m^y^I)+T[8]+2272392833&4294967295,b=m+(g<<11&4294967295|g>>>21),g=I+(b^m^y)+T[11]+1839030562&4294967295,I=b+(g<<16&4294967295|g>>>16),g=y+(I^b^m)+T[14]+4259657740&4294967295,y=I+(g<<23&4294967295|g>>>9),g=m+(y^I^b)+T[1]+2763975236&4294967295,m=y+(g<<4&4294967295|g>>>28),g=b+(m^y^I)+T[4]+1272893353&4294967295,b=m+(g<<11&4294967295|g>>>21),g=I+(b^m^y)+T[7]+4139469664&4294967295,I=b+(g<<16&4294967295|g>>>16),g=y+(I^b^m)+T[10]+3200236656&4294967295,y=I+(g<<23&4294967295|g>>>9),g=m+(y^I^b)+T[13]+681279174&4294967295,m=y+(g<<4&4294967295|g>>>28),g=b+(m^y^I)+T[0]+3936430074&4294967295,b=m+(g<<11&4294967295|g>>>21),g=I+(b^m^y)+T[3]+3572445317&4294967295,I=b+(g<<16&4294967295|g>>>16),g=y+(I^b^m)+T[6]+76029189&4294967295,y=I+(g<<23&4294967295|g>>>9),g=m+(y^I^b)+T[9]+3654602809&4294967295,m=y+(g<<4&4294967295|g>>>28),g=b+(m^y^I)+T[12]+3873151461&4294967295,b=m+(g<<11&4294967295|g>>>21),g=I+(b^m^y)+T[15]+530742520&4294967295,I=b+(g<<16&4294967295|g>>>16),g=y+(I^b^m)+T[2]+3299628645&4294967295,y=I+(g<<23&4294967295|g>>>9),g=m+(I^(y|~b))+T[0]+4096336452&4294967295,m=y+(g<<6&4294967295|g>>>26),g=b+(y^(m|~I))+T[7]+1126891415&4294967295,b=m+(g<<10&4294967295|g>>>22),g=I+(m^(b|~y))+T[14]+2878612391&4294967295,I=b+(g<<15&4294967295|g>>>17),g=y+(b^(I|~m))+T[5]+4237533241&4294967295,y=I+(g<<21&4294967295|g>>>11),g=m+(I^(y|~b))+T[12]+1700485571&4294967295,m=y+(g<<6&4294967295|g>>>26),g=b+(y^(m|~I))+T[3]+2399980690&4294967295,b=m+(g<<10&4294967295|g>>>22),g=I+(m^(b|~y))+T[10]+4293915773&4294967295,I=b+(g<<15&4294967295|g>>>17),g=y+(b^(I|~m))+T[1]+2240044497&4294967295,y=I+(g<<21&4294967295|g>>>11),g=m+(I^(y|~b))+T[8]+1873313359&4294967295,m=y+(g<<6&4294967295|g>>>26),g=b+(y^(m|~I))+T[15]+4264355552&4294967295,b=m+(g<<10&4294967295|g>>>22),g=I+(m^(b|~y))+T[6]+2734768916&4294967295,I=b+(g<<15&4294967295|g>>>17),g=y+(b^(I|~m))+T[13]+1309151649&4294967295,y=I+(g<<21&4294967295|g>>>11),g=m+(I^(y|~b))+T[4]+4149444226&4294967295,m=y+(g<<6&4294967295|g>>>26),g=b+(y^(m|~I))+T[11]+3174756917&4294967295,b=m+(g<<10&4294967295|g>>>22),g=I+(m^(b|~y))+T[2]+718787259&4294967295,I=b+(g<<15&4294967295|g>>>17),g=y+(b^(I|~m))+T[9]+3951481745&4294967295,E.g[0]=E.g[0]+m&4294967295,E.g[1]=E.g[1]+(I+(g<<21&4294967295|g>>>11))&4294967295,E.g[2]=E.g[2]+I&4294967295,E.g[3]=E.g[3]+b&4294967295}r.prototype.v=function(E,m){m===void 0&&(m=E.length);let y=m-this.blockSize,T=this.C,I=this.h,b=0;for(;b<m;){if(I==0)for(;b<=y;)i(this,E,b),b+=this.blockSize;if(typeof E=="string"){for(;b<m;)if(T[I++]=E.charCodeAt(b++),I==this.blockSize){i(this,T),I=0;break}}else for(;b<m;)if(T[I++]=E[b++],I==this.blockSize){i(this,T),I=0;break}}this.h=I,this.o+=m},r.prototype.A=function(){var E=Array((this.h<56?this.blockSize:this.blockSize*2)-this.h);E[0]=128;for(var m=1;m<E.length-8;++m)E[m]=0;m=this.o*8;for(var y=E.length-8;y<E.length;++y)E[y]=m&255,m/=256;for(this.v(E),E=Array(16),m=0,y=0;y<4;++y)for(let T=0;T<32;T+=8)E[m++]=this.g[y]>>>T&255;return E};function o(E,m){var y=u;return Object.prototype.hasOwnProperty.call(y,E)?y[E]:y[E]=m(E)}function a(E,m){this.h=m;let y=[],T=!0;for(let I=E.length-1;I>=0;I--){let b=E[I]|0;T&&b==m||(y[I]=b,T=!1)}this.g=y}var u={};function h(E){return-128<=E&&E<128?o(E,function(m){return new a([m|0],m<0?-1:0)}):new a([E|0],E<0?-1:0)}function d(E){if(isNaN(E)||!isFinite(E))return v;if(E<0)return N(d(-E));let m=[],y=1;for(let T=0;E>=y;T++)m[T]=E/y|0,y*=4294967296;return new a(m,0)}function p(E,m){if(E.length==0)throw Error("number format error: empty string");if(m=m||10,m<2||36<m)throw Error("radix out of range: "+m);if(E.charAt(0)=="-")return N(p(E.substring(1),m));if(E.indexOf("-")>=0)throw Error('number format error: interior "-" character');let y=d(Math.pow(m,8)),T=v;for(let b=0;b<E.length;b+=8){var I=Math.min(8,E.length-b);let g=parseInt(E.substring(b,b+I),m);I<8?(I=d(Math.pow(m,I)),T=T.j(I).add(d(g))):(T=T.j(y),T=T.add(d(g)))}return T}var v=h(0),w=h(1),R=h(16777216);n=a.prototype,n.m=function(){if(M(this))return-N(this).m();let E=0,m=1;for(let y=0;y<this.g.length;y++){let T=this.i(y);E+=(T>=0?T:4294967296+T)*m,m*=4294967296}return E},n.toString=function(E){if(E=E||10,E<2||36<E)throw Error("radix out of range: "+E);if(k(this))return"0";if(M(this))return"-"+N(this).toString(E);let m=d(Math.pow(E,6));var y=this;let T="";for(;;){let I=Te(y,m).g;y=G(y,I.j(m));let b=((y.g.length>0?y.g[0]:y.h)>>>0).toString(E);if(y=I,k(y))return b+T;for(;b.length<6;)b="0"+b;T=b+T}},n.i=function(E){return E<0?0:E<this.g.length?this.g[E]:this.h};function k(E){if(E.h!=0)return!1;for(let m=0;m<E.g.length;m++)if(E.g[m]!=0)return!1;return!0}function M(E){return E.h==-1}n.l=function(E){return E=G(this,E),M(E)?-1:k(E)?0:1};function N(E){let m=E.g.length,y=[];for(let T=0;T<m;T++)y[T]=~E.g[T];return new a(y,~E.h).add(w)}n.abs=function(){return M(this)?N(this):this},n.add=function(E){let m=Math.max(this.g.length,E.g.length),y=[],T=0;for(let I=0;I<=m;I++){let b=T+(this.i(I)&65535)+(E.i(I)&65535),g=(b>>>16)+(this.i(I)>>>16)+(E.i(I)>>>16);T=g>>>16,b&=65535,g&=65535,y[I]=g<<16|b}return new a(y,y[y.length-1]&-2147483648?-1:0)};function G(E,m){return E.add(N(m))}n.j=function(E){if(k(this)||k(E))return v;if(M(this))return M(E)?N(this).j(N(E)):N(N(this).j(E));if(M(E))return N(this.j(N(E)));if(this.l(R)<0&&E.l(R)<0)return d(this.m()*E.m());let m=this.g.length+E.g.length,y=[];for(var T=0;T<2*m;T++)y[T]=0;for(T=0;T<this.g.length;T++)for(let I=0;I<E.g.length;I++){let b=this.i(T)>>>16,g=this.i(T)&65535,Ce=E.i(I)>>>16,Et=E.i(I)&65535;y[2*T+2*I]+=g*Et,Q(y,2*T+2*I),y[2*T+2*I+1]+=b*Et,Q(y,2*T+2*I+1),y[2*T+2*I+1]+=g*Ce,Q(y,2*T+2*I+1),y[2*T+2*I+2]+=b*Ce,Q(y,2*T+2*I+2)}for(E=0;E<m;E++)y[E]=y[2*E+1]<<16|y[2*E];for(E=m;E<2*m;E++)y[E]=0;return new a(y,0)};function Q(E,m){for(;(E[m]&65535)!=E[m];)E[m+1]+=E[m]>>>16,E[m]&=65535,m++}function J(E,m){this.g=E,this.h=m}function Te(E,m){if(k(m))throw Error("division by zero");if(k(E))return new J(v,v);if(M(E))return m=Te(N(E),m),new J(N(m.g),N(m.h));if(M(m))return m=Te(E,N(m)),new J(N(m.g),m.h);if(E.g.length>30){if(M(E)||M(m))throw Error("slowDivide_ only works with positive integers.");for(var y=w,T=m;T.l(E)<=0;)y=Se(y),T=Se(T);var I=fe(y,1),b=fe(T,1);for(T=fe(T,2),y=fe(y,2);!k(T);){var g=b.add(T);g.l(E)<=0&&(I=I.add(y),b=g),T=fe(T,1),y=fe(y,1)}return m=G(E,I.j(m)),new J(I,m)}for(I=v;E.l(m)>=0;){for(y=Math.max(1,Math.floor(E.m()/m.m())),T=Math.ceil(Math.log(y)/Math.LN2),T=T<=48?1:Math.pow(2,T-48),b=d(y),g=b.j(m);M(g)||g.l(E)>0;)y-=T,b=d(y),g=b.j(m);k(b)&&(b=w),I=I.add(b),E=G(E,g)}return new J(I,E)}n.B=function(E){return Te(this,E).h},n.and=function(E){let m=Math.max(this.g.length,E.g.length),y=[];for(let T=0;T<m;T++)y[T]=this.i(T)&E.i(T);return new a(y,this.h&E.h)},n.or=function(E){let m=Math.max(this.g.length,E.g.length),y=[];for(let T=0;T<m;T++)y[T]=this.i(T)|E.i(T);return new a(y,this.h|E.h)},n.xor=function(E){let m=Math.max(this.g.length,E.g.length),y=[];for(let T=0;T<m;T++)y[T]=this.i(T)^E.i(T);return new a(y,this.h^E.h)};function Se(E){let m=E.g.length+1,y=[];for(let T=0;T<m;T++)y[T]=E.i(T)<<1|E.i(T-1)>>>31;return new a(y,E.h)}function fe(E,m){let y=m>>5;m%=32;let T=E.g.length-y,I=[];for(let b=0;b<T;b++)I[b]=m>0?E.i(b+y)>>>m|E.i(b+y+1)<<32-m:E.i(b+y);return new a(I,E.h)}r.prototype.digest=r.prototype.A,r.prototype.reset=r.prototype.u,r.prototype.update=r.prototype.v,cc=ip.Md5=r,a.prototype.add=a.prototype.add,a.prototype.multiply=a.prototype.j,a.prototype.modulo=a.prototype.B,a.prototype.compare=a.prototype.l,a.prototype.toNumber=a.prototype.m,a.prototype.toString=a.prototype.toString,a.prototype.getBits=a.prototype.i,a.fromNumber=d,a.fromString=p,ft=ip.Integer=a}).apply(typeof rp<"u"?rp:typeof self<"u"?self:typeof window<"u"?window:{});var As=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},pt={};var uc,KI,Mn,lc,Hr,bs,hc,dc,fc;(function(){var n,e=Object.defineProperty;function t(s){s=[typeof globalThis=="object"&&globalThis,s,typeof window=="object"&&window,typeof self=="object"&&self,typeof As=="object"&&As];for(var c=0;c<s.length;++c){var l=s[c];if(l&&l.Math==Math)return l}throw Error("Cannot find global object")}var r=t(this);function i(s,c){if(c)e:{var l=r;s=s.split(".");for(var f=0;f<s.length-1;f++){var A=s[f];if(!(A in l))break e;l=l[A]}s=s[s.length-1],f=l[s],c=c(f),c!=f&&c!=null&&e(l,s,{configurable:!0,writable:!0,value:c})}}i("Symbol.dispose",function(s){return s||Symbol("Symbol.dispose")}),i("Array.prototype.values",function(s){return s||function(){return this[Symbol.iterator]()}}),i("Object.entries",function(s){return s||function(c){var l=[],f;for(f in c)Object.prototype.hasOwnProperty.call(c,f)&&l.push([f,c[f]]);return l}});var o=o||{},a=this||self;function u(s){var c=typeof s;return c=="object"&&s!=null||c=="function"}function h(s,c,l){return s.call.apply(s.bind,arguments)}function d(s,c,l){return d=h,d.apply(null,arguments)}function p(s,c){var l=Array.prototype.slice.call(arguments,1);return function(){var f=l.slice();return f.push.apply(f,arguments),s.apply(this,f)}}function v(s,c){function l(){}l.prototype=c.prototype,s.Z=c.prototype,s.prototype=new l,s.prototype.constructor=s,s.Ob=function(f,A,S){for(var D=Array(arguments.length-2),j=2;j<arguments.length;j++)D[j-2]=arguments[j];return c.prototype[A].apply(f,D)}}var w=typeof AsyncContext<"u"&&typeof AsyncContext.Snapshot=="function"?s=>s&&AsyncContext.Snapshot.wrap(s):s=>s;function R(s){let c=s.length;if(c>0){let l=Array(c);for(let f=0;f<c;f++)l[f]=s[f];return l}return[]}function k(s,c){for(let f=1;f<arguments.length;f++){let A=arguments[f];var l=typeof A;if(l=l!="object"?l:A?Array.isArray(A)?"array":l:"null",l=="array"||l=="object"&&typeof A.length=="number"){l=s.length||0;let S=A.length||0;s.length=l+S;for(let D=0;D<S;D++)s[l+D]=A[D]}else s.push(A)}}class M{constructor(c,l){this.i=c,this.j=l,this.h=0,this.g=null}get(){let c;return this.h>0?(this.h--,c=this.g,this.g=c.next,c.next=null):c=this.i(),c}}function N(s){a.setTimeout(()=>{throw s},0)}function G(){var s=E;let c=null;return s.g&&(c=s.g,s.g=s.g.next,s.g||(s.h=null),c.next=null),c}class Q{constructor(){this.h=this.g=null}add(c,l){let f=J.get();f.set(c,l),this.h?this.h.next=f:this.g=f,this.h=f}}var J=new M(()=>new Te,s=>s.reset());class Te{constructor(){this.next=this.g=this.h=null}set(c,l){this.h=c,this.g=l,this.next=null}reset(){this.next=this.g=this.h=null}}let Se,fe=!1,E=new Q,m=()=>{let s=Promise.resolve(void 0);Se=()=>{s.then(y)}};function y(){for(var s;s=G();){try{s.h.call(s.g)}catch(l){N(l)}var c=J;c.j(s),c.h<100&&(c.h++,s.next=c.g,c.g=s)}fe=!1}function T(){this.u=this.u,this.C=this.C}T.prototype.u=!1,T.prototype.dispose=function(){this.u||(this.u=!0,this.N())},T.prototype[Symbol.dispose]=function(){this.dispose()},T.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()};function I(s,c){this.type=s,this.g=this.target=c,this.defaultPrevented=!1}I.prototype.h=function(){this.defaultPrevented=!0};var b=(function(){if(!a.addEventListener||!Object.defineProperty)return!1;var s=!1,c=Object.defineProperty({},"passive",{get:function(){s=!0}});try{let l=()=>{};a.addEventListener("test",l,c),a.removeEventListener("test",l,c)}catch{}return s})();function g(s){return/^[\s\xa0]*$/.test(s)}function Ce(s,c){I.call(this,s?s.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,s&&this.init(s,c)}v(Ce,I),Ce.prototype.init=function(s,c){let l=this.type=s.type,f=s.changedTouches&&s.changedTouches.length?s.changedTouches[0]:null;this.target=s.target||s.srcElement,this.g=c,c=s.relatedTarget,c||(l=="mouseover"?c=s.fromElement:l=="mouseout"&&(c=s.toElement)),this.relatedTarget=c,f?(this.clientX=f.clientX!==void 0?f.clientX:f.pageX,this.clientY=f.clientY!==void 0?f.clientY:f.pageY,this.screenX=f.screenX||0,this.screenY=f.screenY||0):(this.clientX=s.clientX!==void 0?s.clientX:s.pageX,this.clientY=s.clientY!==void 0?s.clientY:s.pageY,this.screenX=s.screenX||0,this.screenY=s.screenY||0),this.button=s.button,this.key=s.key||"",this.ctrlKey=s.ctrlKey,this.altKey=s.altKey,this.shiftKey=s.shiftKey,this.metaKey=s.metaKey,this.pointerId=s.pointerId||0,this.pointerType=s.pointerType,this.state=s.state,this.i=s,s.defaultPrevented&&Ce.Z.h.call(this)},Ce.prototype.h=function(){Ce.Z.h.call(this);let s=this.i;s.preventDefault?s.preventDefault():s.returnValue=!1};var Et="closure_listenable_"+(Math.random()*1e6|0),Rg=0;function Pg(s,c,l,f,A){this.listener=s,this.proxy=null,this.src=c,this.type=l,this.capture=!!f,this.ha=A,this.key=++Rg,this.da=this.fa=!1}function pi(s){s.da=!0,s.listener=null,s.proxy=null,s.src=null,s.ha=null}function mi(s,c,l){for(let f in s)c.call(l,s[f],f,s)}function Dg(s,c){for(let l in s)c.call(void 0,s[l],l,s)}function kl(s){let c={};for(let l in s)c[l]=s[l];return c}let Ol="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function Ml(s,c){let l,f;for(let A=1;A<arguments.length;A++){f=arguments[A];for(l in f)s[l]=f[l];for(let S=0;S<Ol.length;S++)l=Ol[S],Object.prototype.hasOwnProperty.call(f,l)&&(s[l]=f[l])}}function gi(s){this.src=s,this.g={},this.h=0}gi.prototype.add=function(s,c,l,f,A){let S=s.toString();s=this.g[S],s||(s=this.g[S]=[],this.h++);let D=Co(s,c,f,A);return D>-1?(c=s[D],l||(c.fa=!1)):(c=new Pg(c,this.src,S,!!f,A),c.fa=l,s.push(c)),c};function So(s,c){let l=c.type;if(l in s.g){var f=s.g[l],A=Array.prototype.indexOf.call(f,c,void 0),S;(S=A>=0)&&Array.prototype.splice.call(f,A,1),S&&(pi(c),s.g[l].length==0&&(delete s.g[l],s.h--))}}function Co(s,c,l,f){for(let A=0;A<s.length;++A){let S=s[A];if(!S.da&&S.listener==c&&S.capture==!!l&&S.ha==f)return A}return-1}var Ro="closure_lm_"+(Math.random()*1e6|0),Po={};function xl(s,c,l,f,A){if(f&&f.once)return Ll(s,c,l,f,A);if(Array.isArray(c)){for(let S=0;S<c.length;S++)xl(s,c[S],l,f,A);return null}return l=ko(l),s&&s[Et]?s.J(c,l,u(f)?!!f.capture:!!f,A):Fl(s,c,l,!1,f,A)}function Fl(s,c,l,f,A,S){if(!c)throw Error("Invalid event type");let D=u(A)?!!A.capture:!!A,j=No(s);if(j||(s[Ro]=j=new gi(s)),l=j.add(c,l,f,D,S),l.proxy)return l;if(f=Ng(),l.proxy=f,f.src=s,f.listener=l,s.addEventListener)b||(A=D),A===void 0&&(A=!1),s.addEventListener(c.toString(),f,A);else if(s.attachEvent)s.attachEvent(Bl(c.toString()),f);else if(s.addListener&&s.removeListener)s.addListener(f);else throw Error("addEventListener and attachEvent are unavailable.");return l}function Ng(){function s(l){return c.call(s.src,s.listener,l)}let c=Vg;return s}function Ll(s,c,l,f,A){if(Array.isArray(c)){for(let S=0;S<c.length;S++)Ll(s,c[S],l,f,A);return null}return l=ko(l),s&&s[Et]?s.K(c,l,u(f)?!!f.capture:!!f,A):Fl(s,c,l,!0,f,A)}function Ul(s,c,l,f,A){if(Array.isArray(c))for(var S=0;S<c.length;S++)Ul(s,c[S],l,f,A);else f=u(f)?!!f.capture:!!f,l=ko(l),s&&s[Et]?(s=s.i,S=String(c).toString(),S in s.g&&(c=s.g[S],l=Co(c,l,f,A),l>-1&&(pi(c[l]),Array.prototype.splice.call(c,l,1),c.length==0&&(delete s.g[S],s.h--)))):s&&(s=No(s))&&(c=s.g[c.toString()],s=-1,c&&(s=Co(c,l,f,A)),(l=s>-1?c[s]:null)&&Do(l))}function Do(s){if(typeof s!="number"&&s&&!s.da){var c=s.src;if(c&&c[Et])So(c.i,s);else{var l=s.type,f=s.proxy;c.removeEventListener?c.removeEventListener(l,f,s.capture):c.detachEvent?c.detachEvent(Bl(l),f):c.addListener&&c.removeListener&&c.removeListener(f),(l=No(c))?(So(l,s),l.h==0&&(l.src=null,c[Ro]=null)):pi(s)}}}function Bl(s){return s in Po?Po[s]:Po[s]="on"+s}function Vg(s,c){if(s.da)s=!0;else{c=new Ce(c,this);let l=s.listener,f=s.ha||s.src;s.fa&&Do(s),s=l.call(f,c)}return s}function No(s){return s=s[Ro],s instanceof gi?s:null}var Vo="__closure_events_fn_"+(Math.random()*1e9>>>0);function ko(s){return typeof s=="function"?s:(s[Vo]||(s[Vo]=function(c){return s.handleEvent(c)}),s[Vo])}function Ie(){T.call(this),this.i=new gi(this),this.M=this,this.G=null}v(Ie,T),Ie.prototype[Et]=!0,Ie.prototype.removeEventListener=function(s,c,l,f){Ul(this,s,c,l,f)};function Ae(s,c){var l,f=s.G;if(f)for(l=[];f;f=f.G)l.push(f);if(s=s.M,f=c.type||c,typeof c=="string")c=new I(c,s);else if(c instanceof I)c.target=c.target||s;else{var A=c;c=new I(f,s),Ml(c,A)}A=!0;let S,D;if(l)for(D=l.length-1;D>=0;D--)S=c.g=l[D],A=_i(S,f,!0,c)&&A;if(S=c.g=s,A=_i(S,f,!0,c)&&A,A=_i(S,f,!1,c)&&A,l)for(D=0;D<l.length;D++)S=c.g=l[D],A=_i(S,f,!1,c)&&A}Ie.prototype.N=function(){if(Ie.Z.N.call(this),this.i){var s=this.i;for(let c in s.g){let l=s.g[c];for(let f=0;f<l.length;f++)pi(l[f]);delete s.g[c],s.h--}}this.G=null},Ie.prototype.J=function(s,c,l,f){return this.i.add(String(s),c,!1,l,f)},Ie.prototype.K=function(s,c,l,f){return this.i.add(String(s),c,!0,l,f)};function _i(s,c,l,f){if(c=s.i.g[String(c)],!c)return!0;c=c.concat();let A=!0;for(let S=0;S<c.length;++S){let D=c[S];if(D&&!D.da&&D.capture==l){let j=D.listener,de=D.ha||D.src;D.fa&&So(s.i,D),A=j.call(de,f)!==!1&&A}}return A&&!f.defaultPrevented}function kg(s,c){if(typeof s!="function")if(s&&typeof s.handleEvent=="function")s=d(s.handleEvent,s);else throw Error("Invalid listener argument");return Number(c)>2147483647?-1:a.setTimeout(s,c||0)}function ql(s){s.g=kg(()=>{s.g=null,s.i&&(s.i=!1,ql(s))},s.l);let c=s.h;s.h=null,s.m.apply(null,c)}class Og extends T{constructor(c,l){super(),this.m=c,this.l=l,this.h=null,this.i=!1,this.g=null}j(c){this.h=arguments,this.g?this.i=!0:ql(this)}N(){super.N(),this.g&&(a.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function cr(s){T.call(this),this.h=s,this.g={}}v(cr,T);var jl=[];function Gl(s){mi(s.g,function(c,l){this.g.hasOwnProperty(l)&&Do(c)},s),s.g={}}cr.prototype.N=function(){cr.Z.N.call(this),Gl(this)},cr.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var Oo=a.JSON.stringify,Mg=a.JSON.parse,xg=class{stringify(s){return a.JSON.stringify(s,void 0)}parse(s){return a.JSON.parse(s,void 0)}};function zl(){}function $l(){}var ur={OPEN:"a",hb:"b",ERROR:"c",tb:"d"};function Mo(){I.call(this,"d")}v(Mo,I);function xo(){I.call(this,"c")}v(xo,I);var Yt={},Hl=null;function yi(){return Hl=Hl||new Ie}Yt.Ia="serverreachability";function Wl(s){I.call(this,Yt.Ia,s)}v(Wl,I);function lr(s){let c=yi();Ae(c,new Wl(c))}Yt.STAT_EVENT="statevent";function Kl(s,c){I.call(this,Yt.STAT_EVENT,s),this.stat=c}v(Kl,I);function be(s){let c=yi();Ae(c,new Kl(c,s))}Yt.Ja="timingevent";function Ql(s,c){I.call(this,Yt.Ja,s),this.size=c}v(Ql,I);function hr(s,c){if(typeof s!="function")throw Error("Fn must not be null and must be a function");return a.setTimeout(function(){s()},c)}function dr(){this.g=!0}dr.prototype.ua=function(){this.g=!1};function Fg(s,c,l,f,A,S){s.info(function(){if(s.g)if(S){var D="",j=S.split("&");for(let X=0;X<j.length;X++){var de=j[X].split("=");if(de.length>1){let pe=de[0];de=de[1];let We=pe.split("_");D=We.length>=2&&We[1]=="type"?D+(pe+"="+de+"&"):D+(pe+"=redacted&")}}}else D=null;else D=S;return"XMLHTTP REQ ("+f+") [attempt "+A+"]: "+c+`
`+l+`
`+D})}function Lg(s,c,l,f,A,S,D){s.info(function(){return"XMLHTTP RESP ("+f+") [ attempt "+A+"]: "+c+`
`+l+`
`+S+" "+D})}function bn(s,c,l,f){s.info(function(){return"XMLHTTP TEXT ("+c+"): "+Bg(s,l)+(f?" "+f:"")})}function Ug(s,c){s.info(function(){return"TIMEOUT: "+c})}dr.prototype.info=function(){};function Bg(s,c){if(!s.g)return c;if(!c)return null;try{let S=JSON.parse(c);if(S){for(s=0;s<S.length;s++)if(Array.isArray(S[s])){var l=S[s];if(!(l.length<2)){var f=l[1];if(Array.isArray(f)&&!(f.length<1)){var A=f[0];if(A!="noop"&&A!="stop"&&A!="close")for(let D=1;D<f.length;D++)f[D]=""}}}}return Oo(S)}catch{return c}}var vi={NO_ERROR:0,cb:1,qb:2,pb:3,kb:4,ob:5,rb:6,Ga:7,TIMEOUT:8,ub:9},Jl={ib:"complete",Fb:"success",ERROR:"error",Ga:"abort",xb:"ready",yb:"readystatechange",TIMEOUT:"timeout",sb:"incrementaldata",wb:"progress",lb:"downloadprogress",Nb:"uploadprogress"},Yl;function Fo(){}v(Fo,zl),Fo.prototype.g=function(){return new XMLHttpRequest},Yl=new Fo;function fr(s){return encodeURIComponent(String(s))}function qg(s){var c=1;s=s.split(":");let l=[];for(;c>0&&s.length;)l.push(s.shift()),c--;return s.length&&l.push(s.join(":")),l}function Tt(s,c,l,f){this.j=s,this.i=c,this.l=l,this.S=f||1,this.V=new cr(this),this.H=45e3,this.J=null,this.o=!1,this.u=this.B=this.A=this.M=this.F=this.T=this.D=null,this.G=[],this.g=null,this.C=0,this.m=this.v=null,this.X=-1,this.K=!1,this.P=0,this.O=null,this.W=this.L=this.U=this.R=!1,this.h=new Xl}function Xl(){this.i=null,this.g="",this.h=!1}var Zl={},Lo={};function Uo(s,c,l){s.M=1,s.A=wi(He(c)),s.u=l,s.R=!0,eh(s,null)}function eh(s,c){s.F=Date.now(),Ii(s),s.B=He(s.A);var l=s.B,f=s.S;Array.isArray(f)||(f=[String(f)]),fh(l.i,"t",f),s.C=0,l=s.j.L,s.h=new Xl,s.g=Nh(s.j,l?c:null,!s.u),s.P>0&&(s.O=new Og(d(s.Y,s,s.g),s.P)),c=s.V,l=s.g,f=s.ba;var A="readystatechange";Array.isArray(A)||(A&&(jl[0]=A.toString()),A=jl);for(let S=0;S<A.length;S++){let D=xl(l,A[S],f||c.handleEvent,!1,c.h||c);if(!D)break;c.g[D.key]=D}c=s.J?kl(s.J):{},s.u?(s.v||(s.v="POST"),c["Content-Type"]="application/x-www-form-urlencoded",s.g.ea(s.B,s.v,s.u,c)):(s.v="GET",s.g.ea(s.B,s.v,null,c)),lr(),Fg(s.i,s.v,s.B,s.l,s.S,s.u)}Tt.prototype.ba=function(s){s=s.target;let c=this.O;c&&St(s)==3?c.j():this.Y(s)},Tt.prototype.Y=function(s){try{if(s==this.g)e:{let j=St(this.g),de=this.g.ya(),X=this.g.ca();if(!(j<3)&&(j!=3||this.g&&(this.h.h||this.g.la()||Ih(this.g)))){this.K||j!=4||de==7||(de==8||X<=0?lr(3):lr(2)),Bo(this);var c=this.g.ca();this.X=c;var l=jg(this);if(this.o=c==200,Lg(this.i,this.v,this.B,this.l,this.S,j,c),this.o){if(this.U&&!this.L){t:{if(this.g){var f,A=this.g;if((f=A.g?A.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!g(f)){var S=f;break t}}S=null}if(s=S)bn(this.i,this.l,s,"Initial handshake response via X-HTTP-Initial-Response"),this.L=!0,qo(this,s);else{this.o=!1,this.m=3,be(12),Xt(this),pr(this);break e}}if(this.R){s=!0;let pe;for(;!this.K&&this.C<l.length;)if(pe=Gg(this,l),pe==Lo){j==4&&(this.m=4,be(14),s=!1),bn(this.i,this.l,null,"[Incomplete Response]");break}else if(pe==Zl){this.m=4,be(15),bn(this.i,this.l,l,"[Invalid Chunk]"),s=!1;break}else bn(this.i,this.l,pe,null),qo(this,pe);if(th(this)&&this.C!=0&&(this.h.g=this.h.g.slice(this.C),this.C=0),j!=4||l.length!=0||this.h.h||(this.m=1,be(16),s=!1),this.o=this.o&&s,!s)bn(this.i,this.l,l,"[Invalid Chunked Response]"),Xt(this),pr(this);else if(l.length>0&&!this.W){this.W=!0;var D=this.j;D.g==this&&D.aa&&!D.P&&(D.j.info("Great, no buffering proxy detected. Bytes received: "+l.length),Ko(D),D.P=!0,be(11))}}else bn(this.i,this.l,l,null),qo(this,l);j==4&&Xt(this),this.o&&!this.K&&(j==4?Ch(this.j,this):(this.o=!1,Ii(this)))}else r_(this.g),c==400&&l.indexOf("Unknown SID")>0?(this.m=3,be(12)):(this.m=0,be(13)),Xt(this),pr(this)}}}catch{}finally{}};function jg(s){if(!th(s))return s.g.la();let c=Ih(s.g);if(c==="")return"";let l="",f=c.length,A=St(s.g)==4;if(!s.h.i){if(typeof TextDecoder>"u")return Xt(s),pr(s),"";s.h.i=new a.TextDecoder}for(let S=0;S<f;S++)s.h.h=!0,l+=s.h.i.decode(c[S],{stream:!(A&&S==f-1)});return c.length=0,s.h.g+=l,s.C=0,s.h.g}function th(s){return s.g?s.v=="GET"&&s.M!=2&&s.j.Aa:!1}function Gg(s,c){var l=s.C,f=c.indexOf(`
`,l);return f==-1?Lo:(l=Number(c.substring(l,f)),isNaN(l)?Zl:(f+=1,f+l>c.length?Lo:(c=c.slice(f,f+l),s.C=f+l,c)))}Tt.prototype.cancel=function(){this.K=!0,Xt(this)};function Ii(s){s.T=Date.now()+s.H,nh(s,s.H)}function nh(s,c){if(s.D!=null)throw Error("WatchDog timer not null");s.D=hr(d(s.aa,s),c)}function Bo(s){s.D&&(a.clearTimeout(s.D),s.D=null)}Tt.prototype.aa=function(){this.D=null;let s=Date.now();s-this.T>=0?(Ug(this.i,this.B),this.M!=2&&(lr(),be(17)),Xt(this),this.m=2,pr(this)):nh(this,this.T-s)};function pr(s){s.j.I==0||s.K||Ch(s.j,s)}function Xt(s){Bo(s);var c=s.O;c&&typeof c.dispose=="function"&&c.dispose(),s.O=null,Gl(s.V),s.g&&(c=s.g,s.g=null,c.abort(),c.dispose())}function qo(s,c){try{var l=s.j;if(l.I!=0&&(l.g==s||jo(l.h,s))){if(!s.L&&jo(l.h,s)&&l.I==3){try{var f=l.Ba.g.parse(c)}catch{f=null}if(Array.isArray(f)&&f.length==3){var A=f;if(A[0]==0){e:if(!l.v){if(l.g)if(l.g.F+3e3<s.F)Ci(l),bi(l);else break e;Wo(l),be(18)}}else l.xa=A[1],0<l.xa-l.K&&A[2]<37500&&l.F&&l.A==0&&!l.C&&(l.C=hr(d(l.Va,l),6e3));sh(l.h)<=1&&l.ta&&(l.ta=void 0)}else en(l,11)}else if((s.L||l.g==s)&&Ci(l),!g(c))for(A=l.Ba.g.parse(c),c=0;c<A.length;c++){let X=A[c],pe=X[0];if(!(pe<=l.K))if(l.K=pe,X=X[1],l.I==2)if(X[0]=="c"){l.M=X[1],l.ba=X[2];let We=X[3];We!=null&&(l.ka=We,l.j.info("VER="+l.ka));let tn=X[4];tn!=null&&(l.za=tn,l.j.info("SVER="+l.za));let Ct=X[5];Ct!=null&&typeof Ct=="number"&&Ct>0&&(f=1.5*Ct,l.O=f,l.j.info("backChannelRequestTimeoutMs_="+f)),f=l;let Rt=s.g;if(Rt){let Pi=Rt.g?Rt.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(Pi){var S=f.h;S.g||Pi.indexOf("spdy")==-1&&Pi.indexOf("quic")==-1&&Pi.indexOf("h2")==-1||(S.j=S.l,S.g=new Set,S.h&&(Go(S,S.h),S.h=null))}if(f.G){let Qo=Rt.g?Rt.g.getResponseHeader("X-HTTP-Session-Id"):null;Qo&&(f.wa=Qo,ee(f.J,f.G,Qo))}}l.I=3,l.l&&l.l.ra(),l.aa&&(l.T=Date.now()-s.F,l.j.info("Handshake RTT: "+l.T+"ms")),f=l;var D=s;if(f.na=Dh(f,f.L?f.ba:null,f.W),D.L){oh(f.h,D);var j=D,de=f.O;de&&(j.H=de),j.D&&(Bo(j),Ii(j)),f.g=D}else bh(f);l.i.length>0&&Si(l)}else X[0]!="stop"&&X[0]!="close"||en(l,7);else l.I==3&&(X[0]=="stop"||X[0]=="close"?X[0]=="stop"?en(l,7):Ho(l):X[0]!="noop"&&l.l&&l.l.qa(X),l.A=0)}}lr(4)}catch{}}var zg=class{constructor(s,c){this.g=s,this.map=c}};function rh(s){this.l=s||10,a.PerformanceNavigationTiming?(s=a.performance.getEntriesByType("navigation"),s=s.length>0&&(s[0].nextHopProtocol=="hq"||s[0].nextHopProtocol=="h2")):s=!!(a.chrome&&a.chrome.loadTimes&&a.chrome.loadTimes()&&a.chrome.loadTimes().wasFetchedViaSpdy),this.j=s?this.l:1,this.g=null,this.j>1&&(this.g=new Set),this.h=null,this.i=[]}function ih(s){return s.h?!0:s.g?s.g.size>=s.j:!1}function sh(s){return s.h?1:s.g?s.g.size:0}function jo(s,c){return s.h?s.h==c:s.g?s.g.has(c):!1}function Go(s,c){s.g?s.g.add(c):s.h=c}function oh(s,c){s.h&&s.h==c?s.h=null:s.g&&s.g.has(c)&&s.g.delete(c)}rh.prototype.cancel=function(){if(this.i=ah(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&this.g.size!==0){for(let s of this.g.values())s.cancel();this.g.clear()}};function ah(s){if(s.h!=null)return s.i.concat(s.h.G);if(s.g!=null&&s.g.size!==0){let c=s.i;for(let l of s.g.values())c=c.concat(l.G);return c}return R(s.i)}var ch=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function $g(s,c){if(s){s=s.split("&");for(let l=0;l<s.length;l++){let f=s[l].indexOf("="),A,S=null;f>=0?(A=s[l].substring(0,f),S=s[l].substring(f+1)):A=s[l],c(A,S?decodeURIComponent(S.replace(/\+/g," ")):"")}}}function At(s){this.g=this.o=this.j="",this.u=null,this.m=this.h="",this.l=!1;let c;s instanceof At?(this.l=s.l,mr(this,s.j),this.o=s.o,this.g=s.g,gr(this,s.u),this.h=s.h,zo(this,ph(s.i)),this.m=s.m):s&&(c=String(s).match(ch))?(this.l=!1,mr(this,c[1]||"",!0),this.o=_r(c[2]||""),this.g=_r(c[3]||"",!0),gr(this,c[4]),this.h=_r(c[5]||"",!0),zo(this,c[6]||"",!0),this.m=_r(c[7]||"")):(this.l=!1,this.i=new vr(null,this.l))}At.prototype.toString=function(){let s=[];var c=this.j;c&&s.push(yr(c,uh,!0),":");var l=this.g;return(l||c=="file")&&(s.push("//"),(c=this.o)&&s.push(yr(c,uh,!0),"@"),s.push(fr(l).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),l=this.u,l!=null&&s.push(":",String(l))),(l=this.h)&&(this.g&&l.charAt(0)!="/"&&s.push("/"),s.push(yr(l,l.charAt(0)=="/"?Kg:Wg,!0))),(l=this.i.toString())&&s.push("?",l),(l=this.m)&&s.push("#",yr(l,Jg)),s.join("")},At.prototype.resolve=function(s){let c=He(this),l=!!s.j;l?mr(c,s.j):l=!!s.o,l?c.o=s.o:l=!!s.g,l?c.g=s.g:l=s.u!=null;var f=s.h;if(l)gr(c,s.u);else if(l=!!s.h){if(f.charAt(0)!="/")if(this.g&&!this.h)f="/"+f;else{var A=c.h.lastIndexOf("/");A!=-1&&(f=c.h.slice(0,A+1)+f)}if(A=f,A==".."||A==".")f="";else if(A.indexOf("./")!=-1||A.indexOf("/.")!=-1){f=A.lastIndexOf("/",0)==0,A=A.split("/");let S=[];for(let D=0;D<A.length;){let j=A[D++];j=="."?f&&D==A.length&&S.push(""):j==".."?((S.length>1||S.length==1&&S[0]!="")&&S.pop(),f&&D==A.length&&S.push("")):(S.push(j),f=!0)}f=S.join("/")}else f=A}return l?c.h=f:l=s.i.toString()!=="",l?zo(c,ph(s.i)):l=!!s.m,l&&(c.m=s.m),c};function He(s){return new At(s)}function mr(s,c,l){s.j=l?_r(c,!0):c,s.j&&(s.j=s.j.replace(/:$/,""))}function gr(s,c){if(c){if(c=Number(c),isNaN(c)||c<0)throw Error("Bad port number "+c);s.u=c}else s.u=null}function zo(s,c,l){c instanceof vr?(s.i=c,Yg(s.i,s.l)):(l||(c=yr(c,Qg)),s.i=new vr(c,s.l))}function ee(s,c,l){s.i.set(c,l)}function wi(s){return ee(s,"zx",Math.floor(Math.random()*2147483648).toString(36)+Math.abs(Math.floor(Math.random()*2147483648)^Date.now()).toString(36)),s}function _r(s,c){return s?c?decodeURI(s.replace(/%25/g,"%2525")):decodeURIComponent(s):""}function yr(s,c,l){return typeof s=="string"?(s=encodeURI(s).replace(c,Hg),l&&(s=s.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),s):null}function Hg(s){return s=s.charCodeAt(0),"%"+(s>>4&15).toString(16)+(s&15).toString(16)}var uh=/[#\/\?@]/g,Wg=/[#\?:]/g,Kg=/[#\?]/g,Qg=/[#\?@]/g,Jg=/#/g;function vr(s,c){this.h=this.g=null,this.i=s||null,this.j=!!c}function Zt(s){s.g||(s.g=new Map,s.h=0,s.i&&$g(s.i,function(c,l){s.add(decodeURIComponent(c.replace(/\+/g," ")),l)}))}n=vr.prototype,n.add=function(s,c){Zt(this),this.i=null,s=Sn(this,s);let l=this.g.get(s);return l||this.g.set(s,l=[]),l.push(c),this.h+=1,this};function lh(s,c){Zt(s),c=Sn(s,c),s.g.has(c)&&(s.i=null,s.h-=s.g.get(c).length,s.g.delete(c))}function hh(s,c){return Zt(s),c=Sn(s,c),s.g.has(c)}n.forEach=function(s,c){Zt(this),this.g.forEach(function(l,f){l.forEach(function(A){s.call(c,A,f,this)},this)},this)};function dh(s,c){Zt(s);let l=[];if(typeof c=="string")hh(s,c)&&(l=l.concat(s.g.get(Sn(s,c))));else for(s=Array.from(s.g.values()),c=0;c<s.length;c++)l=l.concat(s[c]);return l}n.set=function(s,c){return Zt(this),this.i=null,s=Sn(this,s),hh(this,s)&&(this.h-=this.g.get(s).length),this.g.set(s,[c]),this.h+=1,this},n.get=function(s,c){return s?(s=dh(this,s),s.length>0?String(s[0]):c):c};function fh(s,c,l){lh(s,c),l.length>0&&(s.i=null,s.g.set(Sn(s,c),R(l)),s.h+=l.length)}n.toString=function(){if(this.i)return this.i;if(!this.g)return"";let s=[],c=Array.from(this.g.keys());for(let f=0;f<c.length;f++){var l=c[f];let A=fr(l);l=dh(this,l);for(let S=0;S<l.length;S++){let D=A;l[S]!==""&&(D+="="+fr(l[S])),s.push(D)}}return this.i=s.join("&")};function ph(s){let c=new vr;return c.i=s.i,s.g&&(c.g=new Map(s.g),c.h=s.h),c}function Sn(s,c){return c=String(c),s.j&&(c=c.toLowerCase()),c}function Yg(s,c){c&&!s.j&&(Zt(s),s.i=null,s.g.forEach(function(l,f){let A=f.toLowerCase();f!=A&&(lh(this,f),fh(this,A,l))},s)),s.j=c}function Xg(s,c){let l=new dr;if(a.Image){let f=new Image;f.onload=p(bt,l,"TestLoadImage: loaded",!0,c,f),f.onerror=p(bt,l,"TestLoadImage: error",!1,c,f),f.onabort=p(bt,l,"TestLoadImage: abort",!1,c,f),f.ontimeout=p(bt,l,"TestLoadImage: timeout",!1,c,f),a.setTimeout(function(){f.ontimeout&&f.ontimeout()},1e4),f.src=s}else c(!1)}function Zg(s,c){let l=new dr,f=new AbortController,A=setTimeout(()=>{f.abort(),bt(l,"TestPingServer: timeout",!1,c)},1e4);fetch(s,{signal:f.signal}).then(S=>{clearTimeout(A),S.ok?bt(l,"TestPingServer: ok",!0,c):bt(l,"TestPingServer: server error",!1,c)}).catch(()=>{clearTimeout(A),bt(l,"TestPingServer: error",!1,c)})}function bt(s,c,l,f,A){try{A&&(A.onload=null,A.onerror=null,A.onabort=null,A.ontimeout=null),f(l)}catch{}}function e_(){this.g=new xg}function Ei(s){this.i=s.Sb||null,this.h=s.ab||!1}v(Ei,zl),Ei.prototype.g=function(){return new Ti(this.i,this.h)};function Ti(s,c){Ie.call(this),this.H=s,this.o=c,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.A=new Headers,this.h=null,this.F="GET",this.D="",this.g=!1,this.B=this.j=this.l=null,this.v=new AbortController}v(Ti,Ie),n=Ti.prototype,n.open=function(s,c){if(this.readyState!=0)throw this.abort(),Error("Error reopening a connection");this.F=s,this.D=c,this.readyState=1,wr(this)},n.send=function(s){if(this.readyState!=1)throw this.abort(),Error("need to call open() first. ");if(this.v.signal.aborted)throw this.abort(),Error("Request was aborted.");this.g=!0;let c={headers:this.A,method:this.F,credentials:this.m,cache:void 0,signal:this.v.signal};s&&(c.body=s),(this.H||a).fetch(new Request(this.D,c)).then(this.Pa.bind(this),this.ga.bind(this))},n.abort=function(){this.response=this.responseText="",this.A=new Headers,this.status=0,this.v.abort(),this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),this.readyState>=1&&this.g&&this.readyState!=4&&(this.g=!1,Ir(this)),this.readyState=0},n.Pa=function(s){if(this.g&&(this.l=s,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=s.headers,this.readyState=2,wr(this)),this.g&&(this.readyState=3,wr(this),this.g)))if(this.responseType==="arraybuffer")s.arrayBuffer().then(this.Na.bind(this),this.ga.bind(this));else if(typeof a.ReadableStream<"u"&&"body"in s){if(this.j=s.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.B=new TextDecoder;mh(this)}else s.text().then(this.Oa.bind(this),this.ga.bind(this))};function mh(s){s.j.read().then(s.Ma.bind(s)).catch(s.ga.bind(s))}n.Ma=function(s){if(this.g){if(this.o&&s.value)this.response.push(s.value);else if(!this.o){var c=s.value?s.value:new Uint8Array(0);(c=this.B.decode(c,{stream:!s.done}))&&(this.response=this.responseText+=c)}s.done?Ir(this):wr(this),this.readyState==3&&mh(this)}},n.Oa=function(s){this.g&&(this.response=this.responseText=s,Ir(this))},n.Na=function(s){this.g&&(this.response=s,Ir(this))},n.ga=function(){this.g&&Ir(this)};function Ir(s){s.readyState=4,s.l=null,s.j=null,s.B=null,wr(s)}n.setRequestHeader=function(s,c){this.A.append(s,c)},n.getResponseHeader=function(s){return this.h&&this.h.get(s.toLowerCase())||""},n.getAllResponseHeaders=function(){if(!this.h)return"";let s=[],c=this.h.entries();for(var l=c.next();!l.done;)l=l.value,s.push(l[0]+": "+l[1]),l=c.next();return s.join(`\r
`)};function wr(s){s.onreadystatechange&&s.onreadystatechange.call(s)}Object.defineProperty(Ti.prototype,"withCredentials",{get:function(){return this.m==="include"},set:function(s){this.m=s?"include":"same-origin"}});function gh(s){let c="";return mi(s,function(l,f){c+=f,c+=":",c+=l,c+=`\r
`}),c}function $o(s,c,l){e:{for(f in l){var f=!1;break e}f=!0}f||(l=gh(l),typeof s=="string"?l!=null&&fr(l):ee(s,c,l))}function ie(s){Ie.call(this),this.headers=new Map,this.L=s||null,this.h=!1,this.g=null,this.D="",this.o=0,this.l="",this.j=this.B=this.v=this.A=!1,this.m=null,this.F="",this.H=!1}v(ie,Ie);var t_=/^https?$/i,n_=["POST","PUT"];n=ie.prototype,n.Fa=function(s){this.H=s},n.ea=function(s,c,l,f){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+s);c=c?c.toUpperCase():"GET",this.D=s,this.l="",this.o=0,this.A=!1,this.h=!0,this.g=this.L?this.L.g():Yl.g(),this.g.onreadystatechange=w(d(this.Ca,this));try{this.B=!0,this.g.open(c,String(s),!0),this.B=!1}catch(S){_h(this,S);return}if(s=l||"",l=new Map(this.headers),f)if(Object.getPrototypeOf(f)===Object.prototype)for(var A in f)l.set(A,f[A]);else if(typeof f.keys=="function"&&typeof f.get=="function")for(let S of f.keys())l.set(S,f.get(S));else throw Error("Unknown input type for opt_headers: "+String(f));f=Array.from(l.keys()).find(S=>S.toLowerCase()=="content-type"),A=a.FormData&&s instanceof a.FormData,!(Array.prototype.indexOf.call(n_,c,void 0)>=0)||f||A||l.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(let[S,D]of l)this.g.setRequestHeader(S,D);this.F&&(this.g.responseType=this.F),"withCredentials"in this.g&&this.g.withCredentials!==this.H&&(this.g.withCredentials=this.H);try{this.m&&(clearTimeout(this.m),this.m=null),this.v=!0,this.g.send(s),this.v=!1}catch(S){_h(this,S)}};function _h(s,c){s.h=!1,s.g&&(s.j=!0,s.g.abort(),s.j=!1),s.l=c,s.o=5,yh(s),Ai(s)}function yh(s){s.A||(s.A=!0,Ae(s,"complete"),Ae(s,"error"))}n.abort=function(s){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.o=s||7,Ae(this,"complete"),Ae(this,"abort"),Ai(this))},n.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),Ai(this,!0)),ie.Z.N.call(this)},n.Ca=function(){this.u||(this.B||this.v||this.j?vh(this):this.Xa())},n.Xa=function(){vh(this)};function vh(s){if(s.h&&typeof o<"u"){if(s.v&&St(s)==4)setTimeout(s.Ca.bind(s),0);else if(Ae(s,"readystatechange"),St(s)==4){s.h=!1;try{let S=s.ca();e:switch(S){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var c=!0;break e;default:c=!1}var l;if(!(l=c)){var f;if(f=S===0){let D=String(s.D).match(ch)[1]||null;!D&&a.self&&a.self.location&&(D=a.self.location.protocol.slice(0,-1)),f=!t_.test(D?D.toLowerCase():"")}l=f}if(l)Ae(s,"complete"),Ae(s,"success");else{s.o=6;try{var A=St(s)>2?s.g.statusText:""}catch{A=""}s.l=A+" ["+s.ca()+"]",yh(s)}}finally{Ai(s)}}}}function Ai(s,c){if(s.g){s.m&&(clearTimeout(s.m),s.m=null);let l=s.g;s.g=null,c||Ae(s,"ready");try{l.onreadystatechange=null}catch{}}}n.isActive=function(){return!!this.g};function St(s){return s.g?s.g.readyState:0}n.ca=function(){try{return St(this)>2?this.g.status:-1}catch{return-1}},n.la=function(){try{return this.g?this.g.responseText:""}catch{return""}},n.La=function(s){if(this.g){var c=this.g.responseText;return s&&c.indexOf(s)==0&&(c=c.substring(s.length)),Mg(c)}};function Ih(s){try{if(!s.g)return null;if("response"in s.g)return s.g.response;switch(s.F){case"":case"text":return s.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in s.g)return s.g.mozResponseArrayBuffer}return null}catch{return null}}function r_(s){let c={};s=(s.g&&St(s)>=2&&s.g.getAllResponseHeaders()||"").split(`\r
`);for(let f=0;f<s.length;f++){if(g(s[f]))continue;var l=qg(s[f]);let A=l[0];if(l=l[1],typeof l!="string")continue;l=l.trim();let S=c[A]||[];c[A]=S,S.push(l)}Dg(c,function(f){return f.join(", ")})}n.ya=function(){return this.o},n.Ha=function(){return typeof this.l=="string"?this.l:String(this.l)};function Er(s,c,l){return l&&l.internalChannelParams&&l.internalChannelParams[s]||c}function wh(s){this.za=0,this.i=[],this.j=new dr,this.ba=this.na=this.J=this.W=this.g=this.wa=this.G=this.H=this.u=this.U=this.o=null,this.Ya=this.V=0,this.Sa=Er("failFast",!1,s),this.F=this.C=this.v=this.m=this.l=null,this.X=!0,this.xa=this.K=-1,this.Y=this.A=this.D=0,this.Qa=Er("baseRetryDelayMs",5e3,s),this.Za=Er("retryDelaySeedMs",1e4,s),this.Ta=Er("forwardChannelMaxRetries",2,s),this.va=Er("forwardChannelRequestTimeoutMs",2e4,s),this.ma=s&&s.xmlHttpFactory||void 0,this.Ua=s&&s.Rb||void 0,this.Aa=s&&s.useFetchStreams||!1,this.O=void 0,this.L=s&&s.supportsCrossDomainXhr||!1,this.M="",this.h=new rh(s&&s.concurrentRequestLimit),this.Ba=new e_,this.S=s&&s.fastHandshake||!1,this.R=s&&s.encodeInitMessageHeaders||!1,this.S&&this.R&&(this.R=!1),this.Ra=s&&s.Pb||!1,s&&s.ua&&this.j.ua(),s&&s.forceLongPolling&&(this.X=!1),this.aa=!this.S&&this.X&&s&&s.detectBufferingProxy||!1,this.ia=void 0,s&&s.longPollingTimeout&&s.longPollingTimeout>0&&(this.ia=s.longPollingTimeout),this.ta=void 0,this.T=0,this.P=!1,this.ja=this.B=null}n=wh.prototype,n.ka=8,n.I=1,n.connect=function(s,c,l,f){be(0),this.W=s,this.H=c||{},l&&f!==void 0&&(this.H.OSID=l,this.H.OAID=f),this.F=this.X,this.J=Dh(this,null,this.W),Si(this)};function Ho(s){if(Eh(s),s.I==3){var c=s.V++,l=He(s.J);if(ee(l,"SID",s.M),ee(l,"RID",c),ee(l,"TYPE","terminate"),Tr(s,l),c=new Tt(s,s.j,c),c.M=2,c.A=wi(He(l)),l=!1,a.navigator&&a.navigator.sendBeacon)try{l=a.navigator.sendBeacon(c.A.toString(),"")}catch{}!l&&a.Image&&(new Image().src=c.A,l=!0),l||(c.g=Nh(c.j,null),c.g.ea(c.A)),c.F=Date.now(),Ii(c)}Ph(s)}function bi(s){s.g&&(Ko(s),s.g.cancel(),s.g=null)}function Eh(s){bi(s),s.v&&(a.clearTimeout(s.v),s.v=null),Ci(s),s.h.cancel(),s.m&&(typeof s.m=="number"&&a.clearTimeout(s.m),s.m=null)}function Si(s){if(!ih(s.h)&&!s.m){s.m=!0;var c=s.Ea;Se||m(),fe||(Se(),fe=!0),E.add(c,s),s.D=0}}function i_(s,c){return sh(s.h)>=s.h.j-(s.m?1:0)?!1:s.m?(s.i=c.G.concat(s.i),!0):s.I==1||s.I==2||s.D>=(s.Sa?0:s.Ta)?!1:(s.m=hr(d(s.Ea,s,c),Rh(s,s.D)),s.D++,!0)}n.Ea=function(s){if(this.m)if(this.m=null,this.I==1){if(!s){this.V=Math.floor(Math.random()*1e5),s=this.V++;let A=new Tt(this,this.j,s),S=this.o;if(this.U&&(S?(S=kl(S),Ml(S,this.U)):S=this.U),this.u!==null||this.R||(A.J=S,S=null),this.S)e:{for(var c=0,l=0;l<this.i.length;l++){t:{var f=this.i[l];if("__data__"in f.map&&(f=f.map.__data__,typeof f=="string")){f=f.length;break t}f=void 0}if(f===void 0)break;if(c+=f,c>4096){c=l;break e}if(c===4096||l===this.i.length-1){c=l+1;break e}}c=1e3}else c=1e3;c=Ah(this,A,c),l=He(this.J),ee(l,"RID",s),ee(l,"CVER",22),this.G&&ee(l,"X-HTTP-Session-Id",this.G),Tr(this,l),S&&(this.R?c="headers="+fr(gh(S))+"&"+c:this.u&&$o(l,this.u,S)),Go(this.h,A),this.Ra&&ee(l,"TYPE","init"),this.S?(ee(l,"$req",c),ee(l,"SID","null"),A.U=!0,Uo(A,l,null)):Uo(A,l,c),this.I=2}}else this.I==3&&(s?Th(this,s):this.i.length==0||ih(this.h)||Th(this))};function Th(s,c){var l;c?l=c.l:l=s.V++;let f=He(s.J);ee(f,"SID",s.M),ee(f,"RID",l),ee(f,"AID",s.K),Tr(s,f),s.u&&s.o&&$o(f,s.u,s.o),l=new Tt(s,s.j,l,s.D+1),s.u===null&&(l.J=s.o),c&&(s.i=c.G.concat(s.i)),c=Ah(s,l,1e3),l.H=Math.round(s.va*.5)+Math.round(s.va*.5*Math.random()),Go(s.h,l),Uo(l,f,c)}function Tr(s,c){s.H&&mi(s.H,function(l,f){ee(c,f,l)}),s.l&&mi({},function(l,f){ee(c,f,l)})}function Ah(s,c,l){l=Math.min(s.i.length,l);let f=s.l?d(s.l.Ka,s.l,s):null;e:{var A=s.i;let j=-1;for(;;){let de=["count="+l];j==-1?l>0?(j=A[0].g,de.push("ofs="+j)):j=0:de.push("ofs="+j);let X=!0;for(let pe=0;pe<l;pe++){var S=A[pe].g;let We=A[pe].map;if(S-=j,S<0)j=Math.max(0,A[pe].g-100),X=!1;else try{S="req"+S+"_"||"";try{var D=We instanceof Map?We:Object.entries(We);for(let[tn,Ct]of D){let Rt=Ct;u(Ct)&&(Rt=Oo(Ct)),de.push(S+tn+"="+encodeURIComponent(Rt))}}catch(tn){throw de.push(S+"type="+encodeURIComponent("_badmap")),tn}}catch{f&&f(We)}}if(X){D=de.join("&");break e}}D=void 0}return s=s.i.splice(0,l),c.G=s,D}function bh(s){if(!s.g&&!s.v){s.Y=1;var c=s.Da;Se||m(),fe||(Se(),fe=!0),E.add(c,s),s.A=0}}function Wo(s){return s.g||s.v||s.A>=3?!1:(s.Y++,s.v=hr(d(s.Da,s),Rh(s,s.A)),s.A++,!0)}n.Da=function(){if(this.v=null,Sh(this),this.aa&&!(this.P||this.g==null||this.T<=0)){var s=4*this.T;this.j.info("BP detection timer enabled: "+s),this.B=hr(d(this.Wa,this),s)}},n.Wa=function(){this.B&&(this.B=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.P=!0,be(10),bi(this),Sh(this))};function Ko(s){s.B!=null&&(a.clearTimeout(s.B),s.B=null)}function Sh(s){s.g=new Tt(s,s.j,"rpc",s.Y),s.u===null&&(s.g.J=s.o),s.g.P=0;var c=He(s.na);ee(c,"RID","rpc"),ee(c,"SID",s.M),ee(c,"AID",s.K),ee(c,"CI",s.F?"0":"1"),!s.F&&s.ia&&ee(c,"TO",s.ia),ee(c,"TYPE","xmlhttp"),Tr(s,c),s.u&&s.o&&$o(c,s.u,s.o),s.O&&(s.g.H=s.O);var l=s.g;s=s.ba,l.M=1,l.A=wi(He(c)),l.u=null,l.R=!0,eh(l,s)}n.Va=function(){this.C!=null&&(this.C=null,bi(this),Wo(this),be(19))};function Ci(s){s.C!=null&&(a.clearTimeout(s.C),s.C=null)}function Ch(s,c){var l=null;if(s.g==c){Ci(s),Ko(s),s.g=null;var f=2}else if(jo(s.h,c))l=c.G,oh(s.h,c),f=1;else return;if(s.I!=0){if(c.o)if(f==1){l=c.u?c.u.length:0,c=Date.now()-c.F;var A=s.D;f=yi(),Ae(f,new Ql(f,l)),Si(s)}else bh(s);else if(A=c.m,A==3||A==0&&c.X>0||!(f==1&&i_(s,c)||f==2&&Wo(s)))switch(l&&l.length>0&&(c=s.h,c.i=c.i.concat(l)),A){case 1:en(s,5);break;case 4:en(s,10);break;case 3:en(s,6);break;default:en(s,2)}}}function Rh(s,c){let l=s.Qa+Math.floor(Math.random()*s.Za);return s.isActive()||(l*=2),l*c}function en(s,c){if(s.j.info("Error code "+c),c==2){var l=d(s.bb,s),f=s.Ua;let A=!f;f=new At(f||"//www.google.com/images/cleardot.gif"),a.location&&a.location.protocol=="http"||mr(f,"https"),wi(f),A?Xg(f.toString(),l):Zg(f.toString(),l)}else be(2);s.I=0,s.l&&s.l.pa(c),Ph(s),Eh(s)}n.bb=function(s){s?(this.j.info("Successfully pinged google.com"),be(2)):(this.j.info("Failed to ping google.com"),be(1))};function Ph(s){if(s.I=0,s.ja=[],s.l){let c=ah(s.h);(c.length!=0||s.i.length!=0)&&(k(s.ja,c),k(s.ja,s.i),s.h.i.length=0,R(s.i),s.i.length=0),s.l.oa()}}function Dh(s,c,l){var f=l instanceof At?He(l):new At(l);if(f.g!="")c&&(f.g=c+"."+f.g),gr(f,f.u);else{var A=a.location;f=A.protocol,c=c?c+"."+A.hostname:A.hostname,A=+A.port;let S=new At(null);f&&mr(S,f),c&&(S.g=c),A&&gr(S,A),l&&(S.h=l),f=S}return l=s.G,c=s.wa,l&&c&&ee(f,l,c),ee(f,"VER",s.ka),Tr(s,f),f}function Nh(s,c,l){if(c&&!s.L)throw Error("Can't create secondary domain capable XhrIo object.");return c=s.Aa&&!s.ma?new ie(new Ei({ab:l})):new ie(s.ma),c.Fa(s.L),c}n.isActive=function(){return!!this.l&&this.l.isActive(this)};function Vh(){}n=Vh.prototype,n.ra=function(){},n.qa=function(){},n.pa=function(){},n.oa=function(){},n.isActive=function(){return!0},n.Ka=function(){};function Ri(){}Ri.prototype.g=function(s,c){return new Ne(s,c)};function Ne(s,c){Ie.call(this),this.g=new wh(c),this.l=s,this.h=c&&c.messageUrlParams||null,s=c&&c.messageHeaders||null,c&&c.clientProtocolHeaderRequired&&(s?s["X-Client-Protocol"]="webchannel":s={"X-Client-Protocol":"webchannel"}),this.g.o=s,s=c&&c.initMessageHeaders||null,c&&c.messageContentType&&(s?s["X-WebChannel-Content-Type"]=c.messageContentType:s={"X-WebChannel-Content-Type":c.messageContentType}),c&&c.sa&&(s?s["X-WebChannel-Client-Profile"]=c.sa:s={"X-WebChannel-Client-Profile":c.sa}),this.g.U=s,(s=c&&c.Qb)&&!g(s)&&(this.g.u=s),this.A=c&&c.supportsCrossDomainXhr||!1,this.v=c&&c.sendRawJson||!1,(c=c&&c.httpSessionIdParam)&&!g(c)&&(this.g.G=c,s=this.h,s!==null&&c in s&&(s=this.h,c in s&&delete s[c])),this.j=new Cn(this)}v(Ne,Ie),Ne.prototype.m=function(){this.g.l=this.j,this.A&&(this.g.L=!0),this.g.connect(this.l,this.h||void 0)},Ne.prototype.close=function(){Ho(this.g)},Ne.prototype.o=function(s){var c=this.g;if(typeof s=="string"){var l={};l.__data__=s,s=l}else this.v&&(l={},l.__data__=Oo(s),s=l);c.i.push(new zg(c.Ya++,s)),c.I==3&&Si(c)},Ne.prototype.N=function(){this.g.l=null,delete this.j,Ho(this.g),delete this.g,Ne.Z.N.call(this)};function kh(s){Mo.call(this),s.__headers__&&(this.headers=s.__headers__,this.statusCode=s.__status__,delete s.__headers__,delete s.__status__);var c=s.__sm__;if(c){e:{for(let l in c){s=l;break e}s=void 0}(this.i=s)&&(s=this.i,c=c!==null&&s in c?c[s]:void 0),this.data=c}else this.data=s}v(kh,Mo);function Oh(){xo.call(this),this.status=1}v(Oh,xo);function Cn(s){this.g=s}v(Cn,Vh),Cn.prototype.ra=function(){Ae(this.g,"a")},Cn.prototype.qa=function(s){Ae(this.g,new kh(s))},Cn.prototype.pa=function(s){Ae(this.g,new Oh)},Cn.prototype.oa=function(){Ae(this.g,"b")},Ri.prototype.createWebChannel=Ri.prototype.g,Ne.prototype.send=Ne.prototype.o,Ne.prototype.open=Ne.prototype.m,Ne.prototype.close=Ne.prototype.close,fc=pt.createWebChannelTransport=function(){return new Ri},dc=pt.getStatEventTarget=function(){return yi()},hc=pt.Event=Yt,bs=pt.Stat={jb:0,mb:1,nb:2,Hb:3,Mb:4,Jb:5,Kb:6,Ib:7,Gb:8,Lb:9,PROXY:10,NOPROXY:11,Eb:12,Ab:13,Bb:14,zb:15,Cb:16,Db:17,fb:18,eb:19,gb:20},vi.NO_ERROR=0,vi.TIMEOUT=8,vi.HTTP_ERROR=6,Hr=pt.ErrorCode=vi,Jl.COMPLETE="complete",lc=pt.EventType=Jl,$l.EventType=ur,ur.OPEN="a",ur.CLOSE="b",ur.ERROR="c",ur.MESSAGE="d",Ie.prototype.listen=Ie.prototype.J,Mn=pt.WebChannel=$l,KI=pt.FetchXmlHttpFactory=Ei,ie.prototype.listenOnce=ie.prototype.K,ie.prototype.getLastError=ie.prototype.Ha,ie.prototype.getLastErrorCode=ie.prototype.ya,ie.prototype.getStatus=ie.prototype.ca,ie.prototype.getResponseJson=ie.prototype.La,ie.prototype.getResponseText=ie.prototype.la,ie.prototype.send=ie.prototype.ea,ie.prototype.setWithCredentials=ie.prototype.Fa,uc=pt.XhrIo=ie}).apply(typeof As<"u"?As:typeof self<"u"?self:typeof window<"u"?window:{});var sp="@firebase/firestore",op="4.9.2";var _e=class{constructor(e){this.uid=e}isAuthenticated(){return this.uid!=null}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}};_e.UNAUTHENTICATED=new _e(null),_e.GOOGLE_CREDENTIALS=new _e("google-credentials-uid"),_e.FIRST_PARTY=new _e("first-party-uid"),_e.MOCK_USER=new _e("mock-user");var rr="12.3.0";var gn=new Mt("@firebase/firestore");function xn(){return gn.logLevel}function O(n,...e){if(gn.logLevel<=z.DEBUG){let t=e.map(il);gn.debug(`Firestore (${rr}): ${n}`,...t)}}function mt(n,...e){if(gn.logLevel<=z.ERROR){let t=e.map(il);gn.error(`Firestore (${rr}): ${n}`,...t)}}function zn(n,...e){if(gn.logLevel<=z.WARN){let t=e.map(il);gn.warn(`Firestore (${rr}): ${n}`,...t)}}function il(n){if(typeof n=="string")return n;try{return(function(t){return JSON.stringify(t)})(n)}catch{return n}}function F(n,e,t){let r="Unexpected state";typeof e=="string"?r=e:t=e,Qp(n,r,t)}function Qp(n,e,t){let r=`FIRESTORE (${rr}) INTERNAL ASSERTION FAILED: ${e} (ID: ${n.toString(16)})`;if(t!==void 0)try{r+=" CONTEXT: "+JSON.stringify(t)}catch{r+=" CONTEXT: "+t}throw mt(r),new Error(r)}function Y(n,e,t,r){let i="Unexpected state";typeof t=="string"?i=t:r=t,n||Qp(e,i,r)}function B(n,e){return n}var C={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"},V=class extends ke{constructor(e,t){super(e,t),this.code=e,this.message=t,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}};var je=class{constructor(){this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}};var Vs=class{constructor(e,t){this.user=t,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}},vc=class{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,t){e.enqueueRetryable(()=>t(_e.UNAUTHENTICATED))}shutdown(){}},Ic=class{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,t){this.changeListener=t,e.enqueueRetryable(()=>t(this.token.user))}shutdown(){this.changeListener=null}},wc=class{constructor(e){this.t=e,this.currentUser=_e.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,t){Y(this.o===void 0,42304);let r=this.i,i=h=>this.i!==r?(r=this.i,t(h)):Promise.resolve(),o=new je;this.o=()=>{this.i++,this.currentUser=this.u(),o.resolve(),o=new je,e.enqueueRetryable(()=>i(this.currentUser))};let a=()=>{let h=o;e.enqueueRetryable(()=>_(this,null,function*(){yield h.promise,yield i(this.currentUser)}))},u=h=>{O("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=h,this.o&&(this.auth.addAuthTokenListener(this.o),a())};this.t.onInit(h=>u(h)),setTimeout(()=>{if(!this.auth){let h=this.t.getImmediate({optional:!0});h?u(h):(O("FirebaseAuthCredentialsProvider","Auth not yet detected"),o.resolve(),o=new je)}},0),a()}getToken(){let e=this.i,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then(r=>this.i!==e?(O("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):r?(Y(typeof r.accessToken=="string",31837,{l:r}),new Vs(r.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.o&&this.auth.removeAuthTokenListener(this.o),this.o=void 0}u(){let e=this.auth&&this.auth.getUid();return Y(e===null||typeof e=="string",2055,{h:e}),new _e(e)}},Ec=class{constructor(e,t,r){this.P=e,this.T=t,this.I=r,this.type="FirstParty",this.user=_e.FIRST_PARTY,this.A=new Map}R(){return this.I?this.I():null}get headers(){this.A.set("X-Goog-AuthUser",this.P);let e=this.R();return e&&this.A.set("Authorization",e),this.T&&this.A.set("X-Goog-Iam-Authorization-Token",this.T),this.A}},Tc=class{constructor(e,t,r){this.P=e,this.T=t,this.I=r}getToken(){return Promise.resolve(new Ec(this.P,this.T,this.I))}start(e,t){e.enqueueRetryable(()=>t(_e.FIRST_PARTY))}shutdown(){}invalidateToken(){}},ks=class{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}},Ac=class{constructor(e,t){this.V=t,this.forceRefresh=!1,this.appCheck=null,this.m=null,this.p=null,Oe(e)&&e.settings.appCheckToken&&(this.p=e.settings.appCheckToken)}start(e,t){Y(this.o===void 0,3512);let r=o=>{o.error!=null&&O("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${o.error.message}`);let a=o.token!==this.m;return this.m=o.token,O("FirebaseAppCheckTokenProvider",`Received ${a?"new":"existing"} token.`),a?t(o.token):Promise.resolve()};this.o=o=>{e.enqueueRetryable(()=>r(o))};let i=o=>{O("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=o,this.o&&this.appCheck.addTokenListener(this.o)};this.V.onInit(o=>i(o)),setTimeout(()=>{if(!this.appCheck){let o=this.V.getImmediate({optional:!0});o?i(o):O("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){if(this.p)return Promise.resolve(new ks(this.p));let e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then(t=>t?(Y(typeof t.token=="string",44558,{tokenResult:t}),this.m=t.token,new ks(t.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.o&&this.appCheck.removeTokenListener(this.o),this.o=void 0}};function QI(n){let e=typeof self<"u"&&(self.crypto||self.msCrypto),t=new Uint8Array(n);if(e&&typeof e.getRandomValues=="function")e.getRandomValues(t);else for(let r=0;r<n;r++)t[r]=Math.floor(256*Math.random());return t}var Xr=class{static newId(){let e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",t=62*Math.floor(4.129032258064516),r="";for(;r.length<20;){let i=QI(40);for(let o=0;o<i.length;++o)r.length<20&&i[o]<t&&(r+=e.charAt(i[o]%62))}return r}};function $(n,e){return n<e?-1:n>e?1:0}function bc(n,e){let t=Math.min(n.length,e.length);for(let r=0;r<t;r++){let i=n.charAt(r),o=e.charAt(r);if(i!==o)return pc(i)===pc(o)?$(i,o):pc(i)?1:-1}return $(n.length,e.length)}var JI=55296,YI=57343;function pc(n){let e=n.charCodeAt(0);return e>=JI&&e<=YI}function $n(n,e,t){return n.length===e.length&&n.every((r,i)=>t(r,e[i]))}var ap="__name__",Os=class n{constructor(e,t,r){t===void 0?t=0:t>e.length&&F(637,{offset:t,range:e.length}),r===void 0?r=e.length-t:r>e.length-t&&F(1746,{length:r,range:e.length-t}),this.segments=e,this.offset=t,this.len=r}get length(){return this.len}isEqual(e){return n.comparator(this,e)===0}child(e){let t=this.segments.slice(this.offset,this.limit());return e instanceof n?e.forEach(r=>{t.push(r)}):t.push(e),this.construct(t)}limit(){return this.offset+this.length}popFirst(e){return e=e===void 0?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return this.length===0}isPrefixOf(e){if(e.length<this.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}forEach(e){for(let t=this.offset,r=this.limit();t<r;t++)e(this.segments[t])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,t){let r=Math.min(e.length,t.length);for(let i=0;i<r;i++){let o=n.compareSegments(e.get(i),t.get(i));if(o!==0)return o}return $(e.length,t.length)}static compareSegments(e,t){let r=n.isNumericId(e),i=n.isNumericId(t);return r&&!i?-1:!r&&i?1:r&&i?n.extractNumericId(e).compare(n.extractNumericId(t)):bc(e,t)}static isNumericId(e){return e.startsWith("__id")&&e.endsWith("__")}static extractNumericId(e){return ft.fromString(e.substring(4,e.length-2))}},ne=class n extends Os{construct(e,t,r){return new n(e,t,r)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...e){let t=[];for(let r of e){if(r.indexOf("//")>=0)throw new V(C.INVALID_ARGUMENT,`Invalid segment (${r}). Paths must not contain // in them.`);t.push(...r.split("/").filter(i=>i.length>0))}return new n(t)}static emptyPath(){return new n([])}},XI=/^[_a-zA-Z][_a-zA-Z0-9]*$/,xe=class n extends Os{construct(e,t,r){return new n(e,t,r)}static isValidIdentifier(e){return XI.test(e)}canonicalString(){return this.toArray().map(e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),n.isValidIdentifier(e)||(e="`"+e+"`"),e)).join(".")}toString(){return this.canonicalString()}isKeyField(){return this.length===1&&this.get(0)===ap}static keyField(){return new n([ap])}static fromServerFormat(e){let t=[],r="",i=0,o=()=>{if(r.length===0)throw new V(C.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);t.push(r),r=""},a=!1;for(;i<e.length;){let u=e[i];if(u==="\\"){if(i+1===e.length)throw new V(C.INVALID_ARGUMENT,"Path has trailing escape character: "+e);let h=e[i+1];if(h!=="\\"&&h!=="."&&h!=="`")throw new V(C.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);r+=h,i+=2}else u==="`"?(a=!a,i++):u!=="."||a?(r+=u,i++):(o(),i++)}if(o(),a)throw new V(C.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new n(t)}static emptyPath(){return new n([])}};var x=class n{constructor(e){this.path=e}static fromPath(e){return new n(ne.fromString(e))}static fromName(e){return new n(ne.fromString(e).popFirst(5))}static empty(){return new n(ne.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return e!==null&&ne.comparator(this.path,e.path)===0}toString(){return this.path.toString()}static comparator(e,t){return ne.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new n(new ne(e.slice()))}};function Jp(n,e,t){if(!t)throw new V(C.INVALID_ARGUMENT,`Function ${n}() cannot be called with an empty ${e}.`)}function ZI(n,e,t,r){if(e===!0&&r===!0)throw new V(C.INVALID_ARGUMENT,`${n} and ${t} cannot be used together.`)}function cp(n){if(!x.isDocumentKey(n))throw new V(C.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${n} has ${n.length}.`)}function up(n){if(x.isDocumentKey(n))throw new V(C.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${n} has ${n.length}.`)}function Yp(n){return typeof n=="object"&&n!==null&&(Object.getPrototypeOf(n)===Object.prototype||Object.getPrototypeOf(n)===null)}function mo(n){if(n===void 0)return"undefined";if(n===null)return"null";if(typeof n=="string")return n.length>20&&(n=`${n.substring(0,20)}...`),JSON.stringify(n);if(typeof n=="number"||typeof n=="boolean")return""+n;if(typeof n=="object"){if(n instanceof Array)return"an array";{let e=(function(r){return r.constructor?r.constructor.name:null})(n);return e?`a custom ${e} object`:"an object"}}return typeof n=="function"?"a function":F(12329,{type:typeof n})}function Ge(n,e){if("_delegate"in n&&(n=n._delegate),!(n instanceof e)){if(e.name===n.constructor.name)throw new V(C.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{let t=mo(n);throw new V(C.INVALID_ARGUMENT,`Expected type '${e.name}', but it was: ${t}`)}}return n}function ew(n,e){if(e<=0)throw new V(C.INVALID_ARGUMENT,`Function ${n}() requires a positive number, but it was: ${e}.`)}function he(n,e){let t={typeString:n};return e&&(t.value=e),t}function li(n,e){if(!Yp(n))throw new V(C.INVALID_ARGUMENT,"JSON must be an object");let t;for(let r in e)if(e[r]){let i=e[r].typeString,o="value"in e[r]?{value:e[r].value}:void 0;if(!(r in n)){t=`JSON missing required field: '${r}'`;break}let a=n[r];if(i&&typeof a!==i){t=`JSON field '${r}' must be a ${i}.`;break}if(o!==void 0&&a!==o.value){t=`Expected '${r}' field to equal '${o.value}'`;break}}if(t)throw new V(C.INVALID_ARGUMENT,t);return!0}var lp=-62135596800,hp=1e6,se=class n{static now(){return n.fromMillis(Date.now())}static fromDate(e){return n.fromMillis(e.getTime())}static fromMillis(e){let t=Math.floor(e/1e3),r=Math.floor((e-1e3*t)*hp);return new n(t,r)}constructor(e,t){if(this.seconds=e,this.nanoseconds=t,t<0)throw new V(C.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(t>=1e9)throw new V(C.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(e<lp)throw new V(C.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new V(C.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/hp}_compareTo(e){return this.seconds===e.seconds?$(this.nanoseconds,e.nanoseconds):$(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{type:n._jsonSchemaVersion,seconds:this.seconds,nanoseconds:this.nanoseconds}}static fromJSON(e){if(li(e,n._jsonSchema))return new n(e.seconds,e.nanoseconds)}valueOf(){let e=this.seconds-lp;return String(e).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}};se._jsonSchemaVersion="firestore/timestamp/1.0",se._jsonSchema={type:he("string",se._jsonSchemaVersion),seconds:he("number"),nanoseconds:he("number")};var q=class n{static fromTimestamp(e){return new n(e)}static min(){return new n(new se(0,0))}static max(){return new n(new se(253402300799,999999999))}constructor(e){this.timestamp=e}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}};var Zr=-1,Sc=class{constructor(e,t,r,i){this.indexId=e,this.collectionGroup=t,this.fields=r,this.indexState=i}};Sc.UNKNOWN_ID=-1;function tw(n,e){let t=n.toTimestamp().seconds,r=n.toTimestamp().nanoseconds+1,i=q.fromTimestamp(r===1e9?new se(t+1,0):new se(t,r));return new _n(i,x.empty(),e)}function nw(n){return new _n(n.readTime,n.key,Zr)}var _n=class n{constructor(e,t,r){this.readTime=e,this.documentKey=t,this.largestBatchId=r}static min(){return new n(q.min(),x.empty(),Zr)}static max(){return new n(q.max(),x.empty(),Zr)}};function rw(n,e){let t=n.readTime.compareTo(e.readTime);return t!==0?t:(t=x.comparator(n.documentKey,e.documentKey),t!==0?t:$(n.largestBatchId,e.largestBatchId))}var iw="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.",Cc=class{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(e=>e())}};function ir(n){return _(this,null,function*(){if(n.code!==C.FAILED_PRECONDITION||n.message!==iw)throw n;O("LocalStore","Unexpectedly lost primary lease")})}var P=class n{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e(t=>{this.isDone=!0,this.result=t,this.nextCallback&&this.nextCallback(t)},t=>{this.isDone=!0,this.error=t,this.catchCallback&&this.catchCallback(t)})}catch(e){return this.next(void 0,e)}next(e,t){return this.callbackAttached&&F(59440),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(t,this.error):this.wrapSuccess(e,this.result):new n((r,i)=>{this.nextCallback=o=>{this.wrapSuccess(e,o).next(r,i)},this.catchCallback=o=>{this.wrapFailure(t,o).next(r,i)}})}toPromise(){return new Promise((e,t)=>{this.next(e,t)})}wrapUserFunction(e){try{let t=e();return t instanceof n?t:n.resolve(t)}catch(t){return n.reject(t)}}wrapSuccess(e,t){return e?this.wrapUserFunction(()=>e(t)):n.resolve(t)}wrapFailure(e,t){return e?this.wrapUserFunction(()=>e(t)):n.reject(t)}static resolve(e){return new n((t,r)=>{t(e)})}static reject(e){return new n((t,r)=>{r(e)})}static waitFor(e){return new n((t,r)=>{let i=0,o=0,a=!1;e.forEach(u=>{++i,u.next(()=>{++o,a&&o===i&&t()},h=>r(h))}),a=!0,o===i&&t()})}static or(e){let t=n.resolve(!1);for(let r of e)t=t.next(i=>i?n.resolve(i):r());return t}static forEach(e,t){let r=[];return e.forEach((i,o)=>{r.push(t.call(this,i,o))}),this.waitFor(r)}static mapArray(e,t){return new n((r,i)=>{let o=e.length,a=new Array(o),u=0;for(let h=0;h<o;h++){let d=h;t(e[d]).next(p=>{a[d]=p,++u,u===o&&r(a)},p=>i(p))}})}static doWhile(e,t){return new n((r,i)=>{let o=()=>{e()===!0?t().next(()=>{o()},i):r()};o()})}};function sw(n){let e=n.match(/Android ([\d.]+)/i),t=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(t)}function sr(n){return n.name==="IndexedDbTransactionError"}var sl=(()=>{class n{constructor(t,r){this.previousValue=t,r&&(r.sequenceNumberHandler=i=>this.ae(i),this.ue=i=>r.writeSequenceNumber(i))}ae(t){return this.previousValue=Math.max(t,this.previousValue),this.previousValue}next(){let t=++this.previousValue;return this.ue&&this.ue(t),t}}n.ce=-1;return n})(),ol=-1;function go(n){return n==null}function ei(n){return n===0&&1/n==-1/0}function ow(n){return typeof n=="number"&&Number.isInteger(n)&&!ei(n)&&n<=Number.MAX_SAFE_INTEGER&&n>=Number.MIN_SAFE_INTEGER}var Xp="";function aw(n){let e="";for(let t=0;t<n.length;t++)e.length>0&&(e=dp(e)),e=cw(n.get(t),e);return dp(e)}function cw(n,e){let t=e,r=n.length;for(let i=0;i<r;i++){let o=n.charAt(i);switch(o){case"\0":t+="";break;case Xp:t+="";break;default:t+=o}}return t}function dp(n){return n+Xp+""}var uw="remoteDocuments",Zp="owner";var em="mutationQueues";var tm="mutations";var nm="documentMutations",lw="remoteDocumentsV14";var rm="remoteDocumentGlobal";var im="targets";var sm="targetDocuments";var om="targetGlobal",am="collectionParents";var cm="clientMetadata";var um="bundles";var lm="namedQueries";var hw="indexConfiguration";var dw="indexState";var fw="indexEntries";var hm="documentOverlays";var pw="globals";var mw=[em,tm,nm,uw,im,Zp,om,sm,cm,rm,am,um,lm],Wb=[...mw,hm],gw=[em,tm,nm,lw,im,Zp,om,sm,cm,rm,am,um,lm,hm],_w=gw,yw=[..._w,hw,dw,fw];var Kb=[...yw,pw];function fp(n){let e=0;for(let t in n)Object.prototype.hasOwnProperty.call(n,t)&&e++;return e}function Jt(n,e){for(let t in n)Object.prototype.hasOwnProperty.call(n,t)&&e(t,n[t])}function dm(n){for(let e in n)if(Object.prototype.hasOwnProperty.call(n,e))return!1;return!0}var oe=class n{constructor(e,t){this.comparator=e,this.root=t||et.EMPTY}insert(e,t){return new n(this.comparator,this.root.insert(e,t,this.comparator).copy(null,null,et.BLACK,null,null))}remove(e){return new n(this.comparator,this.root.remove(e,this.comparator).copy(null,null,et.BLACK,null,null))}get(e){let t=this.root;for(;!t.isEmpty();){let r=this.comparator(e,t.key);if(r===0)return t.value;r<0?t=t.left:r>0&&(t=t.right)}return null}indexOf(e){let t=0,r=this.root;for(;!r.isEmpty();){let i=this.comparator(e,r.key);if(i===0)return t+r.left.size;i<0?r=r.left:(t+=r.left.size+1,r=r.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal((t,r)=>(e(t,r),!1))}toString(){let e=[];return this.inorderTraversal((t,r)=>(e.push(`${t}:${r}`),!1)),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new Bn(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new Bn(this.root,e,this.comparator,!1)}getReverseIterator(){return new Bn(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new Bn(this.root,e,this.comparator,!0)}},Bn=class{constructor(e,t,r,i){this.isReverse=i,this.nodeStack=[];let o=1;for(;!e.isEmpty();)if(o=t?r(e.key,t):1,t&&i&&(o*=-1),o<0)e=this.isReverse?e.left:e.right;else{if(o===0){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop(),t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}hasNext(){return this.nodeStack.length>0}peek(){if(this.nodeStack.length===0)return null;let e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}},et=class n{constructor(e,t,r,i,o){this.key=e,this.value=t,this.color=r??n.RED,this.left=i??n.EMPTY,this.right=o??n.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,t,r,i,o){return new n(e??this.key,t??this.value,r??this.color,i??this.left,o??this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,r){let i=this,o=r(e,i.key);return i=o<0?i.copy(null,null,null,i.left.insert(e,t,r),null):o===0?i.copy(null,t,null,null,null):i.copy(null,null,null,null,i.right.insert(e,t,r)),i.fixUp()}removeMin(){if(this.left.isEmpty())return n.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,t){let r,i=this;if(t(e,i.key)<0)i.left.isEmpty()||i.left.isRed()||i.left.left.isRed()||(i=i.moveRedLeft()),i=i.copy(null,null,null,i.left.remove(e,t),null);else{if(i.left.isRed()&&(i=i.rotateRight()),i.right.isEmpty()||i.right.isRed()||i.right.left.isRed()||(i=i.moveRedRight()),t(e,i.key)===0){if(i.right.isEmpty())return n.EMPTY;r=i.right.min(),i=i.copy(r.key,r.value,null,null,i.right.removeMin())}i=i.copy(null,null,null,null,i.right.remove(e,t))}return i.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){let e=this.copy(null,null,n.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){let e=this.copy(null,null,n.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){let e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth(){let e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed())throw F(43730,{key:this.key,value:this.value});if(this.right.isRed())throw F(14113,{key:this.key,value:this.value});let e=this.left.check();if(e!==this.right.check())throw F(27949);return e+(this.isRed()?0:1)}};et.EMPTY=null,et.RED=!0,et.BLACK=!1;et.EMPTY=new class{constructor(){this.size=0}get key(){throw F(57766)}get value(){throw F(16141)}get color(){throw F(16727)}get left(){throw F(29726)}get right(){throw F(36894)}copy(e,t,r,i,o){return this}insert(e,t,r){return new et(e,t)}remove(e,t){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};var ye=class n{constructor(e){this.comparator=e,this.data=new oe(this.comparator)}has(e){return this.data.get(e)!==null}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal((t,r)=>(e(t),!1))}forEachInRange(e,t){let r=this.data.getIteratorFrom(e[0]);for(;r.hasNext();){let i=r.getNext();if(this.comparator(i.key,e[1])>=0)return;t(i.key)}}forEachWhile(e,t){let r;for(r=t!==void 0?this.data.getIteratorFrom(t):this.data.getIterator();r.hasNext();)if(!e(r.getNext().key))return}firstAfterOrEqual(e){let t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}getIterator(){return new Ms(this.data.getIterator())}getIteratorFrom(e){return new Ms(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let t=this;return t.size<e.size&&(t=e,e=this),e.forEach(r=>{t=t.add(r)}),t}isEqual(e){if(!(e instanceof n)||this.size!==e.size)return!1;let t=this.data.getIterator(),r=e.data.getIterator();for(;t.hasNext();){let i=t.getNext().key,o=r.getNext().key;if(this.comparator(i,o)!==0)return!1}return!0}toArray(){let e=[];return this.forEach(t=>{e.push(t)}),e}toString(){let e=[];return this.forEach(t=>e.push(t)),"SortedSet("+e.toString()+")"}copy(e){let t=new n(this.comparator);return t.data=e,t}},Ms=class{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}};var Be=class n{constructor(e){this.fields=e,e.sort(xe.comparator)}static empty(){return new n([])}unionWith(e){let t=new ye(xe.comparator);for(let r of this.fields)t=t.add(r);for(let r of e)t=t.add(r);return new n(t.toArray())}covers(e){for(let t of this.fields)if(t.isPrefixOf(e))return!0;return!1}isEqual(e){return $n(this.fields,e.fields,(t,r)=>t.isEqual(r))}};var xs=class extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}};var Ee=class n{constructor(e){this.binaryString=e}static fromBase64String(e){let t=(function(i){try{return atob(i)}catch(o){throw typeof DOMException<"u"&&o instanceof DOMException?new xs("Invalid base64 string: "+o):o}})(e);return new n(t)}static fromUint8Array(e){let t=(function(i){let o="";for(let a=0;a<i.length;++a)o+=String.fromCharCode(i[a]);return o})(e);return new n(t)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return(function(t){return btoa(t)})(this.binaryString)}toUint8Array(){return(function(t){let r=new Uint8Array(t.length);for(let i=0;i<t.length;i++)r[i]=t.charCodeAt(i);return r})(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return $(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}};Ee.EMPTY_BYTE_STRING=new Ee("");var vw=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function gt(n){if(Y(!!n,39018),typeof n=="string"){let e=0,t=vw.exec(n);if(Y(!!t,46558,{timestamp:n}),t[1]){let i=t[1];i=(i+"000000000").substr(0,9),e=Number(i)}let r=new Date(n);return{seconds:Math.floor(r.getTime()/1e3),nanos:e}}return{seconds:te(n.seconds),nanos:te(n.nanos)}}function te(n){return typeof n=="number"?n:typeof n=="string"?Number(n):0}function _t(n){return typeof n=="string"?Ee.fromBase64String(n):Ee.fromUint8Array(n)}var fm="server_timestamp",pm="__type__",mm="__previous_value__",gm="__local_write_time__";function al(n){return(n?.mapValue?.fields||{})[pm]?.stringValue===fm}function _o(n){let e=n.mapValue.fields[mm];return al(e)?_o(e):e}function ti(n){let e=gt(n.mapValue.fields[gm].timestampValue);return new se(e.seconds,e.nanos)}var Rc=class{constructor(e,t,r,i,o,a,u,h,d,p){this.databaseId=e,this.appId=t,this.persistenceKey=r,this.host=i,this.ssl=o,this.forceLongPolling=a,this.autoDetectLongPolling=u,this.longPollingOptions=h,this.useFetchStreams=d,this.isUsingEmulator=p}},Fs="(default)",Ls=class n{constructor(e,t){this.projectId=e,this.database=t||Fs}static empty(){return new n("","")}get isDefaultDatabase(){return this.database===Fs}isEqual(e){return e instanceof n&&e.projectId===this.projectId&&e.database===this.database}};var cl="__type__",_m="__max__",Ss={mapValue:{fields:{__type__:{stringValue:_m}}}},ul="__vector__",Hn="value";function $t(n){return"nullValue"in n?0:"booleanValue"in n?1:"integerValue"in n||"doubleValue"in n?2:"timestampValue"in n?3:"stringValue"in n?5:"bytesValue"in n?6:"referenceValue"in n?7:"geoPointValue"in n?8:"arrayValue"in n?9:"mapValue"in n?al(n)?4:vm(n)?9007199254740991:ym(n)?10:11:F(28295,{value:n})}function it(n,e){if(n===e)return!0;let t=$t(n);if(t!==$t(e))return!1;switch(t){case 0:case 9007199254740991:return!0;case 1:return n.booleanValue===e.booleanValue;case 4:return ti(n).isEqual(ti(e));case 3:return(function(i,o){if(typeof i.timestampValue=="string"&&typeof o.timestampValue=="string"&&i.timestampValue.length===o.timestampValue.length)return i.timestampValue===o.timestampValue;let a=gt(i.timestampValue),u=gt(o.timestampValue);return a.seconds===u.seconds&&a.nanos===u.nanos})(n,e);case 5:return n.stringValue===e.stringValue;case 6:return(function(i,o){return _t(i.bytesValue).isEqual(_t(o.bytesValue))})(n,e);case 7:return n.referenceValue===e.referenceValue;case 8:return(function(i,o){return te(i.geoPointValue.latitude)===te(o.geoPointValue.latitude)&&te(i.geoPointValue.longitude)===te(o.geoPointValue.longitude)})(n,e);case 2:return(function(i,o){if("integerValue"in i&&"integerValue"in o)return te(i.integerValue)===te(o.integerValue);if("doubleValue"in i&&"doubleValue"in o){let a=te(i.doubleValue),u=te(o.doubleValue);return a===u?ei(a)===ei(u):isNaN(a)&&isNaN(u)}return!1})(n,e);case 9:return $n(n.arrayValue.values||[],e.arrayValue.values||[],it);case 10:case 11:return(function(i,o){let a=i.mapValue.fields||{},u=o.mapValue.fields||{};if(fp(a)!==fp(u))return!1;for(let h in a)if(a.hasOwnProperty(h)&&(u[h]===void 0||!it(a[h],u[h])))return!1;return!0})(n,e);default:return F(52216,{left:n})}}function ni(n,e){return(n.values||[]).find(t=>it(t,e))!==void 0}function Wn(n,e){if(n===e)return 0;let t=$t(n),r=$t(e);if(t!==r)return $(t,r);switch(t){case 0:case 9007199254740991:return 0;case 1:return $(n.booleanValue,e.booleanValue);case 2:return(function(o,a){let u=te(o.integerValue||o.doubleValue),h=te(a.integerValue||a.doubleValue);return u<h?-1:u>h?1:u===h?0:isNaN(u)?isNaN(h)?0:-1:1})(n,e);case 3:return pp(n.timestampValue,e.timestampValue);case 4:return pp(ti(n),ti(e));case 5:return bc(n.stringValue,e.stringValue);case 6:return(function(o,a){let u=_t(o),h=_t(a);return u.compareTo(h)})(n.bytesValue,e.bytesValue);case 7:return(function(o,a){let u=o.split("/"),h=a.split("/");for(let d=0;d<u.length&&d<h.length;d++){let p=$(u[d],h[d]);if(p!==0)return p}return $(u.length,h.length)})(n.referenceValue,e.referenceValue);case 8:return(function(o,a){let u=$(te(o.latitude),te(a.latitude));return u!==0?u:$(te(o.longitude),te(a.longitude))})(n.geoPointValue,e.geoPointValue);case 9:return mp(n.arrayValue,e.arrayValue);case 10:return(function(o,a){let u=o.fields||{},h=a.fields||{},d=u[Hn]?.arrayValue,p=h[Hn]?.arrayValue,v=$(d?.values?.length||0,p?.values?.length||0);return v!==0?v:mp(d,p)})(n.mapValue,e.mapValue);case 11:return(function(o,a){if(o===Ss.mapValue&&a===Ss.mapValue)return 0;if(o===Ss.mapValue)return 1;if(a===Ss.mapValue)return-1;let u=o.fields||{},h=Object.keys(u),d=a.fields||{},p=Object.keys(d);h.sort(),p.sort();for(let v=0;v<h.length&&v<p.length;++v){let w=bc(h[v],p[v]);if(w!==0)return w;let R=Wn(u[h[v]],d[p[v]]);if(R!==0)return R}return $(h.length,p.length)})(n.mapValue,e.mapValue);default:throw F(23264,{he:t})}}function pp(n,e){if(typeof n=="string"&&typeof e=="string"&&n.length===e.length)return $(n,e);let t=gt(n),r=gt(e),i=$(t.seconds,r.seconds);return i!==0?i:$(t.nanos,r.nanos)}function mp(n,e){let t=n.values||[],r=e.values||[];for(let i=0;i<t.length&&i<r.length;++i){let o=Wn(t[i],r[i]);if(o)return o}return $(t.length,r.length)}function Kn(n){return Pc(n)}function Pc(n){return"nullValue"in n?"null":"booleanValue"in n?""+n.booleanValue:"integerValue"in n?""+n.integerValue:"doubleValue"in n?""+n.doubleValue:"timestampValue"in n?(function(t){let r=gt(t);return`time(${r.seconds},${r.nanos})`})(n.timestampValue):"stringValue"in n?n.stringValue:"bytesValue"in n?(function(t){return _t(t).toBase64()})(n.bytesValue):"referenceValue"in n?(function(t){return x.fromName(t).toString()})(n.referenceValue):"geoPointValue"in n?(function(t){return`geo(${t.latitude},${t.longitude})`})(n.geoPointValue):"arrayValue"in n?(function(t){let r="[",i=!0;for(let o of t.values||[])i?i=!1:r+=",",r+=Pc(o);return r+"]"})(n.arrayValue):"mapValue"in n?(function(t){let r=Object.keys(t.fields||{}).sort(),i="{",o=!0;for(let a of r)o?o=!1:i+=",",i+=`${a}:${Pc(t.fields[a])}`;return i+"}"})(n.mapValue):F(61005,{value:n})}function Ps(n){switch($t(n)){case 0:case 1:return 4;case 2:return 8;case 3:case 8:return 16;case 4:let e=_o(n);return e?16+Ps(e):16;case 5:return 2*n.stringValue.length;case 6:return _t(n.bytesValue).approximateByteSize();case 7:return n.referenceValue.length;case 9:return(function(r){return(r.values||[]).reduce((i,o)=>i+Ps(o),0)})(n.arrayValue);case 10:case 11:return(function(r){let i=0;return Jt(r.fields,(o,a)=>{i+=o.length+Ps(a)}),i})(n.mapValue);default:throw F(13486,{value:n})}}function gp(n,e){return{referenceValue:`projects/${n.projectId}/databases/${n.database}/documents/${e.path.canonicalString()}`}}function Dc(n){return!!n&&"integerValue"in n}function ll(n){return!!n&&"arrayValue"in n}function _p(n){return!!n&&"nullValue"in n}function yp(n){return!!n&&"doubleValue"in n&&isNaN(Number(n.doubleValue))}function Ds(n){return!!n&&"mapValue"in n}function ym(n){return(n?.mapValue?.fields||{})[cl]?.stringValue===ul}function Kr(n){if(n.geoPointValue)return{geoPointValue:L({},n.geoPointValue)};if(n.timestampValue&&typeof n.timestampValue=="object")return{timestampValue:L({},n.timestampValue)};if(n.mapValue){let e={mapValue:{fields:{}}};return Jt(n.mapValue.fields,(t,r)=>e.mapValue.fields[t]=Kr(r)),e}if(n.arrayValue){let e={arrayValue:{values:[]}};for(let t=0;t<(n.arrayValue.values||[]).length;++t)e.arrayValue.values[t]=Kr(n.arrayValue.values[t]);return e}return L({},n)}function vm(n){return(((n.mapValue||{}).fields||{}).__type__||{}).stringValue===_m}var Jb={mapValue:{fields:{[cl]:{stringValue:ul},[Hn]:{arrayValue:{}}}}};var Me=class n{constructor(e){this.value=e}static empty(){return new n({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let t=this.value;for(let r=0;r<e.length-1;++r)if(t=(t.mapValue.fields||{})[e.get(r)],!Ds(t))return null;return t=(t.mapValue.fields||{})[e.lastSegment()],t||null}}set(e,t){this.getFieldsMap(e.popLast())[e.lastSegment()]=Kr(t)}setAll(e){let t=xe.emptyPath(),r={},i=[];e.forEach((a,u)=>{if(!t.isImmediateParentOf(u)){let h=this.getFieldsMap(t);this.applyChanges(h,r,i),r={},i=[],t=u.popLast()}a?r[u.lastSegment()]=Kr(a):i.push(u.lastSegment())});let o=this.getFieldsMap(t);this.applyChanges(o,r,i)}delete(e){let t=this.field(e.popLast());Ds(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}isEqual(e){return it(this.value,e.value)}getFieldsMap(e){let t=this.value;t.mapValue.fields||(t.mapValue={fields:{}});for(let r=0;r<e.length;++r){let i=t.mapValue.fields[e.get(r)];Ds(i)&&i.mapValue.fields||(i={mapValue:{fields:{}}},t.mapValue.fields[e.get(r)]=i),t=i}return t.mapValue.fields}applyChanges(e,t,r){Jt(t,(i,o)=>e[i]=o);for(let i of r)delete e[i]}clone(){return new n(Kr(this.value))}};function Im(n){let e=[];return Jt(n.fields,(t,r)=>{let i=new xe([t]);if(Ds(r)){let o=Im(r.mapValue).fields;if(o.length===0)e.push(i);else for(let a of o)e.push(i.child(a))}else e.push(i)}),new Be(e)}var ze=class n{constructor(e,t,r,i,o,a,u){this.key=e,this.documentType=t,this.version=r,this.readTime=i,this.createTime=o,this.data=a,this.documentState=u}static newInvalidDocument(e){return new n(e,0,q.min(),q.min(),q.min(),Me.empty(),0)}static newFoundDocument(e,t,r,i){return new n(e,1,t,q.min(),r,i,0)}static newNoDocument(e,t){return new n(e,2,t,q.min(),q.min(),Me.empty(),0)}static newUnknownDocument(e,t){return new n(e,3,t,q.min(),q.min(),Me.empty(),2)}convertToFoundDocument(e,t){return!this.createTime.isEqual(q.min())||this.documentType!==2&&this.documentType!==0||(this.createTime=e),this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=Me.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=Me.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=q.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return this.documentState===1}get hasCommittedMutations(){return this.documentState===2}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return this.documentType!==0}isFoundDocument(){return this.documentType===1}isNoDocument(){return this.documentType===2}isUnknownDocument(){return this.documentType===3}isEqual(e){return e instanceof n&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new n(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}};var Qn=class{constructor(e,t){this.position=e,this.inclusive=t}};function vp(n,e,t){let r=0;for(let i=0;i<n.position.length;i++){let o=e[i],a=n.position[i];if(o.field.isKeyField()?r=x.comparator(x.fromName(a.referenceValue),t.key):r=Wn(a,t.data.field(o.field)),o.dir==="desc"&&(r*=-1),r!==0)break}return r}function Ip(n,e){if(n===null)return e===null;if(e===null||n.inclusive!==e.inclusive||n.position.length!==e.position.length)return!1;for(let t=0;t<n.position.length;t++)if(!it(n.position[t],e.position[t]))return!1;return!0}var yn=class{constructor(e,t="asc"){this.field=e,this.dir=t}};function Iw(n,e){return n.dir===e.dir&&n.field.isEqual(e.field)}var Us=class{},le=class n extends Us{constructor(e,t,r){super(),this.field=e,this.op=t,this.value=r}static create(e,t,r){return e.isKeyField()?t==="in"||t==="not-in"?this.createKeyFieldInFilter(e,t,r):new Vc(e,t,r):t==="array-contains"?new Mc(e,r):t==="in"?new xc(e,r):t==="not-in"?new Fc(e,r):t==="array-contains-any"?new Lc(e,r):new n(e,t,r)}static createKeyFieldInFilter(e,t,r){return t==="in"?new kc(e,r):new Oc(e,r)}matches(e){let t=e.data.field(this.field);return this.op==="!="?t!==null&&t.nullValue===void 0&&this.matchesComparison(Wn(t,this.value)):t!==null&&$t(this.value)===$t(t)&&this.matchesComparison(Wn(t,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return e===0;case"!=":return e!==0;case">":return e>0;case">=":return e>=0;default:return F(47266,{operator:this.op})}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}},$e=class n extends Us{constructor(e,t){super(),this.filters=e,this.op=t,this.Pe=null}static create(e,t){return new n(e,t)}matches(e){return wm(this)?this.filters.find(t=>!t.matches(e))===void 0:this.filters.find(t=>t.matches(e))!==void 0}getFlattenedFilters(){return this.Pe!==null||(this.Pe=this.filters.reduce((e,t)=>e.concat(t.getFlattenedFilters()),[])),this.Pe}getFilters(){return Object.assign([],this.filters)}};function wm(n){return n.op==="and"}function Em(n){return ww(n)&&wm(n)}function ww(n){for(let e of n.filters)if(e instanceof $e)return!1;return!0}function Nc(n){if(n instanceof le)return n.field.canonicalString()+n.op.toString()+Kn(n.value);if(Em(n))return n.filters.map(e=>Nc(e)).join(",");{let e=n.filters.map(t=>Nc(t)).join(",");return`${n.op}(${e})`}}function Tm(n,e){return n instanceof le?(function(r,i){return i instanceof le&&r.op===i.op&&r.field.isEqual(i.field)&&it(r.value,i.value)})(n,e):n instanceof $e?(function(r,i){return i instanceof $e&&r.op===i.op&&r.filters.length===i.filters.length?r.filters.reduce((o,a,u)=>o&&Tm(a,i.filters[u]),!0):!1})(n,e):void F(19439)}function Am(n){return n instanceof le?(function(t){return`${t.field.canonicalString()} ${t.op} ${Kn(t.value)}`})(n):n instanceof $e?(function(t){return t.op.toString()+" {"+t.getFilters().map(Am).join(" ,")+"}"})(n):"Filter"}var Vc=class extends le{constructor(e,t,r){super(e,t,r),this.key=x.fromName(r.referenceValue)}matches(e){let t=x.comparator(e.key,this.key);return this.matchesComparison(t)}},kc=class extends le{constructor(e,t){super(e,"in",t),this.keys=bm("in",t)}matches(e){return this.keys.some(t=>t.isEqual(e.key))}},Oc=class extends le{constructor(e,t){super(e,"not-in",t),this.keys=bm("not-in",t)}matches(e){return!this.keys.some(t=>t.isEqual(e.key))}};function bm(n,e){return(e.arrayValue?.values||[]).map(t=>x.fromName(t.referenceValue))}var Mc=class extends le{constructor(e,t){super(e,"array-contains",t)}matches(e){let t=e.data.field(this.field);return ll(t)&&ni(t.arrayValue,this.value)}},xc=class extends le{constructor(e,t){super(e,"in",t)}matches(e){let t=e.data.field(this.field);return t!==null&&ni(this.value.arrayValue,t)}},Fc=class extends le{constructor(e,t){super(e,"not-in",t)}matches(e){if(ni(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;let t=e.data.field(this.field);return t!==null&&t.nullValue===void 0&&!ni(this.value.arrayValue,t)}},Lc=class extends le{constructor(e,t){super(e,"array-contains-any",t)}matches(e){let t=e.data.field(this.field);return!(!ll(t)||!t.arrayValue.values)&&t.arrayValue.values.some(r=>ni(this.value.arrayValue,r))}};var Uc=class{constructor(e,t=null,r=[],i=[],o=null,a=null,u=null){this.path=e,this.collectionGroup=t,this.orderBy=r,this.filters=i,this.limit=o,this.startAt=a,this.endAt=u,this.Te=null}};function wp(n,e=null,t=[],r=[],i=null,o=null,a=null){return new Uc(n,e,t,r,i,o,a)}function hl(n){let e=B(n);if(e.Te===null){let t=e.path.canonicalString();e.collectionGroup!==null&&(t+="|cg:"+e.collectionGroup),t+="|f:",t+=e.filters.map(r=>Nc(r)).join(","),t+="|ob:",t+=e.orderBy.map(r=>(function(o){return o.field.canonicalString()+o.dir})(r)).join(","),go(e.limit)||(t+="|l:",t+=e.limit),e.startAt&&(t+="|lb:",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map(r=>Kn(r)).join(",")),e.endAt&&(t+="|ub:",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map(r=>Kn(r)).join(",")),e.Te=t}return e.Te}function dl(n,e){if(n.limit!==e.limit||n.orderBy.length!==e.orderBy.length)return!1;for(let t=0;t<n.orderBy.length;t++)if(!Iw(n.orderBy[t],e.orderBy[t]))return!1;if(n.filters.length!==e.filters.length)return!1;for(let t=0;t<n.filters.length;t++)if(!Tm(n.filters[t],e.filters[t]))return!1;return n.collectionGroup===e.collectionGroup&&!!n.path.isEqual(e.path)&&!!Ip(n.startAt,e.startAt)&&Ip(n.endAt,e.endAt)}function Bc(n){return x.isDocumentKey(n.path)&&n.collectionGroup===null&&n.filters.length===0}var Ht=class{constructor(e,t=null,r=[],i=[],o=null,a="F",u=null,h=null){this.path=e,this.collectionGroup=t,this.explicitOrderBy=r,this.filters=i,this.limit=o,this.limitType=a,this.startAt=u,this.endAt=h,this.Ie=null,this.Ee=null,this.de=null,this.startAt,this.endAt}};function Ew(n,e,t,r,i,o,a,u){return new Ht(n,e,t,r,i,o,a,u)}function fl(n){return new Ht(n)}function Ep(n){return n.filters.length===0&&n.limit===null&&n.startAt==null&&n.endAt==null&&(n.explicitOrderBy.length===0||n.explicitOrderBy.length===1&&n.explicitOrderBy[0].field.isKeyField())}function Sm(n){return n.collectionGroup!==null}function Qr(n){let e=B(n);if(e.Ie===null){e.Ie=[];let t=new Set;for(let o of e.explicitOrderBy)e.Ie.push(o),t.add(o.field.canonicalString());let r=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";(function(a){let u=new ye(xe.comparator);return a.filters.forEach(h=>{h.getFlattenedFilters().forEach(d=>{d.isInequality()&&(u=u.add(d.field))})}),u})(e).forEach(o=>{t.has(o.canonicalString())||o.isKeyField()||e.Ie.push(new yn(o,r))}),t.has(xe.keyField().canonicalString())||e.Ie.push(new yn(xe.keyField(),r))}return e.Ie}function tt(n){let e=B(n);return e.Ee||(e.Ee=Tw(e,Qr(n))),e.Ee}function Tw(n,e){if(n.limitType==="F")return wp(n.path,n.collectionGroup,e,n.filters,n.limit,n.startAt,n.endAt);{e=e.map(i=>{let o=i.dir==="desc"?"asc":"desc";return new yn(i.field,o)});let t=n.endAt?new Qn(n.endAt.position,n.endAt.inclusive):null,r=n.startAt?new Qn(n.startAt.position,n.startAt.inclusive):null;return wp(n.path,n.collectionGroup,e,n.filters,n.limit,t,r)}}function qc(n,e){let t=n.filters.concat([e]);return new Ht(n.path,n.collectionGroup,n.explicitOrderBy.slice(),t,n.limit,n.limitType,n.startAt,n.endAt)}function Bs(n,e,t){return new Ht(n.path,n.collectionGroup,n.explicitOrderBy.slice(),n.filters.slice(),e,t,n.startAt,n.endAt)}function yo(n,e){return dl(tt(n),tt(e))&&n.limitType===e.limitType}function Cm(n){return`${hl(tt(n))}|lt:${n.limitType}`}function Fn(n){return`Query(target=${(function(t){let r=t.path.canonicalString();return t.collectionGroup!==null&&(r+=" collectionGroup="+t.collectionGroup),t.filters.length>0&&(r+=`, filters: [${t.filters.map(i=>Am(i)).join(", ")}]`),go(t.limit)||(r+=", limit: "+t.limit),t.orderBy.length>0&&(r+=`, orderBy: [${t.orderBy.map(i=>(function(a){return`${a.field.canonicalString()} (${a.dir})`})(i)).join(", ")}]`),t.startAt&&(r+=", startAt: ",r+=t.startAt.inclusive?"b:":"a:",r+=t.startAt.position.map(i=>Kn(i)).join(",")),t.endAt&&(r+=", endAt: ",r+=t.endAt.inclusive?"a:":"b:",r+=t.endAt.position.map(i=>Kn(i)).join(",")),`Target(${r})`})(tt(n))}; limitType=${n.limitType})`}function vo(n,e){return e.isFoundDocument()&&(function(r,i){let o=i.key.path;return r.collectionGroup!==null?i.key.hasCollectionId(r.collectionGroup)&&r.path.isPrefixOf(o):x.isDocumentKey(r.path)?r.path.isEqual(o):r.path.isImmediateParentOf(o)})(n,e)&&(function(r,i){for(let o of Qr(r))if(!o.field.isKeyField()&&i.data.field(o.field)===null)return!1;return!0})(n,e)&&(function(r,i){for(let o of r.filters)if(!o.matches(i))return!1;return!0})(n,e)&&(function(r,i){return!(r.startAt&&!(function(a,u,h){let d=vp(a,u,h);return a.inclusive?d<=0:d<0})(r.startAt,Qr(r),i)||r.endAt&&!(function(a,u,h){let d=vp(a,u,h);return a.inclusive?d>=0:d>0})(r.endAt,Qr(r),i))})(n,e)}function Aw(n){return n.collectionGroup||(n.path.length%2==1?n.path.lastSegment():n.path.get(n.path.length-2))}function Rm(n){return(e,t)=>{let r=!1;for(let i of Qr(n)){let o=bw(i,e,t);if(o!==0)return o;r=r||i.field.isKeyField()}return 0}}function bw(n,e,t){let r=n.field.isKeyField()?x.comparator(e.key,t.key):(function(o,a,u){let h=a.data.field(o),d=u.data.field(o);return h!==null&&d!==null?Wn(h,d):F(42886)})(n.field,e,t);switch(n.dir){case"asc":return r;case"desc":return-1*r;default:return F(19790,{direction:n.dir})}}var yt=class{constructor(e,t){this.mapKeyFn=e,this.equalsFn=t,this.inner={},this.innerSize=0}get(e){let t=this.mapKeyFn(e),r=this.inner[t];if(r!==void 0){for(let[i,o]of r)if(this.equalsFn(i,e))return o}}has(e){return this.get(e)!==void 0}set(e,t){let r=this.mapKeyFn(e),i=this.inner[r];if(i===void 0)return this.inner[r]=[[e,t]],void this.innerSize++;for(let o=0;o<i.length;o++)if(this.equalsFn(i[o][0],e))return void(i[o]=[e,t]);i.push([e,t]),this.innerSize++}delete(e){let t=this.mapKeyFn(e),r=this.inner[t];if(r===void 0)return!1;for(let i=0;i<r.length;i++)if(this.equalsFn(r[i][0],e))return r.length===1?delete this.inner[t]:r.splice(i,1),this.innerSize--,!0;return!1}forEach(e){Jt(this.inner,(t,r)=>{for(let[i,o]of r)e(i,o)})}isEmpty(){return dm(this.inner)}size(){return this.innerSize}};var Sw=new oe(x.comparator);function vt(){return Sw}var Pm=new oe(x.comparator);function Wr(...n){let e=Pm;for(let t of n)e=e.insert(t.key,t);return e}function Dm(n){let e=Pm;return n.forEach((t,r)=>e=e.insert(t,r.overlayedDocument)),e}function dn(){return Jr()}function Nm(){return Jr()}function Jr(){return new yt(n=>n.toString(),(n,e)=>n.isEqual(e))}var Cw=new oe(x.comparator),Rw=new ye(x.comparator);function H(...n){let e=Rw;for(let t of n)e=e.add(t);return e}var Pw=new ye($);function Dw(){return Pw}function pl(n,e){if(n.useProto3Json){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:ei(e)?"-0":e}}function Vm(n){return{integerValue:""+n}}function Nw(n,e){return ow(e)?Vm(e):pl(n,e)}var Jn=class{constructor(){this._=void 0}};function Vw(n,e,t){return n instanceof vn?(function(i,o){let a={fields:{[pm]:{stringValue:fm},[gm]:{timestampValue:{seconds:i.seconds,nanos:i.nanoseconds}}}};return o&&al(o)&&(o=_o(o)),o&&(a.fields[mm]=o),{mapValue:a}})(t,e):n instanceof In?Om(n,e):n instanceof wn?Mm(n,e):(function(i,o){let a=km(i,o),u=Tp(a)+Tp(i.Ae);return Dc(a)&&Dc(i.Ae)?Vm(u):pl(i.serializer,u)})(n,e)}function kw(n,e,t){return n instanceof In?Om(n,e):n instanceof wn?Mm(n,e):t}function km(n,e){return n instanceof Yn?(function(r){return Dc(r)||(function(o){return!!o&&"doubleValue"in o})(r)})(e)?e:{integerValue:0}:null}var vn=class extends Jn{},In=class extends Jn{constructor(e){super(),this.elements=e}};function Om(n,e){let t=xm(e);for(let r of n.elements)t.some(i=>it(i,r))||t.push(r);return{arrayValue:{values:t}}}var wn=class extends Jn{constructor(e){super(),this.elements=e}};function Mm(n,e){let t=xm(e);for(let r of n.elements)t=t.filter(i=>!it(i,r));return{arrayValue:{values:t}}}var Yn=class extends Jn{constructor(e,t){super(),this.serializer=e,this.Ae=t}};function Tp(n){return te(n.integerValue||n.doubleValue)}function xm(n){return ll(n)&&n.arrayValue.values?n.arrayValue.values.slice():[]}var jc=class{constructor(e,t){this.field=e,this.transform=t}};function Ow(n,e){return n.field.isEqual(e.field)&&(function(r,i){return r instanceof In&&i instanceof In||r instanceof wn&&i instanceof wn?$n(r.elements,i.elements,it):r instanceof Yn&&i instanceof Yn?it(r.Ae,i.Ae):r instanceof vn&&i instanceof vn})(n.transform,e.transform)}var Gc=class{constructor(e,t){this.version=e,this.transformResults=t}},nt=class n{constructor(e,t){this.updateTime=e,this.exists=t}static none(){return new n}static exists(e){return new n(void 0,e)}static updateTime(e){return new n(e)}get isNone(){return this.updateTime===void 0&&this.exists===void 0}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}};function Ns(n,e){return n.updateTime!==void 0?e.isFoundDocument()&&e.version.isEqual(n.updateTime):n.exists===void 0||n.exists===e.isFoundDocument()}var Xn=class{};function Fm(n,e){if(!n.hasLocalMutations||e&&e.fields.length===0)return null;if(e===null)return n.isNoDocument()?new ri(n.key,nt.none()):new En(n.key,n.data,nt.none());{let t=n.data,r=Me.empty(),i=new ye(xe.comparator);for(let o of e.fields)if(!i.has(o)){let a=t.field(o);a===null&&o.length>1&&(o=o.popLast(),a=t.field(o)),a===null?r.delete(o):r.set(o,a),i=i.add(o)}return new st(n.key,r,new Be(i.toArray()),nt.none())}}function Mw(n,e,t){n instanceof En?(function(i,o,a){let u=i.value.clone(),h=bp(i.fieldTransforms,o,a.transformResults);u.setAll(h),o.convertToFoundDocument(a.version,u).setHasCommittedMutations()})(n,e,t):n instanceof st?(function(i,o,a){if(!Ns(i.precondition,o))return void o.convertToUnknownDocument(a.version);let u=bp(i.fieldTransforms,o,a.transformResults),h=o.data;h.setAll(Lm(i)),h.setAll(u),o.convertToFoundDocument(a.version,h).setHasCommittedMutations()})(n,e,t):(function(i,o,a){o.convertToNoDocument(a.version).setHasCommittedMutations()})(0,e,t)}function Yr(n,e,t,r){return n instanceof En?(function(o,a,u,h){if(!Ns(o.precondition,a))return u;let d=o.value.clone(),p=Sp(o.fieldTransforms,h,a);return d.setAll(p),a.convertToFoundDocument(a.version,d).setHasLocalMutations(),null})(n,e,t,r):n instanceof st?(function(o,a,u,h){if(!Ns(o.precondition,a))return u;let d=Sp(o.fieldTransforms,h,a),p=a.data;return p.setAll(Lm(o)),p.setAll(d),a.convertToFoundDocument(a.version,p).setHasLocalMutations(),u===null?null:u.unionWith(o.fieldMask.fields).unionWith(o.fieldTransforms.map(v=>v.field))})(n,e,t,r):(function(o,a,u){return Ns(o.precondition,a)?(a.convertToNoDocument(a.version).setHasLocalMutations(),null):u})(n,e,t)}function xw(n,e){let t=null;for(let r of n.fieldTransforms){let i=e.data.field(r.field),o=km(r.transform,i||null);o!=null&&(t===null&&(t=Me.empty()),t.set(r.field,o))}return t||null}function Ap(n,e){return n.type===e.type&&!!n.key.isEqual(e.key)&&!!n.precondition.isEqual(e.precondition)&&!!(function(r,i){return r===void 0&&i===void 0||!(!r||!i)&&$n(r,i,(o,a)=>Ow(o,a))})(n.fieldTransforms,e.fieldTransforms)&&(n.type===0?n.value.isEqual(e.value):n.type!==1||n.data.isEqual(e.data)&&n.fieldMask.isEqual(e.fieldMask))}var En=class extends Xn{constructor(e,t,r,i=[]){super(),this.key=e,this.value=t,this.precondition=r,this.fieldTransforms=i,this.type=0}getFieldMask(){return null}},st=class extends Xn{constructor(e,t,r,i,o=[]){super(),this.key=e,this.data=t,this.fieldMask=r,this.precondition=i,this.fieldTransforms=o,this.type=1}getFieldMask(){return this.fieldMask}};function Lm(n){let e=new Map;return n.fieldMask.fields.forEach(t=>{if(!t.isEmpty()){let r=n.data.field(t);e.set(t,r)}}),e}function bp(n,e,t){let r=new Map;Y(n.length===t.length,32656,{Re:t.length,Ve:n.length});for(let i=0;i<t.length;i++){let o=n[i],a=o.transform,u=e.data.field(o.field);r.set(o.field,kw(a,u,t[i]))}return r}function Sp(n,e,t){let r=new Map;for(let i of n){let o=i.transform,a=t.data.field(i.field);r.set(i.field,Vw(o,a,e))}return r}var ri=class extends Xn{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}},zc=class extends Xn{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}};var $c=class{constructor(e,t,r,i){this.batchId=e,this.localWriteTime=t,this.baseMutations=r,this.mutations=i}applyToRemoteDocument(e,t){let r=t.mutationResults;for(let i=0;i<this.mutations.length;i++){let o=this.mutations[i];o.key.isEqual(e.key)&&Mw(o,e,r[i])}}applyToLocalView(e,t){for(let r of this.baseMutations)r.key.isEqual(e.key)&&(t=Yr(r,e,t,this.localWriteTime));for(let r of this.mutations)r.key.isEqual(e.key)&&(t=Yr(r,e,t,this.localWriteTime));return t}applyToLocalDocumentSet(e,t){let r=Nm();return this.mutations.forEach(i=>{let o=e.get(i.key),a=o.overlayedDocument,u=this.applyToLocalView(a,o.mutatedFields);u=t.has(i.key)?null:u;let h=Fm(a,u);h!==null&&r.set(i.key,h),a.isValidDocument()||a.convertToNoDocument(q.min())}),r}keys(){return this.mutations.reduce((e,t)=>e.add(t.key),H())}isEqual(e){return this.batchId===e.batchId&&$n(this.mutations,e.mutations,(t,r)=>Ap(t,r))&&$n(this.baseMutations,e.baseMutations,(t,r)=>Ap(t,r))}},Hc=class n{constructor(e,t,r,i){this.batch=e,this.commitVersion=t,this.mutationResults=r,this.docVersions=i}static from(e,t,r){Y(e.mutations.length===r.length,58842,{me:e.mutations.length,fe:r.length});let i=(function(){return Cw})(),o=e.mutations;for(let a=0;a<o.length;a++)i=i.insert(o[a].key,r[a].version);return new n(e,t,r,i)}};var Wc=class{constructor(e,t){this.largestBatchId=e,this.mutation=t}getKey(){return this.mutation.key}isEqual(e){return e!==null&&this.mutation===e.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}};var Kc=class{constructor(e,t){this.count=e,this.unchangedNames=t}};var ce,K;function Fw(n){switch(n){case C.OK:return F(64938);case C.CANCELLED:case C.UNKNOWN:case C.DEADLINE_EXCEEDED:case C.RESOURCE_EXHAUSTED:case C.INTERNAL:case C.UNAVAILABLE:case C.UNAUTHENTICATED:return!1;case C.INVALID_ARGUMENT:case C.NOT_FOUND:case C.ALREADY_EXISTS:case C.PERMISSION_DENIED:case C.FAILED_PRECONDITION:case C.ABORTED:case C.OUT_OF_RANGE:case C.UNIMPLEMENTED:case C.DATA_LOSS:return!0;default:return F(15467,{code:n})}}function Um(n){if(n===void 0)return mt("GRPC error has no .code"),C.UNKNOWN;switch(n){case ce.OK:return C.OK;case ce.CANCELLED:return C.CANCELLED;case ce.UNKNOWN:return C.UNKNOWN;case ce.DEADLINE_EXCEEDED:return C.DEADLINE_EXCEEDED;case ce.RESOURCE_EXHAUSTED:return C.RESOURCE_EXHAUSTED;case ce.INTERNAL:return C.INTERNAL;case ce.UNAVAILABLE:return C.UNAVAILABLE;case ce.UNAUTHENTICATED:return C.UNAUTHENTICATED;case ce.INVALID_ARGUMENT:return C.INVALID_ARGUMENT;case ce.NOT_FOUND:return C.NOT_FOUND;case ce.ALREADY_EXISTS:return C.ALREADY_EXISTS;case ce.PERMISSION_DENIED:return C.PERMISSION_DENIED;case ce.FAILED_PRECONDITION:return C.FAILED_PRECONDITION;case ce.ABORTED:return C.ABORTED;case ce.OUT_OF_RANGE:return C.OUT_OF_RANGE;case ce.UNIMPLEMENTED:return C.UNIMPLEMENTED;case ce.DATA_LOSS:return C.DATA_LOSS;default:return F(39323,{code:n})}}(K=ce||(ce={}))[K.OK=0]="OK",K[K.CANCELLED=1]="CANCELLED",K[K.UNKNOWN=2]="UNKNOWN",K[K.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",K[K.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",K[K.NOT_FOUND=5]="NOT_FOUND",K[K.ALREADY_EXISTS=6]="ALREADY_EXISTS",K[K.PERMISSION_DENIED=7]="PERMISSION_DENIED",K[K.UNAUTHENTICATED=16]="UNAUTHENTICATED",K[K.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",K[K.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",K[K.ABORTED=10]="ABORTED",K[K.OUT_OF_RANGE=11]="OUT_OF_RANGE",K[K.UNIMPLEMENTED=12]="UNIMPLEMENTED",K[K.INTERNAL=13]="INTERNAL",K[K.UNAVAILABLE=14]="UNAVAILABLE",K[K.DATA_LOSS=15]="DATA_LOSS";var Lw=null;function Uw(){return new TextEncoder}var Bw=new ft([4294967295,4294967295],0);function Cp(n){let e=Uw().encode(n),t=new cc;return t.update(e),new Uint8Array(t.digest())}function Rp(n){let e=new DataView(n.buffer),t=e.getUint32(0,!0),r=e.getUint32(4,!0),i=e.getUint32(8,!0),o=e.getUint32(12,!0);return[new ft([t,r],0),new ft([i,o],0)]}var Qc=class n{constructor(e,t,r){if(this.bitmap=e,this.padding=t,this.hashCount=r,t<0||t>=8)throw new fn(`Invalid padding: ${t}`);if(r<0)throw new fn(`Invalid hash count: ${r}`);if(e.length>0&&this.hashCount===0)throw new fn(`Invalid hash count: ${r}`);if(e.length===0&&t!==0)throw new fn(`Invalid padding when bitmap length is 0: ${t}`);this.ge=8*e.length-t,this.pe=ft.fromNumber(this.ge)}ye(e,t,r){let i=e.add(t.multiply(ft.fromNumber(r)));return i.compare(Bw)===1&&(i=new ft([i.getBits(0),i.getBits(1)],0)),i.modulo(this.pe).toNumber()}we(e){return!!(this.bitmap[Math.floor(e/8)]&1<<e%8)}mightContain(e){if(this.ge===0)return!1;let t=Cp(e),[r,i]=Rp(t);for(let o=0;o<this.hashCount;o++){let a=this.ye(r,i,o);if(!this.we(a))return!1}return!0}static create(e,t,r){let i=e%8==0?0:8-e%8,o=new Uint8Array(Math.ceil(e/8)),a=new n(o,i,t);return r.forEach(u=>a.insert(u)),a}insert(e){if(this.ge===0)return;let t=Cp(e),[r,i]=Rp(t);for(let o=0;o<this.hashCount;o++){let a=this.ye(r,i,o);this.Se(a)}}Se(e){let t=Math.floor(e/8),r=e%8;this.bitmap[t]|=1<<r}},fn=class extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}};var qs=class n{constructor(e,t,r,i,o){this.snapshotVersion=e,this.targetChanges=t,this.targetMismatches=r,this.documentUpdates=i,this.resolvedLimboDocuments=o}static createSynthesizedRemoteEventForCurrentChange(e,t,r){let i=new Map;return i.set(e,ii.createSynthesizedTargetChangeForCurrentChange(e,t,r)),new n(q.min(),i,new oe($),vt(),H())}},ii=class n{constructor(e,t,r,i,o){this.resumeToken=e,this.current=t,this.addedDocuments=r,this.modifiedDocuments=i,this.removedDocuments=o}static createSynthesizedTargetChangeForCurrentChange(e,t,r){return new n(r,t,H(),H(),H())}};var qn=class{constructor(e,t,r,i){this.be=e,this.removedTargetIds=t,this.key=r,this.De=i}},js=class{constructor(e,t){this.targetId=e,this.Ce=t}},Gs=class{constructor(e,t,r=Ee.EMPTY_BYTE_STRING,i=null){this.state=e,this.targetIds=t,this.resumeToken=r,this.cause=i}},zs=class{constructor(){this.ve=0,this.Fe=Pp(),this.Me=Ee.EMPTY_BYTE_STRING,this.xe=!1,this.Oe=!0}get current(){return this.xe}get resumeToken(){return this.Me}get Ne(){return this.ve!==0}get Be(){return this.Oe}Le(e){e.approximateByteSize()>0&&(this.Oe=!0,this.Me=e)}ke(){let e=H(),t=H(),r=H();return this.Fe.forEach((i,o)=>{switch(o){case 0:e=e.add(i);break;case 2:t=t.add(i);break;case 1:r=r.add(i);break;default:F(38017,{changeType:o})}}),new ii(this.Me,this.xe,e,t,r)}qe(){this.Oe=!1,this.Fe=Pp()}Qe(e,t){this.Oe=!0,this.Fe=this.Fe.insert(e,t)}$e(e){this.Oe=!0,this.Fe=this.Fe.remove(e)}Ue(){this.ve+=1}Ke(){this.ve-=1,Y(this.ve>=0,3241,{ve:this.ve})}We(){this.Oe=!0,this.xe=!0}},Jc=class{constructor(e){this.Ge=e,this.ze=new Map,this.je=vt(),this.Je=Cs(),this.He=Cs(),this.Ye=new oe($)}Ze(e){for(let t of e.be)e.De&&e.De.isFoundDocument()?this.Xe(t,e.De):this.et(t,e.key,e.De);for(let t of e.removedTargetIds)this.et(t,e.key,e.De)}tt(e){this.forEachTarget(e,t=>{let r=this.nt(t);switch(e.state){case 0:this.rt(t)&&r.Le(e.resumeToken);break;case 1:r.Ke(),r.Ne||r.qe(),r.Le(e.resumeToken);break;case 2:r.Ke(),r.Ne||this.removeTarget(t);break;case 3:this.rt(t)&&(r.We(),r.Le(e.resumeToken));break;case 4:this.rt(t)&&(this.it(t),r.Le(e.resumeToken));break;default:F(56790,{state:e.state})}})}forEachTarget(e,t){e.targetIds.length>0?e.targetIds.forEach(t):this.ze.forEach((r,i)=>{this.rt(i)&&t(i)})}st(e){let t=e.targetId,r=e.Ce.count,i=this.ot(t);if(i){let o=i.target;if(Bc(o))if(r===0){let a=new x(o.path);this.et(t,a,ze.newNoDocument(a,q.min()))}else Y(r===1,20013,{expectedCount:r});else{let a=this._t(t);if(a!==r){let u=this.ut(e),h=u?this.ct(u,e,a):1;if(h!==0){this.it(t);let d=h===2?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.Ye=this.Ye.insert(t,d)}Lw?.lt((function(p,v,w,R,k){let M={localCacheCount:p,existenceFilterCount:v.count,databaseId:w.database,projectId:w.projectId},N=v.unchangedNames;return N&&(M.bloomFilter={applied:k===0,hashCount:N?.hashCount??0,bitmapLength:N?.bits?.bitmap?.length??0,padding:N?.bits?.padding??0,mightContain:G=>R?.mightContain(G)??!1}),M})(a,e.Ce,this.Ge.ht(),u,h))}}}}ut(e){let t=e.Ce.unchangedNames;if(!t||!t.bits)return null;let{bits:{bitmap:r="",padding:i=0},hashCount:o=0}=t,a,u;try{a=_t(r).toUint8Array()}catch(h){if(h instanceof xs)return zn("Decoding the base64 bloom filter in existence filter failed ("+h.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw h}try{u=new Qc(a,i,o)}catch(h){return zn(h instanceof fn?"BloomFilter error: ":"Applying bloom filter failed: ",h),null}return u.ge===0?null:u}ct(e,t,r){return t.Ce.count===r-this.Pt(e,t.targetId)?0:2}Pt(e,t){let r=this.Ge.getRemoteKeysForTarget(t),i=0;return r.forEach(o=>{let a=this.Ge.ht(),u=`projects/${a.projectId}/databases/${a.database}/documents/${o.path.canonicalString()}`;e.mightContain(u)||(this.et(t,o,null),i++)}),i}Tt(e){let t=new Map;this.ze.forEach((o,a)=>{let u=this.ot(a);if(u){if(o.current&&Bc(u.target)){let h=new x(u.target.path);this.It(h).has(a)||this.Et(a,h)||this.et(a,h,ze.newNoDocument(h,e))}o.Be&&(t.set(a,o.ke()),o.qe())}});let r=H();this.He.forEach((o,a)=>{let u=!0;a.forEachWhile(h=>{let d=this.ot(h);return!d||d.purpose==="TargetPurposeLimboResolution"||(u=!1,!1)}),u&&(r=r.add(o))}),this.je.forEach((o,a)=>a.setReadTime(e));let i=new qs(e,t,this.Ye,this.je,r);return this.je=vt(),this.Je=Cs(),this.He=Cs(),this.Ye=new oe($),i}Xe(e,t){if(!this.rt(e))return;let r=this.Et(e,t.key)?2:0;this.nt(e).Qe(t.key,r),this.je=this.je.insert(t.key,t),this.Je=this.Je.insert(t.key,this.It(t.key).add(e)),this.He=this.He.insert(t.key,this.dt(t.key).add(e))}et(e,t,r){if(!this.rt(e))return;let i=this.nt(e);this.Et(e,t)?i.Qe(t,1):i.$e(t),this.He=this.He.insert(t,this.dt(t).delete(e)),this.He=this.He.insert(t,this.dt(t).add(e)),r&&(this.je=this.je.insert(t,r))}removeTarget(e){this.ze.delete(e)}_t(e){let t=this.nt(e).ke();return this.Ge.getRemoteKeysForTarget(e).size+t.addedDocuments.size-t.removedDocuments.size}Ue(e){this.nt(e).Ue()}nt(e){let t=this.ze.get(e);return t||(t=new zs,this.ze.set(e,t)),t}dt(e){let t=this.He.get(e);return t||(t=new ye($),this.He=this.He.insert(e,t)),t}It(e){let t=this.Je.get(e);return t||(t=new ye($),this.Je=this.Je.insert(e,t)),t}rt(e){let t=this.ot(e)!==null;return t||O("WatchChangeAggregator","Detected inactive target",e),t}ot(e){let t=this.ze.get(e);return t&&t.Ne?null:this.Ge.At(e)}it(e){this.ze.set(e,new zs),this.Ge.getRemoteKeysForTarget(e).forEach(t=>{this.et(e,t,null)})}Et(e,t){return this.Ge.getRemoteKeysForTarget(e).has(t)}};function Cs(){return new oe(x.comparator)}function Pp(){return new oe(x.comparator)}var qw={asc:"ASCENDING",desc:"DESCENDING"},jw={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},Gw={and:"AND",or:"OR"},Yc=class{constructor(e,t){this.databaseId=e,this.useProto3Json=t}};function Xc(n,e){return n.useProto3Json||go(e)?e:{value:e}}function $s(n,e){return n.useProto3Json?`${new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+e.nanoseconds).slice(-9)}Z`:{seconds:""+e.seconds,nanos:e.nanoseconds}}function Bm(n,e){return n.useProto3Json?e.toBase64():e.toUint8Array()}function zw(n,e){return $s(n,e.toTimestamp())}function rt(n){return Y(!!n,49232),q.fromTimestamp((function(t){let r=gt(t);return new se(r.seconds,r.nanos)})(n))}function ml(n,e){return Zc(n,e).canonicalString()}function Zc(n,e){let t=(function(i){return new ne(["projects",i.projectId,"databases",i.database])})(n).child("documents");return e===void 0?t:t.child(e)}function qm(n){let e=ne.fromString(n);return Y(Hm(e),10190,{key:e.toString()}),e}function eu(n,e){return ml(n.databaseId,e.path)}function mc(n,e){let t=qm(e);if(t.get(1)!==n.databaseId.projectId)throw new V(C.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+t.get(1)+" vs "+n.databaseId.projectId);if(t.get(3)!==n.databaseId.database)throw new V(C.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+t.get(3)+" vs "+n.databaseId.database);return new x(Gm(t))}function jm(n,e){return ml(n.databaseId,e)}function $w(n){let e=qm(n);return e.length===4?ne.emptyPath():Gm(e)}function tu(n){return new ne(["projects",n.databaseId.projectId,"databases",n.databaseId.database]).canonicalString()}function Gm(n){return Y(n.length>4&&n.get(4)==="documents",29091,{key:n.toString()}),n.popFirst(5)}function Dp(n,e,t){return{name:eu(n,e),fields:t.value.mapValue.fields}}function Hw(n,e){let t;if("targetChange"in e){e.targetChange;let r=(function(d){return d==="NO_CHANGE"?0:d==="ADD"?1:d==="REMOVE"?2:d==="CURRENT"?3:d==="RESET"?4:F(39313,{state:d})})(e.targetChange.targetChangeType||"NO_CHANGE"),i=e.targetChange.targetIds||[],o=(function(d,p){return d.useProto3Json?(Y(p===void 0||typeof p=="string",58123),Ee.fromBase64String(p||"")):(Y(p===void 0||p instanceof Buffer||p instanceof Uint8Array,16193),Ee.fromUint8Array(p||new Uint8Array))})(n,e.targetChange.resumeToken),a=e.targetChange.cause,u=a&&(function(d){let p=d.code===void 0?C.UNKNOWN:Um(d.code);return new V(p,d.message||"")})(a);t=new Gs(r,i,o,u||null)}else if("documentChange"in e){e.documentChange;let r=e.documentChange;r.document,r.document.name,r.document.updateTime;let i=mc(n,r.document.name),o=rt(r.document.updateTime),a=r.document.createTime?rt(r.document.createTime):q.min(),u=new Me({mapValue:{fields:r.document.fields}}),h=ze.newFoundDocument(i,o,a,u),d=r.targetIds||[],p=r.removedTargetIds||[];t=new qn(d,p,h.key,h)}else if("documentDelete"in e){e.documentDelete;let r=e.documentDelete;r.document;let i=mc(n,r.document),o=r.readTime?rt(r.readTime):q.min(),a=ze.newNoDocument(i,o),u=r.removedTargetIds||[];t=new qn([],u,a.key,a)}else if("documentRemove"in e){e.documentRemove;let r=e.documentRemove;r.document;let i=mc(n,r.document),o=r.removedTargetIds||[];t=new qn([],o,i,null)}else{if(!("filter"in e))return F(11601,{Rt:e});{e.filter;let r=e.filter;r.targetId;let{count:i=0,unchangedNames:o}=r,a=new Kc(i,o),u=r.targetId;t=new js(u,a)}}return t}function Ww(n,e){let t;if(e instanceof En)t={update:Dp(n,e.key,e.value)};else if(e instanceof ri)t={delete:eu(n,e.key)};else if(e instanceof st)t={update:Dp(n,e.key,e.data),updateMask:nE(e.fieldMask)};else{if(!(e instanceof zc))return F(16599,{Vt:e.type});t={verify:eu(n,e.key)}}return e.fieldTransforms.length>0&&(t.updateTransforms=e.fieldTransforms.map(r=>(function(o,a){let u=a.transform;if(u instanceof vn)return{fieldPath:a.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(u instanceof In)return{fieldPath:a.field.canonicalString(),appendMissingElements:{values:u.elements}};if(u instanceof wn)return{fieldPath:a.field.canonicalString(),removeAllFromArray:{values:u.elements}};if(u instanceof Yn)return{fieldPath:a.field.canonicalString(),increment:u.Ae};throw F(20930,{transform:a.transform})})(0,r))),e.precondition.isNone||(t.currentDocument=(function(i,o){return o.updateTime!==void 0?{updateTime:zw(i,o.updateTime)}:o.exists!==void 0?{exists:o.exists}:F(27497)})(n,e.precondition)),t}function Kw(n,e){return n&&n.length>0?(Y(e!==void 0,14353),n.map(t=>(function(i,o){let a=i.updateTime?rt(i.updateTime):rt(o);return a.isEqual(q.min())&&(a=rt(o)),new Gc(a,i.transformResults||[])})(t,e))):[]}function Qw(n,e){return{documents:[jm(n,e.path)]}}function Jw(n,e){let t={structuredQuery:{}},r=e.path,i;e.collectionGroup!==null?(i=r,t.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(i=r.popLast(),t.structuredQuery.from=[{collectionId:r.lastSegment()}]),t.parent=jm(n,i);let o=(function(d){if(d.length!==0)return $m($e.create(d,"and"))})(e.filters);o&&(t.structuredQuery.where=o);let a=(function(d){if(d.length!==0)return d.map(p=>(function(w){return{field:Ln(w.field),direction:Zw(w.dir)}})(p))})(e.orderBy);a&&(t.structuredQuery.orderBy=a);let u=Xc(n,e.limit);return u!==null&&(t.structuredQuery.limit=u),e.startAt&&(t.structuredQuery.startAt=(function(d){return{before:d.inclusive,values:d.position}})(e.startAt)),e.endAt&&(t.structuredQuery.endAt=(function(d){return{before:!d.inclusive,values:d.position}})(e.endAt)),{ft:t,parent:i}}function Yw(n){let e=$w(n.parent),t=n.structuredQuery,r=t.from?t.from.length:0,i=null;if(r>0){Y(r===1,65062);let p=t.from[0];p.allDescendants?i=p.collectionId:e=e.child(p.collectionId)}let o=[];t.where&&(o=(function(v){let w=zm(v);return w instanceof $e&&Em(w)?w.getFilters():[w]})(t.where));let a=[];t.orderBy&&(a=(function(v){return v.map(w=>(function(k){return new yn(Un(k.field),(function(N){switch(N){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}})(k.direction))})(w))})(t.orderBy));let u=null;t.limit&&(u=(function(v){let w;return w=typeof v=="object"?v.value:v,go(w)?null:w})(t.limit));let h=null;t.startAt&&(h=(function(v){let w=!!v.before,R=v.values||[];return new Qn(R,w)})(t.startAt));let d=null;return t.endAt&&(d=(function(v){let w=!v.before,R=v.values||[];return new Qn(R,w)})(t.endAt)),Ew(e,i,a,o,u,"F",h,d)}function Xw(n,e){let t=(function(i){switch(i){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return F(28987,{purpose:i})}})(e.purpose);return t==null?null:{"goog-listen-tags":t}}function zm(n){return n.unaryFilter!==void 0?(function(t){switch(t.unaryFilter.op){case"IS_NAN":let r=Un(t.unaryFilter.field);return le.create(r,"==",{doubleValue:NaN});case"IS_NULL":let i=Un(t.unaryFilter.field);return le.create(i,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":let o=Un(t.unaryFilter.field);return le.create(o,"!=",{doubleValue:NaN});case"IS_NOT_NULL":let a=Un(t.unaryFilter.field);return le.create(a,"!=",{nullValue:"NULL_VALUE"});case"OPERATOR_UNSPECIFIED":return F(61313);default:return F(60726)}})(n):n.fieldFilter!==void 0?(function(t){return le.create(Un(t.fieldFilter.field),(function(i){switch(i){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";case"OPERATOR_UNSPECIFIED":return F(58110);default:return F(50506)}})(t.fieldFilter.op),t.fieldFilter.value)})(n):n.compositeFilter!==void 0?(function(t){return $e.create(t.compositeFilter.filters.map(r=>zm(r)),(function(i){switch(i){case"AND":return"and";case"OR":return"or";default:return F(1026)}})(t.compositeFilter.op))})(n):F(30097,{filter:n})}function Zw(n){return qw[n]}function eE(n){return jw[n]}function tE(n){return Gw[n]}function Ln(n){return{fieldPath:n.canonicalString()}}function Un(n){return xe.fromServerFormat(n.fieldPath)}function $m(n){return n instanceof le?(function(t){if(t.op==="=="){if(yp(t.value))return{unaryFilter:{field:Ln(t.field),op:"IS_NAN"}};if(_p(t.value))return{unaryFilter:{field:Ln(t.field),op:"IS_NULL"}}}else if(t.op==="!="){if(yp(t.value))return{unaryFilter:{field:Ln(t.field),op:"IS_NOT_NAN"}};if(_p(t.value))return{unaryFilter:{field:Ln(t.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:Ln(t.field),op:eE(t.op),value:t.value}}})(n):n instanceof $e?(function(t){let r=t.getFilters().map(i=>$m(i));return r.length===1?r[0]:{compositeFilter:{op:tE(t.op),filters:r}}})(n):F(54877,{filter:n})}function nE(n){let e=[];return n.fields.forEach(t=>e.push(t.canonicalString())),{fieldPaths:e}}function Hm(n){return n.length>=4&&n.get(0)==="projects"&&n.get(2)==="databases"}var si=class n{constructor(e,t,r,i,o=q.min(),a=q.min(),u=Ee.EMPTY_BYTE_STRING,h=null){this.target=e,this.targetId=t,this.purpose=r,this.sequenceNumber=i,this.snapshotVersion=o,this.lastLimboFreeSnapshotVersion=a,this.resumeToken=u,this.expectedCount=h}withSequenceNumber(e){return new n(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,t){return new n(this.target,this.targetId,this.purpose,this.sequenceNumber,t,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new n(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new n(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}};var nu=class{constructor(e){this.yt=e}};function rE(n){let e=Yw({parent:n.parent,structuredQuery:n.structuredQuery});return n.limitType==="LAST"?Bs(e,e.limit,"L"):e}var Hs=class{constructor(){}Dt(e,t){this.Ct(e,t),t.vt()}Ct(e,t){if("nullValue"in e)this.Ft(t,5);else if("booleanValue"in e)this.Ft(t,10),t.Mt(e.booleanValue?1:0);else if("integerValue"in e)this.Ft(t,15),t.Mt(te(e.integerValue));else if("doubleValue"in e){let r=te(e.doubleValue);isNaN(r)?this.Ft(t,13):(this.Ft(t,15),ei(r)?t.Mt(0):t.Mt(r))}else if("timestampValue"in e){let r=e.timestampValue;this.Ft(t,20),typeof r=="string"&&(r=gt(r)),t.xt(`${r.seconds||""}`),t.Mt(r.nanos||0)}else if("stringValue"in e)this.Ot(e.stringValue,t),this.Nt(t);else if("bytesValue"in e)this.Ft(t,30),t.Bt(_t(e.bytesValue)),this.Nt(t);else if("referenceValue"in e)this.Lt(e.referenceValue,t);else if("geoPointValue"in e){let r=e.geoPointValue;this.Ft(t,45),t.Mt(r.latitude||0),t.Mt(r.longitude||0)}else"mapValue"in e?vm(e)?this.Ft(t,Number.MAX_SAFE_INTEGER):ym(e)?this.kt(e.mapValue,t):(this.qt(e.mapValue,t),this.Nt(t)):"arrayValue"in e?(this.Qt(e.arrayValue,t),this.Nt(t)):F(19022,{$t:e})}Ot(e,t){this.Ft(t,25),this.Ut(e,t)}Ut(e,t){t.xt(e)}qt(e,t){let r=e.fields||{};this.Ft(t,55);for(let i of Object.keys(r))this.Ot(i,t),this.Ct(r[i],t)}kt(e,t){let r=e.fields||{};this.Ft(t,53);let i=Hn,o=r[i].arrayValue?.values?.length||0;this.Ft(t,15),t.Mt(te(o)),this.Ot(i,t),this.Ct(r[i],t)}Qt(e,t){let r=e.values||[];this.Ft(t,50);for(let i of r)this.Ct(i,t)}Lt(e,t){this.Ft(t,37),x.fromName(e).path.forEach(r=>{this.Ft(t,60),this.Ut(r,t)})}Ft(e,t){e.Mt(t)}Nt(e){e.Mt(2)}};Hs.Kt=new Hs;var ru=class{constructor(){this.Cn=new iu}addToCollectionParentIndex(e,t){return this.Cn.add(t),P.resolve()}getCollectionParents(e,t){return P.resolve(this.Cn.getEntries(t))}addFieldIndex(e,t){return P.resolve()}deleteFieldIndex(e,t){return P.resolve()}deleteAllFieldIndexes(e){return P.resolve()}createTargetIndexes(e,t){return P.resolve()}getDocumentsMatchingTarget(e,t){return P.resolve(null)}getIndexType(e,t){return P.resolve(0)}getFieldIndexes(e,t){return P.resolve([])}getNextCollectionGroupToUpdate(e){return P.resolve(null)}getMinOffset(e,t){return P.resolve(_n.min())}getMinOffsetFromCollectionGroup(e,t){return P.resolve(_n.min())}updateCollectionGroup(e,t,r){return P.resolve()}updateIndexEntries(e,t){return P.resolve()}},iu=class{constructor(){this.index={}}add(e){let t=e.lastSegment(),r=e.popLast(),i=this.index[t]||new ye(ne.comparator),o=!i.has(r);return this.index[t]=i.add(r),o}has(e){let t=e.lastSegment(),r=e.popLast(),i=this.index[t];return i&&i.has(r)}getEntries(e){return(this.index[e]||new ye(ne.comparator)).toArray()}};var Yb=new Uint8Array(0);var Np={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0},Wm=41943040,Ue=class n{static withCacheSize(e){return new n(e,n.DEFAULT_COLLECTION_PERCENTILE,n.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}constructor(e,t,r){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=t,this.maximumSequenceNumbersToCollect=r}};Ue.DEFAULT_COLLECTION_PERCENTILE=10,Ue.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,Ue.DEFAULT=new Ue(Wm,Ue.DEFAULT_COLLECTION_PERCENTILE,Ue.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),Ue.DISABLED=new Ue(-1,0,0);var oi=class n{constructor(e){this.ar=e}next(){return this.ar+=2,this.ar}static ur(){return new n(0)}static cr(){return new n(-1)}};var Vp="LruGarbageCollector",iE=1048576;function kp([n,e],[t,r]){let i=$(n,t);return i===0?$(e,r):i}var su=class{constructor(e){this.Ir=e,this.buffer=new ye(kp),this.Er=0}dr(){return++this.Er}Ar(e){let t=[e,this.dr()];if(this.buffer.size<this.Ir)this.buffer=this.buffer.add(t);else{let r=this.buffer.last();kp(t,r)<0&&(this.buffer=this.buffer.delete(r).add(t))}}get maxValue(){return this.buffer.last()[0]}},ou=class{constructor(e,t,r){this.garbageCollector=e,this.asyncQueue=t,this.localStore=r,this.Rr=null}start(){this.garbageCollector.params.cacheSizeCollectionThreshold!==-1&&this.Vr(6e4)}stop(){this.Rr&&(this.Rr.cancel(),this.Rr=null)}get started(){return this.Rr!==null}Vr(e){O(Vp,`Garbage collection scheduled in ${e}ms`),this.Rr=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",e,()=>_(this,null,function*(){this.Rr=null;try{yield this.localStore.collectGarbage(this.garbageCollector)}catch(t){sr(t)?O(Vp,"Ignoring IndexedDB error during garbage collection: ",t):yield ir(t)}yield this.Vr(3e5)}))}},au=class{constructor(e,t){this.mr=e,this.params=t}calculateTargetCount(e,t){return this.mr.gr(e).next(r=>Math.floor(t/100*r))}nthSequenceNumber(e,t){if(t===0)return P.resolve(sl.ce);let r=new su(t);return this.mr.forEachTarget(e,i=>r.Ar(i.sequenceNumber)).next(()=>this.mr.pr(e,i=>r.Ar(i))).next(()=>r.maxValue)}removeTargets(e,t,r){return this.mr.removeTargets(e,t,r)}removeOrphanedDocuments(e,t){return this.mr.removeOrphanedDocuments(e,t)}collect(e,t){return this.params.cacheSizeCollectionThreshold===-1?(O("LruGarbageCollector","Garbage collection skipped; disabled"),P.resolve(Np)):this.getCacheSize(e).next(r=>r<this.params.cacheSizeCollectionThreshold?(O("LruGarbageCollector",`Garbage collection skipped; Cache size ${r} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),Np):this.yr(e,t))}getCacheSize(e){return this.mr.getCacheSize(e)}yr(e,t){let r,i,o,a,u,h,d,p=Date.now();return this.calculateTargetCount(e,this.params.percentileToCollect).next(v=>(v>this.params.maximumSequenceNumbersToCollect?(O("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${v}`),i=this.params.maximumSequenceNumbersToCollect):i=v,a=Date.now(),this.nthSequenceNumber(e,i))).next(v=>(r=v,u=Date.now(),this.removeTargets(e,r,t))).next(v=>(o=v,h=Date.now(),this.removeOrphanedDocuments(e,r))).next(v=>(d=Date.now(),xn()<=z.DEBUG&&O("LruGarbageCollector",`LRU Garbage Collection
	Counted targets in ${a-p}ms
	Determined least recently used ${i} in `+(u-a)+`ms
	Removed ${o} targets in `+(h-u)+`ms
	Removed ${v} documents in `+(d-h)+`ms
Total Duration: ${d-p}ms`),P.resolve({didRun:!0,sequenceNumbersCollected:i,targetsRemoved:o,documentsRemoved:v})))}};function sE(n,e){return new au(n,e)}var cu=class{constructor(){this.changes=new yt(e=>e.toString(),(e,t)=>e.isEqual(t)),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,t){this.assertNotApplied(),this.changes.set(e,ze.newInvalidDocument(e).setReadTime(t))}getEntry(e,t){this.assertNotApplied();let r=this.changes.get(t);return r!==void 0?P.resolve(r):this.getFromCache(e,t)}getEntries(e,t){return this.getAllFromCache(e,t)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}};var uu=class{constructor(e,t){this.overlayedDocument=e,this.mutatedFields=t}};var lu=class{constructor(e,t,r,i){this.remoteDocumentCache=e,this.mutationQueue=t,this.documentOverlayCache=r,this.indexManager=i}getDocument(e,t){let r=null;return this.documentOverlayCache.getOverlay(e,t).next(i=>(r=i,this.remoteDocumentCache.getEntry(e,t))).next(i=>(r!==null&&Yr(r.mutation,i,Be.empty(),se.now()),i))}getDocuments(e,t){return this.remoteDocumentCache.getEntries(e,t).next(r=>this.getLocalViewOfDocuments(e,r,H()).next(()=>r))}getLocalViewOfDocuments(e,t,r=H()){let i=dn();return this.populateOverlays(e,i,t).next(()=>this.computeViews(e,t,i,r).next(o=>{let a=Wr();return o.forEach((u,h)=>{a=a.insert(u,h.overlayedDocument)}),a}))}getOverlayedDocuments(e,t){let r=dn();return this.populateOverlays(e,r,t).next(()=>this.computeViews(e,t,r,H()))}populateOverlays(e,t,r){let i=[];return r.forEach(o=>{t.has(o)||i.push(o)}),this.documentOverlayCache.getOverlays(e,i).next(o=>{o.forEach((a,u)=>{t.set(a,u)})})}computeViews(e,t,r,i){let o=vt(),a=Jr(),u=(function(){return Jr()})();return t.forEach((h,d)=>{let p=r.get(d.key);i.has(d.key)&&(p===void 0||p.mutation instanceof st)?o=o.insert(d.key,d):p!==void 0?(a.set(d.key,p.mutation.getFieldMask()),Yr(p.mutation,d,p.mutation.getFieldMask(),se.now())):a.set(d.key,Be.empty())}),this.recalculateAndSaveOverlays(e,o).next(h=>(h.forEach((d,p)=>a.set(d,p)),t.forEach((d,p)=>u.set(d,new uu(p,a.get(d)??null))),u))}recalculateAndSaveOverlays(e,t){let r=Jr(),i=new oe((a,u)=>a-u),o=H();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,t).next(a=>{for(let u of a)u.keys().forEach(h=>{let d=t.get(h);if(d===null)return;let p=r.get(h)||Be.empty();p=u.applyToLocalView(d,p),r.set(h,p);let v=(i.get(u.batchId)||H()).add(h);i=i.insert(u.batchId,v)})}).next(()=>{let a=[],u=i.getReverseIterator();for(;u.hasNext();){let h=u.getNext(),d=h.key,p=h.value,v=Nm();p.forEach(w=>{if(!o.has(w)){let R=Fm(t.get(w),r.get(w));R!==null&&v.set(w,R),o=o.add(w)}}),a.push(this.documentOverlayCache.saveOverlays(e,d,v))}return P.waitFor(a)}).next(()=>r)}recalculateAndSaveOverlaysForDocumentKeys(e,t){return this.remoteDocumentCache.getEntries(e,t).next(r=>this.recalculateAndSaveOverlays(e,r))}getDocumentsMatchingQuery(e,t,r,i){return(function(a){return x.isDocumentKey(a.path)&&a.collectionGroup===null&&a.filters.length===0})(t)?this.getDocumentsMatchingDocumentQuery(e,t.path):Sm(t)?this.getDocumentsMatchingCollectionGroupQuery(e,t,r,i):this.getDocumentsMatchingCollectionQuery(e,t,r,i)}getNextDocuments(e,t,r,i){return this.remoteDocumentCache.getAllFromCollectionGroup(e,t,r,i).next(o=>{let a=i-o.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,t,r.largestBatchId,i-o.size):P.resolve(dn()),u=Zr,h=o;return a.next(d=>P.forEach(d,(p,v)=>(u<v.largestBatchId&&(u=v.largestBatchId),o.get(p)?P.resolve():this.remoteDocumentCache.getEntry(e,p).next(w=>{h=h.insert(p,w)}))).next(()=>this.populateOverlays(e,d,o)).next(()=>this.computeViews(e,h,d,H())).next(p=>({batchId:u,changes:Dm(p)})))})}getDocumentsMatchingDocumentQuery(e,t){return this.getDocument(e,new x(t)).next(r=>{let i=Wr();return r.isFoundDocument()&&(i=i.insert(r.key,r)),i})}getDocumentsMatchingCollectionGroupQuery(e,t,r,i){let o=t.collectionGroup,a=Wr();return this.indexManager.getCollectionParents(e,o).next(u=>P.forEach(u,h=>{let d=(function(v,w){return new Ht(w,null,v.explicitOrderBy.slice(),v.filters.slice(),v.limit,v.limitType,v.startAt,v.endAt)})(t,h.child(o));return this.getDocumentsMatchingCollectionQuery(e,d,r,i).next(p=>{p.forEach((v,w)=>{a=a.insert(v,w)})})}).next(()=>a))}getDocumentsMatchingCollectionQuery(e,t,r,i){let o;return this.documentOverlayCache.getOverlaysForCollection(e,t.path,r.largestBatchId).next(a=>(o=a,this.remoteDocumentCache.getDocumentsMatchingQuery(e,t,r,o,i))).next(a=>{o.forEach((h,d)=>{let p=d.getKey();a.get(p)===null&&(a=a.insert(p,ze.newInvalidDocument(p)))});let u=Wr();return a.forEach((h,d)=>{let p=o.get(h);p!==void 0&&Yr(p.mutation,d,Be.empty(),se.now()),vo(t,d)&&(u=u.insert(h,d))}),u})}};var hu=class{constructor(e){this.serializer=e,this.Lr=new Map,this.kr=new Map}getBundleMetadata(e,t){return P.resolve(this.Lr.get(t))}saveBundleMetadata(e,t){return this.Lr.set(t.id,(function(i){return{id:i.id,version:i.version,createTime:rt(i.createTime)}})(t)),P.resolve()}getNamedQuery(e,t){return P.resolve(this.kr.get(t))}saveNamedQuery(e,t){return this.kr.set(t.name,(function(i){return{name:i.name,query:rE(i.bundledQuery),readTime:rt(i.readTime)}})(t)),P.resolve()}};var du=class{constructor(){this.overlays=new oe(x.comparator),this.qr=new Map}getOverlay(e,t){return P.resolve(this.overlays.get(t))}getOverlays(e,t){let r=dn();return P.forEach(t,i=>this.getOverlay(e,i).next(o=>{o!==null&&r.set(i,o)})).next(()=>r)}saveOverlays(e,t,r){return r.forEach((i,o)=>{this.St(e,t,o)}),P.resolve()}removeOverlaysForBatchId(e,t,r){let i=this.qr.get(r);return i!==void 0&&(i.forEach(o=>this.overlays=this.overlays.remove(o)),this.qr.delete(r)),P.resolve()}getOverlaysForCollection(e,t,r){let i=dn(),o=t.length+1,a=new x(t.child("")),u=this.overlays.getIteratorFrom(a);for(;u.hasNext();){let h=u.getNext().value,d=h.getKey();if(!t.isPrefixOf(d.path))break;d.path.length===o&&h.largestBatchId>r&&i.set(h.getKey(),h)}return P.resolve(i)}getOverlaysForCollectionGroup(e,t,r,i){let o=new oe((d,p)=>d-p),a=this.overlays.getIterator();for(;a.hasNext();){let d=a.getNext().value;if(d.getKey().getCollectionGroup()===t&&d.largestBatchId>r){let p=o.get(d.largestBatchId);p===null&&(p=dn(),o=o.insert(d.largestBatchId,p)),p.set(d.getKey(),d)}}let u=dn(),h=o.getIterator();for(;h.hasNext()&&(h.getNext().value.forEach((d,p)=>u.set(d,p)),!(u.size()>=i)););return P.resolve(u)}St(e,t,r){let i=this.overlays.get(r.key);if(i!==null){let a=this.qr.get(i.largestBatchId).delete(r.key);this.qr.set(i.largestBatchId,a)}this.overlays=this.overlays.insert(r.key,new Wc(t,r));let o=this.qr.get(t);o===void 0&&(o=H(),this.qr.set(t,o)),this.qr.set(t,o.add(r.key))}};var fu=class{constructor(){this.sessionToken=Ee.EMPTY_BYTE_STRING}getSessionToken(e){return P.resolve(this.sessionToken)}setSessionToken(e,t){return this.sessionToken=t,P.resolve()}};var ai=class{constructor(){this.Qr=new ye(ue.$r),this.Ur=new ye(ue.Kr)}isEmpty(){return this.Qr.isEmpty()}addReference(e,t){let r=new ue(e,t);this.Qr=this.Qr.add(r),this.Ur=this.Ur.add(r)}Wr(e,t){e.forEach(r=>this.addReference(r,t))}removeReference(e,t){this.Gr(new ue(e,t))}zr(e,t){e.forEach(r=>this.removeReference(r,t))}jr(e){let t=new x(new ne([])),r=new ue(t,e),i=new ue(t,e+1),o=[];return this.Ur.forEachInRange([r,i],a=>{this.Gr(a),o.push(a.key)}),o}Jr(){this.Qr.forEach(e=>this.Gr(e))}Gr(e){this.Qr=this.Qr.delete(e),this.Ur=this.Ur.delete(e)}Hr(e){let t=new x(new ne([])),r=new ue(t,e),i=new ue(t,e+1),o=H();return this.Ur.forEachInRange([r,i],a=>{o=o.add(a.key)}),o}containsKey(e){let t=new ue(e,0),r=this.Qr.firstAfterOrEqual(t);return r!==null&&e.isEqual(r.key)}},ue=class{constructor(e,t){this.key=e,this.Yr=t}static $r(e,t){return x.comparator(e.key,t.key)||$(e.Yr,t.Yr)}static Kr(e,t){return $(e.Yr,t.Yr)||x.comparator(e.key,t.key)}};var pu=class{constructor(e,t){this.indexManager=e,this.referenceDelegate=t,this.mutationQueue=[],this.tr=1,this.Zr=new ye(ue.$r)}checkEmpty(e){return P.resolve(this.mutationQueue.length===0)}addMutationBatch(e,t,r,i){let o=this.tr;this.tr++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];let a=new $c(o,t,r,i);this.mutationQueue.push(a);for(let u of i)this.Zr=this.Zr.add(new ue(u.key,o)),this.indexManager.addToCollectionParentIndex(e,u.key.path.popLast());return P.resolve(a)}lookupMutationBatch(e,t){return P.resolve(this.Xr(t))}getNextMutationBatchAfterBatchId(e,t){let r=t+1,i=this.ei(r),o=i<0?0:i;return P.resolve(this.mutationQueue.length>o?this.mutationQueue[o]:null)}getHighestUnacknowledgedBatchId(){return P.resolve(this.mutationQueue.length===0?ol:this.tr-1)}getAllMutationBatches(e){return P.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,t){let r=new ue(t,0),i=new ue(t,Number.POSITIVE_INFINITY),o=[];return this.Zr.forEachInRange([r,i],a=>{let u=this.Xr(a.Yr);o.push(u)}),P.resolve(o)}getAllMutationBatchesAffectingDocumentKeys(e,t){let r=new ye($);return t.forEach(i=>{let o=new ue(i,0),a=new ue(i,Number.POSITIVE_INFINITY);this.Zr.forEachInRange([o,a],u=>{r=r.add(u.Yr)})}),P.resolve(this.ti(r))}getAllMutationBatchesAffectingQuery(e,t){let r=t.path,i=r.length+1,o=r;x.isDocumentKey(o)||(o=o.child(""));let a=new ue(new x(o),0),u=new ye($);return this.Zr.forEachWhile(h=>{let d=h.key.path;return!!r.isPrefixOf(d)&&(d.length===i&&(u=u.add(h.Yr)),!0)},a),P.resolve(this.ti(u))}ti(e){let t=[];return e.forEach(r=>{let i=this.Xr(r);i!==null&&t.push(i)}),t}removeMutationBatch(e,t){Y(this.ni(t.batchId,"removed")===0,55003),this.mutationQueue.shift();let r=this.Zr;return P.forEach(t.mutations,i=>{let o=new ue(i.key,t.batchId);return r=r.delete(o),this.referenceDelegate.markPotentiallyOrphaned(e,i.key)}).next(()=>{this.Zr=r})}ir(e){}containsKey(e,t){let r=new ue(t,0),i=this.Zr.firstAfterOrEqual(r);return P.resolve(t.isEqual(i&&i.key))}performConsistencyCheck(e){return this.mutationQueue.length,P.resolve()}ni(e,t){return this.ei(e)}ei(e){return this.mutationQueue.length===0?0:e-this.mutationQueue[0].batchId}Xr(e){let t=this.ei(e);return t<0||t>=this.mutationQueue.length?null:this.mutationQueue[t]}};var mu=class{constructor(e){this.ri=e,this.docs=(function(){return new oe(x.comparator)})(),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,t){let r=t.key,i=this.docs.get(r),o=i?i.size:0,a=this.ri(t);return this.docs=this.docs.insert(r,{document:t.mutableCopy(),size:a}),this.size+=a-o,this.indexManager.addToCollectionParentIndex(e,r.path.popLast())}removeEntry(e){let t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}getEntry(e,t){let r=this.docs.get(t);return P.resolve(r?r.document.mutableCopy():ze.newInvalidDocument(t))}getEntries(e,t){let r=vt();return t.forEach(i=>{let o=this.docs.get(i);r=r.insert(i,o?o.document.mutableCopy():ze.newInvalidDocument(i))}),P.resolve(r)}getDocumentsMatchingQuery(e,t,r,i){let o=vt(),a=t.path,u=new x(a.child("__id-9223372036854775808__")),h=this.docs.getIteratorFrom(u);for(;h.hasNext();){let{key:d,value:{document:p}}=h.getNext();if(!a.isPrefixOf(d.path))break;d.path.length>a.length+1||rw(nw(p),r)<=0||(i.has(p.key)||vo(t,p))&&(o=o.insert(p.key,p.mutableCopy()))}return P.resolve(o)}getAllFromCollectionGroup(e,t,r,i){F(9500)}ii(e,t){return P.forEach(this.docs,r=>t(r))}newChangeBuffer(e){return new gu(this)}getSize(e){return P.resolve(this.size)}},gu=class extends cu{constructor(e){super(),this.Nr=e}applyChanges(e){let t=[];return this.changes.forEach((r,i)=>{i.isValidDocument()?t.push(this.Nr.addEntry(e,i)):this.Nr.removeEntry(r)}),P.waitFor(t)}getFromCache(e,t){return this.Nr.getEntry(e,t)}getAllFromCache(e,t){return this.Nr.getEntries(e,t)}};var _u=class{constructor(e){this.persistence=e,this.si=new yt(t=>hl(t),dl),this.lastRemoteSnapshotVersion=q.min(),this.highestTargetId=0,this.oi=0,this._i=new ai,this.targetCount=0,this.ai=oi.ur()}forEachTarget(e,t){return this.si.forEach((r,i)=>t(i)),P.resolve()}getLastRemoteSnapshotVersion(e){return P.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return P.resolve(this.oi)}allocateTargetId(e){return this.highestTargetId=this.ai.next(),P.resolve(this.highestTargetId)}setTargetsMetadata(e,t,r){return r&&(this.lastRemoteSnapshotVersion=r),t>this.oi&&(this.oi=t),P.resolve()}Pr(e){this.si.set(e.target,e);let t=e.targetId;t>this.highestTargetId&&(this.ai=new oi(t),this.highestTargetId=t),e.sequenceNumber>this.oi&&(this.oi=e.sequenceNumber)}addTargetData(e,t){return this.Pr(t),this.targetCount+=1,P.resolve()}updateTargetData(e,t){return this.Pr(t),P.resolve()}removeTargetData(e,t){return this.si.delete(t.target),this._i.jr(t.targetId),this.targetCount-=1,P.resolve()}removeTargets(e,t,r){let i=0,o=[];return this.si.forEach((a,u)=>{u.sequenceNumber<=t&&r.get(u.targetId)===null&&(this.si.delete(a),o.push(this.removeMatchingKeysForTargetId(e,u.targetId)),i++)}),P.waitFor(o).next(()=>i)}getTargetCount(e){return P.resolve(this.targetCount)}getTargetData(e,t){let r=this.si.get(t)||null;return P.resolve(r)}addMatchingKeys(e,t,r){return this._i.Wr(t,r),P.resolve()}removeMatchingKeys(e,t,r){this._i.zr(t,r);let i=this.persistence.referenceDelegate,o=[];return i&&t.forEach(a=>{o.push(i.markPotentiallyOrphaned(e,a))}),P.waitFor(o)}removeMatchingKeysForTargetId(e,t){return this._i.jr(t),P.resolve()}getMatchingKeysForTargetId(e,t){let r=this._i.Hr(t);return P.resolve(r)}containsKey(e,t){return P.resolve(this._i.containsKey(t))}};var Ws=class{constructor(e,t){this.ui={},this.overlays={},this.ci=new sl(0),this.li=!1,this.li=!0,this.hi=new fu,this.referenceDelegate=e(this),this.Pi=new _u(this),this.indexManager=new ru,this.remoteDocumentCache=(function(i){return new mu(i)})(r=>this.referenceDelegate.Ti(r)),this.serializer=new nu(t),this.Ii=new hu(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.li=!1,Promise.resolve()}get started(){return this.li}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let t=this.overlays[e.toKey()];return t||(t=new du,this.overlays[e.toKey()]=t),t}getMutationQueue(e,t){let r=this.ui[e.toKey()];return r||(r=new pu(t,this.referenceDelegate),this.ui[e.toKey()]=r),r}getGlobalsCache(){return this.hi}getTargetCache(){return this.Pi}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Ii}runTransaction(e,t,r){O("MemoryPersistence","Starting transaction:",e);let i=new yu(this.ci.next());return this.referenceDelegate.Ei(),r(i).next(o=>this.referenceDelegate.di(i).next(()=>o)).toPromise().then(o=>(i.raiseOnCommittedEvent(),o))}Ai(e,t){return P.or(Object.values(this.ui).map(r=>()=>r.containsKey(e,t)))}},yu=class extends Cc{constructor(e){super(),this.currentSequenceNumber=e}},vu=class n{constructor(e){this.persistence=e,this.Ri=new ai,this.Vi=null}static mi(e){return new n(e)}get fi(){if(this.Vi)return this.Vi;throw F(60996)}addReference(e,t,r){return this.Ri.addReference(r,t),this.fi.delete(r.toString()),P.resolve()}removeReference(e,t,r){return this.Ri.removeReference(r,t),this.fi.add(r.toString()),P.resolve()}markPotentiallyOrphaned(e,t){return this.fi.add(t.toString()),P.resolve()}removeTarget(e,t){this.Ri.jr(t.targetId).forEach(i=>this.fi.add(i.toString()));let r=this.persistence.getTargetCache();return r.getMatchingKeysForTargetId(e,t.targetId).next(i=>{i.forEach(o=>this.fi.add(o.toString()))}).next(()=>r.removeTargetData(e,t))}Ei(){this.Vi=new Set}di(e){let t=this.persistence.getRemoteDocumentCache().newChangeBuffer();return P.forEach(this.fi,r=>{let i=x.fromPath(r);return this.gi(e,i).next(o=>{o||t.removeEntry(i,q.min())})}).next(()=>(this.Vi=null,t.apply(e)))}updateLimboDocument(e,t){return this.gi(e,t).next(r=>{r?this.fi.delete(t.toString()):this.fi.add(t.toString())})}Ti(e){return 0}gi(e,t){return P.or([()=>P.resolve(this.Ri.containsKey(t)),()=>this.persistence.getTargetCache().containsKey(e,t),()=>this.persistence.Ai(e,t)])}},Ks=class n{constructor(e,t){this.persistence=e,this.pi=new yt(r=>aw(r.path),(r,i)=>r.isEqual(i)),this.garbageCollector=sE(this,t)}static mi(e,t){return new n(e,t)}Ei(){}di(e){return P.resolve()}forEachTarget(e,t){return this.persistence.getTargetCache().forEachTarget(e,t)}gr(e){let t=this.wr(e);return this.persistence.getTargetCache().getTargetCount(e).next(r=>t.next(i=>r+i))}wr(e){let t=0;return this.pr(e,r=>{t++}).next(()=>t)}pr(e,t){return P.forEach(this.pi,(r,i)=>this.br(e,r,i).next(o=>o?P.resolve():t(i)))}removeTargets(e,t,r){return this.persistence.getTargetCache().removeTargets(e,t,r)}removeOrphanedDocuments(e,t){let r=0,i=this.persistence.getRemoteDocumentCache(),o=i.newChangeBuffer();return i.ii(e,a=>this.br(e,a,t).next(u=>{u||(r++,o.removeEntry(a,q.min()))})).next(()=>o.apply(e)).next(()=>r)}markPotentiallyOrphaned(e,t){return this.pi.set(t,e.currentSequenceNumber),P.resolve()}removeTarget(e,t){let r=t.withSequenceNumber(e.currentSequenceNumber);return this.persistence.getTargetCache().updateTargetData(e,r)}addReference(e,t,r){return this.pi.set(r,e.currentSequenceNumber),P.resolve()}removeReference(e,t,r){return this.pi.set(r,e.currentSequenceNumber),P.resolve()}updateLimboDocument(e,t){return this.pi.set(t,e.currentSequenceNumber),P.resolve()}Ti(e){let t=e.key.toString().length;return e.isFoundDocument()&&(t+=Ps(e.data.value)),t}br(e,t,r){return P.or([()=>this.persistence.Ai(e,t),()=>this.persistence.getTargetCache().containsKey(e,t),()=>{let i=this.pi.get(t);return P.resolve(i!==void 0&&i>r)}])}getCacheSize(e){return this.persistence.getRemoteDocumentCache().getSize(e)}};var Iu=class n{constructor(e,t,r,i){this.targetId=e,this.fromCache=t,this.Es=r,this.ds=i}static As(e,t){let r=H(),i=H();for(let o of t.docChanges)switch(o.type){case 0:r=r.add(o.doc.key);break;case 1:i=i.add(o.doc.key)}return new n(e,t.fromCache,r,i)}};var wu=class{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(e){this._documentReadCount+=e}};var Eu=class{constructor(){this.Rs=!1,this.Vs=!1,this.fs=100,this.gs=(function(){return Hd()?8:sw(ge())>0?6:4})()}initialize(e,t){this.ps=e,this.indexManager=t,this.Rs=!0}getDocumentsMatchingQuery(e,t,r,i){let o={result:null};return this.ys(e,t).next(a=>{o.result=a}).next(()=>{if(!o.result)return this.ws(e,t,i,r).next(a=>{o.result=a})}).next(()=>{if(o.result)return;let a=new wu;return this.Ss(e,t,a).next(u=>{if(o.result=u,this.Vs)return this.bs(e,t,a,u.size)})}).next(()=>o.result)}bs(e,t,r,i){return r.documentReadCount<this.fs?(xn()<=z.DEBUG&&O("QueryEngine","SDK will not create cache indexes for query:",Fn(t),"since it only creates cache indexes for collection contains","more than or equal to",this.fs,"documents"),P.resolve()):(xn()<=z.DEBUG&&O("QueryEngine","Query:",Fn(t),"scans",r.documentReadCount,"local documents and returns",i,"documents as results."),r.documentReadCount>this.gs*i?(xn()<=z.DEBUG&&O("QueryEngine","The SDK decides to create cache indexes for query:",Fn(t),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(e,tt(t))):P.resolve())}ys(e,t){if(Ep(t))return P.resolve(null);let r=tt(t);return this.indexManager.getIndexType(e,r).next(i=>i===0?null:(t.limit!==null&&i===1&&(t=Bs(t,null,"F"),r=tt(t)),this.indexManager.getDocumentsMatchingTarget(e,r).next(o=>{let a=H(...o);return this.ps.getDocuments(e,a).next(u=>this.indexManager.getMinOffset(e,r).next(h=>{let d=this.Ds(t,u);return this.Cs(t,d,a,h.readTime)?this.ys(e,Bs(t,null,"F")):this.vs(e,d,t,h)}))})))}ws(e,t,r,i){return Ep(t)||i.isEqual(q.min())?P.resolve(null):this.ps.getDocuments(e,r).next(o=>{let a=this.Ds(t,o);return this.Cs(t,a,r,i)?P.resolve(null):(xn()<=z.DEBUG&&O("QueryEngine","Re-using previous result from %s to execute query: %s",i.toString(),Fn(t)),this.vs(e,a,t,tw(i,Zr)).next(u=>u))})}Ds(e,t){let r=new ye(Rm(e));return t.forEach((i,o)=>{vo(e,o)&&(r=r.add(o))}),r}Cs(e,t,r,i){if(e.limit===null)return!1;if(r.size!==t.size)return!0;let o=e.limitType==="F"?t.last():t.first();return!!o&&(o.hasPendingWrites||o.version.compareTo(i)>0)}Ss(e,t,r){return xn()<=z.DEBUG&&O("QueryEngine","Using full collection scan to execute query:",Fn(t)),this.ps.getDocumentsMatchingQuery(e,t,_n.min(),r)}vs(e,t,r,i){return this.ps.getDocumentsMatchingQuery(e,r,i).next(o=>(t.forEach(a=>{o=o.insert(a.key,a)}),o))}};var gl="LocalStore",oE=3e8,Tu=class{constructor(e,t,r,i){this.persistence=e,this.Fs=t,this.serializer=i,this.Ms=new oe($),this.xs=new yt(o=>hl(o),dl),this.Os=new Map,this.Ns=e.getRemoteDocumentCache(),this.Pi=e.getTargetCache(),this.Ii=e.getBundleCache(),this.Bs(r)}Bs(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new lu(this.Ns,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.Ns.setIndexManager(this.indexManager),this.Fs.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",t=>e.collect(t,this.Ms))}};function aE(n,e,t,r){return new Tu(n,e,t,r)}function Km(n,e){return _(this,null,function*(){let t=B(n);return yield t.persistence.runTransaction("Handle user change","readonly",r=>{let i;return t.mutationQueue.getAllMutationBatches(r).next(o=>(i=o,t.Bs(e),t.mutationQueue.getAllMutationBatches(r))).next(o=>{let a=[],u=[],h=H();for(let d of i){a.push(d.batchId);for(let p of d.mutations)h=h.add(p.key)}for(let d of o){u.push(d.batchId);for(let p of d.mutations)h=h.add(p.key)}return t.localDocuments.getDocuments(r,h).next(d=>({Ls:d,removedBatchIds:a,addedBatchIds:u}))})})})}function cE(n,e){let t=B(n);return t.persistence.runTransaction("Acknowledge batch","readwrite-primary",r=>{let i=e.batch.keys(),o=t.Ns.newChangeBuffer({trackRemovals:!0});return(function(u,h,d,p){let v=d.batch,w=v.keys(),R=P.resolve();return w.forEach(k=>{R=R.next(()=>p.getEntry(h,k)).next(M=>{let N=d.docVersions.get(k);Y(N!==null,48541),M.version.compareTo(N)<0&&(v.applyToRemoteDocument(M,d),M.isValidDocument()&&(M.setReadTime(d.commitVersion),p.addEntry(M)))})}),R.next(()=>u.mutationQueue.removeMutationBatch(h,v))})(t,r,e,o).next(()=>o.apply(r)).next(()=>t.mutationQueue.performConsistencyCheck(r)).next(()=>t.documentOverlayCache.removeOverlaysForBatchId(r,i,e.batch.batchId)).next(()=>t.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(r,(function(u){let h=H();for(let d=0;d<u.mutationResults.length;++d)u.mutationResults[d].transformResults.length>0&&(h=h.add(u.batch.mutations[d].key));return h})(e))).next(()=>t.localDocuments.getDocuments(r,i))})}function Qm(n){let e=B(n);return e.persistence.runTransaction("Get last remote snapshot version","readonly",t=>e.Pi.getLastRemoteSnapshotVersion(t))}function uE(n,e){let t=B(n),r=e.snapshotVersion,i=t.Ms;return t.persistence.runTransaction("Apply remote event","readwrite-primary",o=>{let a=t.Ns.newChangeBuffer({trackRemovals:!0});i=t.Ms;let u=[];e.targetChanges.forEach((p,v)=>{let w=i.get(v);if(!w)return;u.push(t.Pi.removeMatchingKeys(o,p.removedDocuments,v).next(()=>t.Pi.addMatchingKeys(o,p.addedDocuments,v)));let R=w.withSequenceNumber(o.currentSequenceNumber);e.targetMismatches.get(v)!==null?R=R.withResumeToken(Ee.EMPTY_BYTE_STRING,q.min()).withLastLimboFreeSnapshotVersion(q.min()):p.resumeToken.approximateByteSize()>0&&(R=R.withResumeToken(p.resumeToken,r)),i=i.insert(v,R),(function(M,N,G){return M.resumeToken.approximateByteSize()===0||N.snapshotVersion.toMicroseconds()-M.snapshotVersion.toMicroseconds()>=oE?!0:G.addedDocuments.size+G.modifiedDocuments.size+G.removedDocuments.size>0})(w,R,p)&&u.push(t.Pi.updateTargetData(o,R))});let h=vt(),d=H();if(e.documentUpdates.forEach(p=>{e.resolvedLimboDocuments.has(p)&&u.push(t.persistence.referenceDelegate.updateLimboDocument(o,p))}),u.push(lE(o,a,e.documentUpdates).next(p=>{h=p.ks,d=p.qs})),!r.isEqual(q.min())){let p=t.Pi.getLastRemoteSnapshotVersion(o).next(v=>t.Pi.setTargetsMetadata(o,o.currentSequenceNumber,r));u.push(p)}return P.waitFor(u).next(()=>a.apply(o)).next(()=>t.localDocuments.getLocalViewOfDocuments(o,h,d)).next(()=>h)}).then(o=>(t.Ms=i,o))}function lE(n,e,t){let r=H(),i=H();return t.forEach(o=>r=r.add(o)),e.getEntries(n,r).next(o=>{let a=vt();return t.forEach((u,h)=>{let d=o.get(u);h.isFoundDocument()!==d.isFoundDocument()&&(i=i.add(u)),h.isNoDocument()&&h.version.isEqual(q.min())?(e.removeEntry(u,h.readTime),a=a.insert(u,h)):!d.isValidDocument()||h.version.compareTo(d.version)>0||h.version.compareTo(d.version)===0&&d.hasPendingWrites?(e.addEntry(h),a=a.insert(u,h)):O(gl,"Ignoring outdated watch update for ",u,". Current version:",d.version," Watch version:",h.version)}),{ks:a,qs:i}})}function hE(n,e){let t=B(n);return t.persistence.runTransaction("Get next mutation batch","readonly",r=>(e===void 0&&(e=ol),t.mutationQueue.getNextMutationBatchAfterBatchId(r,e)))}function dE(n,e){let t=B(n);return t.persistence.runTransaction("Allocate target","readwrite",r=>{let i;return t.Pi.getTargetData(r,e).next(o=>o?(i=o,P.resolve(i)):t.Pi.allocateTargetId(r).next(a=>(i=new si(e,a,"TargetPurposeListen",r.currentSequenceNumber),t.Pi.addTargetData(r,i).next(()=>i))))}).then(r=>{let i=t.Ms.get(r.targetId);return(i===null||r.snapshotVersion.compareTo(i.snapshotVersion)>0)&&(t.Ms=t.Ms.insert(r.targetId,r),t.xs.set(e,r.targetId)),r})}function Au(n,e,t){return _(this,null,function*(){let r=B(n),i=r.Ms.get(e),o=t?"readwrite":"readwrite-primary";try{t||(yield r.persistence.runTransaction("Release target",o,a=>r.persistence.referenceDelegate.removeTarget(a,i)))}catch(a){if(!sr(a))throw a;O(gl,`Failed to update sequence numbers for target ${e}: ${a}`)}r.Ms=r.Ms.remove(e),r.xs.delete(i.target)})}function Op(n,e,t){let r=B(n),i=q.min(),o=H();return r.persistence.runTransaction("Execute query","readwrite",a=>(function(h,d,p){let v=B(h),w=v.xs.get(p);return w!==void 0?P.resolve(v.Ms.get(w)):v.Pi.getTargetData(d,p)})(r,a,tt(e)).next(u=>{if(u)return i=u.lastLimboFreeSnapshotVersion,r.Pi.getMatchingKeysForTargetId(a,u.targetId).next(h=>{o=h})}).next(()=>r.Fs.getDocumentsMatchingQuery(a,e,t?i:q.min(),t?o:H())).next(u=>(fE(r,Aw(e),u),{documents:u,Qs:o})))}function fE(n,e,t){let r=n.Os.get(e)||q.min();t.forEach((i,o)=>{o.readTime.compareTo(r)>0&&(r=o.readTime)}),n.Os.set(e,r)}var Qs=class{constructor(){this.activeTargetIds=Dw()}zs(e){this.activeTargetIds=this.activeTargetIds.add(e)}js(e){this.activeTargetIds=this.activeTargetIds.delete(e)}Gs(){let e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}};var bu=class{constructor(){this.Mo=new Qs,this.xo={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,t,r){}addLocalQueryTarget(e,t=!0){return t&&this.Mo.zs(e),this.xo[e]||"not-current"}updateQueryState(e,t,r){this.xo[e]=t}removeLocalQueryTarget(e){this.Mo.js(e)}isLocalQueryTarget(e){return this.Mo.activeTargetIds.has(e)}clearQueryState(e){delete this.xo[e]}getAllActiveQueryTargets(){return this.Mo.activeTargetIds}isActiveQueryTarget(e){return this.Mo.activeTargetIds.has(e)}start(){return this.Mo=new Qs,Promise.resolve()}handleUserChange(e,t,r){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}};var Su=class{Oo(e){}shutdown(){}};var Mp="ConnectivityMonitor",Js=class{constructor(){this.No=()=>this.Bo(),this.Lo=()=>this.ko(),this.qo=[],this.Qo()}Oo(e){this.qo.push(e)}shutdown(){window.removeEventListener("online",this.No),window.removeEventListener("offline",this.Lo)}Qo(){window.addEventListener("online",this.No),window.addEventListener("offline",this.Lo)}Bo(){O(Mp,"Network connectivity changed: AVAILABLE");for(let e of this.qo)e(0)}ko(){O(Mp,"Network connectivity changed: UNAVAILABLE");for(let e of this.qo)e(1)}static v(){return typeof window<"u"&&window.addEventListener!==void 0&&window.removeEventListener!==void 0}};var Rs=null;function Cu(){return Rs===null?Rs=(function(){return 268435456+Math.round(2147483648*Math.random())})():Rs++,"0x"+Rs.toString(16)}var gc="RestConnection",pE={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"},Ru=class{get $o(){return!1}constructor(e){this.databaseInfo=e,this.databaseId=e.databaseId;let t=e.ssl?"https":"http",r=encodeURIComponent(this.databaseId.projectId),i=encodeURIComponent(this.databaseId.database);this.Uo=t+"://"+e.host,this.Ko=`projects/${r}/databases/${i}`,this.Wo=this.databaseId.database===Fs?`project_id=${r}`:`project_id=${r}&database_id=${i}`}Go(e,t,r,i,o){let a=Cu(),u=this.zo(e,t.toUriEncodedString());O(gc,`Sending RPC '${e}' ${a}:`,u,r);let h={"google-cloud-resource-prefix":this.Ko,"x-goog-request-params":this.Wo};this.jo(h,i,o);let{host:d}=new URL(u),p=Ot(d);return this.Jo(e,u,h,r,p).then(v=>(O(gc,`Received RPC '${e}' ${a}: `,v),v),v=>{throw zn(gc,`RPC '${e}' ${a} failed with error: `,v,"url: ",u,"request:",r),v})}Ho(e,t,r,i,o,a){return this.Go(e,t,r,i,o)}jo(e,t,r){e["X-Goog-Api-Client"]=(function(){return"gl-js/ fire/"+rr})(),e["Content-Type"]="text/plain",this.databaseInfo.appId&&(e["X-Firebase-GMPID"]=this.databaseInfo.appId),t&&t.headers.forEach((i,o)=>e[o]=i),r&&r.headers.forEach((i,o)=>e[o]=i)}zo(e,t){let r=pE[e];return`${this.Uo}/v1/${t}:${r}`}terminate(){}};var Pu=class{constructor(e){this.Yo=e.Yo,this.Zo=e.Zo}Xo(e){this.e_=e}t_(e){this.n_=e}r_(e){this.i_=e}onMessage(e){this.s_=e}close(){this.Zo()}send(e){this.Yo(e)}o_(){this.e_()}__(){this.n_()}a_(e){this.i_(e)}u_(e){this.s_(e)}};var we="WebChannelConnection",Du=class extends Ru{constructor(e){super(e),this.c_=[],this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams,this.longPollingOptions=e.longPollingOptions}Jo(e,t,r,i,o){let a=Cu();return new Promise((u,h)=>{let d=new uc;d.setWithCredentials(!0),d.listenOnce(lc.COMPLETE,()=>{try{switch(d.getLastErrorCode()){case Hr.NO_ERROR:let v=d.getResponseJson();O(we,`XHR for RPC '${e}' ${a} received:`,JSON.stringify(v)),u(v);break;case Hr.TIMEOUT:O(we,`RPC '${e}' ${a} timed out`),h(new V(C.DEADLINE_EXCEEDED,"Request time out"));break;case Hr.HTTP_ERROR:let w=d.getStatus();if(O(we,`RPC '${e}' ${a} failed with status:`,w,"response text:",d.getResponseText()),w>0){let R=d.getResponseJson();Array.isArray(R)&&(R=R[0]);let k=R?.error;if(k&&k.status&&k.message){let M=(function(G){let Q=G.toLowerCase().replace(/_/g,"-");return Object.values(C).indexOf(Q)>=0?Q:C.UNKNOWN})(k.status);h(new V(M,k.message))}else h(new V(C.UNKNOWN,"Server responded with status "+d.getStatus()))}else h(new V(C.UNAVAILABLE,"Connection failed."));break;default:F(9055,{l_:e,streamId:a,h_:d.getLastErrorCode(),P_:d.getLastError()})}}finally{O(we,`RPC '${e}' ${a} completed.`)}});let p=JSON.stringify(i);O(we,`RPC '${e}' ${a} sending request:`,i),d.send(t,"POST",p,r,15)})}T_(e,t,r){let i=Cu(),o=[this.Uo,"/","google.firestore.v1.Firestore","/",e,"/channel"],a=fc(),u=dc(),h={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},d=this.longPollingOptions.timeoutSeconds;d!==void 0&&(h.longPollingTimeout=Math.round(1e3*d)),this.useFetchStreams&&(h.useFetchStreams=!0),this.jo(h.initMessageHeaders,t,r),h.encodeInitMessageHeaders=!0;let p=o.join("");O(we,`Creating RPC '${e}' stream ${i}: ${p}`,h);let v=a.createWebChannel(p,h);this.I_(v);let w=!1,R=!1,k=new Pu({Yo:N=>{R?O(we,`Not sending because RPC '${e}' stream ${i} is closed:`,N):(w||(O(we,`Opening RPC '${e}' stream ${i} transport.`),v.open(),w=!0),O(we,`RPC '${e}' stream ${i} sending:`,N),v.send(N))},Zo:()=>v.close()}),M=(N,G,Q)=>{N.listen(G,J=>{try{Q(J)}catch(Te){setTimeout(()=>{throw Te},0)}})};return M(v,Mn.EventType.OPEN,()=>{R||(O(we,`RPC '${e}' stream ${i} transport opened.`),k.o_())}),M(v,Mn.EventType.CLOSE,()=>{R||(R=!0,O(we,`RPC '${e}' stream ${i} transport closed`),k.a_(),this.E_(v))}),M(v,Mn.EventType.ERROR,N=>{R||(R=!0,zn(we,`RPC '${e}' stream ${i} transport errored. Name:`,N.name,"Message:",N.message),k.a_(new V(C.UNAVAILABLE,"The operation could not be completed")))}),M(v,Mn.EventType.MESSAGE,N=>{if(!R){let G=N.data[0];Y(!!G,16349);let Q=G,J=Q?.error||Q[0]?.error;if(J){O(we,`RPC '${e}' stream ${i} received error:`,J);let Te=J.status,Se=(function(m){let y=ce[m];if(y!==void 0)return Um(y)})(Te),fe=J.message;Se===void 0&&(Se=C.INTERNAL,fe="Unknown error status: "+Te+" with message "+J.message),R=!0,k.a_(new V(Se,fe)),v.close()}else O(we,`RPC '${e}' stream ${i} received:`,G),k.u_(G)}}),M(u,hc.STAT_EVENT,N=>{N.stat===bs.PROXY?O(we,`RPC '${e}' stream ${i} detected buffering proxy`):N.stat===bs.NOPROXY&&O(we,`RPC '${e}' stream ${i} detected no buffering proxy`)}),setTimeout(()=>{k.__()},0),k}terminate(){this.c_.forEach(e=>e.close()),this.c_=[]}I_(e){this.c_.push(e)}E_(e){this.c_=this.c_.filter(t=>t===e)}};function _c(){return typeof document<"u"?document:null}function Io(n){return new Yc(n,!0)}var Ys=class{constructor(e,t,r=1e3,i=1.5,o=6e4){this.Mi=e,this.timerId=t,this.d_=r,this.A_=i,this.R_=o,this.V_=0,this.m_=null,this.f_=Date.now(),this.reset()}reset(){this.V_=0}g_(){this.V_=this.R_}p_(e){this.cancel();let t=Math.floor(this.V_+this.y_()),r=Math.max(0,Date.now()-this.f_),i=Math.max(0,t-r);i>0&&O("ExponentialBackoff",`Backing off for ${i} ms (base delay: ${this.V_} ms, delay with jitter: ${t} ms, last attempt: ${r} ms ago)`),this.m_=this.Mi.enqueueAfterDelay(this.timerId,i,()=>(this.f_=Date.now(),e())),this.V_*=this.A_,this.V_<this.d_&&(this.V_=this.d_),this.V_>this.R_&&(this.V_=this.R_)}w_(){this.m_!==null&&(this.m_.skipDelay(),this.m_=null)}cancel(){this.m_!==null&&(this.m_.cancel(),this.m_=null)}y_(){return(Math.random()-.5)*this.V_}};var xp="PersistentStream",Xs=class{constructor(e,t,r,i,o,a,u,h){this.Mi=e,this.S_=r,this.b_=i,this.connection=o,this.authCredentialsProvider=a,this.appCheckCredentialsProvider=u,this.listener=h,this.state=0,this.D_=0,this.C_=null,this.v_=null,this.stream=null,this.F_=0,this.M_=new Ys(e,t)}x_(){return this.state===1||this.state===5||this.O_()}O_(){return this.state===2||this.state===3}start(){this.F_=0,this.state!==4?this.auth():this.N_()}stop(){return _(this,null,function*(){this.x_()&&(yield this.close(0))})}B_(){this.state=0,this.M_.reset()}L_(){this.O_()&&this.C_===null&&(this.C_=this.Mi.enqueueAfterDelay(this.S_,6e4,()=>this.k_()))}q_(e){this.Q_(),this.stream.send(e)}k_(){return _(this,null,function*(){if(this.O_())return this.close(0)})}Q_(){this.C_&&(this.C_.cancel(),this.C_=null)}U_(){this.v_&&(this.v_.cancel(),this.v_=null)}close(e,t){return _(this,null,function*(){this.Q_(),this.U_(),this.M_.cancel(),this.D_++,e!==4?this.M_.reset():t&&t.code===C.RESOURCE_EXHAUSTED?(mt(t.toString()),mt("Using maximum backoff delay to prevent overloading the backend."),this.M_.g_()):t&&t.code===C.UNAUTHENTICATED&&this.state!==3&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),this.stream!==null&&(this.K_(),this.stream.close(),this.stream=null),this.state=e,yield this.listener.r_(t)})}K_(){}auth(){this.state=1;let e=this.W_(this.D_),t=this.D_;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([r,i])=>{this.D_===t&&this.G_(r,i)},r=>{e(()=>{let i=new V(C.UNKNOWN,"Fetching auth token failed: "+r.message);return this.z_(i)})})}G_(e,t){let r=this.W_(this.D_);this.stream=this.j_(e,t),this.stream.Xo(()=>{r(()=>this.listener.Xo())}),this.stream.t_(()=>{r(()=>(this.state=2,this.v_=this.Mi.enqueueAfterDelay(this.b_,1e4,()=>(this.O_()&&(this.state=3),Promise.resolve())),this.listener.t_()))}),this.stream.r_(i=>{r(()=>this.z_(i))}),this.stream.onMessage(i=>{r(()=>++this.F_==1?this.J_(i):this.onNext(i))})}N_(){this.state=5,this.M_.p_(()=>_(this,null,function*(){this.state=0,this.start()}))}z_(e){return O(xp,`close with error: ${e}`),this.stream=null,this.close(4,e)}W_(e){return t=>{this.Mi.enqueueAndForget(()=>this.D_===e?t():(O(xp,"stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}},Nu=class extends Xs{constructor(e,t,r,i,o,a){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",t,r,i,a),this.serializer=o}j_(e,t){return this.connection.T_("Listen",e,t)}J_(e){return this.onNext(e)}onNext(e){this.M_.reset();let t=Hw(this.serializer,e),r=(function(o){if(!("targetChange"in o))return q.min();let a=o.targetChange;return a.targetIds&&a.targetIds.length?q.min():a.readTime?rt(a.readTime):q.min()})(e);return this.listener.H_(t,r)}Y_(e){let t={};t.database=tu(this.serializer),t.addTarget=(function(o,a){let u,h=a.target;if(u=Bc(h)?{documents:Qw(o,h)}:{query:Jw(o,h).ft},u.targetId=a.targetId,a.resumeToken.approximateByteSize()>0){u.resumeToken=Bm(o,a.resumeToken);let d=Xc(o,a.expectedCount);d!==null&&(u.expectedCount=d)}else if(a.snapshotVersion.compareTo(q.min())>0){u.readTime=$s(o,a.snapshotVersion.toTimestamp());let d=Xc(o,a.expectedCount);d!==null&&(u.expectedCount=d)}return u})(this.serializer,e);let r=Xw(this.serializer,e);r&&(t.labels=r),this.q_(t)}Z_(e){let t={};t.database=tu(this.serializer),t.removeTarget=e,this.q_(t)}},Vu=class extends Xs{constructor(e,t,r,i,o,a){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",t,r,i,a),this.serializer=o}get X_(){return this.F_>0}start(){this.lastStreamToken=void 0,super.start()}K_(){this.X_&&this.ea([])}j_(e,t){return this.connection.T_("Write",e,t)}J_(e){return Y(!!e.streamToken,31322),this.lastStreamToken=e.streamToken,Y(!e.writeResults||e.writeResults.length===0,55816),this.listener.ta()}onNext(e){Y(!!e.streamToken,12678),this.lastStreamToken=e.streamToken,this.M_.reset();let t=Kw(e.writeResults,e.commitTime),r=rt(e.commitTime);return this.listener.na(r,t)}ra(){let e={};e.database=tu(this.serializer),this.q_(e)}ea(e){let t={streamToken:this.lastStreamToken,writes:e.map(r=>Ww(this.serializer,r))};this.q_(t)}};var ku=class{},Ou=class extends ku{constructor(e,t,r,i){super(),this.authCredentials=e,this.appCheckCredentials=t,this.connection=r,this.serializer=i,this.ia=!1}sa(){if(this.ia)throw new V(C.FAILED_PRECONDITION,"The client has already been terminated.")}Go(e,t,r,i){return this.sa(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([o,a])=>this.connection.Go(e,Zc(t,r),i,o,a)).catch(o=>{throw o.name==="FirebaseError"?(o.code===C.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),o):new V(C.UNKNOWN,o.toString())})}Ho(e,t,r,i,o){return this.sa(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([a,u])=>this.connection.Ho(e,Zc(t,r),i,a,u,o)).catch(a=>{throw a.name==="FirebaseError"?(a.code===C.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),a):new V(C.UNKNOWN,a.toString())})}terminate(){this.ia=!0,this.connection.terminate()}},Mu=class{constructor(e,t){this.asyncQueue=e,this.onlineStateHandler=t,this.state="Unknown",this.oa=0,this._a=null,this.aa=!0}ua(){this.oa===0&&(this.ca("Unknown"),this._a=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this._a=null,this.la("Backend didn't respond within 10 seconds."),this.ca("Offline"),Promise.resolve())))}ha(e){this.state==="Online"?this.ca("Unknown"):(this.oa++,this.oa>=1&&(this.Pa(),this.la(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.ca("Offline")))}set(e){this.Pa(),this.oa=0,e==="Online"&&(this.aa=!1),this.ca(e)}ca(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}la(e){let t=`Could not reach Cloud Firestore backend. ${e}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.aa?(mt(t),this.aa=!1):O("OnlineStateTracker",t)}Pa(){this._a!==null&&(this._a.cancel(),this._a=null)}};var Tn="RemoteStore",xu=class{constructor(e,t,r,i,o){this.localStore=e,this.datastore=t,this.asyncQueue=r,this.remoteSyncer={},this.Ta=[],this.Ia=new Map,this.Ea=new Set,this.da=[],this.Aa=o,this.Aa.Oo(a=>{r.enqueueAndForget(()=>_(this,null,function*(){An(this)&&(O(Tn,"Restarting streams for network reachability change."),yield(function(h){return _(this,null,function*(){let d=B(h);d.Ea.add(4),yield hi(d),d.Ra.set("Unknown"),d.Ea.delete(4),yield wo(d)})})(this))}))}),this.Ra=new Mu(r,i)}};function wo(n){return _(this,null,function*(){if(An(n))for(let e of n.da)yield e(!0)})}function hi(n){return _(this,null,function*(){for(let e of n.da)yield e(!1)})}function Jm(n,e){let t=B(n);t.Ia.has(e.targetId)||(t.Ia.set(e.targetId,e),Il(t)?vl(t):or(t).O_()&&yl(t,e))}function _l(n,e){let t=B(n),r=or(t);t.Ia.delete(e),r.O_()&&Ym(t,e),t.Ia.size===0&&(r.O_()?r.L_():An(t)&&t.Ra.set("Unknown"))}function yl(n,e){if(n.Va.Ue(e.targetId),e.resumeToken.approximateByteSize()>0||e.snapshotVersion.compareTo(q.min())>0){let t=n.remoteSyncer.getRemoteKeysForTarget(e.targetId).size;e=e.withExpectedCount(t)}or(n).Y_(e)}function Ym(n,e){n.Va.Ue(e),or(n).Z_(e)}function vl(n){n.Va=new Jc({getRemoteKeysForTarget:e=>n.remoteSyncer.getRemoteKeysForTarget(e),At:e=>n.Ia.get(e)||null,ht:()=>n.datastore.serializer.databaseId}),or(n).start(),n.Ra.ua()}function Il(n){return An(n)&&!or(n).x_()&&n.Ia.size>0}function An(n){return B(n).Ea.size===0}function Xm(n){n.Va=void 0}function mE(n){return _(this,null,function*(){n.Ra.set("Online")})}function gE(n){return _(this,null,function*(){n.Ia.forEach((e,t)=>{yl(n,e)})})}function _E(n,e){return _(this,null,function*(){Xm(n),Il(n)?(n.Ra.ha(e),vl(n)):n.Ra.set("Unknown")})}function yE(n,e,t){return _(this,null,function*(){if(n.Ra.set("Online"),e instanceof Gs&&e.state===2&&e.cause)try{yield(function(i,o){return _(this,null,function*(){let a=o.cause;for(let u of o.targetIds)i.Ia.has(u)&&(yield i.remoteSyncer.rejectListen(u,a),i.Ia.delete(u),i.Va.removeTarget(u))})})(n,e)}catch(r){O(Tn,"Failed to remove targets %s: %s ",e.targetIds.join(","),r),yield Zs(n,r)}else if(e instanceof qn?n.Va.Ze(e):e instanceof js?n.Va.st(e):n.Va.tt(e),!t.isEqual(q.min()))try{let r=yield Qm(n.localStore);t.compareTo(r)>=0&&(yield(function(o,a){let u=o.Va.Tt(a);return u.targetChanges.forEach((h,d)=>{if(h.resumeToken.approximateByteSize()>0){let p=o.Ia.get(d);p&&o.Ia.set(d,p.withResumeToken(h.resumeToken,a))}}),u.targetMismatches.forEach((h,d)=>{let p=o.Ia.get(h);if(!p)return;o.Ia.set(h,p.withResumeToken(Ee.EMPTY_BYTE_STRING,p.snapshotVersion)),Ym(o,h);let v=new si(p.target,h,d,p.sequenceNumber);yl(o,v)}),o.remoteSyncer.applyRemoteEvent(u)})(n,t))}catch(r){O(Tn,"Failed to raise snapshot:",r),yield Zs(n,r)}})}function Zs(n,e,t){return _(this,null,function*(){if(!sr(e))throw e;n.Ea.add(1),yield hi(n),n.Ra.set("Offline"),t||(t=()=>Qm(n.localStore)),n.asyncQueue.enqueueRetryable(()=>_(null,null,function*(){O(Tn,"Retrying IndexedDB access"),yield t(),n.Ea.delete(1),yield wo(n)}))})}function Zm(n,e){return e().catch(t=>Zs(n,t,e))}function Eo(n){return _(this,null,function*(){let e=B(n),t=Wt(e),r=e.Ta.length>0?e.Ta[e.Ta.length-1].batchId:ol;for(;vE(e);)try{let i=yield hE(e.localStore,r);if(i===null){e.Ta.length===0&&t.L_();break}r=i.batchId,IE(e,i)}catch(i){yield Zs(e,i)}eg(e)&&tg(e)})}function vE(n){return An(n)&&n.Ta.length<10}function IE(n,e){n.Ta.push(e);let t=Wt(n);t.O_()&&t.X_&&t.ea(e.mutations)}function eg(n){return An(n)&&!Wt(n).x_()&&n.Ta.length>0}function tg(n){Wt(n).start()}function wE(n){return _(this,null,function*(){Wt(n).ra()})}function EE(n){return _(this,null,function*(){let e=Wt(n);for(let t of n.Ta)e.ea(t.mutations)})}function TE(n,e,t){return _(this,null,function*(){let r=n.Ta.shift(),i=Hc.from(r,e,t);yield Zm(n,()=>n.remoteSyncer.applySuccessfulWrite(i)),yield Eo(n)})}function AE(n,e){return _(this,null,function*(){e&&Wt(n).X_&&(yield(function(r,i){return _(this,null,function*(){if((function(a){return Fw(a)&&a!==C.ABORTED})(i.code)){let o=r.Ta.shift();Wt(r).B_(),yield Zm(r,()=>r.remoteSyncer.rejectFailedWrite(o.batchId,i)),yield Eo(r)}})})(n,e)),eg(n)&&tg(n)})}function Fp(n,e){return _(this,null,function*(){let t=B(n);t.asyncQueue.verifyOperationInProgress(),O(Tn,"RemoteStore received new credentials");let r=An(t);t.Ea.add(3),yield hi(t),r&&t.Ra.set("Unknown"),yield t.remoteSyncer.handleCredentialChange(e),t.Ea.delete(3),yield wo(t)})}function bE(n,e){return _(this,null,function*(){let t=B(n);e?(t.Ea.delete(2),yield wo(t)):e||(t.Ea.add(2),yield hi(t),t.Ra.set("Unknown"))})}function or(n){return n.ma||(n.ma=(function(t,r,i){let o=B(t);return o.sa(),new Nu(r,o.connection,o.authCredentials,o.appCheckCredentials,o.serializer,i)})(n.datastore,n.asyncQueue,{Xo:mE.bind(null,n),t_:gE.bind(null,n),r_:_E.bind(null,n),H_:yE.bind(null,n)}),n.da.push(e=>_(null,null,function*(){e?(n.ma.B_(),Il(n)?vl(n):n.Ra.set("Unknown")):(yield n.ma.stop(),Xm(n))}))),n.ma}function Wt(n){return n.fa||(n.fa=(function(t,r,i){let o=B(t);return o.sa(),new Vu(r,o.connection,o.authCredentials,o.appCheckCredentials,o.serializer,i)})(n.datastore,n.asyncQueue,{Xo:()=>Promise.resolve(),t_:wE.bind(null,n),r_:AE.bind(null,n),ta:EE.bind(null,n),na:TE.bind(null,n)}),n.da.push(e=>_(null,null,function*(){e?(n.fa.B_(),yield Eo(n)):(yield n.fa.stop(),n.Ta.length>0&&(O(Tn,`Stopping write stream with ${n.Ta.length} pending writes`),n.Ta=[]))}))),n.fa}var Fu=class n{constructor(e,t,r,i,o){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=r,this.op=i,this.removalCallback=o,this.deferred=new je,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(a=>{})}get promise(){return this.deferred.promise}static createAndSchedule(e,t,r,i,o){let a=Date.now()+r,u=new n(e,t,a,i,o);return u.start(r),u}start(e){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){this.timerHandle!==null&&(this.clearTimeout(),this.deferred.reject(new V(C.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>this.timerHandle!==null?(this.clearTimeout(),this.op().then(e=>this.deferred.resolve(e))):Promise.resolve())}clearTimeout(){this.timerHandle!==null&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}};function wl(n,e){if(mt("AsyncQueue",`${e}: ${n}`),sr(n))return new V(C.UNAVAILABLE,`${e}: ${n}`);throw n}var eo=class n{static emptySet(e){return new n(e.comparator)}constructor(e){this.comparator=e?(t,r)=>e(t,r)||x.comparator(t.key,r.key):(t,r)=>x.comparator(t.key,r.key),this.keyedMap=Wr(),this.sortedSet=new oe(this.comparator)}has(e){return this.keyedMap.get(e)!=null}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){let t=this.keyedMap.get(e);return t?this.sortedSet.indexOf(t):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal((t,r)=>(e(t),!1))}add(e){let t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))}delete(e){let t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this}isEqual(e){if(!(e instanceof n)||this.size!==e.size)return!1;let t=this.sortedSet.getIterator(),r=e.sortedSet.getIterator();for(;t.hasNext();){let i=t.getNext().key,o=r.getNext().key;if(!i.isEqual(o))return!1}return!0}toString(){let e=[];return this.forEach(t=>{e.push(t.toString())}),e.length===0?"DocumentSet ()":`DocumentSet (
  `+e.join(`  
`)+`
)`}copy(e,t){let r=new n;return r.comparator=this.comparator,r.keyedMap=e,r.sortedSet=t,r}};var to=class{constructor(){this.ga=new oe(x.comparator)}track(e){let t=e.doc.key,r=this.ga.get(t);r?e.type!==0&&r.type===3?this.ga=this.ga.insert(t,e):e.type===3&&r.type!==1?this.ga=this.ga.insert(t,{type:r.type,doc:e.doc}):e.type===2&&r.type===2?this.ga=this.ga.insert(t,{type:2,doc:e.doc}):e.type===2&&r.type===0?this.ga=this.ga.insert(t,{type:0,doc:e.doc}):e.type===1&&r.type===0?this.ga=this.ga.remove(t):e.type===1&&r.type===2?this.ga=this.ga.insert(t,{type:1,doc:r.doc}):e.type===0&&r.type===1?this.ga=this.ga.insert(t,{type:2,doc:e.doc}):F(63341,{Rt:e,pa:r}):this.ga=this.ga.insert(t,e)}ya(){let e=[];return this.ga.inorderTraversal((t,r)=>{e.push(r)}),e}},Zn=class n{constructor(e,t,r,i,o,a,u,h,d){this.query=e,this.docs=t,this.oldDocs=r,this.docChanges=i,this.mutatedKeys=o,this.fromCache=a,this.syncStateChanged=u,this.excludesMetadataChanges=h,this.hasCachedResults=d}static fromInitialDocuments(e,t,r,i,o){let a=[];return t.forEach(u=>{a.push({type:0,doc:u})}),new n(e,t,eo.emptySet(t),a,r,i,!0,!1,o)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&yo(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;let t=this.docChanges,r=e.docChanges;if(t.length!==r.length)return!1;for(let i=0;i<t.length;i++)if(t[i].type!==r[i].type||!t[i].doc.isEqual(r[i].doc))return!1;return!0}};var Lu=class{constructor(){this.wa=void 0,this.Sa=[]}ba(){return this.Sa.some(e=>e.Da())}},Uu=class{constructor(){this.queries=Lp(),this.onlineState="Unknown",this.Ca=new Set}terminate(){(function(t,r){let i=B(t),o=i.queries;i.queries=Lp(),o.forEach((a,u)=>{for(let h of u.Sa)h.onError(r)})})(this,new V(C.ABORTED,"Firestore shutting down"))}};function Lp(){return new yt(n=>Cm(n),yo)}function ng(n,e){return _(this,null,function*(){let t=B(n),r=3,i=e.query,o=t.queries.get(i);o?!o.ba()&&e.Da()&&(r=2):(o=new Lu,r=e.Da()?0:1);try{switch(r){case 0:o.wa=yield t.onListen(i,!0);break;case 1:o.wa=yield t.onListen(i,!1);break;case 2:yield t.onFirstRemoteStoreListen(i)}}catch(a){let u=wl(a,`Initialization of query '${Fn(e.query)}' failed`);return void e.onError(u)}t.queries.set(i,o),o.Sa.push(e),e.va(t.onlineState),o.wa&&e.Fa(o.wa)&&El(t)})}function rg(n,e){return _(this,null,function*(){let t=B(n),r=e.query,i=3,o=t.queries.get(r);if(o){let a=o.Sa.indexOf(e);a>=0&&(o.Sa.splice(a,1),o.Sa.length===0?i=e.Da()?0:1:!o.ba()&&e.Da()&&(i=2))}switch(i){case 0:return t.queries.delete(r),t.onUnlisten(r,!0);case 1:return t.queries.delete(r),t.onUnlisten(r,!1);case 2:return t.onLastRemoteStoreUnlisten(r);default:return}})}function SE(n,e){let t=B(n),r=!1;for(let i of e){let o=i.query,a=t.queries.get(o);if(a){for(let u of a.Sa)u.Fa(i)&&(r=!0);a.wa=i}}r&&El(t)}function CE(n,e,t){let r=B(n),i=r.queries.get(e);if(i)for(let o of i.Sa)o.onError(t);r.queries.delete(e)}function El(n){n.Ca.forEach(e=>{e.next()})}var Bu,Up;(Up=Bu||(Bu={})).Ma="default",Up.Cache="cache";var no=class{constructor(e,t,r){this.query=e,this.xa=t,this.Oa=!1,this.Na=null,this.onlineState="Unknown",this.options=r||{}}Fa(e){if(!this.options.includeMetadataChanges){let r=[];for(let i of e.docChanges)i.type!==3&&r.push(i);e=new Zn(e.query,e.docs,e.oldDocs,r,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let t=!1;return this.Oa?this.Ba(e)&&(this.xa.next(e),t=!0):this.La(e,this.onlineState)&&(this.ka(e),t=!0),this.Na=e,t}onError(e){this.xa.error(e)}va(e){this.onlineState=e;let t=!1;return this.Na&&!this.Oa&&this.La(this.Na,e)&&(this.ka(this.Na),t=!0),t}La(e,t){if(!e.fromCache||!this.Da())return!0;let r=t!=="Offline";return(!this.options.qa||!r)&&(!e.docs.isEmpty()||e.hasCachedResults||t==="Offline")}Ba(e){if(e.docChanges.length>0)return!0;let t=this.Na&&this.Na.hasPendingWrites!==e.hasPendingWrites;return!(!e.syncStateChanged&&!t)&&this.options.includeMetadataChanges===!0}ka(e){e=Zn.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.Oa=!0,this.xa.next(e)}Da(){return this.options.source!==Bu.Cache}};var ro=class{constructor(e){this.key=e}},io=class{constructor(e){this.key=e}},qu=class{constructor(e,t){this.query=e,this.Ya=t,this.Za=null,this.hasCachedResults=!1,this.current=!1,this.Xa=H(),this.mutatedKeys=H(),this.eu=Rm(e),this.tu=new eo(this.eu)}get nu(){return this.Ya}ru(e,t){let r=t?t.iu:new to,i=t?t.tu:this.tu,o=t?t.mutatedKeys:this.mutatedKeys,a=i,u=!1,h=this.query.limitType==="F"&&i.size===this.query.limit?i.last():null,d=this.query.limitType==="L"&&i.size===this.query.limit?i.first():null;if(e.inorderTraversal((p,v)=>{let w=i.get(p),R=vo(this.query,v)?v:null,k=!!w&&this.mutatedKeys.has(w.key),M=!!R&&(R.hasLocalMutations||this.mutatedKeys.has(R.key)&&R.hasCommittedMutations),N=!1;w&&R?w.data.isEqual(R.data)?k!==M&&(r.track({type:3,doc:R}),N=!0):this.su(w,R)||(r.track({type:2,doc:R}),N=!0,(h&&this.eu(R,h)>0||d&&this.eu(R,d)<0)&&(u=!0)):!w&&R?(r.track({type:0,doc:R}),N=!0):w&&!R&&(r.track({type:1,doc:w}),N=!0,(h||d)&&(u=!0)),N&&(R?(a=a.add(R),o=M?o.add(p):o.delete(p)):(a=a.delete(p),o=o.delete(p)))}),this.query.limit!==null)for(;a.size>this.query.limit;){let p=this.query.limitType==="F"?a.last():a.first();a=a.delete(p.key),o=o.delete(p.key),r.track({type:1,doc:p})}return{tu:a,iu:r,Cs:u,mutatedKeys:o}}su(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations}applyChanges(e,t,r,i){let o=this.tu;this.tu=e.tu,this.mutatedKeys=e.mutatedKeys;let a=e.iu.ya();a.sort((p,v)=>(function(R,k){let M=N=>{switch(N){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return F(20277,{Rt:N})}};return M(R)-M(k)})(p.type,v.type)||this.eu(p.doc,v.doc)),this.ou(r),i=i??!1;let u=t&&!i?this._u():[],h=this.Xa.size===0&&this.current&&!i?1:0,d=h!==this.Za;return this.Za=h,a.length!==0||d?{snapshot:new Zn(this.query,e.tu,o,a,e.mutatedKeys,h===0,d,!1,!!r&&r.resumeToken.approximateByteSize()>0),au:u}:{au:u}}va(e){return this.current&&e==="Offline"?(this.current=!1,this.applyChanges({tu:this.tu,iu:new to,mutatedKeys:this.mutatedKeys,Cs:!1},!1)):{au:[]}}uu(e){return!this.Ya.has(e)&&!!this.tu.has(e)&&!this.tu.get(e).hasLocalMutations}ou(e){e&&(e.addedDocuments.forEach(t=>this.Ya=this.Ya.add(t)),e.modifiedDocuments.forEach(t=>{}),e.removedDocuments.forEach(t=>this.Ya=this.Ya.delete(t)),this.current=e.current)}_u(){if(!this.current)return[];let e=this.Xa;this.Xa=H(),this.tu.forEach(r=>{this.uu(r.key)&&(this.Xa=this.Xa.add(r.key))});let t=[];return e.forEach(r=>{this.Xa.has(r)||t.push(new io(r))}),this.Xa.forEach(r=>{e.has(r)||t.push(new ro(r))}),t}cu(e){this.Ya=e.Qs,this.Xa=H();let t=this.ru(e.documents);return this.applyChanges(t,!0)}lu(){return Zn.fromInitialDocuments(this.query,this.tu,this.mutatedKeys,this.Za===0,this.hasCachedResults)}},Tl="SyncEngine",ju=class{constructor(e,t,r){this.query=e,this.targetId=t,this.view=r}},Gu=class{constructor(e){this.key=e,this.hu=!1}},zu=class{constructor(e,t,r,i,o,a){this.localStore=e,this.remoteStore=t,this.eventManager=r,this.sharedClientState=i,this.currentUser=o,this.maxConcurrentLimboResolutions=a,this.Pu={},this.Tu=new yt(u=>Cm(u),yo),this.Iu=new Map,this.Eu=new Set,this.du=new oe(x.comparator),this.Au=new Map,this.Ru=new ai,this.Vu={},this.mu=new Map,this.fu=oi.cr(),this.onlineState="Unknown",this.gu=void 0}get isPrimaryClient(){return this.gu===!0}};function RE(n,e,t=!0){return _(this,null,function*(){let r=ug(n),i,o=r.Tu.get(e);return o?(r.sharedClientState.addLocalQueryTarget(o.targetId),i=o.view.lu()):i=yield ig(r,e,t,!0),i})}function PE(n,e){return _(this,null,function*(){let t=ug(n);yield ig(t,e,!0,!1)})}function ig(n,e,t,r){return _(this,null,function*(){let i=yield dE(n.localStore,tt(e)),o=i.targetId,a=n.sharedClientState.addLocalQueryTarget(o,t),u;return r&&(u=yield DE(n,e,o,a==="current",i.resumeToken)),n.isPrimaryClient&&t&&Jm(n.remoteStore,i),u})}function DE(n,e,t,r,i){return _(this,null,function*(){n.pu=(v,w,R)=>(function(M,N,G,Q){return _(this,null,function*(){let J=N.view.ru(G);J.Cs&&(J=yield Op(M.localStore,N.query,!1).then(({documents:E})=>N.view.ru(E,J)));let Te=Q&&Q.targetChanges.get(N.targetId),Se=Q&&Q.targetMismatches.get(N.targetId)!=null,fe=N.view.applyChanges(J,M.isPrimaryClient,Te,Se);return qp(M,N.targetId,fe.au),fe.snapshot})})(n,v,w,R);let o=yield Op(n.localStore,e,!0),a=new qu(e,o.Qs),u=a.ru(o.documents),h=ii.createSynthesizedTargetChangeForCurrentChange(t,r&&n.onlineState!=="Offline",i),d=a.applyChanges(u,n.isPrimaryClient,h);qp(n,t,d.au);let p=new ju(e,t,a);return n.Tu.set(e,p),n.Iu.has(t)?n.Iu.get(t).push(e):n.Iu.set(t,[e]),d.snapshot})}function NE(n,e,t){return _(this,null,function*(){let r=B(n),i=r.Tu.get(e),o=r.Iu.get(i.targetId);if(o.length>1)return r.Iu.set(i.targetId,o.filter(a=>!yo(a,e))),void r.Tu.delete(e);r.isPrimaryClient?(r.sharedClientState.removeLocalQueryTarget(i.targetId),r.sharedClientState.isActiveQueryTarget(i.targetId)||(yield Au(r.localStore,i.targetId,!1).then(()=>{r.sharedClientState.clearQueryState(i.targetId),t&&_l(r.remoteStore,i.targetId),$u(r,i.targetId)}).catch(ir))):($u(r,i.targetId),yield Au(r.localStore,i.targetId,!0))})}function VE(n,e){return _(this,null,function*(){let t=B(n),r=t.Tu.get(e),i=t.Iu.get(r.targetId);t.isPrimaryClient&&i.length===1&&(t.sharedClientState.removeLocalQueryTarget(r.targetId),_l(t.remoteStore,r.targetId))})}function kE(n,e,t){return _(this,null,function*(){let r=BE(n);try{let i=yield(function(a,u){let h=B(a),d=se.now(),p=u.reduce((R,k)=>R.add(k.key),H()),v,w;return h.persistence.runTransaction("Locally write mutations","readwrite",R=>{let k=vt(),M=H();return h.Ns.getEntries(R,p).next(N=>{k=N,k.forEach((G,Q)=>{Q.isValidDocument()||(M=M.add(G))})}).next(()=>h.localDocuments.getOverlayedDocuments(R,k)).next(N=>{v=N;let G=[];for(let Q of u){let J=xw(Q,v.get(Q.key).overlayedDocument);J!=null&&G.push(new st(Q.key,J,Im(J.value.mapValue),nt.exists(!0)))}return h.mutationQueue.addMutationBatch(R,d,G,u)}).next(N=>{w=N;let G=N.applyToLocalDocumentSet(v,M);return h.documentOverlayCache.saveOverlays(R,N.batchId,G)})}).then(()=>({batchId:w.batchId,changes:Dm(v)}))})(r.localStore,e);r.sharedClientState.addPendingMutation(i.batchId),(function(a,u,h){let d=a.Vu[a.currentUser.toKey()];d||(d=new oe($)),d=d.insert(u,h),a.Vu[a.currentUser.toKey()]=d})(r,i.batchId,t),yield di(r,i.changes),yield Eo(r.remoteStore)}catch(i){let o=wl(i,"Failed to persist write");t.reject(o)}})}function sg(n,e){return _(this,null,function*(){let t=B(n);try{let r=yield uE(t.localStore,e);e.targetChanges.forEach((i,o)=>{let a=t.Au.get(o);a&&(Y(i.addedDocuments.size+i.modifiedDocuments.size+i.removedDocuments.size<=1,22616),i.addedDocuments.size>0?a.hu=!0:i.modifiedDocuments.size>0?Y(a.hu,14607):i.removedDocuments.size>0&&(Y(a.hu,42227),a.hu=!1))}),yield di(t,r,e)}catch(r){yield ir(r)}})}function Bp(n,e,t){let r=B(n);if(r.isPrimaryClient&&t===0||!r.isPrimaryClient&&t===1){let i=[];r.Tu.forEach((o,a)=>{let u=a.view.va(e);u.snapshot&&i.push(u.snapshot)}),(function(a,u){let h=B(a);h.onlineState=u;let d=!1;h.queries.forEach((p,v)=>{for(let w of v.Sa)w.va(u)&&(d=!0)}),d&&El(h)})(r.eventManager,e),i.length&&r.Pu.H_(i),r.onlineState=e,r.isPrimaryClient&&r.sharedClientState.setOnlineState(e)}}function OE(n,e,t){return _(this,null,function*(){let r=B(n);r.sharedClientState.updateQueryState(e,"rejected",t);let i=r.Au.get(e),o=i&&i.key;if(o){let a=new oe(x.comparator);a=a.insert(o,ze.newNoDocument(o,q.min()));let u=H().add(o),h=new qs(q.min(),new Map,new oe($),a,u);yield sg(r,h),r.du=r.du.remove(o),r.Au.delete(e),Al(r)}else yield Au(r.localStore,e,!1).then(()=>$u(r,e,t)).catch(ir)})}function ME(n,e){return _(this,null,function*(){let t=B(n),r=e.batch.batchId;try{let i=yield cE(t.localStore,e);ag(t,r,null),og(t,r),t.sharedClientState.updateMutationState(r,"acknowledged"),yield di(t,i)}catch(i){yield ir(i)}})}function xE(n,e,t){return _(this,null,function*(){let r=B(n);try{let i=yield(function(a,u){let h=B(a);return h.persistence.runTransaction("Reject batch","readwrite-primary",d=>{let p;return h.mutationQueue.lookupMutationBatch(d,u).next(v=>(Y(v!==null,37113),p=v.keys(),h.mutationQueue.removeMutationBatch(d,v))).next(()=>h.mutationQueue.performConsistencyCheck(d)).next(()=>h.documentOverlayCache.removeOverlaysForBatchId(d,p,u)).next(()=>h.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(d,p)).next(()=>h.localDocuments.getDocuments(d,p))})})(r.localStore,e);ag(r,e,t),og(r,e),r.sharedClientState.updateMutationState(e,"rejected",t),yield di(r,i)}catch(i){yield ir(i)}})}function og(n,e){(n.mu.get(e)||[]).forEach(t=>{t.resolve()}),n.mu.delete(e)}function ag(n,e,t){let r=B(n),i=r.Vu[r.currentUser.toKey()];if(i){let o=i.get(e);o&&(t?o.reject(t):o.resolve(),i=i.remove(e)),r.Vu[r.currentUser.toKey()]=i}}function $u(n,e,t=null){n.sharedClientState.removeLocalQueryTarget(e);for(let r of n.Iu.get(e))n.Tu.delete(r),t&&n.Pu.yu(r,t);n.Iu.delete(e),n.isPrimaryClient&&n.Ru.jr(e).forEach(r=>{n.Ru.containsKey(r)||cg(n,r)})}function cg(n,e){n.Eu.delete(e.path.canonicalString());let t=n.du.get(e);t!==null&&(_l(n.remoteStore,t),n.du=n.du.remove(e),n.Au.delete(t),Al(n))}function qp(n,e,t){for(let r of t)r instanceof ro?(n.Ru.addReference(r.key,e),FE(n,r)):r instanceof io?(O(Tl,"Document no longer in limbo: "+r.key),n.Ru.removeReference(r.key,e),n.Ru.containsKey(r.key)||cg(n,r.key)):F(19791,{wu:r})}function FE(n,e){let t=e.key,r=t.path.canonicalString();n.du.get(t)||n.Eu.has(r)||(O(Tl,"New document in limbo: "+t),n.Eu.add(r),Al(n))}function Al(n){for(;n.Eu.size>0&&n.du.size<n.maxConcurrentLimboResolutions;){let e=n.Eu.values().next().value;n.Eu.delete(e);let t=new x(ne.fromString(e)),r=n.fu.next();n.Au.set(r,new Gu(t)),n.du=n.du.insert(t,r),Jm(n.remoteStore,new si(tt(fl(t.path)),r,"TargetPurposeLimboResolution",sl.ce))}}function di(n,e,t){return _(this,null,function*(){let r=B(n),i=[],o=[],a=[];r.Tu.isEmpty()||(r.Tu.forEach((u,h)=>{a.push(r.pu(h,e,t).then(d=>{if((d||t)&&r.isPrimaryClient){let p=d?!d.fromCache:t?.targetChanges.get(h.targetId)?.current;r.sharedClientState.updateQueryState(h.targetId,p?"current":"not-current")}if(d){i.push(d);let p=Iu.As(h.targetId,d);o.push(p)}}))}),yield Promise.all(a),r.Pu.H_(i),yield(function(h,d){return _(this,null,function*(){let p=B(h);try{yield p.persistence.runTransaction("notifyLocalViewChanges","readwrite",v=>P.forEach(d,w=>P.forEach(w.Es,R=>p.persistence.referenceDelegate.addReference(v,w.targetId,R)).next(()=>P.forEach(w.ds,R=>p.persistence.referenceDelegate.removeReference(v,w.targetId,R)))))}catch(v){if(!sr(v))throw v;O(gl,"Failed to update sequence numbers: "+v)}for(let v of d){let w=v.targetId;if(!v.fromCache){let R=p.Ms.get(w),k=R.snapshotVersion,M=R.withLastLimboFreeSnapshotVersion(k);p.Ms=p.Ms.insert(w,M)}}})})(r.localStore,o))})}function LE(n,e){return _(this,null,function*(){let t=B(n);if(!t.currentUser.isEqual(e)){O(Tl,"User change. New user:",e.toKey());let r=yield Km(t.localStore,e);t.currentUser=e,(function(o,a){o.mu.forEach(u=>{u.forEach(h=>{h.reject(new V(C.CANCELLED,a))})}),o.mu.clear()})(t,"'waitForPendingWrites' promise is rejected due to a user change."),t.sharedClientState.handleUserChange(e,r.removedBatchIds,r.addedBatchIds),yield di(t,r.Ls)}})}function UE(n,e){let t=B(n),r=t.Au.get(e);if(r&&r.hu)return H().add(r.key);{let i=H(),o=t.Iu.get(e);if(!o)return i;for(let a of o){let u=t.Tu.get(a);i=i.unionWith(u.view.nu)}return i}}function ug(n){let e=B(n);return e.remoteStore.remoteSyncer.applyRemoteEvent=sg.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=UE.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=OE.bind(null,e),e.Pu.H_=SE.bind(null,e.eventManager),e.Pu.yu=CE.bind(null,e.eventManager),e}function BE(n){let e=B(n);return e.remoteStore.remoteSyncer.applySuccessfulWrite=ME.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=xE.bind(null,e),e}var lg=(()=>{class n{constructor(){this.kind="memory",this.synchronizeTabs=!1}initialize(t){return _(this,null,function*(){this.serializer=Io(t.databaseInfo.databaseId),this.sharedClientState=this.Du(t),this.persistence=this.Cu(t),yield this.persistence.start(),this.localStore=this.vu(t),this.gcScheduler=this.Fu(t,this.localStore),this.indexBackfillerScheduler=this.Mu(t,this.localStore)})}Fu(t,r){return null}Mu(t,r){return null}vu(t){return aE(this.persistence,new Eu,t.initialUser,this.serializer)}Cu(t){return new Ws(vu.mi,this.serializer)}Du(t){return new bu}terminate(){return _(this,null,function*(){this.gcScheduler?.stop(),this.indexBackfillerScheduler?.stop(),this.sharedClientState.shutdown(),yield this.persistence.shutdown()})}}return n.provider={build:()=>new n},n})(),Hu=class extends lg{constructor(e){super(),this.cacheSizeBytes=e}Fu(e,t){Y(this.persistence.referenceDelegate instanceof Ks,46915);let r=this.persistence.referenceDelegate.garbageCollector;return new ou(r,e.asyncQueue,t)}Cu(e){let t=this.cacheSizeBytes!==void 0?Ue.withCacheSize(this.cacheSizeBytes):Ue.DEFAULT;return new Ws(r=>Ks.mi(r,t),this.serializer)}};var qE=(()=>{class n{initialize(t,r){return _(this,null,function*(){this.localStore||(this.localStore=t.localStore,this.sharedClientState=t.sharedClientState,this.datastore=this.createDatastore(r),this.remoteStore=this.createRemoteStore(r),this.eventManager=this.createEventManager(r),this.syncEngine=this.createSyncEngine(r,!t.synchronizeTabs),this.sharedClientState.onlineStateHandler=i=>Bp(this.syncEngine,i,1),this.remoteStore.remoteSyncer.handleCredentialChange=LE.bind(null,this.syncEngine),yield bE(this.remoteStore,this.syncEngine.isPrimaryClient))})}createEventManager(t){return(function(){return new Uu})()}createDatastore(t){let r=Io(t.databaseInfo.databaseId),i=(function(a){return new Du(a)})(t.databaseInfo);return(function(a,u,h,d){return new Ou(a,u,h,d)})(t.authCredentials,t.appCheckCredentials,i,r)}createRemoteStore(t){return(function(i,o,a,u,h){return new xu(i,o,a,u,h)})(this.localStore,this.datastore,t.asyncQueue,r=>Bp(this.syncEngine,r,0),(function(){return Js.v()?new Js:new Su})())}createSyncEngine(t,r){return(function(o,a,u,h,d,p,v){let w=new zu(o,a,u,h,d,p);return v&&(w.gu=!0),w})(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,t.initialUser,t.maxConcurrentLimboResolutions,r)}terminate(){return _(this,null,function*(){yield(function(r){return _(this,null,function*(){let i=B(r);O(Tn,"RemoteStore shutting down."),i.Ea.add(5),yield hi(i),i.Aa.shutdown(),i.Ra.set("Unknown")})})(this.remoteStore),this.datastore?.terminate(),this.eventManager?.terminate()})}}return n.provider={build:()=>new n},n})();var so=class{constructor(e){this.observer=e,this.muted=!1}next(e){this.muted||this.observer.next&&this.Ou(this.observer.next,e)}error(e){this.muted||(this.observer.error?this.Ou(this.observer.error,e):mt("Uncaught Error in snapshot listener:",e.toString()))}Nu(){this.muted=!0}Ou(e,t){setTimeout(()=>{this.muted||e(t)},0)}};var Kt="FirestoreClient",Wu=class{constructor(e,t,r,i,o){this.authCredentials=e,this.appCheckCredentials=t,this.asyncQueue=r,this.databaseInfo=i,this.user=_e.UNAUTHENTICATED,this.clientId=Xr.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this._uninitializedComponentsProvider=o,this.authCredentials.start(r,a=>_(this,null,function*(){O(Kt,"Received user=",a.uid),yield this.authCredentialListener(a),this.user=a})),this.appCheckCredentials.start(r,a=>(O(Kt,"Received new app check token=",a),this.appCheckCredentialListener(a,this.user)))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}terminate(){this.asyncQueue.enterRestrictedMode();let e=new je;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(()=>_(this,null,function*(){try{this._onlineComponents&&(yield this._onlineComponents.terminate()),this._offlineComponents&&(yield this._offlineComponents.terminate()),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(t){let r=wl(t,"Failed to shutdown persistence");e.reject(r)}})),e.promise}};function yc(n,e){return _(this,null,function*(){n.asyncQueue.verifyOperationInProgress(),O(Kt,"Initializing OfflineComponentProvider");let t=n.configuration;yield e.initialize(t);let r=t.initialUser;n.setCredentialChangeListener(i=>_(null,null,function*(){r.isEqual(i)||(yield Km(e.localStore,i),r=i)})),e.persistence.setDatabaseDeletedListener(()=>n.terminate()),n._offlineComponents=e})}function jp(n,e){return _(this,null,function*(){n.asyncQueue.verifyOperationInProgress();let t=yield jE(n);O(Kt,"Initializing OnlineComponentProvider"),yield e.initialize(t,n.configuration),n.setCredentialChangeListener(r=>Fp(e.remoteStore,r)),n.setAppCheckTokenChangeListener((r,i)=>Fp(e.remoteStore,i)),n._onlineComponents=e})}function jE(n){return _(this,null,function*(){if(!n._offlineComponents)if(n._uninitializedComponentsProvider){O(Kt,"Using user provided OfflineComponentProvider");try{yield yc(n,n._uninitializedComponentsProvider._offline)}catch(e){let t=e;if(!(function(i){return i.name==="FirebaseError"?i.code===C.FAILED_PRECONDITION||i.code===C.UNIMPLEMENTED:!(typeof DOMException<"u"&&i instanceof DOMException)||i.code===22||i.code===20||i.code===11})(t))throw t;zn("Error using user provided cache. Falling back to memory cache: "+t),yield yc(n,new lg)}}else O(Kt,"Using default OfflineComponentProvider"),yield yc(n,new Hu(void 0));return n._offlineComponents})}function hg(n){return _(this,null,function*(){return n._onlineComponents||(n._uninitializedComponentsProvider?(O(Kt,"Using user provided OnlineComponentProvider"),yield jp(n,n._uninitializedComponentsProvider._online)):(O(Kt,"Using default OnlineComponentProvider"),yield jp(n,new qE))),n._onlineComponents})}function GE(n){return hg(n).then(e=>e.syncEngine)}function dg(n){return _(this,null,function*(){let e=yield hg(n),t=e.eventManager;return t.onListen=RE.bind(null,e.syncEngine),t.onUnlisten=NE.bind(null,e.syncEngine),t.onFirstRemoteStoreListen=PE.bind(null,e.syncEngine),t.onLastRemoteStoreUnlisten=VE.bind(null,e.syncEngine),t})}function zE(n,e,t={}){let r=new je;return n.asyncQueue.enqueueAndForget(()=>_(null,null,function*(){return(function(o,a,u,h,d){let p=new so({next:w=>{p.Nu(),a.enqueueAndForget(()=>rg(o,v));let R=w.docs.has(u);!R&&w.fromCache?d.reject(new V(C.UNAVAILABLE,"Failed to get document because the client is offline.")):R&&w.fromCache&&h&&h.source==="server"?d.reject(new V(C.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):d.resolve(w)},error:w=>d.reject(w)}),v=new no(fl(u.path),p,{includeMetadataChanges:!0,qa:!0});return ng(o,v)})(yield dg(n),n.asyncQueue,e,t,r)})),r.promise}function $E(n,e,t={}){let r=new je;return n.asyncQueue.enqueueAndForget(()=>_(null,null,function*(){return(function(o,a,u,h,d){let p=new so({next:w=>{p.Nu(),a.enqueueAndForget(()=>rg(o,v)),w.fromCache&&h.source==="server"?d.reject(new V(C.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):d.resolve(w)},error:w=>d.reject(w)}),v=new no(u,p,{includeMetadataChanges:!0,qa:!0});return ng(o,v)})(yield dg(n),n.asyncQueue,e,t,r)})),r.promise}function fg(n){let e={};return n.timeoutSeconds!==void 0&&(e.timeoutSeconds=n.timeoutSeconds),e}var Gp=new Map;var pg="firestore.googleapis.com",zp=!0,oo=class{constructor(e){if(e.host===void 0){if(e.ssl!==void 0)throw new V(C.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host=pg,this.ssl=zp}else this.host=e.host,this.ssl=e.ssl??zp;if(this.isUsingEmulator=e.emulatorOptions!==void 0,this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,e.cacheSizeBytes===void 0)this.cacheSizeBytes=Wm;else{if(e.cacheSizeBytes!==-1&&e.cacheSizeBytes<iE)throw new V(C.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}ZI("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:e.experimentalAutoDetectLongPolling===void 0?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=fg(e.experimentalLongPollingOptions??{}),(function(r){if(r.timeoutSeconds!==void 0){if(isNaN(r.timeoutSeconds))throw new V(C.INVALID_ARGUMENT,`invalid long polling timeout: ${r.timeoutSeconds} (must not be NaN)`);if(r.timeoutSeconds<5)throw new V(C.INVALID_ARGUMENT,`invalid long polling timeout: ${r.timeoutSeconds} (minimum allowed value is 5)`);if(r.timeoutSeconds>30)throw new V(C.INVALID_ARGUMENT,`invalid long polling timeout: ${r.timeoutSeconds} (maximum allowed value is 30)`)}})(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&(function(r,i){return r.timeoutSeconds===i.timeoutSeconds})(this.experimentalLongPollingOptions,e.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}},er=class{constructor(e,t,r,i){this._authCredentials=e,this._appCheckCredentials=t,this._databaseId=r,this._app=i,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new oo({}),this._settingsFrozen=!1,this._emulatorOptions={},this._terminateTask="notTerminated"}get app(){if(!this._app)throw new V(C.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return this._terminateTask!=="notTerminated"}_setSettings(e){if(this._settingsFrozen)throw new V(C.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new oo(e),this._emulatorOptions=e.emulatorOptions||{},e.credentials!==void 0&&(this._authCredentials=(function(r){if(!r)return new vc;switch(r.type){case"firstParty":return new Tc(r.sessionIndex||"0",r.iamToken||null,r.authTokenFactory||null);case"provider":return r.client;default:throw new V(C.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}})(e.credentials))}_getSettings(){return this._settings}_getEmulatorOptions(){return this._emulatorOptions}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask==="notTerminated"&&(this._terminateTask=this._terminate()),this._terminateTask}_restart(){return _(this,null,function*(){this._terminateTask==="notTerminated"?yield this._terminate():this._terminateTask="notTerminated"})}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return(function(t){let r=Gp.get(t);r&&(O("ComponentProvider","Removing Datastore"),Gp.delete(t),r.terminate())})(this),Promise.resolve()}};function HE(n,e,t,r={}){n=Ge(n,er);let i=Ot(e),o=n._getSettings(),a=Z(L({},o),{emulatorOptions:n._getEmulatorOptions()}),u=`${e}:${t}`;i&&(Xi(`https://${u}`),Zi("Firestore",!0)),o.host!==pg&&o.host!==u&&zn("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used.");let h=Z(L({},o),{host:u,ssl:i,emulatorOptions:r});if(!Je(h,a)&&(n._setSettings(h),r.mockUserToken)){let d,p;if(typeof r.mockUserToken=="string")d=r.mockUserToken,p=_e.MOCK_USER;else{d=Bd(r.mockUserToken,n._app?.options.projectId);let v=r.mockUserToken.sub||r.mockUserToken.user_id;if(!v)throw new V(C.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");p=new _e(v)}n._authCredentials=new Ic(new Vs(d,p))}}var Qt=class n{constructor(e,t,r){this.converter=t,this._query=r,this.type="query",this.firestore=e}withConverter(e){return new n(this.firestore,e,this._query)}},ve=class n{constructor(e,t,r){this.converter=t,this._key=r,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new qt(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new n(this.firestore,e,this._key)}toJSON(){return{type:n._jsonSchemaVersion,referencePath:this._key.toString()}}static fromJSON(e,t,r){if(li(t,n._jsonSchema))return new n(e,r||null,new x(ne.fromString(t.referencePath)))}};ve._jsonSchemaVersion="firestore/documentReference/1.0",ve._jsonSchema={type:he("string",ve._jsonSchemaVersion),referencePath:he("string")};var qt=class n extends Qt{constructor(e,t,r){super(e,t,fl(r)),this._path=r,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){let e=this._path.popLast();return e.isEmpty()?null:new ve(this.firestore,null,new x(e))}withConverter(e){return new n(this.firestore,e,this._path)}};function bl(n,e,...t){if(n=ae(n),Jp("collection","path",e),n instanceof er){let r=ne.fromString(e,...t);return up(r),new qt(n,null,r)}{if(!(n instanceof ve||n instanceof qt))throw new V(C.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");let r=n._path.child(ne.fromString(e,...t));return up(r),new qt(n.firestore,null,r)}}function wt(n,e,...t){if(n=ae(n),arguments.length===1&&(e=Xr.newId()),Jp("doc","path",e),n instanceof er){let r=ne.fromString(e,...t);return cp(r),new ve(n,null,new x(r))}{if(!(n instanceof ve||n instanceof qt))throw new V(C.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");let r=n._path.child(ne.fromString(e,...t));return cp(r),new ve(n.firestore,n instanceof qt?n.converter:null,new x(r))}}var $p="AsyncQueue",ao=class{constructor(e=Promise.resolve()){this.Xu=[],this.ec=!1,this.tc=[],this.nc=null,this.rc=!1,this.sc=!1,this.oc=[],this.M_=new Ys(this,"async_queue_retry"),this._c=()=>{let r=_c();r&&O($p,"Visibility state changed to "+r.visibilityState),this.M_.w_()},this.ac=e;let t=_c();t&&typeof t.addEventListener=="function"&&t.addEventListener("visibilitychange",this._c)}get isShuttingDown(){return this.ec}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.uc(),this.cc(e)}enterRestrictedMode(e){if(!this.ec){this.ec=!0,this.sc=e||!1;let t=_c();t&&typeof t.removeEventListener=="function"&&t.removeEventListener("visibilitychange",this._c)}}enqueue(e){if(this.uc(),this.ec)return new Promise(()=>{});let t=new je;return this.cc(()=>this.ec&&this.sc?Promise.resolve():(e().then(t.resolve,t.reject),t.promise)).then(()=>t.promise)}enqueueRetryable(e){this.enqueueAndForget(()=>(this.Xu.push(e),this.lc()))}lc(){return _(this,null,function*(){if(this.Xu.length!==0){try{yield this.Xu[0](),this.Xu.shift(),this.M_.reset()}catch(e){if(!sr(e))throw e;O($p,"Operation failed with retryable error: "+e)}this.Xu.length>0&&this.M_.p_(()=>this.lc())}})}cc(e){let t=this.ac.then(()=>(this.rc=!0,e().catch(r=>{throw this.nc=r,this.rc=!1,mt("INTERNAL UNHANDLED ERROR: ",Hp(r)),r}).then(r=>(this.rc=!1,r))));return this.ac=t,t}enqueueAfterDelay(e,t,r){this.uc(),this.oc.indexOf(e)>-1&&(t=0);let i=Fu.createAndSchedule(this,e,t,r,o=>this.hc(o));return this.tc.push(i),i}uc(){this.nc&&F(47125,{Pc:Hp(this.nc)})}verifyOperationInProgress(){}Tc(){return _(this,null,function*(){let e;do e=this.ac,yield e;while(e!==this.ac)})}Ic(e){for(let t of this.tc)if(t.timerId===e)return!0;return!1}Ec(e){return this.Tc().then(()=>{this.tc.sort((t,r)=>t.targetTimeMs-r.targetTimeMs);for(let t of this.tc)if(t.skipDelay(),e!=="all"&&t.timerId===e)break;return this.Tc()})}dc(e){this.oc.push(e)}hc(e){let t=this.tc.indexOf(e);this.tc.splice(t,1)}};function Hp(n){let e=n.message||"";return n.stack&&(e=n.stack.includes(n.message)?n.stack:n.message+`
`+n.stack),e}var It=class extends er{constructor(e,t,r,i){super(e,t,r,i),this.type="firestore",this._queue=new ao,this._persistenceKey=i?.name||"[DEFAULT]"}_terminate(){return _(this,null,function*(){if(this._firestoreClient){let e=this._firestoreClient.terminate();this._queue=new ao(e),this._firestoreClient=void 0,yield e}})}};function mg(n,e){let t=typeof n=="object"?n:rs(),r=typeof n=="string"?n:e||Fs,i=Lr(t,"firestore").getImmediate({identifier:r});if(!i._initialized){let o=Ud("firestore");o&&HE(i,...o)}return i}function Sl(n){if(n._terminated)throw new V(C.FAILED_PRECONDITION,"The client has already been terminated.");return n._firestoreClient||WE(n),n._firestoreClient}function WE(n){let e=n._freezeSettings(),t=(function(i,o,a,u){return new Rc(i,o,a,u.host,u.ssl,u.experimentalForceLongPolling,u.experimentalAutoDetectLongPolling,fg(u.experimentalLongPollingOptions),u.useFetchStreams,u.isUsingEmulator)})(n._databaseId,n._app?.options.appId||"",n._persistenceKey,e);n._componentsProvider||e.localCache?._offlineComponentProvider&&e.localCache?._onlineComponentProvider&&(n._componentsProvider={_offline:e.localCache._offlineComponentProvider,_online:e.localCache._onlineComponentProvider}),n._firestoreClient=new Wu(n._authCredentials,n._appCheckCredentials,n._queue,t,n._componentsProvider&&(function(i){let o=i?._online.build();return{_offline:i?._offline.build(o),_online:o}})(n._componentsProvider))}var jt=class n{constructor(e){this._byteString=e}static fromBase64String(e){try{return new n(Ee.fromBase64String(e))}catch(t){throw new V(C.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+t)}}static fromUint8Array(e){return new n(Ee.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}toJSON(){return{type:n._jsonSchemaVersion,bytes:this.toBase64()}}static fromJSON(e){if(li(e,n._jsonSchema))return n.fromBase64String(e.bytes)}};jt._jsonSchemaVersion="firestore/bytes/1.0",jt._jsonSchema={type:he("string",jt._jsonSchemaVersion),bytes:he("string")};var tr=class{constructor(...e){for(let t=0;t<e.length;++t)if(e[t].length===0)throw new V(C.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new xe(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}};var nr=class{constructor(e){this._methodName=e}};var Gt=class n{constructor(e,t){if(!isFinite(e)||e<-90||e>90)throw new V(C.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(t)||t<-180||t>180)throw new V(C.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+t);this._lat=e,this._long=t}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}_compareTo(e){return $(this._lat,e._lat)||$(this._long,e._long)}toJSON(){return{latitude:this._lat,longitude:this._long,type:n._jsonSchemaVersion}}static fromJSON(e){if(li(e,n._jsonSchema))return new n(e.latitude,e.longitude)}};Gt._jsonSchemaVersion="firestore/geoPoint/1.0",Gt._jsonSchema={type:he("string",Gt._jsonSchemaVersion),latitude:he("number"),longitude:he("number")};var zt=class n{constructor(e){this._values=(e||[]).map(t=>t)}toArray(){return this._values.map(e=>e)}isEqual(e){return(function(r,i){if(r.length!==i.length)return!1;for(let o=0;o<r.length;++o)if(r[o]!==i[o])return!1;return!0})(this._values,e._values)}toJSON(){return{type:n._jsonSchemaVersion,vectorValues:this._values}}static fromJSON(e){if(li(e,n._jsonSchema)){if(Array.isArray(e.vectorValues)&&e.vectorValues.every(t=>typeof t=="number"))return new n(e.vectorValues);throw new V(C.INVALID_ARGUMENT,"Expected 'vectorValues' field to be a number array")}}};zt._jsonSchemaVersion="firestore/vectorValue/1.0",zt._jsonSchema={type:he("string",zt._jsonSchemaVersion),vectorValues:he("object")};var KE=/^__.*__$/,Ku=class{constructor(e,t,r){this.data=e,this.fieldMask=t,this.fieldTransforms=r}toMutation(e,t){return this.fieldMask!==null?new st(e,this.data,this.fieldMask,t,this.fieldTransforms):new En(e,this.data,t,this.fieldTransforms)}},co=class{constructor(e,t,r){this.data=e,this.fieldMask=t,this.fieldTransforms=r}toMutation(e,t){return new st(e,this.data,this.fieldMask,t,this.fieldTransforms)}};function gg(n){switch(n){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw F(40011,{Ac:n})}}var Qu=class n{constructor(e,t,r,i,o,a){this.settings=e,this.databaseId=t,this.serializer=r,this.ignoreUndefinedProperties=i,o===void 0&&this.Rc(),this.fieldTransforms=o||[],this.fieldMask=a||[]}get path(){return this.settings.path}get Ac(){return this.settings.Ac}Vc(e){return new n(L(L({},this.settings),e),this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}mc(e){let t=this.path?.child(e),r=this.Vc({path:t,fc:!1});return r.gc(e),r}yc(e){let t=this.path?.child(e),r=this.Vc({path:t,fc:!1});return r.Rc(),r}wc(e){return this.Vc({path:void 0,fc:!0})}Sc(e){return lo(e,this.settings.methodName,this.settings.bc||!1,this.path,this.settings.Dc)}contains(e){return this.fieldMask.find(t=>e.isPrefixOf(t))!==void 0||this.fieldTransforms.find(t=>e.isPrefixOf(t.field))!==void 0}Rc(){if(this.path)for(let e=0;e<this.path.length;e++)this.gc(this.path.get(e))}gc(e){if(e.length===0)throw this.Sc("Document fields must not be empty");if(gg(this.Ac)&&KE.test(e))throw this.Sc('Document fields cannot begin and end with "__"')}},Ju=class{constructor(e,t,r){this.databaseId=e,this.ignoreUndefinedProperties=t,this.serializer=r||Io(e)}Cc(e,t,r,i=!1){return new Qu({Ac:e,methodName:t,Dc:r,path:xe.emptyPath(),fc:!1,bc:i},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}};function To(n){let e=n._freezeSettings(),t=Io(n._databaseId);return new Ju(n._databaseId,!!e.ignoreUndefinedProperties,t)}function _g(n,e,t,r,i,o={}){let a=n.Cc(o.merge||o.mergeFields?2:0,e,t,i);Cl("Data must be an object, but it was:",a,r);let u=yg(r,a),h,d;if(o.merge)h=new Be(a.fieldMask),d=a.fieldTransforms;else if(o.mergeFields){let p=[];for(let v of o.mergeFields){let w=Xu(e,v,t);if(!a.contains(w))throw new V(C.INVALID_ARGUMENT,`Field '${w}' is specified in your field mask but missing from your input data.`);Ig(p,w)||p.push(w)}h=new Be(p),d=a.fieldTransforms.filter(v=>h.covers(v.field))}else h=null,d=a.fieldTransforms;return new Ku(new Me(u),h,d)}var uo=class n extends nr{_toFieldTransform(e){if(e.Ac!==2)throw e.Ac===1?e.Sc(`${this._methodName}() can only appear at the top level of your update data`):e.Sc(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return e.fieldMask.push(e.path),null}isEqual(e){return e instanceof n}};var Yu=class n extends nr{_toFieldTransform(e){return new jc(e.path,new vn)}isEqual(e){return e instanceof n}};function QE(n,e,t,r){let i=n.Cc(1,e,t);Cl("Data must be an object, but it was:",i,r);let o=[],a=Me.empty();Jt(r,(h,d)=>{let p=Rl(e,h,t);d=ae(d);let v=i.yc(p);if(d instanceof uo)o.push(p);else{let w=fi(d,v);w!=null&&(o.push(p),a.set(p,w))}});let u=new Be(o);return new co(a,u,i.fieldTransforms)}function JE(n,e,t,r,i,o){let a=n.Cc(1,e,t),u=[Xu(e,r,t)],h=[i];if(o.length%2!=0)throw new V(C.INVALID_ARGUMENT,`Function ${e}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let w=0;w<o.length;w+=2)u.push(Xu(e,o[w])),h.push(o[w+1]);let d=[],p=Me.empty();for(let w=u.length-1;w>=0;--w)if(!Ig(d,u[w])){let R=u[w],k=h[w];k=ae(k);let M=a.yc(R);if(k instanceof uo)d.push(R);else{let N=fi(k,M);N!=null&&(d.push(R),p.set(R,N))}}let v=new Be(d);return new co(p,v,a.fieldTransforms)}function YE(n,e,t,r=!1){return fi(t,n.Cc(r?4:3,e))}function fi(n,e){if(vg(n=ae(n)))return Cl("Unsupported field value:",e,n),yg(n,e);if(n instanceof nr)return(function(r,i){if(!gg(i.Ac))throw i.Sc(`${r._methodName}() can only be used with update() and set()`);if(!i.path)throw i.Sc(`${r._methodName}() is not currently supported inside arrays`);let o=r._toFieldTransform(i);o&&i.fieldTransforms.push(o)})(n,e),null;if(n===void 0&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),n instanceof Array){if(e.settings.fc&&e.Ac!==4)throw e.Sc("Nested arrays are not supported");return(function(r,i){let o=[],a=0;for(let u of r){let h=fi(u,i.wc(a));h==null&&(h={nullValue:"NULL_VALUE"}),o.push(h),a++}return{arrayValue:{values:o}}})(n,e)}return(function(r,i){if((r=ae(r))===null)return{nullValue:"NULL_VALUE"};if(typeof r=="number")return Nw(i.serializer,r);if(typeof r=="boolean")return{booleanValue:r};if(typeof r=="string")return{stringValue:r};if(r instanceof Date){let o=se.fromDate(r);return{timestampValue:$s(i.serializer,o)}}if(r instanceof se){let o=new se(r.seconds,1e3*Math.floor(r.nanoseconds/1e3));return{timestampValue:$s(i.serializer,o)}}if(r instanceof Gt)return{geoPointValue:{latitude:r.latitude,longitude:r.longitude}};if(r instanceof jt)return{bytesValue:Bm(i.serializer,r._byteString)};if(r instanceof ve){let o=i.databaseId,a=r.firestore._databaseId;if(!a.isEqual(o))throw i.Sc(`Document reference is for database ${a.projectId}/${a.database} but should be for database ${o.projectId}/${o.database}`);return{referenceValue:ml(r.firestore._databaseId||i.databaseId,r._key.path)}}if(r instanceof zt)return(function(a,u){return{mapValue:{fields:{[cl]:{stringValue:ul},[Hn]:{arrayValue:{values:a.toArray().map(d=>{if(typeof d!="number")throw u.Sc("VectorValues must only contain numeric values.");return pl(u.serializer,d)})}}}}}})(r,i);throw i.Sc(`Unsupported field value: ${mo(r)}`)})(n,e)}function yg(n,e){let t={};return dm(n)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):Jt(n,(r,i)=>{let o=fi(i,e.mc(r));o!=null&&(t[r]=o)}),{mapValue:{fields:t}}}function vg(n){return!(typeof n!="object"||n===null||n instanceof Array||n instanceof Date||n instanceof se||n instanceof Gt||n instanceof jt||n instanceof ve||n instanceof nr||n instanceof zt)}function Cl(n,e,t){if(!vg(t)||!Yp(t)){let r=mo(t);throw r==="an object"?e.Sc(n+" a custom object"):e.Sc(n+" "+r)}}function Xu(n,e,t){if((e=ae(e))instanceof tr)return e._internalPath;if(typeof e=="string")return Rl(n,e);throw lo("Field path arguments must be of type string or ",n,!1,void 0,t)}var XE=new RegExp("[~\\*/\\[\\]]");function Rl(n,e,t){if(e.search(XE)>=0)throw lo(`Invalid field path (${e}). Paths must not contain '~', '*', '/', '[', or ']'`,n,!1,void 0,t);try{return new tr(...e.split("."))._internalPath}catch{throw lo(`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,n,!1,void 0,t)}}function lo(n,e,t,r,i){let o=r&&!r.isEmpty(),a=i!==void 0,u=`Function ${e}() called with invalid data`;t&&(u+=" (via `toFirestore()`)"),u+=". ";let h="";return(o||a)&&(h+=" (found",o&&(h+=` in field ${r}`),a&&(h+=` in document ${i}`),h+=")"),new V(C.INVALID_ARGUMENT,u+n+h)}function Ig(n,e){return n.some(t=>t.isEqual(e))}var ho=class{constructor(e,t,r,i,o){this._firestore=e,this._userDataWriter=t,this._key=r,this._document=i,this._converter=o}get id(){return this._key.path.lastSegment()}get ref(){return new ve(this._firestore,this._converter,this._key)}exists(){return this._document!==null}data(){if(this._document){if(this._converter){let e=new Zu(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){let t=this._document.data.field(Ao("DocumentSnapshot.get",e));if(t!==null)return this._userDataWriter.convertValue(t)}}},Zu=class extends ho{data(){return super.data()}};function Ao(n,e){return typeof e=="string"?Rl(n,e):e instanceof tr?e._internalPath:e._delegate._internalPath}function ZE(n){if(n.limitType==="L"&&n.explicitOrderBy.length===0)throw new V(C.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}var ci=class{},ui=class extends ci{};function Pl(n,e,...t){let r=[];e instanceof ci&&r.push(e),r=r.concat(t),(function(o){let a=o.filter(h=>h instanceof el).length,u=o.filter(h=>h instanceof fo).length;if(a>1||a>0&&u>0)throw new V(C.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")})(r);for(let i of r)n=i._apply(n);return n}var fo=class n extends ui{constructor(e,t,r){super(),this._field=e,this._op=t,this._value=r,this.type="where"}static _create(e,t,r){return new n(e,t,r)}_apply(e){let t=this._parse(e);return Ag(e._query,t),new Qt(e.firestore,e.converter,qc(e._query,t))}_parse(e){let t=To(e.firestore);return(function(o,a,u,h,d,p,v){let w;if(d.isKeyField()){if(p==="array-contains"||p==="array-contains-any")throw new V(C.INVALID_ARGUMENT,`Invalid Query. You can't perform '${p}' queries on documentId().`);if(p==="in"||p==="not-in"){Kp(v,p);let k=[];for(let M of v)k.push(Wp(h,o,M));w={arrayValue:{values:k}}}else w=Wp(h,o,v)}else p!=="in"&&p!=="not-in"&&p!=="array-contains-any"||Kp(v,p),w=YE(u,a,v,p==="in"||p==="not-in");return le.create(d,p,w)})(e._query,"where",t,e.firestore._databaseId,this._field,this._op,this._value)}};function wg(n,e,t){let r=e,i=Ao("where",n);return fo._create(i,r,t)}var el=class n extends ci{constructor(e,t){super(),this.type=e,this._queryConstraints=t}static _create(e,t){return new n(e,t)}_parse(e){let t=this._queryConstraints.map(r=>r._parse(e)).filter(r=>r.getFilters().length>0);return t.length===1?t[0]:$e.create(t,this._getOperator())}_apply(e){let t=this._parse(e);return t.getFilters().length===0?e:((function(i,o){let a=i,u=o.getFlattenedFilters();for(let h of u)Ag(a,h),a=qc(a,h)})(e._query,t),new Qt(e.firestore,e.converter,qc(e._query,t)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return this.type==="and"?"and":"or"}};var tl=class n extends ui{constructor(e,t){super(),this._field=e,this._direction=t,this.type="orderBy"}static _create(e,t){return new n(e,t)}_apply(e){let t=(function(i,o,a){if(i.startAt!==null)throw new V(C.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(i.endAt!==null)throw new V(C.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");return new yn(o,a)})(e._query,this._field,this._direction);return new Qt(e.firestore,e.converter,(function(i,o){let a=i.explicitOrderBy.concat([o]);return new Ht(i.path,i.collectionGroup,a,i.filters.slice(),i.limit,i.limitType,i.startAt,i.endAt)})(e._query,t))}};function Eg(n,e="asc"){let t=e,r=Ao("orderBy",n);return tl._create(r,t)}var nl=class n extends ui{constructor(e,t,r){super(),this.type=e,this._limit=t,this._limitType=r}static _create(e,t,r){return new n(e,t,r)}_apply(e){return new Qt(e.firestore,e.converter,Bs(e._query,this._limit,this._limitType))}};function Tg(n){return ew("limit",n),nl._create("limit",n,"F")}function Wp(n,e,t){if(typeof(t=ae(t))=="string"){if(t==="")throw new V(C.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!Sm(e)&&t.indexOf("/")!==-1)throw new V(C.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${t}' contains a '/' character.`);let r=e.path.child(ne.fromString(t));if(!x.isDocumentKey(r))throw new V(C.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${r}' is not because it has an odd number of segments (${r.length}).`);return gp(n,new x(r))}if(t instanceof ve)return gp(n,t._key);throw new V(C.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${mo(t)}.`)}function Kp(n,e){if(!Array.isArray(n)||n.length===0)throw new V(C.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${e.toString()}' filters.`)}function Ag(n,e){let t=(function(i,o){for(let a of i)for(let u of a.getFlattenedFilters())if(o.indexOf(u.op)>=0)return u.op;return null})(n.filters,(function(i){switch(i){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}})(e.op));if(t!==null)throw t===e.op?new V(C.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${e.op.toString()}' filter.`):new V(C.INVALID_ARGUMENT,`Invalid query. You cannot use '${e.op.toString()}' filters with '${t.toString()}' filters.`)}var rl=class{convertValue(e,t="none"){switch($t(e)){case 0:return null;case 1:return e.booleanValue;case 2:return te(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes(_t(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 11:return this.convertObject(e.mapValue,t);case 10:return this.convertVectorValue(e.mapValue);default:throw F(62114,{value:e})}}convertObject(e,t){return this.convertObjectMap(e.fields,t)}convertObjectMap(e,t="none"){let r={};return Jt(e,(i,o)=>{r[i]=this.convertValue(o,t)}),r}convertVectorValue(e){let t=e.fields?.[Hn].arrayValue?.values?.map(r=>te(r.doubleValue));return new zt(t)}convertGeoPoint(e){return new Gt(te(e.latitude),te(e.longitude))}convertArray(e,t){return(e.values||[]).map(r=>this.convertValue(r,t))}convertServerTimestamp(e,t){switch(t){case"previous":let r=_o(e);return r==null?null:this.convertValue(r,t);case"estimate":return this.convertTimestamp(ti(e));default:return null}}convertTimestamp(e){let t=gt(e);return new se(t.seconds,t.nanos)}convertDocumentKey(e,t){let r=ne.fromString(e);Y(Hm(r),9688,{name:e});let i=new Ls(r.get(1),r.get(3)),o=new x(r.popFirst(5));return i.isEqual(t)||mt(`Document ${o} contains a document reference within a different database (${i.projectId}/${i.database}) which is not supported. It will be treated as a reference in the current database (${t.projectId}/${t.database}) instead.`),o}};function bg(n,e,t){let r;return r=n?t&&(t.merge||t.mergeFields)?n.toFirestore(e,t):n.toFirestore(e):e,r}var pn=class{constructor(e,t){this.hasPendingWrites=e,this.fromCache=t}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}},mn=class n extends ho{constructor(e,t,r,i,o,a){super(e,t,r,i,a),this._firestore=e,this._firestoreImpl=e,this.metadata=o}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){let t=new jn(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,t={}){if(this._document){let r=this._document.data.field(Ao("DocumentSnapshot.get",e));if(r!==null)return this._userDataWriter.convertValue(r,t.serverTimestamps)}}toJSON(){if(this.metadata.hasPendingWrites)throw new V(C.FAILED_PRECONDITION,"DocumentSnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");let e=this._document,t={};return t.type=n._jsonSchemaVersion,t.bundle="",t.bundleSource="DocumentSnapshot",t.bundleName=this._key.toString(),!e||!e.isValidDocument()||!e.isFoundDocument()?t:(this._userDataWriter.convertObjectMap(e.data.value.mapValue.fields,"previous"),t.bundle=(this._firestore,this.ref.path,"NOT SUPPORTED"),t)}};mn._jsonSchemaVersion="firestore/documentSnapshot/1.0",mn._jsonSchema={type:he("string",mn._jsonSchemaVersion),bundleSource:he("string","DocumentSnapshot"),bundleName:he("string"),bundle:he("string")};var jn=class extends mn{data(e={}){return super.data(e)}},Gn=class n{constructor(e,t,r,i){this._firestore=e,this._userDataWriter=t,this._snapshot=i,this.metadata=new pn(i.hasPendingWrites,i.fromCache),this.query=r}get docs(){let e=[];return this.forEach(t=>e.push(t)),e}get size(){return this._snapshot.docs.size}get empty(){return this.size===0}forEach(e,t){this._snapshot.docs.forEach(r=>{e.call(t,new jn(this._firestore,this._userDataWriter,r.key,r,new pn(this._snapshot.mutatedKeys.has(r.key),this._snapshot.fromCache),this.query.converter))})}docChanges(e={}){let t=!!e.includeMetadataChanges;if(t&&this._snapshot.excludesMetadataChanges)throw new V(C.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===t||(this._cachedChanges=(function(i,o){if(i._snapshot.oldDocs.isEmpty()){let a=0;return i._snapshot.docChanges.map(u=>{let h=new jn(i._firestore,i._userDataWriter,u.doc.key,u.doc,new pn(i._snapshot.mutatedKeys.has(u.doc.key),i._snapshot.fromCache),i.query.converter);return u.doc,{type:"added",doc:h,oldIndex:-1,newIndex:a++}})}{let a=i._snapshot.oldDocs;return i._snapshot.docChanges.filter(u=>o||u.type!==3).map(u=>{let h=new jn(i._firestore,i._userDataWriter,u.doc.key,u.doc,new pn(i._snapshot.mutatedKeys.has(u.doc.key),i._snapshot.fromCache),i.query.converter),d=-1,p=-1;return u.type!==0&&(d=a.indexOf(u.doc.key),a=a.delete(u.doc.key)),u.type!==1&&(a=a.add(u.doc),p=a.indexOf(u.doc.key)),{type:eT(u.type),doc:h,oldIndex:d,newIndex:p}})}})(this,t),this._cachedChangesIncludeMetadataChanges=t),this._cachedChanges}toJSON(){if(this.metadata.hasPendingWrites)throw new V(C.FAILED_PRECONDITION,"QuerySnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");let e={};e.type=n._jsonSchemaVersion,e.bundleSource="QuerySnapshot",e.bundleName=Xr.newId(),this._firestore._databaseId.database,this._firestore._databaseId.projectId;let t=[],r=[],i=[];return this.docs.forEach(o=>{o._document!==null&&(t.push(o._document),r.push(this._userDataWriter.convertObjectMap(o._document.data.value.mapValue.fields,"previous")),i.push(o.ref.path))}),e.bundle=(this._firestore,this.query._query,e.bundleName,"NOT SUPPORTED"),e}};function eT(n){switch(n){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return F(61501,{type:n})}}function Dl(n){n=Ge(n,ve);let e=Ge(n.firestore,It);return zE(Sl(e),n._key).then(t=>tT(e,n,t))}Gn._jsonSchemaVersion="firestore/querySnapshot/1.0",Gn._jsonSchema={type:he("string",Gn._jsonSchemaVersion),bundleSource:he("string","QuerySnapshot"),bundleName:he("string"),bundle:he("string")};var po=class extends rl{constructor(e){super(),this.firestore=e}convertBytes(e){return new jt(e)}convertReference(e){let t=this.convertDocumentKey(e,this.firestore._databaseId);return new ve(this.firestore,null,t)}};function Nl(n){n=Ge(n,Qt);let e=Ge(n.firestore,It),t=Sl(e),r=new po(e);return ZE(n._query),$E(t,n._query).then(i=>new Gn(e,r,n,i))}function Sg(n,e,t){n=Ge(n,ve);let r=Ge(n.firestore,It),i=bg(n.converter,e,t);return bo(r,[_g(To(r),"setDoc",n._key,i,n.converter!==null,t).toMutation(n._key,nt.none())])}function ar(n,e,t,...r){n=Ge(n,ve);let i=Ge(n.firestore,It),o=To(i),a;return a=typeof(e=ae(e))=="string"||e instanceof tr?JE(o,"updateDoc",n._key,e,t,r):QE(o,"updateDoc",n._key,e),bo(i,[a.toMutation(n._key,nt.exists(!0))])}function Vl(n){return bo(Ge(n.firestore,It),[new ri(n._key,nt.none())])}function Xb(n,e){let t=Ge(n.firestore,It),r=wt(n),i=bg(n.converter,e);return bo(t,[_g(To(n.firestore),"addDoc",r._key,i,n.converter!==null,{}).toMutation(r._key,nt.exists(!1))]).then(()=>r)}function bo(n,e){return(function(r,i){let o=new je;return r.asyncQueue.enqueueAndForget(()=>_(null,null,function*(){return kE(yield GE(r),i,o)})),o.promise})(Sl(n),e)}function tT(n,e,t){let r=t.docs.get(e._key),i=new po(n);return new mn(n,i,e._key,r,new pn(t.hasPendingWrites,t.fromCache),e.converter)}function ot(){return new Yu("serverTimestamp")}(function(e,t=!0){(function(i){rr=i})(Lt),Ft(new Le("firestore",(r,{instanceIdentifier:i,options:o})=>{let a=r.getProvider("app").getImmediate(),u=new It(new wc(r.getProvider("auth-internal")),new Ac(a,r.getProvider("app-check-internal")),(function(d,p){if(!Object.prototype.hasOwnProperty.apply(d.options,["projectId"]))throw new V(C.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new Ls(d.options.projectId,p)})(a,i),a);return o=L({useFetchStreams:t},o),u._setSettings(o),u},"PUBLIC").setMultipleInstances(!0)),ct(sp,op,e),ct(sp,op,"esm2020")})();var Cg=(()=>{let e=class e{constructor(){this.db=null,this.USERS_COLLECTION="users",this.DONATIONS_COLLECTION="donations",this.CURRENT_PLATFORM="quotation"}initializeFirestore(){this.db=mg()}getUserData(r){return _(this,null,function*(){if(!this.db)throw new Error("Firestore not initialized");try{let i=wt(this.db,this.USERS_COLLECTION,r),o=yield Dl(i);return o.exists()?o.data():null}catch(i){throw console.error("Failed to get user data:",i),i}})}createUserData(r,i,o,a){return _(this,null,function*(){if(!this.db)throw new Error("Firestore not initialized");try{let u=wt(this.db,this.USERS_COLLECTION,r),h=ot(),d={uid:r,email:i,displayName:o,photoURL:a,platforms:{[this.CURRENT_PLATFORM]:{role:"free",firstAccessTime:h,lastAccessTime:h}},createdAt:h,updatedAt:h};yield Sg(u,d)}catch(u){throw console.error("Failed to create user data:",u),u}})}updateUserRole(r,i,o){return _(this,null,function*(){if(!this.db)throw new Error("Firestore not initialized");try{let a=wt(this.db,this.USERS_COLLECTION,r),u={[`platforms.${this.CURRENT_PLATFORM}.role`]:i,updatedAt:ot()};o!==void 0&&(u[`platforms.${this.CURRENT_PLATFORM}.premiumUntil`]=o?se.fromDate(o):null),yield ar(a,u)}catch(a){throw console.error("Failed to update user role:",a),a}})}updateUserDisplayName(r,i){return _(this,null,function*(){if(!this.db)throw new Error("Firestore not initialized");try{let o=wt(this.db,this.USERS_COLLECTION,r);yield ar(o,{displayName:i,updatedAt:ot()})}catch(o){throw console.error("Failed to update display name:",o),o}})}isPremiumUser(r){if(!r)return!1;let i=r.platforms[this.CURRENT_PLATFORM];return!i||i.role!=="premium"?!1:i.premiumUntil?i.premiumUntil.toDate()>new Date:!0}recordPlatformAccess(r){return _(this,null,function*(){if(!this.db)throw new Error("Firestore not initialized");try{let i=wt(this.db,this.USERS_COLLECTION,r),o=yield Dl(i);if(!o.exists()){console.error("User document does not exist:",r);return}o.data().platforms[this.CURRENT_PLATFORM]?yield ar(i,{[`platforms.${this.CURRENT_PLATFORM}.lastAccessTime`]:ot(),updatedAt:ot()}):yield ar(i,{[`platforms.${this.CURRENT_PLATFORM}`]:{role:"free",firstAccessTime:ot(),lastAccessTime:ot()},updatedAt:ot()})}catch(i){throw console.error("Failed to record platform access:",i),i}})}getOrCreateUserData(r,i,o,a){return _(this,null,function*(){let u=yield this.getUserData(r);if(!u&&(yield this.createUserData(r,i,o,a),u=yield this.getUserData(r),!u))throw new Error("Failed to create user data");return u})}getAllUsers(r){return _(this,null,function*(){if(!this.db)throw new Error("Firestore not initialized");try{let i=bl(this.db,this.USERS_COLLECTION),o=[Eg("createdAt","desc")];r&&o.push(Tg(r));let a=Pl(i,...o),u=yield Nl(a),h=[];return u.forEach(d=>{h.push(d.data())}),h}catch(i){throw console.error("Failed to get all users:",i),i}})}updateUser(r,i){return _(this,null,function*(){if(!this.db)throw new Error("Firestore not initialized");try{let o=wt(this.db,this.USERS_COLLECTION,r),a=Z(L({},i),{updatedAt:ot()});yield ar(o,a)}catch(o){throw console.error("Failed to update user:",o),o}})}deleteUser(r){return _(this,null,function*(){if(!this.db)throw new Error("Firestore not initialized");try{let i=bl(this.db,this.DONATIONS_COLLECTION),o=Pl(i,wg("uid","==",r)),u=(yield Nl(o)).docs.map(d=>Vl(d.ref));yield Promise.all(u);let h=wt(this.db,this.USERS_COLLECTION,r);yield Vl(h)}catch(i){throw console.error("Failed to delete user:",i),i}})}};e.\u0275fac=function(i){return new(i||e)},e.\u0275prov=Ke({token:e,factory:e.\u0275fac,providedIn:"root"});let n=e;return n})();var dS=(()=>{let e=class e{constructor(){this.analyticsService=Dt(Nd),this.firestoreService=Dt(Cg),this.toastService=Dt(Vd),this.auth=null,this.currentUser=Fe(null),this.userData=Fe(null),this.isAuthenticated=De(()=>this.currentUser()!==null),this.userDisplayName=De(()=>this.currentUser()?.displayName||"\u8A2A\u5BA2"),this.userPhotoURL=De(()=>this.currentUser()?.photoURL||null),this.userEmail=De(()=>this.currentUser()?.email||null),this.userId=De(()=>this.currentUser()?.uid||null),this.isPremium=De(()=>this.firestoreService.isPremiumUser(this.userData())),this.isAdmin=De(()=>this.userData()?.platforms.quotation?.role==="admin"),this.userRole=De(()=>this.userData()?.platforms.quotation?.role||"free")}initializeAuth(){this.auth=ac(),nc(this.auth,r=>_(this,null,function*(){this.currentUser.set(r),r?(yield this.loadUserData(r),this.analyticsService.trackEvent("user_signed_in",{method:"google",user_id:r.uid,user_role:this.userRole()})):this.userData.set(null)}))}loadUserData(r){return _(this,null,function*(){try{let i=yield this.firestoreService.getOrCreateUserData(r.uid,r.email,r.displayName,r.photoURL);yield this.firestoreService.recordPlatformAccess(r.uid);let o=i.platforms.quotation;if(o?.role==="premium"&&o.premiumUntil&&o.premiumUntil.toDate()<new Date){let a=o.premiumUntil.toDate();console.log(`User ${r.uid} premium expired on ${a}, downgrading to free`),yield this.firestoreService.updateUserRole(r.uid,"free"),i.platforms.quotation&&(i.platforms.quotation.role="free")}this.userData.set(i)}catch(i){console.error("Failed to load user data:",i),this.analyticsService.trackError(i,"load_user_data")}})}loginWithGoogle(){return _(this,null,function*(){if(!this.auth)throw new Error("Firebase Auth not initialized");try{let r=new ec;r.setCustomParameters({prompt:"select_account"});let i=yield oc(this.auth,r);return this.analyticsService.trackEvent("login_success",{method:"google",user_id:i.user.uid}),i}catch(r){throw console.error("Login failed:",r),this.analyticsService.trackEvent("login_failed",{method:"google",error_code:r.code,error_message:r.message}),r}})}logout(){return _(this,null,function*(){if(!this.auth)throw new Error("Firebase Auth not initialized");try{let r=this.userId();yield rc(this.auth),this.analyticsService.trackEvent("logout_success",{user_id:r})}catch(r){throw console.error("Logout failed:",r),this.analyticsService.trackEvent("logout_failed",{error_message:r.message}),r}})}getCurrentUser(){return this.currentUser()}getIdToken(){return _(this,null,function*(){let r=this.currentUser();if(!r)return null;try{return yield r.getIdToken()}catch(i){return console.error("Failed to get ID token:",i),null}})}updateDisplayName(r){return _(this,null,function*(){let i=this.currentUser();if(!i)throw new Error("\u4F7F\u7528\u8005\u672A\u767B\u5165");let o=r.trim();if(!o)throw new Error("\u986F\u793A\u540D\u7A31\u4E0D\u80FD\u70BA\u7A7A");if(o.length>50)throw new Error("\u986F\u793A\u540D\u7A31\u4E0D\u80FD\u8D85\u904E 50 \u500B\u5B57");try{yield tc(i,{displayName:o}),yield this.firestoreService.updateUserDisplayName(i.uid,o);let a=this.userData();a&&this.userData.set(Z(L({},a),{displayName:o})),this.toastService.success("\u986F\u793A\u540D\u7A31\u5DF2\u66F4\u65B0")}catch(a){throw console.error("Failed to update display name:",a),this.analyticsService.trackError(a,"update_display_name"),a}})}};e.\u0275fac=function(i){return new(i||e)},e.\u0275prov=Ke({token:e,factory:e.\u0275fac,providedIn:"root"});let n=e;return n})();var mS={production:!0,googleSheets:{enabled:!0,quotationUrl:"https://script.google.com/macros/s/AKfycbwHIuLbQ2-bdvAvqF7_9OxKeu7ct8s01kiNCUSApBQkwpgXSbct_G6Sghr9hUdWZhuX/exec",commentsUrl:"https://script.google.com/macros/s/AKfycbwwwJ-TWZH1hTb3B4_Ejio9xmccyILy8JC2jp1bRviffLZKBO64Z9qvbAn5jP_3-8J4Mw/exec",notificationUrl:"https://script.google.com/macros/s/AKfycbyswU2iuaGFrOMEjm2skpPqYLzNUAt1IJjX7U0P2zAuiBPycadGbMKU2NTaCdz9_lcr/exec"},firebase:{apiKey:"AIzaSyA6Rlau-Ats3mVvrxQfEimWAgylmPJbuuw",authDomain:"portal-c1b36.firebaseapp.com",projectId:"portal-c1b36",storageBucket:"portal-c1b36.firebasestorage.app",messagingSenderId:"235746173672",appId:"1:235746173672:web:bbe0a081c9293965975f5d",measurementId:"G-DJMC35VQ0W"}};export{nv as a,ct as b,ac as c,o_ as d,td as e,zh as f,IT as g,wT as h,V_ as i,TT as j,O_ as k,Ed as l,Ad as m,U_ as n,Cd as o,AT as p,bT as q,H_ as r,K_ as s,J_ as t,ST as u,CT as v,RT as w,Nd as x,mS as y,se as z,bl as A,wt as B,mg as C,Pl as D,wg as E,Eg as F,Nl as G,ar as H,Vl as I,Xb as J,ot as K,Cg as L,Vd as M,dS as N};
