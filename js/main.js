"use strict";

(function () {
  var modal = document.querySelector('#modal');
  var form = document.querySelector('form#form');
  var inputs = document.querySelectorAll('input, textarea, select');

  var formData = function formData() {
    var data = {
      company: document.querySelector('[name=company]').value,
      name: document.querySelector('[name=name]').value,
      phone: document.querySelector('[name=phone]').value,
      email: document.querySelector('[name=email]').value,
      description: document.querySelector('[name=description]').value,
      items: []
    };
    document.querySelectorAll('[data-item]').forEach(function (element, index) {
      if (index === 0) {
        return;
      }

      data.items.push({
        category: element.querySelector('[name=category]').value,
        item: element.querySelector('[name=item]').value,
        price: element.querySelector('[name=price]').value,
        number: element.querySelector('[name=number]').value,
        amount: element.querySelector('[name=amount]').value
      });
    });
    return data;
  };

  var setAmount = function setAmount(element) {
    var price = element.querySelector('[name=price]').value || 0;
    var number = element.querySelector('[name=number]').value || 1;
    element.querySelector('[name=amount]').value = price * number;
  };

  var setTotal = function setTotal() {
    var total = document.querySelectorAll('[name=amount]');
    var getTotal = 0;
    total.forEach(function (e) {
      getTotal += +e.value;
    });
    document.querySelector('#total-price').textContent = getTotal;
  };

  var delItem = function delItem() {
    document.querySelectorAll('.delItem').forEach(function (e, i) {
      e.addEventListener('click', function (e) {
        if (document.querySelectorAll('[data-item]').length > 2) {
          console.log('del', document.querySelectorAll('[data-item]').length);
          this.parentElement.parentElement.remove();
          setTotal();
        }
      });
    });
  };

  var updateDom = function updateDom() {
    document.querySelectorAll('[data-item]').forEach(function (element, index) {
      element.querySelector('[name=price]').addEventListener('change', function (ev) {
        setAmount(element);
        setTotal();
      });
      element.querySelector('[name=number]').addEventListener('change', function (ev) {
        setAmount(element);
        setTotal();
      });
      delItem();
    });
  };

  var createItem = function createItem(data) {
    return data.map(function (e) {
      return "\n        <tr>\n          <td class=\"text-left\">".concat(e.category, "</td>\n          <td class=\"text-left\">").concat(e.item, "</td>\n          <td>").concat(e.price, "</td>\n          <td>").concat(e.number, "</td>\n          <td class=\"price\">").concat(e.amount, "</td>\n        </tr> \n      ");
    });
  };

  var createModal = function createModal(data) {
    return "\n      <div class=\"table-responsive\">\n        <table class=\"table table-vcenter\">\n          <tr>\n            <th>\u5831\u50F9\u4EBA\u54E1</th>\n            <td>".concat(data.name, "</td>\n          </tr>\n          <tr>\n            <th>\u806F\u7D61\u96FB\u8A71</th>\n            <td>").concat(data.phone, "</td>\n          </tr>\n          <tr>\n            <th>E-Mail</th>\n            <td>").concat(data.email, "</td>\n          </tr>\n        </table>\n        <table class=\"table table-vcenter\">\n          <thead>\n            <tr>\n              <th>\u985E\u5225</th>\n              <th>\u9805\u76EE</th>\n              <th>\u55AE\u50F9</th>\n              <th>\u6578\u91CF / \u9801</th>\n              <th>\u91D1\u984D</th>\n            </tr>\n          </thead>\n          <tbody>\n            ").concat(createItem(data.items).join(''), "\n          </tbody>\n        </table>\n      </div>\n    ");
  }; // validate form


  var constraints = {
    company: {
      presence: {
        message: '^請輸入業主名稱'
      }
    },
    name: {
      presence: {
        message: '^請輸入報價人員'
      }
    },
    email: {
      presence: {
        message: '^請輸入 E-Mail'
      },
      email: {
        message: '格式錯誤'
      }
    },
    phone: {
      presence: {
        message: '^請輸入聯絡電話'
      },
      format: {
        pattern: '^09[0-9]{8}$',
        message: '^手機格式錯誤'
      }
    },
    item: {
      presence: {
        message: '^項目名稱不得為空'
      }
    },
    price: {
      presence: {
        message: '^單價名稱不得為空'
      }
    }
  };

  var resetFormInput = function resetFormInput(formInput) {
    formInput.classList.remove('is-invalid');
    formInput.parentNode.querySelectorAll('.invalid-feedback').forEach(function (el) {
      el.remove();
    });
  };

  var addError = function addError(formInput, error) {
    var block = document.createElement('div');
    block.classList.add('invalid-feedback');
    block.innerText = error;
    formInput.parentNode.appendChild(block);
  };

  var showErrorsForInput = function showErrorsForInput(input, errors) {
    resetFormInput(input);

    if (errors) {
      input.classList.add('is-invalid');
      errors.forEach(function (err) {
        addError(input, err);
      });
    }
  };

  var showErrors = function showErrors(form, errors) {
    form.querySelectorAll('input[name], select[name]').forEach(function (input) {
      showErrorsForInput(input, errors && errors[input.name]);
    });
  };

  var handleFormSubmit = function handleFormSubmit(form, input) {
    console.log('handleFormSubmit', form, formData());
    var errors = validate(form, constraints);

    if (!errors) {
      return true;
    }

    showErrors(form, errors || {});
    return false;
  };

  updateDom();

  for (var i = 0; i < inputs.length; ++i) {
    inputs.item(i).addEventListener('change', function (ev) {
      var errors = validate(form, constraints) || {};
      showErrorsForInput(this, errors[this.name]);
    });
  } // add item row


  document.querySelector('#addItem').addEventListener('click', function (e) {
    e.preventDefault();
    var row = document.querySelector('[data-item]');
    var newRow = row.cloneNode(true);
    newRow.style.display = 'flex';
    document.querySelector('[data-items]').append(newRow);
    updateDom();
  }); // on Submit

  modal.addEventListener('show.bs.modal', function (e) {
    if (!handleFormSubmit(form)) {
      e.preventDefault();
      this.querySelector('.modal-title').textContent = '';
      this.querySelector('.modal-body').textContent = '';
    } else {
      var data = formData();
      var modalTitle = document.querySelector('.modal-title');
      var modalBody = document.querySelector('.modal-body');
      modalTitle.append(data.company + '-報價單');
      modalBody.insertAdjacentHTML('beforeend', createModal(data));
    }
  });
  modal.addEventListener('hidden.bs.modal', function (e) {
    e.preventDefault();
    this.querySelector('.modal-title').textContent = '';
    this.querySelector('.modal-body').textContent = '';
  }); // Print

  var printScreen = function printScreen(print) {
    var printArea = print.innerHTML;
    var printPage = window.open('', 'Printing...', '');
    printPage.document.open();
    printPage.document.write("<html>\n        <head>\n        <meta charset=\"UTF-8\" />\n        <meta http-equiv=\"X-UA-Compatible\" content=\"IE=edge\" />\n        <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\" />\n          <title>\u5831\u50F9\u55AE\u7522\u751F\u5668</title>\n          <link rel=\"stylesheet\" href=\"https://unpkg.com/@tabler/core@latest/dist/css/tabler.min.css\"/>\n        </head>\n        <body onload='window.print();window.close()'>");
    printPage.document.write(printArea);
    printPage.document.close('</body></html>');
  };

  document.querySelector('#print').addEventListener('click', function () {
    var now = new Date().toLocaleDateString();
    var printHtml = document.querySelector('.modal-dialog .modal-content');
    var newPrintHtml = printHtml.cloneNode(true);
    newPrintHtml.querySelector('.modal-footer').remove();
    newPrintHtml.insertAdjacentHTML('beforeend', "<p style=\"text-align: right;\">\u5831\u50F9\u6642\u9593\uFF1A".concat(now, "</p>"));
    printScreen(newPrintHtml);
  });
})();
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm1haW4uanMiXSwibmFtZXMiOlsibW9kYWwiLCJkb2N1bWVudCIsInF1ZXJ5U2VsZWN0b3IiLCJmb3JtIiwiaW5wdXRzIiwicXVlcnlTZWxlY3RvckFsbCIsImZvcm1EYXRhIiwiZGF0YSIsImNvbXBhbnkiLCJ2YWx1ZSIsIm5hbWUiLCJwaG9uZSIsImVtYWlsIiwiZGVzY3JpcHRpb24iLCJpdGVtcyIsImZvckVhY2giLCJlbGVtZW50IiwiaW5kZXgiLCJwdXNoIiwiY2F0ZWdvcnkiLCJpdGVtIiwicHJpY2UiLCJudW1iZXIiLCJhbW91bnQiLCJzZXRBbW91bnQiLCJzZXRUb3RhbCIsInRvdGFsIiwiZ2V0VG90YWwiLCJlIiwidGV4dENvbnRlbnQiLCJkZWxJdGVtIiwiaSIsImFkZEV2ZW50TGlzdGVuZXIiLCJsZW5ndGgiLCJjb25zb2xlIiwibG9nIiwicGFyZW50RWxlbWVudCIsInJlbW92ZSIsInVwZGF0ZURvbSIsImV2IiwiY3JlYXRlSXRlbSIsIm1hcCIsImNyZWF0ZU1vZGFsIiwiam9pbiIsImNvbnN0cmFpbnRzIiwicHJlc2VuY2UiLCJtZXNzYWdlIiwiZm9ybWF0IiwicGF0dGVybiIsInJlc2V0Rm9ybUlucHV0IiwiZm9ybUlucHV0IiwiY2xhc3NMaXN0IiwicGFyZW50Tm9kZSIsImVsIiwiYWRkRXJyb3IiLCJlcnJvciIsImJsb2NrIiwiY3JlYXRlRWxlbWVudCIsImFkZCIsImlubmVyVGV4dCIsImFwcGVuZENoaWxkIiwic2hvd0Vycm9yc0ZvcklucHV0IiwiaW5wdXQiLCJlcnJvcnMiLCJlcnIiLCJzaG93RXJyb3JzIiwiaGFuZGxlRm9ybVN1Ym1pdCIsInZhbGlkYXRlIiwicHJldmVudERlZmF1bHQiLCJyb3ciLCJuZXdSb3ciLCJjbG9uZU5vZGUiLCJzdHlsZSIsImRpc3BsYXkiLCJhcHBlbmQiLCJtb2RhbFRpdGxlIiwibW9kYWxCb2R5IiwiaW5zZXJ0QWRqYWNlbnRIVE1MIiwicHJpbnRTY3JlZW4iLCJwcmludCIsInByaW50QXJlYSIsImlubmVySFRNTCIsInByaW50UGFnZSIsIndpbmRvdyIsIm9wZW4iLCJ3cml0ZSIsImNsb3NlIiwibm93IiwiRGF0ZSIsInRvTG9jYWxlRGF0ZVN0cmluZyIsInByaW50SHRtbCIsIm5ld1ByaW50SHRtbCJdLCJtYXBwaW5ncyI6Ijs7QUFBQSxDQUFDLFlBQVk7QUFDWCxNQUFNQSxLQUFLLEdBQUdDLFFBQVEsQ0FBQ0MsYUFBVCxDQUF1QixRQUF2QixDQUFkO0FBQ0EsTUFBTUMsSUFBSSxHQUFHRixRQUFRLENBQUNDLGFBQVQsQ0FBdUIsV0FBdkIsQ0FBYjtBQUNBLE1BQU1FLE1BQU0sR0FBR0gsUUFBUSxDQUFDSSxnQkFBVCxDQUEwQix5QkFBMUIsQ0FBZjs7QUFDQSxNQUFNQyxRQUFRLEdBQUcsU0FBWEEsUUFBVyxHQUFZO0FBQzNCLFFBQU1DLElBQUksR0FBRztBQUNYQyxNQUFBQSxPQUFPLEVBQUVQLFFBQVEsQ0FBQ0MsYUFBVCxDQUF1QixnQkFBdkIsRUFBeUNPLEtBRHZDO0FBRVhDLE1BQUFBLElBQUksRUFBRVQsUUFBUSxDQUFDQyxhQUFULENBQXVCLGFBQXZCLEVBQXNDTyxLQUZqQztBQUdYRSxNQUFBQSxLQUFLLEVBQUVWLFFBQVEsQ0FBQ0MsYUFBVCxDQUF1QixjQUF2QixFQUF1Q08sS0FIbkM7QUFJWEcsTUFBQUEsS0FBSyxFQUFFWCxRQUFRLENBQUNDLGFBQVQsQ0FBdUIsY0FBdkIsRUFBdUNPLEtBSm5DO0FBS1hJLE1BQUFBLFdBQVcsRUFBRVosUUFBUSxDQUFDQyxhQUFULENBQXVCLG9CQUF2QixFQUE2Q08sS0FML0M7QUFNWEssTUFBQUEsS0FBSyxFQUFFO0FBTkksS0FBYjtBQVNBYixJQUFBQSxRQUFRLENBQUNJLGdCQUFULENBQTBCLGFBQTFCLEVBQXlDVSxPQUF6QyxDQUFpRCxVQUFDQyxPQUFELEVBQVVDLEtBQVYsRUFBb0I7QUFDbkUsVUFBSUEsS0FBSyxLQUFLLENBQWQsRUFBaUI7QUFDZjtBQUNEOztBQUNEVixNQUFBQSxJQUFJLENBQUNPLEtBQUwsQ0FBV0ksSUFBWCxD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Q0FFLElBQUFBLFNBQVMsQ0FBQ2pGLFFBQVYsQ0FBbUJxRixLQUFuQixDQUF5QixnQkFBekI7QUFDRCxHQWpCRDs7QUFtQkFyRixFQUFBQSxRQUFRLENBQUNDLGFBQVQsQ0FBdUIsUUFBdkIsRUFBaUM4QixnQkFBakMsQ0FBa0QsT0FBbEQsRUFBMkQsWUFBWTtBQUNyRSxRQUFNdUQsR0FBRyxHQUFHLElBQUlDLElBQUosR0FBV0Msa0JBQVgsRUFBWjtBQUNBLFFBQU1DLFNBQVMsR0FBR3pGLFFBQVEsQ0FBQ0MsYUFBVCxDQUF1Qiw4QkFBdkIsQ0FBbEI7QUFFQSxRQUFNeUYsWUFBWSxHQUFHRCxTQUFTLENBQUNuQixTQUFWLENBQW9CLElBQXBCLENBQXJCO0FBQ0FvQixJQUFBQSxZQUFZLENBQUN6RixhQUFiLENBQTJCLGVBQTNCLEVBQTRDbUMsTUFBNUM7QUFDQXNELElBQUFBLFlBQVksQ0FBQ2Qsa0JBQWIsQ0FDRSxXQURGLDBFQUV3Q1UsR0FGeEM7QUFLQVQsSUFBQUEsV0FBVyxDQUFDYSxZQUFELENBQVg7QUFDRCxHQVpEO0FBYUQsQ0F4UkQiLCJzb3VyY2VzQ29udGVudCI6WyIoZnVuY3Rpb24gKCkge1xyXG4gIGNvbnN0IG1vZGFsID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignI21vZGFsJyk7XHJcbiAgY29uc3QgZm9ybSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJ2Zvcm0jZm9ybScpO1xyXG4gIGNvbnN0IGlucHV0cyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJ2lucHV0LCB0ZXh0YXJlYSwgc2VsZWN0Jyk7XHJcbiAgY29uc3QgZm9ybURhdGEgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICBjb25zdCBkYXRhID0ge1xyXG4gICAgICBjb21wYW55OiBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCdbbmFtZT1jb21wYW55XScpLnZhbHVlLFxyXG4gICAgICBuYW1lOiBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCdbbmFtZT1uYW1lXScpLnZhbHVlLFxyXG4gICAgICBwaG9uZTogZG9jdW1lbnQucXVlcnlTZWxlY3RvcignW25hbWU9cGhvbmVdJykudmFsdWUsXHJcbiAgICAgIGVtYWlsOiBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCdbbmFtZT1lbWFpbF0nKS52YWx1ZSxcclxuICAgICAgZGVzY3JpcHRpb246IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJ1tuYW1lPWRlc2NyaXB0aW9uXScpLnZhbHVlLFxyXG4gICAgICBpdGVtczogW10sXHJcbiAgICB9O1xyXG5cclxuICAgIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJ1tkYXRhLWl0ZW1dJykuZm9yRWFjaCgoZWxlbWVudCwgaW5kZXgpID0+IHtcclxuICAgICAgaWYgKGluZGV4ID09PSAwKSB7XHJcbiAgICAgICAgcmV0dXJuO1xyXG4gICAgICB9XHJcbiAgICAgIGRhdGEuaXRlbXMucHVzaCh7XHJcbiAgICAgICAgY2F0ZWdvcnk6IGVsZW1lbnQucXVlcnlTZWxlY3RvcignW25hbWU9Y2F0ZWdvcnldJykudmFsdWUsXHJcbiAgICAgICAgaXRlbTogZWxlbWVudC5xdWVyeVNlbGVjdG9yKCdbbmFtZT1pdGVtXScpLnZhbHVlLFxyXG4gICAgICAgIHByaWNlOiBlbGVtZW50LnF1ZXJ5U2VsZWN0b3IoJ1tuYW1lPXByaWNlXScpLnZhbHVlLFxyXG4gICAgICAgIG51bWJlcjogZWxlbWVudC5xdWVyeVNlbGVjdG9yKCdbbmFtZT1udW1iZXJdJykudmFsdWUsXHJcbiAgICAgICAgYW1vdW50OiBlbGVtZW50LnF1ZXJ5U2VsZWN0b3IoJ1tuYW1lPWFtb3VudF0nKS52YWx1ZSxcclxuICAgICAgfSk7XHJcbiAgICB9KTtcclxuXHJcbiAgICByZXR1cm4gZGF0YTtcclxuICB9O1xyXG4gIGNvbnN0IHNldEFtb3VudCA9IChlbGVtZW50KSA9PiB7XHJcbiAgICBjb25zdCBwcmljZSA9IGVsZW1lbnQucXVlcnlTZWxlY3RvcignW25hbWU9cHJpY2VdJykudmFsdWUgfHwgMDtcclxuICAgIGNvbnN0IG51bWJlciA9IGVsZW1lbnQucXVlcnlTZWxlY3RvcignW25hbWU9bnVtYmVyXScpLnZhbHVlIHx8IDE7XHJcbiAgICBlbGVtZW50LnF1ZXJ5U2VsZWN0b3IoJ1tuYW1lPWFtb3VudF0nKS52YWx1ZSA9IHByaWNlICogbnVtYmVyO1xyXG4gIH07XHJcbiAgY29uc3Qgc2V0VG90YWwgPSAoKSA9PiB7XHJcbiAgICBjb25zdCB0b3RhbCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJ1tuYW1lPWFtb3VudF0nKTtcclxuICAgIGxldCBnZXRUb3RhbCA9IDA7XHJcbiAgICB0b3RhbC5mb3JFYWNoKChlKSA9PiB7XHJcbiAgICAgIGdldFRvdGFsICs9ICtlLnZhbHVlO1xyXG4gICAgfSk7XHJcbiAgICBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcjdG90YWwtcHJpY2UnKS50ZXh0Q29udGVudCA9IGdldFRvdGFsO1xyXG4gIH07XHJcbiAgXHJcbiAgY29uc3QgZGVsSXRlbSA9ICgpID0+IHtcclxuICAgIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJy5kZWxJdGVtJykuZm9yRWFjaCgoZSwgaSkgPT4ge1xyXG4gICAgICBlLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgZnVuY3Rpb24gKGUpIHtcclxuICAgICAgICBpZiAoZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnW2RhdGEtaXRlbV0nKS5sZW5ndGggPiAyKSB7XHJcbiAgICAgICAgICBjb25zb2xlLmxvZygnZGVsJywgZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnW2RhdGEtaXRlbV0nKS5sZW5ndGgpO1xyXG4gICAgICAgICAgdGhpcy5wYXJlbnRFbGVtZW50LnBhcmVudEVsZW1lbnQucmVtb3ZlKCk7XHJcbiAgICAgICAgICBzZXRUb3RhbCgpO1xyXG4gICAgICAgIH1cclxuICAgICAgfSk7XHJcbiAgICB9KTtcclxuICB9O1xyXG5cclxuICBjb25zdCB1cGRhdGVEb20gPSAoKSA9PiB7XHJcbiAgICBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCdbZGF0YS1pdGVtXScpLmZvckVhY2goKGVsZW1lbnQsIGluZGV4KSA9PiB7XHJcbiAgICAgIGVsZW1lbnQucXVlcnlTZWxlY3RvcignW25hbWU9cHJpY2VdJykuYWRkRXZlbnRMaXN0ZW5lcignY2hhbmdlJywgKGV2KSA9PiB7XHJcbiAgICAgICAgc2V0QW1vdW50KGVsZW1lbnQpO1xyXG4gICAgICAgIHNldFRvdGFsKCk7XHJcbiAgICAgIH0pO1xyXG5cclxuICAgICAgZWxlbWVudFxyXG4gICAgICAgIC5xdWVyeVNlbGVjdG9yKCdbbmFtZT1udW1iZXJdJylcclxuICAgICAgICAuYWRkRXZlbnRMaXN0ZW5lcignY2hhbmdlJywgKGV2KSA9PiB7XHJcbiAgICAgICAgICBzZXRBbW91bnQoZWxlbWVudCk7XHJcbiAgICAgICAgICBzZXRUb3RhbCgpO1xyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgZGVsSXRlbSgpO1xyXG4gICAgfSk7XHJcbiAgfTtcclxuXHJcbiAgY29uc3QgY3JlYXRlSXRlbSA9IChkYXRhKSA9PiB7XHJcbiAgICByZXR1cm4gZGF0YS5tYXAoXHJcbiAgICAgIChlKSA9PlxyXG4gICAgICAgIGBcclxuICAgICAgICA8dHI+XHJcbiAgICAgICAgICA8dGQgY2xhc3M9XCJ0ZXh0LWxlZnRcIj4ke2UuY2F0ZWdvcnl9PC90ZD5cclxuICAgICAgICAgIDx0ZCBjbGFzcz1cInRleHQtbGVmdFwiPiR7ZS5pdGVtfTwvdGQ+XHJcbiAgICAgICAgICA8dGQ+JHtlLnByaWNlfTwvdGQ+XHJcbiAgICAgICAgICA8dGQ+JHtlLm51bWJlcn08L3RkPlxyXG4gICAgICAgICAgPHRkIGNsYXNzPVwicHJpY2VcIj4ke2UuYW1vdW50fTwvdGQ+XHJcbiAgICAgICAgPC90cj4gXHJcbiAgICAgIGBcclxuICAgICk7XHJcbiAgfTtcclxuICBjb25zdCBjcmVhdGVNb2RhbCA9IChkYXRhKSA9PiB7XHJcbiAgICByZXR1cm4gYFxyXG4gICAgICA8ZGl2IGNsYXNzPVwidGFibGUtcmVzcG9uc2l2ZVwiPlxyXG4gICAgICAgIDx0YWJsZSBjbGFzcz1cInRhYmxlIHRhYmxlLXZjZW50ZXJcIj5cclxuICAgICAgICAgIDx0cj5cclxuICAgICAgICAgICAgPHRoPuWgseWDueS6uuWToTwvdGg+XHJcbiAgICAgICAgICAgIDx0ZD4ke2RhdGEubmFtZX08L3RkPlxyXG4gICAgICAgICAgPC90cj5cclxuICAgICAgICAgIDx0cj5cclxuICAgICAgICAgICAgPHRoPuiBr+e1oembu+ipsTwvdGg+XHJcbiAgICAgICAgICAgIDx0ZD4ke2RhdGEucGhvbmV9PC90ZD5cclxuICAgICAgICAgIDwvdHI+XHJcbiAgICAgICAgICA8dHI+XHJcbiAgICAgICAgICAgIDx0aD5FLU1haWw8L3RoPlxyXG4gICAgICAgICAgICA8dGQ+JHtkYXRhLmVtYWlsfTwvdGQ+XHJcbiAgICAgICAgICA8L3RyPlxyXG4gICAgICAgIDwvdGFibGU+XHJcbiAgICAgICAgPHRhYmxlIGNsYXNzPVwidGFibGUgdGFibGUtdmNlbnRlclwiPlxyXG4gICAgICAgICAgPHRoZWFkPlxyXG4gICAgICAgICAgICA8dHI+XHJcbiAgICAgICAgICAgICAgPHRoPumhnuWIpTwvdGg+XHJcbiAgICAgICAgICAgICAgPHRoPumgheebrjwvdGg+XHJcbiAgICAgICAgICAgICAgPHRoPuWWruWDuTwvdGg+XHJcbiAgICAgICAgICAgICAgPHRoPuaVuOmHjyAvIOmggTwvdGg+XHJcbiAgICAgICAgICAgICAgPHRoPumHkemhjTwvdGg+XHJcbiAgICAgICAgICAgIDwvdHI+XHJcbiAgICAgICAgICA8L3RoZWFkPlxyXG4gICAgICAgICAgPHRib2R5PlxyXG4gICAgICAgICAgICAke2NyZWF0ZUl0ZW0oZGF0YS5pdGVtcykuam9pbignJyl9XHJcbiAgICAgICAgICA8L3Rib2R5PlxyXG4gICAgICAgIDwvdGFibGU+XHJcbiAgICAgIDwvZGl2PlxyXG4gICAgYDtcclxuICB9O1xyXG5cclxuICAvLyB2YWxpZGF0ZSBmb3JtXHJcbiAgY29uc3QgY29uc3RyYWludHMgPSB7XHJcbiAgICBjb21wYW55OiB7XHJcbiAgICAgIHByZXNlbmNlOiB7XHJcbiAgICAgICAgbWVzc2FnZTogJ17oq4vovLjlhaXmpa3kuLvlkI3nqLEnLFxyXG4gICAgICB9LFxyXG4gICAgfSxcclxuICAgIG5hbWU6IHtcclxuICAgICAgcHJlc2VuY2U6IHtcclxuICAgICAgICBtZXNzYWdlOiAnXuiri+i8uOWFpeWgseWDueS6uuWToScsXHJcbiAgICAgIH0sXHJcbiAgICB9LFxyXG4gICAgZW1haWw6IHtcclxuICAgICAgcHJlc2VuY2U6IHtcclxuICAgICAgICBtZXNzYWdlOiAnXuiri+i8uOWFpSBFLU1haWwnLFxyXG4gICAgICB9LFxyXG4gICAgICBlbWFpbDoge1xyXG4gICAgICAgIG1lc3NhZ2U6ICfmoLzlvI/pjK/oqqQnLFxyXG4gICAgICB9LFxyXG4gICAgfSxcclxuICAgIHBob25lOiB7XHJcbiAgICAgIHByZXNlbmNlOiB7XHJcbiAgICAgICAgbWVzc2FnZTogJ17oq4vovLjlhaXoga/ntaHpm7voqbEnLFxyXG4gICAgICB9LFxyXG4gICAgICBmb3JtYXQ6IHtcclxuICAgICAgICBwYXR0ZXJuOiAnXjA5WzAtOV17OH0kJyxcclxuICAgICAgICBtZXNzYWdlOiAnXuaJi+apn+agvOW8j+mMr+iqpCcsXHJcbiAgICAgIH0sXHJcbiAgICB9LFxyXG4gICAgaXRlbToge1xyXG4gICAgICBwcmVzZW5jZToge1xyXG4gICAgICAgIG1lc3NhZ2U6ICde6aCF55uu5ZCN56ix5LiN5b6X54K656m6JyxcclxuICAgICAgfSxcclxuICAgIH0sXHJcbiAgICBwcmljZToge1xyXG4gICAgICBwcmVzZW5jZToge1xyXG4gICAgICAgIG1lc3NhZ2U6ICde5Zau5YO55ZCN56ix5LiN5b6X54K656m6JyxcclxuICAgICAgfSxcclxuICAgIH0sXHJcbiAgfTtcclxuXHJcbiAgY29uc3QgcmVzZXRGb3JtSW5wdXQgPSAoZm9ybUlucHV0KSA9PiB7XHJcbiAgICBmb3JtSW5wdXQuY2xhc3NMaXN0LnJlbW92ZSgnaXMtaW52YWxpZCcpO1xyXG4gICAgZm9ybUlucHV0LnBhcmVudE5vZGUucXVlcnlTZWxlY3RvckFsbCgnLmludmFsaWQtZmVlZGJhY2snKS5mb3JFYWNoKChlbCkgPT4ge1xyXG4gICAgICBlbC5yZW1vdmUoKTtcclxuICAgIH0pO1xyXG4gIH07XHJcblxyXG4gIGNvbnN0IGFkZEVycm9yID0gKGZvcm1JbnB1dCwgZXJyb3IpID0+IHtcclxuICAgIGNvbnN0IGJsb2NrID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7XHJcbiAgICBibG9jay5jbGFzc0xpc3QuYWRkKCdpbnZhbGlkLWZlZWRiYWNrJyk7XHJcbiAgICBibG9jay5pbm5lclRleHQgPSBlcnJvcjtcclxuICAgIGZvcm1JbnB1dC5wYXJlbnROb2RlLmFwcGVuZENoaWxkKGJsb2NrKTtcclxuICB9O1xyXG5cclxuICBjb25zdCBzaG93RXJyb3JzRm9ySW5wdXQgPSAoaW5wdXQsIGVycm9ycykgPT4ge1xyXG4gICAgcmVzZXRGb3JtSW5wdXQoaW5wdXQpO1xyXG4gICAgaWYgKGVycm9ycykge1xyXG4gICAgICBpbnB1dC5jbGFzc0xpc3QuYWRkKCdpcy1pbnZhbGlkJyk7XHJcblxyXG4gICAgICBlcnJvcnMuZm9yRWFjaCgoZXJyKSA9PiB7XHJcbiAgICAgICAgYWRkRXJyb3IoaW5wdXQsIGVycik7XHJcbiAgICAgIH0pO1xyXG4gICAgfVxyXG4gIH07XHJcblxyXG4gIGNvbnN0IHNob3dFcnJvcnMgPSAoZm9ybSwgZXJyb3JzKSA9PiB7XHJcbiAgICBmb3JtLnF1ZXJ5U2VsZWN0b3JBbGwoJ2lucHV0W25hbWVdLCBzZWxlY3RbbmFtZV0nKS5mb3JFYWNoKChpbnB1dCkgPT4ge1xyXG4gICAgICBzaG93RXJyb3JzRm9ySW5wdXQoaW5wdXQsIGVycm9ycyAmJiBlcnJvcnNbaW5wdXQubmFtZV0pO1xyXG4gICAgfSk7XHJcbiAgfTtcclxuXHJcbiAgY29uc3QgaGFuZGxlRm9ybVN1Ym1pdCA9IChmb3JtLCBpbnB1dCkgPT4ge1xyXG4gICAgY29uc29sZS5sb2coJ2hhbmRsZUZvcm1TdWJtaXQnLCBmb3JtLCBmb3JtRGF0YSgpKTtcclxuICAgIGNvbnN0IGVycm9ycyA9IHZhbGlkYXRlKGZvcm0sIGNvbnN0cmFpbnRzKTtcclxuICAgIGlmICghZXJyb3JzKSB7XHJcbiAgICAgIHJldHVybiB0cnVlO1xyXG4gICAgfVxyXG5cclxuICAgIHNob3dFcnJvcnMoZm9ybSwgZXJyb3JzIHx8IHt9KTtcclxuICAgIHJldHVybiBmYWxzZTtcclxuICB9O1xyXG5cclxuICB1cGRhdGVEb20oKTtcclxuXHJcbiAgZm9yICh2YXIgaSA9IDA7IGkgPCBpbnB1dHMubGVuZ3RoOyArK2kpIHtcclxuICAgIGlucHV0cy5pdGVtKGkpLmFkZEV2ZW50TGlzdGVuZXIoJ2NoYW5nZScsIGZ1bmN0aW9uIChldikge1xyXG4gICAgICBjb25zdCBlcnJvcnMgPSB2YWxpZGF0ZShmb3JtLCBjb25zdHJhaW50cykgfHwge307XHJcblxyXG4gICAgICBzaG93RXJyb3JzRm9ySW5wdXQodGhpcywgZXJyb3JzW3RoaXMubmFtZV0pO1xyXG4gICAgfSk7XHJcbiAgfVxyXG5cclxuICAvLyBhZGQgaXRlbSByb3dcclxuICBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcjYWRkSXRlbScpLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgZnVuY3Rpb24gKGUpIHtcclxuICAgIGUucHJldmVudERlZmF1bHQoKTtcclxuICAgIGNvbnN0IHJvdyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJ1tkYXRhLWl0ZW1dJyk7XHJcbiAgICBjb25zdCBuZXdSb3cgPSByb3cuY2xvbmVOb2RlKHRydWUpO1xyXG4gICAgbmV3Um93LnN0eWxlLmRpc3BsYXkgPSAnZmxleCc7XHJcbiAgICBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCdbZGF0YS1pdGVtc10nKS5hcHBlbmQobmV3Um93KTtcclxuICAgIHVwZGF0ZURvbSgpO1xyXG4gIH0pO1xyXG5cclxuICAvLyBvbiBTdWJtaXRcclxuICBtb2RhbC5hZGRFdmVudExpc3RlbmVyKCdzaG93LmJzLm1vZGFsJywgZnVuY3Rpb24gKGUpIHtcclxuICAgIGlmICghaGFuZGxlRm9ybVN1Ym1pdChmb3JtKSkge1xyXG4gICAgICBlLnByZXZlbnREZWZhdWx0KCk7XHJcbiAgICAgIHRoaXMucXVlcnlTZWxlY3RvcignLm1vZGFsLXRpdGxlJykudGV4dENvbnRlbnQgPSAnJztcclxuICAgICAgdGhpcy5xdWVyeVNlbGVjdG9yKCcubW9kYWwtYm9keScpLnRleHRDb250ZW50ID0gJyc7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICBjb25zdCBkYXRhID0gZm9ybURhdGEoKTtcclxuICAgICAgY29uc3QgbW9kYWxUaXRsZSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5tb2RhbC10aXRsZScpO1xyXG4gICAgICBjb25zdCBtb2RhbEJvZHkgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcubW9kYWwtYm9keScpO1xyXG5cclxuICAgICAgbW9kYWxUaXRsZS5hcHBlbmQoZGF0YS5jb21wYW55ICsgJy3loLHlg7nllq4nKTtcclxuICAgICAgbW9kYWxCb2R5Lmluc2VydEFkamFjZW50SFRNTCgnYmVmb3JlZW5kJywgY3JlYXRlTW9kYWwoZGF0YSkpO1xyXG4gICAgfVxyXG4gIH0pO1xyXG5cclxuICBtb2RhbC5hZGRFdmVudExpc3RlbmVyKCdoaWRkZW4uYnMubW9kYWwnLCBmdW5jdGlvbiAoZSkge1xyXG4gICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xyXG4gICAgdGhpcy5xdWVyeVNlbGVjdG9yKCcubW9kYWwtdGl0bGUnKS50ZXh0Q29udGVudCA9ICcnO1xyXG4gICAgdGhpcy5xdWVyeVNlbGVjdG9yKCcubW9kYWwtYm9keScpLnRleHRDb250ZW50ID0gJyc7XHJcbiAgfSk7XHJcblxyXG4gIC8vIFByaW50XHJcbiAgY29uc3QgcHJpbnRTY3JlZW4gPSAocHJpbnQpID0+IHtcclxuICAgIGNvbnN0IHByaW50QXJlYSA9IHByaW50LmlubmVySFRNTDtcclxuICAgIGNvbnN0IHByaW50UGFnZSA9IHdpbmRvdy5vcGVuKCcnLCAnUHJpbnRpbmcuLi4nLCAnJyk7XHJcbiAgICBwcmludFBhZ2UuZG9jdW1lbnQub3BlbigpO1xyXG4gICAgcHJpbnRQYWdlLmRvY3VtZW50LndyaXRlKFxyXG4gICAgICBgPGh0bWw+XHJcbiAgICAgICAgPGhlYWQ+XHJcbiAgICAgICAgPG1ldGEgY2hhcnNldD1cIlVURi04XCIgLz5cclxuICAgICAgICA8bWV0YSBodHRwLWVxdWl2PVwiWC1VQS1Db21wYXRpYmxlXCIgY29udGVudD1cIklFPWVkZ2VcIiAvPlxyXG4gICAgICAgIDxtZXRhIG5hbWU9XCJ2aWV3cG9ydFwiIGNvbnRlbnQ9XCJ3aWR0aD1kZXZpY2Utd2lkdGgsIGluaXRpYWwtc2NhbGU9MS4wXCIgLz5cclxuICAgICAgICAgIDx0aXRsZT7loLHlg7nllq7nlKLnlJ/lmag8L3RpdGxlPlxyXG4gICAgICAgICAgPGxpbmsgcmVsPVwic3R5bGVzaGVldFwiIGhyZWY9XCJodHRwczovL3VucGtnLmNvbS9AdGFibGVyL2NvcmVAbGF0ZXN0L2Rpc3QvY3NzL3RhYmxlci5taW4uY3NzXCIvPlxyXG4gICAgICAgIDwvaGVhZD5cclxuICAgICAgICA8Ym9keSBvbmxvYWQ9J3dpbmRvdy5wcmludCgpO3dpbmRvdy5jbG9zZSgpJz5gXHJcbiAgICApO1xyXG4gICAgcHJpbnRQYWdlLmRvY3VtZW50LndyaXRlKHByaW50QXJlYSk7XHJcbiAgICBwcmludFBhZ2UuZG9jdW1lbnQuY2xvc2UoJzwvYm9keT48L2h0bWw+Jyk7XHJcbiAgfTtcclxuXHJcbiAgZG9jdW1lbnQucXVlcnlTZWxlY3RvcignI3ByaW50JykuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBmdW5jdGlvbiAoKSB7XHJcbiAgICBjb25zdCBub3cgPSBuZXcgRGF0ZSgpLnRvTG9jYWxlRGF0ZVN0cmluZygpO1xyXG4gICAgY29uc3QgcHJpbnRIdG1sID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLm1vZGFsLWRpYWxvZyAubW9kYWwtY29udGVudCcpO1xyXG5cclxuICAgIGNvbnN0IG5ld1ByaW50SHRtbCA9IHByaW50SHRtbC5jbG9uZU5vZGUodHJ1ZSk7XHJcbiAgICBuZXdQcmludEh0bWwucXVlcnlTZWxlY3RvcignLm1vZGFsLWZvb3RlcicpLnJlbW92ZSgpO1xyXG4gICAgbmV3UHJpbnRIdG1sLmluc2VydEFkamFjZW50SFRNTChcclxuICAgICAgJ2JlZm9yZWVuZCcsXHJcbiAgICAgIGA8cCBzdHlsZT1cInRleHQtYWxpZ246IHJpZ2h0O1wiPuWgseWDueaZgumWk++8miR7bm93fTwvcD5gXHJcbiAgICApO1xyXG5cclxuICAgIHByaW50U2NyZWVuKG5ld1ByaW50SHRtbCk7XHJcbiAgfSk7XHJcbn0pKCk7XHJcbiJdLCJmaWxlIjoibWFpbi5qcyJ9
