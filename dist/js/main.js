"use strict";

(function () {
  var $modal = document.querySelector('#modal');
  var $preview = document.querySelector('#preview');
  var $form = document.querySelector('form#form');
  var $inputs = document.querySelectorAll('input, textarea, select'); // common fn

  var _common = common(),
      setAmount = _common.setAmount,
      setTotal = _common.setTotal; // validate


  var _verify = verify(),
      constraints = _verify.constraints,
      setItemFormValidate = _verify.setItemFormValidate,
      showErrorsForInput = _verify.showErrorsForInput,
      handleFormSubmit = _verify.handleFormSubmit; // modal view


  var _modalView = modalView(),
      createModal = _modalView.createModal;

  var delItem = function delItem(row) {
    row.querySelector('.delItem').addEventListener('click', function (e) {
      e.preventDefault();

      if (document.querySelectorAll('[data-item]').length > 1) {
        this.parentElement.parentElement.remove();
        setTotal();
      }

      setItemFormValidate();
    });
  };

  var updateItemRow = function updateItemRow(row) {
    row.querySelectorAll('input').forEach(function (e, i) {
      e.addEventListener('change', function (ev) {
        setAmount(row);
        setTotal();
        var errors = validate($form, constraints) || {};
        showErrorsForInput(e, errors[e.name]);
      });
    });
    delItem(row);
  };
  /**
   * formData
   * @returns 表單資料
   */


  var formData = function formData() {
    var _$form$querySelector;

    var logoFile = (_$form$querySelector = $form.querySelector('[name=logo]')) === null || _$form$querySelector === void 0 ? void 0 : _$form$querySelector.files[0];
    var getLogo = !!logoFile ? URL.createObjectURL(logoFile) : null;
    var data = {
      logo: getLogo,
      company: $form.querySelector('[name=company]').value,
      taxID: $form.querySelector('[name=taxID]').value,
      name: $form.querySelector('[name=name]').value,
      phone: $form.querySelector('[name=phone]').value,
      email: $form.querySelector('[name=email]').value,
      startDate: $form.querySelector('[name=startDate]').value,
      endDate: $form.querySelector('[name=endDate]').value,
      desc: $form.querySelector('[name=desc]').value,
      total: $form.querySelector('#total-price').textContent,
      items: []
    };
    $form.querySelectorAll('[data-item]').forEach(function (e, index) {
      data.items.push({
        category: e.querySelector("[name*=category").value,
        item: e.querySelector("[name*=item").value,
        price: e.querySelector("[name*=price").value,
        count: e.querySelector("[name*=count").value,
        unit: e.querySelector("[name*=unit").value,
        amount: e.querySelector("[name*=amount]").value
      });
    });
    return data;
  };

  var exportTemplate = function exportTemplate(tmp) {
    var data = formData();
    var modalBody = tmp.querySelector('.modal-main');
    modalBody.insertAdjacentHTML('beforeend', createModal(data));
  };

  var resetExportTemplate = function resetExportTemplate(tmp) {
    tmp.querySelector('.modal-main').textContent = '';
  }; //======== document init ========


  $form.querySelectorAll('[data-item]').forEach(function (e) {
    updateItemRow(e);
    setItemFormValidate();
  });
  $inputs.forEach(function (e, i) {
    e.addEventListener('change', function (ev) {
      var errors = validate($form, constraints) || {};
      showErrorsForInput(e, errors[e.name]);
    });
  }); // add item row

  $form.querySelector('#addItem').addEventListener('click', function (e) {
    e.preventDefault();
    var row = $form.querySelector('[data-item]');
    var newRow = row.cloneNode(true);
    newRow.querySelectorAll('input').forEach(function (e) {
      e.value = e.defaultValue;
      e.classList.remove('is-invalid');
      e.parentNode.querySelectorAll('.invalid-feedback').forEach(function (el) {
        el.remove();
      });
    });
    $form.querySelector('[data-items]').append(newRow);
    updateItemRow(newRow);
    setItemFormValidate();
  }); // on preview

  $preview.addEventListener('show.bs.modal', function (e) {
    exportTemplate(this);
  });
  $preview.addEventListener('hidden.bs.modal', function (e) {
    e.preventDefault();
    resetExportTemplate(this);
  }); // on Submit

  $modal.addEventListener('show.bs.modal', function (e) {
    if (!handleFormSubmit($form)) {
      e.preventDefault();
      this.querySelector('.modal-title').textContent = '';
      this.querySelector('.modal-body').textContent = '';
    } else {
      exportTemplate(this);
    }
  });
  $modal.addEventListener('hidden.bs.modal', function (e) {
    e.preventDefault();
    resetExportTemplate(this);
  }); // =========== Export ============

  $modal.querySelector('#exportImage').addEventListener('click', function () {
    var preview = $modal.querySelector('.modal-content'); // export Image

    html2canvas(preview).then(function (canvas) {
      document.body.appendChild(canvas);
      var $a = document.createElement('a');
      $a.href = canvas.toDataURL('image/jpeg').replace('image/jpeg', 'image/octet-stream');
      $a.download = ''.concat(new Date().toLocaleString('roc', {
        hour12: false
      }), '_quotation.jpg');
      $a.click();
    });
  }); // =========== Print ==============

  var printScreen = function printScreen(print) {
    var printArea = print.innerHTML;
    var printPage = window.open('', 'Printing...', '');
    printPage.document.open();
    printPage.document.write("<html>\n        <head>\n        <meta charset=\"UTF-8\" />\n        <meta http-equiv=\"X-UA-Compatible\" content=\"IE=edge\" />\n        <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\" />\n          <title>\u5831\u50F9\u55AE\u7522\u751F\u5668</title>\n          <link rel=\"stylesheet\" href=\"https://unpkg.com/@tabler/core@latest/dist/css/tabler.min.css\"/>\n        </head>\n        <body onload='window.print();window.close()'>");
    printPage.document.write(printArea);
    printPage.document.close('</body></html>');
  };

  $modal.querySelector('#print').addEventListener('click', function () {
    var now = new Date().toLocaleString('roc', {
      hour12: false
    });
    var printHtml = $modal.querySelector('.modal-dialog .modal-content');
    var newPrintHtml = printHtml.cloneNode(true);
    newPrintHtml.querySelector('.modal-footer').remove();
    newPrintHtml.insertAdjacentHTML('beforeend', "<p style=\"text-align: right;\">\u5217\u5370\u6642\u9593\uFF1A".concat(now, "</p>"));
    printScreen(newPrintHtml);
  });
})();
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm1haW4uanMiXSwibmFtZXMiOlsiJG1vZGFsIiwiZG9jdW1lbnQiLCJxdWVyeVNlbGVjdG9yIiwiJHByZXZpZXciLCIkZm9ybSIsIiRpbnB1dHMiLCJxdWVyeVNlbGVjdG9yQWxsIiwiY29tbW9uIiwic2V0QW1vdW50Iiwic2V0VG90YWwiLCJ2ZXJpZnkiLCJjb25zdHJhaW50cyIsInNldEl0ZW1Gb3JtVmFsaWRhdGUiLCJzaG93RXJyb3JzRm9ySW5wdXQiLCJoYW5kbGVGb3JtU3VibWl0IiwibW9kYWxWaWV3IiwiY3JlYXRlTW9kYWwiLCJkZWxJdGVtIiwicm93IiwiYWRkRXZlbnRMaXN0ZW5lciIsImUiLCJwcmV2ZW50RGVmYXVsdCIsImxlbmd0aCIsInBhcmVudEVsZW1lbnQiLCJyZW1vdmUiLCJ1cGRhdGVJdGVtUm93IiwiZm9yRWFjaCIsImkiLCJldiIsImVycm9ycyIsInZhbGlkYXRlIiwibmFtZSIsImZvcm1EYXRhIiwibG9nb0ZpbGUiLCJmaWxlcyIsImdldExvZ28iLCJVUkwiLCJjcmVhdGVPYmplY3RVUkwiLCJkYXRhIiwibG9nbyIsImNvbXBhbnkiLCJ2YWx1ZSIsInRheElEIiwicGhvbmUiLCJlbWFpbCIsInN0YXJ0RGF0ZSIsImVuZERhdGUiLCJkZXNjIiwidG90YWwiLCJ0ZXh0Q29udGVudCIsIml0ZW1zIiwiaW5kZXgiLCJwdXNoIiwiY2F0ZWdvcnkiLCJpdGVtIiwicHJpY2UiLCJjb3VudCIsInVuaXQiLCJhbW91bnQiLCJleHBvcnRUZW1wbGF0ZSIsInRtcCIsIm1vZGFsQm9keSIsImluc2VydEFkamFjZW50SFRNTCIsInJlc2V0RXhwb3J0VGVtcGxhdGUiLCJuZXdSb3ciLCJjbG9uZU5vZGUiLCJkZWZhdWx0VmFsdWUiLCJjbGFzc0xpc3QiLCJwYXJlbnROb2RlIiwiZWwiLCJhcHBlbmQiLCJwcmV2aWV3IiwiaHRtbDJjYW52YXMiLCJ0aGVuIiwiY2FudmFzIiwiYm9keSIsImFwcGVuZENoaWxkIiwiJGEiLCJjcmVhdGVFbGVtZW50IiwiaHJlZiIsInRvRGF0YVVSTCIsInJlcGxhY2UiLCJkb3dubG9hZCIsImNvbmNhdCIsIkRhdGUiLCJ0b0xvY2FsZVN0cmluZyIsImhvdXIxMiIsImNsaWNrIiwicHJpbnRTY3JlZW4iLCJwcmludCIsInByaW50QXJlYSIsImlubmVySFRNTCIsInByaW50UGFnZSIsIndpbmRvdyIsIm9wZW4iLCJ3cml0ZSIsImNsb3NlIiwibm93IiwicHJpbnRIdG1sIiwibmV3UHJpbnRIdG1sIl0sIm1hcHBpbmdzIjoiOztBQUFBLENBQUMsWUFBWTtBQUNYLE1BQU1BLE1BQU0sR0FBR0MsUUFBUSxDQUFDQyxhQUFULENBQXVCLFFBQXZCLENBQWY7QUFDQSxNQUFNQyxRQUFRLEdBQUdGLFFBQVEsQ0FBQ0MsYUFBVCxDQUF1QixVQUF2QixDQUFqQjtBQUNBLE1BQU1FLEtBQUssR0FBR0gsUUFBUSxDQUFDQyxhQUFULENBQXVCLFdBQXZCLENBQWQ7QUFDQSxNQUFNRyxPQUFPLEdBQUdKLFFBQVEsQ0FBQ0ssZ0JBQVQsQ0FBMEIseUJBQTFCLENBQWhCLENBSlcsQ0FNWDs7QUFOVyxnQkFPcUJDLE1BQU0sRUFQM0I7QUFBQSxNQU9IQyxTQVBHLFdBT0hBLFNBUEc7QUFBQSxNQU9RQyxRQVBSLFdBT1FBLFFBUFIsRUFTWDs7O0FBVFcsZ0JBZVBDLE1BQU0sRUFmQztBQUFBLE1BV1RDLFdBWFMsV0FXVEEsV0FYUztBQUFBLE1BWVRDLG1CQVpTLFdBWVRBLG1CQVpTO0FBQUEsTUFhVEMsa0JBYlMsV0FhVEEsa0JBYlM7QUFBQSxNQWNUQyxnQkFkUyxXQWNUQSxnQkFkUyxFQWlCWDs7O0FBakJXLG1CQWtCYUMsU0FBUyxFQWxCdEI7QUFBQSxNQWtCSEMsV0FsQkcsY0FrQkhBLFdBbEJHOztBQW9CWCxNQUFNQyxPQUFPLEdBQUcsU0FBVkEsT0FBVSxDQUFDQyxHQUFELEVBQVM7QUFDdkJBLElBQUFBLEdBQUcsQ0FBQ2hCLGFBQUosQ0FBa0IsVUFBbEIsRUFBOEJpQixnQkFBOUIsQ0FBK0MsT0FBL0MsRUFBd0QsVUFBVUMsQ0FB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QSxNQUFNLENBQUNFLGFBQVAsQ0FBcUIsUUFBckIsRUFBK0JpQixnQkFBL0IsQ0FBZ0QsT0FBaEQsRUFBeUQsWUFBWTtBQUNuRSxRQUFNOEUsR0FBRyxHQUFHLElBQUliLElBQUosR0FBV0MsY0FBWCxDQUEwQixLQUExQixFQUFpQztBQUFFQyxNQUFBQSxNQUFNLEVBQUU7QUFBVixLQUFqQyxDQUFaO0FBQ0EsUUFBTVksU0FBUyxHQUFHbEcsTUFBTSxDQUFDRSxhQUFQLENBQ2hCLDhCQURnQixDQUFsQjtBQUdBLFFBQU1pRyxZQUFZLEdBQUdELFNBQVMsQ0FBQ2pDLFNBQVYsQ0FBb0IsSUFBcEIsQ0FBckI7QUFDQWtDLElBQUFBLFlBQVksQ0FBQ2pHLGFBQWIsQ0FBMkIsZUFBM0IsRUFBNENzQixNQUE1QztBQUNBMkUsSUFBQUEsWUFBWSxDQUFDckMsa0JBQWIsQ0FDRSxXQURGLDBFQUV3Q21DLEdBRnhDO0FBSUFULElBQUFBLFdBQVcsQ0FBQ1csWUFBRCxDQUFYO0FBQ0QsR0FaRDtBQWFELENBcE1EIiwic291cmNlc0NvbnRlbnQiOlsiKGZ1bmN0aW9uICgpIHtcclxuICBjb25zdCAkbW9kYWwgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcjbW9kYWwnKTtcclxuICBjb25zdCAkcHJldmlldyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJyNwcmV2aWV3Jyk7XHJcbiAgY29uc3QgJGZvcm0gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCdmb3JtI2Zvcm0nKTtcclxuICBjb25zdCAkaW5wdXRzID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnaW5wdXQsIHRleHRhcmVhLCBzZWxlY3QnKTtcclxuXHJcbiAgLy8gY29tbW9uIGZuXHJcbiAgY29uc3QgeyBzZXRBbW91bnQsIHNldFRvdGFsIH0gPSBjb21tb24oKTtcclxuXHJcbiAgLy8gdmFsaWRhdGVcclxuICBjb25zdCB7XHJcbiAgICBjb25zdHJhaW50cyxcclxuICAgIHNldEl0ZW1Gb3JtVmFsaWRhdGUsXHJcbiAgICBzaG93RXJyb3JzRm9ySW5wdXQsXHJcbiAgICBoYW5kbGVGb3JtU3VibWl0LFxyXG4gIH0gPSB2ZXJpZnkoKTtcclxuXHJcbiAgLy8gbW9kYWwgdmlld1xyXG4gIGNvbnN0IHsgY3JlYXRlTW9kYWwgfSA9IG1vZGFsVmlldygpO1xyXG5cclxuICBjb25zdCBkZWxJdGVtID0gKHJvdykgPT4ge1xyXG4gICAgcm93LnF1ZXJ5U2VsZWN0b3IoJy5kZWxJdGVtJykuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBmdW5jdGlvbiAoZSkge1xyXG4gICAgICBlLnByZXZlbnREZWZhdWx0KCk7XHJcbiAgICAgIGlmIChkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCdbZGF0YS1pdGVtXScpLmxlbmd0aCA+IDEpIHtcclxuICAgICAgICB0aGlzLnBhcmVudEVsZW1lbnQucGFyZW50RWxlbWVudC5yZW1vdmUoKTtcclxuICAgICAgICBzZXRUb3RhbCgpO1xyXG4gICAgICB9XHJcbiAgICAgIHNldEl0ZW1Gb3JtVmFsaWRhdGUoKTtcclxuICAgIH0pO1xyXG4gIH07XHJcblxyXG4gIGNvbnN0IHVwZGF0ZUl0ZW1Sb3cgPSAocm93KSA9PiB7XHJcbiAgICByb3cucXVlcnlTZWxlY3RvckFsbCgnaW5wdXQnKS5mb3JFYWNoKChlLCBpKSA9PiB7XHJcbiAgICAgIGUuYWRkRXZlbnRMaXN0ZW5lcignY2hhbmdlJywgKGV2KSA9PiB7XHJcbiAgICAgICAgc2V0QW1vdW50KHJvdyk7XHJcbiAgICAgICAgc2V0VG90YWwoKTtcclxuICAgICAgICBjb25zdCBlcnJvcnMgPSB2YWxpZGF0ZSgkZm9ybSwgY29uc3RyYWludHMpIHx8IHt9O1xyXG4gICAgICAgIHNob3dFcnJvcnNGb3JJbnB1dChlLCBlcnJvcnNbZS5uYW1lXSk7XHJcbiAgICAgIH0pO1xyXG4gICAgfSk7XHJcbiAgICBkZWxJdGVtKHJvdyk7XHJcbiAgfTtcclxuXHJcbiAgLyoqXHJcbiAgICogZm9ybURhdGFcclxuICAgKiBAcmV0dXJucyDooajllq7os4fmlplcclxuICAgKi9cclxuICBjb25zdCBmb3JtRGF0YSA9IGZ1bmN0aW9uICgpIHtcclxuICAgIGNvbnN0IGxvZ29GaWxlID0gJGZvcm0ucXVlcnlTZWxlY3RvcignW25hbWU9bG9nb10nKT8uZmlsZXNbMF07XHJcbiAgICBjb25zdCBnZXRMb2dvID0gISFsb2dvRmlsZSA/IFVSTC5jcmVhdGVPYmplY3RVUkwobG9nb0ZpbGUpIDogbnVsbDtcclxuXHJcbiAgICBjb25zdCBkYXRhID0ge1xyXG4gICAgICBsb2dvOiBnZXRMb2dvLFxyXG4gICAgICBjb21wYW55OiAkZm9ybS5xdWVyeVNlbGVjdG9yKCdbbmFtZT1jb21wYW55XScpLnZhbHVlLFxyXG4gICAgICB0YXhJRDogJGZvcm0ucXVlcnlTZWxlY3RvcignW25hbWU9dGF4SURdJykudmFsdWUsXHJcbiAgICAgIG5hbWU6ICRmb3JtLnF1ZXJ5U2VsZWN0b3IoJ1tuYW1lPW5hbWVdJykudmFsdWUsXHJcbiAgICAgIHBob25lOiAkZm9ybS5xdWVyeVNlbGVjdG9yKCdbbmFtZT1waG9uZV0nKS52YWx1ZSxcclxuICAgICAgZW1haWw6ICRmb3JtLnF1ZXJ5U2VsZWN0b3IoJ1tuYW1lPWVtYWlsXScpLnZhbHVlLFxyXG4gICAgICBzdGFydERhdGU6ICRmb3JtLnF1ZXJ5U2VsZWN0b3IoJ1tuYW1lPXN0YXJ0RGF0ZV0nKS52YWx1ZSxcclxuICAgICAgZW5kRGF0ZTogJGZvcm0ucXVlcnlTZWxlY3RvcignW25hbWU9ZW5kRGF0ZV0nKS52YWx1ZSxcclxuICAgICAgZGVzYzogJGZvcm0ucXVlcnlTZWxlY3RvcignW25hbWU9ZGVzY10nKS52YWx1ZSxcclxuICAgICAgdG90YWw6ICRmb3JtLnF1ZXJ5U2VsZWN0b3IoJyN0b3RhbC1wcmljZScpLnRleHRDb250ZW50LFxyXG4gICAgICBpdGVtczogW10sXHJcbiAgICB9O1xyXG5cclxuICAgICRmb3JtLnF1ZXJ5U2VsZWN0b3JBbGwoJ1tkYXRhLWl0ZW1dJykuZm9yRWFjaCgoZSwgaW5kZXgpID0+IHtcclxuICAgICAgZGF0YS5pdGVtcy5wdXNoKHtcclxuICAgICAgICBjYXRlZ29yeTogZS5xdWVyeVNlbGVjdG9yKGBbbmFtZSo9Y2F0ZWdvcnlgKS52YWx1ZSxcclxuICAgICAgICBpdGVtOiBlLnF1ZXJ5U2VsZWN0b3IoYFtuYW1lKj1pdGVtYCkudmFsdWUsXHJcbiAgICAgICAgcHJpY2U6IGUucXVlcnlTZWxlY3RvcihgW25hbWUqPXByaWNlYCkudmFsdWUsXHJcbiAgICAgICAgY291bnQ6IGUucXVlcnlTZWxlY3RvcihgW25hbWUqPWNvdW50YCkudmFsdWUsXHJcbiAgICAgICAgdW5pdDogZS5xdWVyeVNlbGVjdG9yKGBbbmFtZSo9dW5pdGApLnZhbHVlLFxyXG4gICAgICAgIGFtb3VudDogZS5xdWVyeVNlbGVjdG9yKGBbbmFtZSo9YW1vdW50XWApLnZhbHVlLFxyXG4gICAgICB9KTtcclxuICAgIH0pO1xyXG4gICAgcmV0dXJuIGRhdGE7XHJcbiAgfTtcclxuXHJcbiAgY29uc3QgZXhwb3J0VGVtcGxhdGUgPSBmdW5jdGlvbih0bXApIHtcclxuICAgIGNvbnN0IGRhdGEgPSBmb3JtRGF0YSgpO1xyXG4gICAgY29uc3QgbW9kYWxCb2R5ID0gdG1wLnF1ZXJ5U2VsZWN0b3IoJy5tb2RhbC1tYWluJyk7XHJcblxyXG4gICAgbW9kYWxCb2R5Lmluc2VydEFkamFjZW50SFRNTCgnYmVmb3JlZW5kJywgY3JlYXRlTW9kYWwoZGF0YSkpO1xyXG4gIH07XHJcbiAgY29uc3QgcmVzZXRFeHBvcnRUZW1wbGF0ZSA9IGZ1bmN0aW9uKHRtcCkge1xyXG4gICAgdG1wLnF1ZXJ5U2VsZWN0b3IoJy5tb2RhbC1tYWluJykudGV4dENvbnRlbnQgPSAnJztcclxuICB9XHJcblxyXG4gIC8vPT09PT09PT0gZG9jdW1lbnQgaW5pdCA9PT09PT09PVxyXG4gIFxyXG4gICRmb3JtLnF1ZXJ5U2VsZWN0b3JBbGwoJ1tkYXRhLWl0ZW1dJykuZm9yRWFjaCgoZSkgPT4ge1xyXG4gICAgdXBkYXRlSXRlbVJvdyhlKTtcclxuICAgIHNldEl0ZW1Gb3JtVmFsaWRhdGUoKTtcclxuICB9KTtcclxuXHJcbiAgJGlucHV0cy5mb3JFYWNoKChlLCBpKSA9PiB7XHJcbiAgICBlLmFkZEV2ZW50TGlzdGVuZXIoJ2NoYW5nZScsIChldikgPT4ge1xyXG4gICAgICBjb25zdCBlcnJvcnMgPSB2YWxpZGF0ZSgkZm9ybSwgY29uc3RyYWludHMpIHx8IHt9O1xyXG4gICAgICBzaG93RXJyb3JzRm9ySW5wdXQoZSwgZXJyb3JzW2UubmFtZV0pO1xyXG4gICAgfSk7XHJcbiAgfSk7XHJcblxyXG4gIC8vIGFkZCBpdGVtIHJvd1xyXG4gICRmb3JtLnF1ZXJ5U2VsZWN0b3IoJyNhZGRJdGVtJykuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBmdW5jdGlvbiAoZSkge1xyXG4gICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xyXG4gICAgY29uc3Qgcm93ID0gJGZvcm0ucXVlcnlTZWxlY3RvcignW2RhdGEtaXRlbV0nKTtcclxuICAgIGNvbnN0IG5ld1JvdyA9IHJvdy5jbG9uZU5vZGUodHJ1ZSk7XHJcbiAgICBuZXdSb3cucXVlcnlTZWxlY3RvckFsbCgnaW5wdXQnKS5mb3JFYWNoKChlKSA9PiB7XHJcbiAgICAgIGUudmFsdWUgPSBlLmRlZmF1bHRWYWx1ZTtcclxuICAgICAgZS5jbGFzc0xpc3QucmVtb3ZlKCdpcy1pbnZhbGlkJyk7XHJcbiAgICAgIGUucGFyZW50Tm9kZS5xdWVyeVNlbGVjdG9yQWxsKCcuaW52YWxpZC1mZWVkYmFjaycpLmZvckVhY2goKGVsKSA9PiB7XHJcbiAgICAgICAgZWwucmVtb3ZlKCk7XHJcbiAgICAgIH0pO1xyXG4gICAgfSk7XHJcblxyXG4gICAgJGZvcm0ucXVlcnlTZWxlY3RvcignW2RhdGEtaXRlbXNdJykuYXBwZW5kKG5ld1Jvdyk7XHJcbiAgICB1cGRhdGVJdGVtUm93KG5ld1Jvdyk7XHJcbiAgICBzZXRJdGVtRm9ybVZhbGlkYXRlKCk7XHJcbiAgfSk7XHJcblxyXG4gIC8vIG9uIHByZXZpZXdcclxuICAkcHJldmlldy5hZGRFdmVudExpc3RlbmVyKCdzaG93LmJzLm1vZGFsJywgZnVuY3Rpb24gKGUpIHtcclxuICAgIGV4cG9ydFRlbXBsYXRlKHRoaXMpO1xyXG4gIH0pO1xyXG4gICRwcmV2aWV3LmFkZEV2ZW50TGlzdGVuZXIoJ2hpZGRlbi5icy5tb2RhbCcsIGZ1bmN0aW9uIChlKSB7XHJcbiAgICBlLnByZXZlbnREZWZhdWx0KCk7XHJcbiAgICByZXNldEV4cG9ydFRlbXBsYXRlKHRoaXMpXHJcbiAgfSk7XHJcblxyXG4gIC8vIG9uIFN1Ym1pdFxyXG4gICRtb2RhbC5hZGRFdmVudExpc3RlbmVyKCdzaG93LmJzLm1vZGFsJywgZnVuY3Rpb24gKGUpIHtcclxuICAgIGlmICghaGFuZGxlRm9ybVN1Ym1pdCgkZm9ybSkpIHtcclxuICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xyXG4gICAgICB0aGlzLnF1ZXJ5U2VsZWN0b3IoJy5tb2RhbC10aXRsZScpLnRleHRDb250ZW50ID0gJyc7XHJcbiAgICAgIHRoaXMucXVlcnlTZWxlY3RvcignLm1vZGFsLWJvZHknKS50ZXh0Q29udGVudCA9ICcnO1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgZXhwb3J0VGVtcGxhdGUodGhpcyk7XHJcbiAgICB9XHJcbiAgfSk7XHJcblxyXG4gICRtb2RhbC5hZGRFdmVudExpc3RlbmVyKCdoaWRkZW4uYnMubW9kYWwnLCBmdW5jdGlvbiAoZSkge1xyXG4gICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xyXG4gICAgcmVzZXRFeHBvcnRUZW1wbGF0ZSh0aGlzKTtcclxuICB9KTtcclxuXHJcbiAgLy8gPT09PT09PT09PT0gRXhwb3J0ID09PT09PT09PT09PVxyXG4gICRtb2RhbC5xdWVyeVNlbGVjdG9yKCcjZXhwb3J0SW1hZ2UnKS5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIGZ1bmN0aW9uICgpIHtcclxuICAgIGNvbnN0IHByZXZpZXcgPSAkbW9kYWwucXVlcnlTZWxlY3RvcignLm1vZGFsLWNvbnRlbnQnKTtcclxuICAgIC8vIGV4cG9ydCBJbWFnZVxyXG4gICAgaHRtbDJjYW52YXMocHJldmlldykudGhlbihmdW5jdGlvbiAoY2FudmFzKSB7XHJcbiAgICAgIGRvY3VtZW50LmJvZHkuYXBwZW5kQ2hpbGQoY2FudmFzKTtcclxuICAgICAgY29uc3QgJGEgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdhJyk7XHJcbiAgICAgICRhLmhyZWYgPSBjYW52YXNcclxuICAgICAgICAudG9EYXRhVVJMKCdpbWFnZS9qcGVnJylcclxuICAgICAgICAucmVwbGFjZSgnaW1hZ2UvanBlZycsICdpbWFnZS9vY3RldC1zdHJlYW0nKTtcclxuICAgICAgJGEuZG93bmxvYWQgPSAnJy5jb25jYXQoXHJcbiAgICAgICAgbmV3IERhdGUoKS50b0xvY2FsZVN0cmluZygncm9jJywgeyBob3VyMTI6IGZhbHNlIH0pLFxyXG4gICAgICAgICdfcXVvdGF0aW9uLmpwZydcclxuICAgICAgKTtcclxuICAgICAgJGEuY2xpY2soKTtcclxuICAgIH0pO1xyXG4gIH0pO1xyXG5cclxuICAvLyA9PT09PT09PT09PSBQcmludCA9PT09PT09PT09PT09PVxyXG4gIGNvbnN0IHByaW50U2NyZWVuID0gKHByaW50KSA9PiB7XHJcbiAgICBjb25zdCBwcmludEFyZWEgPSBwcmludC5pbm5lckhUTUw7XHJcbiAgICBjb25zdCBwcmludFBhZ2UgPSB3aW5kb3cub3BlbignJywgJ1ByaW50aW5nLi4uJywgJycpO1xyXG4gICAgcHJpbnRQYWdlLmRvY3VtZW50Lm9wZW4oKTtcclxuICAgIHByaW50UGFnZS5kb2N1bWVudC53cml0ZShcclxuICAgICAgYDxodG1sPlxyXG4gICAgICAgIDxoZWFkPlxyXG4gICAgICAgIDxtZXRhIGNoYXJzZXQ9XCJVVEYtOFwiIC8+XHJcbiAgICAgICAgPG1ldGEgaHR0cC1lcXVpdj1cIlgtVUEtQ29tcGF0aWJsZVwiIGNvbnRlbnQ9XCJJRT1lZGdlXCIgLz5cclxuICAgICAgICA8bWV0YSBuYW1lPVwidmlld3BvcnRcIiBjb250ZW50PVwid2lkdGg9ZGV2aWNlLXdpZHRoLCBpbml0aWFsLXNjYWxlPTEuMFwiIC8+XHJcbiAgICAgICAgICA8dGl0bGU+5aCx5YO55Zau55Si55Sf5ZmoPC90aXRsZT5cclxuICAgICAgICAgIDxsaW5rIHJlbD1cInN0eWxlc2hlZXRcIiBocmVmPVwiaHR0cHM6Ly91bnBrZy5jb20vQHRhYmxlci9jb3JlQGxhdGVzdC9kaXN0L2Nzcy90YWJsZXIubWluLmNzc1wiLz5cclxuICAgICAgICA8L2hlYWQ+XHJcbiAgICAgICAgPGJvZHkgb25sb2FkPSd3aW5kb3cucHJpbnQoKTt3aW5kb3cuY2xvc2UoKSc+YFxyXG4gICAgKTtcclxuICAgIHByaW50UGFnZS5kb2N1bWVudC53cml0ZShwcmludEFyZWEpO1xyXG4gICAgcHJpbnRQYWdlLmRvY3VtZW50LmNsb3NlKCc8L2JvZHk+PC9odG1sPicpO1xyXG4gIH07XHJcblxyXG4gICRtb2RhbC5xdWVyeVNlbGVjdG9yKCcjcHJpbnQnKS5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIGZ1bmN0aW9uICgpIHtcclxuICAgIGNvbnN0IG5vdyA9IG5ldyBEYXRlKCkudG9Mb2NhbGVTdHJpbmcoJ3JvYycsIHsgaG91cjEyOiBmYWxzZSB9KTtcclxuICAgIGNvbnN0IHByaW50SHRtbCA9ICRtb2RhbC5xdWVyeVNlbGVjdG9yKFxyXG4gICAgICAnLm1vZGFsLWRpYWxvZyAubW9kYWwtY29udGVudCdcclxuICAgICk7XHJcbiAgICBjb25zdCBuZXdQcmludEh0bWwgPSBwcmludEh0bWwuY2xvbmVOb2RlKHRydWUpO1xyXG4gICAgbmV3UHJpbnRIdG1sLnF1ZXJ5U2VsZWN0b3IoJy5tb2RhbC1mb290ZXInKS5yZW1vdmUoKTtcclxuICAgIG5ld1ByaW50SHRtbC5pbnNlcnRBZGphY2VudEhUTUwoXHJcbiAgICAgICdiZWZvcmVlbmQnLFxyXG4gICAgICBgPHAgc3R5bGU9XCJ0ZXh0LWFsaWduOiByaWdodDtcIj7liJfljbDmmYLplpPvvJoke25vd308L3A+YFxyXG4gICAgKTtcclxuICAgIHByaW50U2NyZWVuKG5ld1ByaW50SHRtbCk7XHJcbiAgfSk7XHJcbn0pKCk7XHJcbiJdLCJmaWxlIjoibWFpbi5qcyJ9
