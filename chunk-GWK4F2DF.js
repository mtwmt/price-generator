import{a as v,b as fe,c as xe,d as je,e as We,f as X,g as Q}from"./chunk-B23YN7RV.js";import{a as xt}from"./chunk-JBCLUUBB.js";import{A as re,B as se,C as Ct,D as le,E as H,F as ze,G as de,H as Z,I as gt,J as ft,K as ee,L as Oe,M as te,N as ge,e as me,g as ce,i as pe,o as tt,p as it,q as nt,t as Be,v as _e,y as pt,z as _t}from"./chunk-Y7B4C4B3.js";import{$ as C,$a as L,Ab as S,Bb as F,Cb as Me,Db as Ye,Eb as ne,Fb as oe,Gb as ae,Ha as U,Kb as Je,Lb as Ee,M as W,Ma as ue,Mb as ye,Mc as rt,O as J,Ob as Se,Pb as Ze,R as Te,Rc as st,Sb as b,Tb as Ne,Vb as B,W as y,Wb as w,Wc as lt,Xa as c,Xc as dt,Ya as p,Yc as Re,_a as Ge,aa as g,ab as I,ad as ut,bb as _,c as j,cb as r,cd as Ve,db as s,dd as mt,eb as f,ed as ct,fb as T,fd as z,gb as M,gc as qe,gd as O,ha as D,hb as Ke,ic as et,jc as ke,k,kb as be,lb as E,lc as N,mb as K,nb as x,ob as R,pb as u,sc as ot,tc as Le,va as $,wb as ve,wc as at,xb as V,xc as Ie,ya as l,yb as Y,yc as Ce,zb as d}from"./chunk-SGJ3NYEE.js";import{a as Ue,h as A}from"./chunk-FJYW2LMB.js";var kt=(e,o)=>({"border-warning bg-warning/10":e,"border-error bg-error/10":o}),Bt=(e,o)=>({"text-warning":e,"text-error":o});function Lt(e,o){if(e&1){let t=E();r(0,"div",9)(1,"input",11),ae("ngModelChange",function(i){C(t);let a=u();return oe(a.editingName,i)||(a.editingName=i),g(i)}),x("keyup.enter",function(){C(t);let i=u();return g(i.saveEditing())})("keyup.escape",function(){C(t);let i=u();return g(i.cancelEditing())}),s(),r(2,"button",12),x("click",function(){C(t);let i=u();return g(i.saveEditing())}),f(3,"lucide-icon",3),s(),r(4,"button",13),x("click",function(){C(t);let i=u();return g(i.cancelEditing())}),f(5,"lucide-icon",3),s()()}if(e&2){let t=u();l(),ne("ngModel",t.editingName),l(2),_("img",t.Check)("size",16),l(2),_("img",t.X)("size",16)}}function It(e,o){e&1&&(r(0,"span",14),d(1,"\u7BA1\u7406\u54E1"),s())}function Rt(e,o){e&1&&(r(0,"span",15),d(1,"\u8D0A\u52A9\u6703\u54E1"),s())}function Vt(e,o){e&1&&(r(0,"span",16),d(1,"\u514D\u8CBB\u6703\u54E1"),s())}function zt(e,o){if(e&1&&(r(0,"div",10),d(1),r(2,"span"),c(3,It,2,0,"span",14)(4,Rt,2,0,"span",15)(5,Vt,2,0,"span",16),s()()),e&2){let t=u();l(),F(" ",t.userDisplayName()," "),l(2),p(t.isAdmin()?3:t.isPremium()?4:5)}}function Ot(e,o){if(e&1&&(r(0,"div",5),f(1,"lucide-icon",6),r(2,"div")(3,"div",8),d(4,"Email"),s(),r(5,"div",17),d(6),s()()()),e&2){let t=u();l(),_("img",t.Mail)("size",20),l(5),S(t.userEmail())}}function jt(e,o){if(e&1&&(r(0,"div",5),f(1,"lucide-icon",6),r(2,"div")(3,"div",8),d(4,"\u8A3B\u518A\u6642\u9593"),s(),r(5,"div",17),d(6),s()()()),e&2){let t=u();l(),_("img",t.Clock)("size",20),l(5),S(t.formattedCreatedAt())}}function Wt(e,o){if(e&1&&(r(0,"div",20),d(1," \u6703\u54E1\u5373\u5C07\u5230\u671F "),s(),r(2,"div",17),d(3),s()),e&2){let t=u(3);l(3),Me(" \u5230\u671F\u65E5\uFF1A",t.formattedPremiumUntil(),"\uFF08\u5269\u9918 ",t.daysUntilExpiry()," \u5929\uFF09 ")}}function $t(e,o){if(e&1&&(r(0,"div",21),d(1,"\u6703\u54E1\u5DF2\u5230\u671F"),s(),r(2,"div",17),d(3),s()),e&2){let t=u(3);l(3),F(" \u5230\u671F\u65E5\uFF1A",t.formattedPremiumUntil()," ")}}function Ht(e,o){if(e&1&&(r(0,"div",18),f(1,"lucide-icon",19),r(2,"div"),c(3,Wt,4,2)(4,$t,4,1),s()()),e&2){let t=u(2);_("ngClass",Je(5,kt,t.daysUntilExpiry()!==null&&t.daysUntilExpiry()>0,t.daysUntilExpiry()!==null&&t.daysUntilExpiry()<=0)),l(),_("img",t.Calendar)("size",20)("ngClass",Je(8,Bt,t.daysUntilExpiry()!==null&&t.daysUntilExpiry()>0,t.daysUntilExpiry()!==null&&t.daysUntilExpiry()<=0)),l(2),p(t.daysUntilExpiry()!==null&&t.daysUntilExpiry()>0?3:4)}}function Xt(e,o){if(e&1&&(r(0,"span",8),d(1),s()),e&2){let t=u(3);l(),F(" (\u5269\u9918 ",t.daysUntilExpiry()," \u5929) ")}}function Qt(e,o){if(e&1&&(r(0,"div",5),f(1,"lucide-icon",6),r(2,"div")(3,"div",8),d(4,"\u6703\u54E1\u5230\u671F\u65E5"),s(),r(5,"div",17),d(6),c(7,Xt,2,1,"span",8),s()()()),e&2){let t=u(2);l(),_("img",t.Calendar)("size",20),l(5),F(" ",t.formattedPremiumUntil()," "),l(),p(t.daysUntilExpiry()!==null?7:-1)}}function Gt(e,o){if(e&1&&c(0,Ht,5,11,"div",18)(1,Qt,8,4,"div",5),e&2){let t=u();p(t.showExpiryWarning()?0:1)}}var vt=(()=>{let o=class o{constructor(){this.userDisplayName=w.required(),this.userEmail=w(null),this.isPremium=w(!1),this.isAdmin=w(!1),this.formattedCreatedAt=w(null),this.formattedPremiumUntil=w(null),this.daysUntilExpiry=w(null),this.showExpiryWarning=w(!1),this.displayNameChange=B(),this.isEditing=D(!1),this.editingName=D(""),this.Crown=Ce,this.User=Ve,this.Mail=rt,this.Calendar=ot,this.Clock=Ie,this.Pencil=st,this.Check=Le,this.X=ct}startEditing(){this.editingName.set(this.userDisplayName()),this.isEditing.set(!0)}cancelEditing(){this.isEditing.set(!1),this.editingName.set("")}saveEditing(){let n=this.editingName().trim();n&&n!==this.userDisplayName()&&this.displayNameChange.emit(n),this.isEditing.set(!1)}};o.\u0275fac=function(i){return new(i||o)},o.\u0275cmp=U({type:o,selectors:[["app-user-profile"]],inputs:{userDisplayName:[1,"userDisplayName"],userEmail:[1,"userEmail"],isPremium:[1,"isPremium"],isAdmin:[1,"isAdmin"],formattedCreatedAt:[1,"formattedCreatedAt"],formattedPremiumUntil:[1,"formattedPremiumUntil"],daysUntilExpiry:[1,"daysUntilExpiry"],showExpiryWarning:[1,"showExpiryWarning"]},outputs:{displayNameChange:"displayNameChange"},decls:16,vars:8,consts:[[1,"card","bg-base-100","shadow-sm","mb-6"],[1,"card-body"],[1,"card-title","flex","items-center","gap-2"],[3,"img","size"],[1,"grid","grid-cols-1","md:grid-cols-2","gap-4","mt-4"],[1,"flex","items-center","gap-3"],[1,"text-base-content/70",3,"img","size"],[1,"flex-1"],[1,"text-sm","text-base-content/70"],[1,"flex","items-center","gap-2","mt-1"],[1,"font-medium","flex","items-center","gap-2"],["type","text","maxlength","50",1,"input","input-bordered","input-sm","flex-1","max-w-xs",3,"ngModelChange","keyup.enter","keyup.escape","ngModel"],["title","\u4FDD\u5B58",1,"btn","btn-success","btn-sm","btn-square",3,"click"],["title","\u53D6\u6D88",1,"btn","btn-ghost","btn-sm","btn-square",3,"click"],[1,"badge","badge-soft","badge-error","badge-sm"],[1,"badge","badge-soft","badge-warning","badge-sm"],[1,"badge","badge-soft","badge-sm"],[1,"font-medium"],[1,"flex","items-center","gap-3","p-3","rounded-lg","border",3,"ngClass"],[3,"img","size","ngClass"],[1,"text-sm","text-warning","font-semibold"],[1,"text-sm","text-error","font-semibold"]],template:function(i,a){i&1&&(r(0,"div",0)(1,"div",1)(2,"h2",2),f(3,"lucide-icon",3),d(4," \u6703\u54E1\u8CC7\u8A0A "),s(),r(5,"div",4)(6,"div",5),f(7,"lucide-icon",6),r(8,"div",7)(9,"div",8),d(10,"\u4F7F\u7528\u8005\u540D\u7A31"),s(),c(11,Lt,6,5,"div",9)(12,zt,6,2,"div",10),s()(),c(13,Ot,7,3,"div",5),c(14,jt,7,3,"div",5),c(15,Gt,2,1),s()()()),i&2&&(l(3),_("img",a.User)("size",24),l(4),_("img",a.User)("size",20),l(4),p(a.isEditing()?11:12),l(2),p(a.userEmail()?13:-1),l(),p(a.formattedCreatedAt()?14:-1),l(),p(a.formattedPremiumUntil()?15:-1))},dependencies:[N,qe,_e,me,ce,Be,pe,O,z],encapsulation:2});let e=o;return e})();var Et=(()=>{let o=class o{constructor(){this.toastService=y(te),this.submitDonation=B(),this.donationProof=D(null),this.donationNote=D(""),this.Crown=Ce,this.Upload=ut}handleDonationProof(n){if(n.length===0)return;let i=n[0],a=new FileReader;a.onload=()=>{let m=a.result;this.donationProof.set(m)},a.onerror=()=>{this.toastService.error("\u6A94\u6848\u8B80\u53D6\u5931\u6557\uFF0C\u8ACB\u91CD\u8A66")},a.readAsDataURL(i)}onSubmit(){let n=!!this.donationProof(),i=!!this.donationNote().trim();if(!n&&!i){this.toastService.error("\u8ACB\u4E0A\u50B3\u8D0A\u52A9\u6191\u8B49\u6216\u586B\u5BEB\u5099\u8A3B");return}this.submitDonation.emit({proof:this.donationProof()||"",note:this.donationNote()}),this.donationProof.set(null),this.donationNote.set("")}};o.\u0275fac=function(i){return new(i||o)},o.\u0275cmp=U({type:o,selectors:[["app-donation-form"]],outputs:{submitDonation:"submitDonation"},decls:27,vars:11,consts:[[1,"card","bg-base-100","shadow-sm"],[1,"card-body"],[1,"card-title","flex","items-center","gap-2"],[3,"img","size"],[1,"text-base-content/70"],[1,"divider"],[1,"form-control"],[1,"label"],[1,"label-text","font-medium"],[3,"fileSelected","label","supportedFormats","accept","previewUrl"],[1,"form-control","mt-4"],["placeholder","\u8ACB\u8F38\u5165\u5099\u8A3B\uFF0C\u4F8B\u5982\uFF1A\u8F49\u5E33\u5E33\u865F\u5F8C\u4E94\u78BC\u3001\u8D0A\u52A9\u65E5\u671F\u7B49...","maxlength","500",1,"textarea","textarea-bordered","h-24","w-full",3,"ngModelChange","ngModel"],[1,"label","flex","justify-between"],[1,"label-text-alt"],[1,"card-actions","justify-end","mt-4"],["type","button",1,"btn","btn-warning","gap-2",3,"click","disabled"]],template:function(i,a){i&1&&(r(0,"div",0)(1,"div",1)(2,"h2",2),f(3,"lucide-icon",3),d(4," \u5347\u7D1A\u70BA\u8D0A\u52A9\u6703\u54E1 "),s(),r(5,"p",4),d(6," \u611F\u8B1D\u60A8\u7684\u652F\u6301\uFF01\u4E0A\u50B3\u8D0A\u52A9\u6191\u8B49\u5F8C\uFF0C\u6211\u5011\u6703\u5118\u5FEB\u5BE9\u6838\u4E26\u5347\u7D1A\u60A8\u7684\u6703\u54E1\u7B49\u7D1A\u3002 "),s(),f(7,"div",5),r(8,"div",6)(9,"label",7)(10,"span",8),d(11,"\u8D0A\u52A9\u6191\u8B49"),s()(),r(12,"app-file-upload",9),x("fileSelected",function(h){return a.handleDonationProof(h)}),s()(),r(13,"div",10)(14,"label",7)(15,"span",8),d(16,"\u5099\u8A3B"),s()(),r(17,"textarea",11),ae("ngModelChange",function(h){return oe(a.donationNote,h)||(a.donationNote=h),h}),s(),r(18,"label",12)(19,"span",13),d(20,"\u63D0\u4F9B\u66F4\u591A\u8CC7\u8A0A\u6709\u52A9\u65BC\u6211\u5011\u66F4\u5FEB\u5B8C\u6210\u5BE9\u6838"),s(),r(21,"span",13),d(22),s()()(),r(23,"div",14)(24,"button",15),x("click",function(){return a.onSubmit()}),f(25,"lucide-icon",3),d(26," \u63D0\u4EA4\u8D0A\u52A9\u7533\u8ACB "),s()()()()),i&2&&(l(3),_("img",a.Crown)("size",24),l(9),_("label","\u4E0A\u50B3\u8D0A\u52A9\u6191\u8B49\uFF08\u8F49\u5E33\u622A\u5716\u6216\u6536\u64DA\uFF09")("supportedFormats","\u652F\u63F4 PNG\u3001JPG\u3001GIF")("accept","image/gif, image/jpeg, image/png")("previewUrl",a.donationProof()),l(5),ne("ngModel",a.donationNote),l(5),F("",a.donationNote().length," / 500"),l(2),_("disabled",!a.donationProof()&&!a.donationNote().trim()),l(),_("img",a.Upload)("size",18))},dependencies:[N,_e,me,ce,Be,pe,O,z,xt],encapsulation:2});let e=o;return e})();function Jt(e,o){if(e&1&&(T(0,"option",11),d(1),M()),e&2){let t=o.$implicit,n=u(2);K("value",t)("selected",t===n.pageSize()),l(),F(" ",t," ")}}function Kt(e,o){if(e&1){let t=E();T(0,"div",1)(1,"span",9),d(2,"\u6BCF\u9801\u986F\u793A"),M(),T(3,"select",10),R("change",function(i){C(t);let a=u();return g(a.onPageSizeChange(i))}),L(4,Jt,2,3,"option",11,Ge),M(),T(6,"span",9),d(7,"\u7B46"),M()()}if(e&2){let t=u();l(4),I(t.pageSizeOptions())}}function Yt(e,o){if(e&1){let t=E();T(0,"button",12),R("click",function(){let i=C(t).$implicit,a=u();return g(a.goToPage(i))}),d(1),M()}if(e&2){let t=o.$implicit,n=u();Y(n.btnClass()),V("btn-active",t===n.currentPage()),l(),F(" ",t," ")}}function Zt(e,o){if(e&1&&(T(0,"div",8),d(1),M()),e&2){let t=u();l(),Ye(" \u986F\u793A\u7B2C ",t.startIndex()," - ",t.endIndex()," \u7B46\uFF0C\u5171 ",t.totalItems()," \u7B46 ")}}var yt=(()=>{let o=class o{constructor(){this.totalItems=w.required(),this.pageSize=w(10),this.currentPage=w(1),this.pageSizeOptions=w([5,10,20,50]),this.showPageSizeSelector=w(!0),this.showInfo=w(!0),this.maxVisiblePages=w(5),this.size=w("sm"),this.pageChange=B(),this.pageSizeChange=B(),this.totalPages=b(()=>{let n=this.totalItems(),i=this.pageSize();return Math.ceil(n/i)||1}),this.visiblePages=b(()=>{let n=this.totalPages(),i=this.currentPage(),a=this.maxVisiblePages();if(n<=a)return Array.from({length:n},(q,P)=>P+1);let m=Math.max(1,i-Math.floor(a/2)),h=m+a-1;return h>n&&(h=n,m=Math.max(1,h-a+1)),Array.from({length:h-m+1},(q,P)=>m+P)}),this.btnClass=b(()=>`join-item btn ${{xs:"btn-xs",sm:"btn-sm",md:"",lg:"btn-lg"}[this.size()]}`),this.startIndex=b(()=>this.totalItems()===0?0:(this.currentPage()-1)*this.pageSize()+1),this.endIndex=b(()=>{let n=this.currentPage()*this.pageSize();return Math.min(n,this.totalItems())}),this.isFirstPage=b(()=>this.currentPage()<=1),this.isLastPage=b(()=>this.currentPage()>=this.totalPages())}goToPage(n){n>=1&&n<=this.totalPages()&&n!==this.currentPage()&&this.pageChange.emit(n)}goToFirstPage(){this.goToPage(1)}goToLastPage(){this.goToPage(this.totalPages())}goToPreviousPage(){this.goToPage(this.currentPage()-1)}goToNextPage(){this.goToPage(this.currentPage()+1)}onPageSizeChange(n){let i=n.target,a=parseInt(i.value,10);a!==this.pageSize()&&(this.pageSizeChange.emit(a),this.pageChange.emit(1))}};o.\u0275fac=function(i){return new(i||o)},o.\u0275cmp=U({type:o,selectors:[["app-pagination"]],inputs:{totalItems:[1,"totalItems"],pageSize:[1,"pageSize"],currentPage:[1,"currentPage"],pageSizeOptions:[1,"pageSizeOptions"],showPageSizeSelector:[1,"showPageSizeSelector"],showInfo:[1,"showInfo"],maxVisiblePages:[1,"maxVisiblePages"],size:[1,"size"]},outputs:{pageChange:"pageChange",pageSizeChange:"pageSizeChange"},decls:14,vars:14,consts:[[1,"flex","flex-col","md:flex-row","items-center","justify-between","gap-4","mt-4","pt-4","border-t","border-base-200"],[1,"flex","items-center","gap-2","text-sm"],[1,"join"],["type","button","title","\u7B2C\u4E00\u9801",3,"click","disabled"],["type","button","title","\u4E0A\u4E00\u9801",3,"click","disabled"],["type","button",3,"class","btn-active"],["type","button","title","\u4E0B\u4E00\u9801",3,"click","disabled"],["type","button","title","\u6700\u5F8C\u4E00\u9801",3,"click","disabled"],[1,"text-sm","text-base-content/70"],[1,"text-base-content/70"],[1,"select","select-bordered","select-sm","w-20",3,"change"],[3,"value","selected"],["type","button",3,"click"]],template:function(i,a){i&1&&(T(0,"div",0),c(1,Kt,8,0,"div",1),T(2,"div",2)(3,"button",3),R("click",function(){return a.goToFirstPage()}),d(4," \xAB "),M(),T(5,"button",4),R("click",function(){return a.goToPreviousPage()}),d(6," \u2039 "),M(),L(7,Yt,2,5,"button",5,Ge),T(9,"button",6),R("click",function(){return a.goToNextPage()}),d(10," \u203A "),M(),T(11,"button",7),R("click",function(){return a.goToLastPage()}),d(12," \xBB "),M()(),c(13,Zt,2,3,"div",8),M()),i&2&&(l(),p(a.showPageSizeSelector()?1:-1),l(2),Y(a.btnClass()),K("disabled",a.isFirstPage()),l(2),Y(a.btnClass()),K("disabled",a.isFirstPage()),l(2),I(a.visiblePages()),l(2),Y(a.btnClass()),K("disabled",a.isLastPage()),l(2),Y(a.btnClass()),K("disabled",a.isLastPage()),l(2),p(a.showInfo()?13:-1))},dependencies:[N],encapsulation:2});let e=o;return e})();var ei={users:[],searchQuery:"",loading:!1,updating:!1,error:null},He=fe({providedIn:"root"},We(ei),xe(({users:e,searchQuery:o})=>({totalUsers:b(()=>e().length),hasUsers:b(()=>e().length>0),filteredUsers:b(()=>{let t=o().toLowerCase().trim();return t?e().filter(n=>n.displayName?.toLowerCase().includes(t)||n.email?.toLowerCase().includes(t)):e()})})),je((e,o=y(Oe),t=y(te))=>({loadUsers:X(j(J(()=>v(e,{loading:!0,error:null})),W(n=>k(o.getAllUsers(n||void 0)).pipe(Q({next:i=>v(e,{users:i,loading:!1}),error:i=>{v(e,{error:i.message||"\u8F09\u5165\u4F7F\u7528\u8005\u5217\u8868\u5931\u6557",loading:!1}),t.error("\u8F09\u5165\u4F7F\u7528\u8005\u5217\u8868\u5931\u6557")}}))))),updateUserRole:X(j(J(()=>v(e,{updating:!0,error:null})),W(({uid:n,role:i,premiumUntil:a})=>k(o.updateUserRole(n,i,a)).pipe(Q({next:()=>{v(e,{updating:!1}),t.success("\u4F7F\u7528\u8005\u6B0A\u9650\u5DF2\u66F4\u65B0"),k(o.getAllUsers()).subscribe({next:m=>v(e,{users:m})})},error:m=>{v(e,{error:m.message||"\u66F4\u65B0\u4F7F\u7528\u8005\u6B0A\u9650\u5931\u6557",updating:!1}),t.error("\u66F4\u65B0\u4F7F\u7528\u8005\u6B0A\u9650\u5931\u6557")}}))))),deleteUser:X(j(J(()=>v(e,{updating:!0,error:null})),W(n=>k(o.deleteUser(n)).pipe(Q({next:()=>{let i=e.users().filter(a=>a.uid!==n);v(e,{users:i,updating:!1}),t.success("\u4F7F\u7528\u8005\u5DF2\u522A\u9664")},error:i=>{v(e,{error:i.message||"\u522A\u9664\u4F7F\u7528\u8005\u5931\u6557",updating:!1}),t.error("\u522A\u9664\u4F7F\u7528\u8005\u5931\u6557")}}))))),clearError(){v(e,{error:null})},setSearchQuery(n){v(e,{searchQuery:n})}})));function ti(e,o){if(e&1&&f(0,"img",5),e&2){let t=u();_("src",t.user().photoURL,$)("alt",t.user().displayName)}}function ii(e,o){if(e&1){let t=E();r(0,"div",8)(1,"label",9)(2,"span",10),d(3,"\u8D0A\u52A9\u5230\u671F\u65E5"),s()(),r(4,"input",18),ae("ngModelChange",function(i){C(t);let a=u();return oe(a.premiumUntilDate,i)||(a.premiumUntilDate=i),g(i)}),s(),r(5,"label",9)(6,"span",19),d(7,"\u8A2D\u5B9A\u8D0A\u52A9\u6703\u54E1\u7684\u6709\u6548\u671F\u9650"),s()()()}if(e&2){let t=u();l(4),ne("ngModel",t.premiumUntilDate)}}var Xe=(()=>{let o=class o{constructor(){this.user=w.required(),this.save=B(),this.cancel=B(),this.selectedRole=D("free"),this.premiumUntilDate=D(""),Ne(()=>{let i=this.user().platforms.quotation;if(this.selectedRole.set(i?.role||"free"),i?.premiumUntil){let a=i.premiumUntil.toDate();this.premiumUntilDate.set(a.toISOString().split("T")[0])}else this.premiumUntilDate.set("")})}handleCancel(){this.cancel.emit()}handleSave(){let n={role:this.selectedRole()};this.selectedRole()==="premium"&&this.premiumUntilDate()?n.premiumUntil=_t.fromDate(new Date(this.premiumUntilDate())):n.premiumUntil=null,this.save.emit(n)}};o.\u0275fac=function(i){return new(i||o)},o.\u0275cmp=U({type:o,selectors:[["app-user-edit-form"]],inputs:{user:[1,"user"]},outputs:{save:"save",cancel:"cancel"},decls:29,vars:5,consts:[[1,"font-bold","text-lg","mb-4"],[1,"mb-4","p-4","bg-base-200","rounded-lg"],[1,"flex","items-center","gap-3"],[1,"avatar"],[1,"w-12","h-12","rounded-full","bg-primary","text-primary-content"],["referrerpolicy","no-referrer",1,"object-cover",3,"src","alt"],[1,"font-medium"],[1,"text-sm","text-base-content/60"],[1,"form-control","mb-4"],[1,"label"],[1,"label-text","font-medium"],[1,"select","select-bordered",3,"ngModelChange","ngModel"],["value","free"],["value","premium"],["value","admin"],[1,"flex","justify-end","gap-2","mt-6"],["type","button",1,"btn","btn-ghost",3,"click"],["type","button",1,"btn","btn-primary",3,"click"],["type","date",1,"input","input-bordered",3,"ngModelChange","ngModel"],[1,"label-text-alt"]],template:function(i,a){i&1&&(r(0,"h3",0),d(1,"\u7DE8\u8F2F\u4F7F\u7528\u8005\u6B0A\u9650"),s(),r(2,"div",1)(3,"div",2)(4,"div",3)(5,"div",4),c(6,ti,1,2,"img",5),s()(),r(7,"div")(8,"div",6),d(9),s(),r(10,"div",7),d(11),s()()()(),r(12,"div",8)(13,"label",9)(14,"span",10),d(15,"\u89D2\u8272"),s()(),r(16,"select",11),ae("ngModelChange",function(h){return oe(a.selectedRole,h)||(a.selectedRole=h),h}),r(17,"option",12),d(18,"\u514D\u8CBB\u6703\u54E1"),s(),r(19,"option",13),d(20,"\u8D0A\u52A9\u6703\u54E1"),s(),r(21,"option",14),d(22,"\u7BA1\u7406\u54E1"),s()()(),c(23,ii,8,1,"div",8),r(24,"div",15)(25,"button",16),x("click",function(){return a.handleCancel()}),d(26," \u53D6\u6D88 "),s(),r(27,"button",17),x("click",function(){return a.handleSave()}),d(28," \u5132\u5B58 "),s()()),i&2&&(l(6),p(a.user().photoURL?6:-1),l(3),S(a.user().displayName||"\u672A\u547D\u540D"),l(2),S(a.user().email),l(5),ne("ngModel",a.selectedRole),l(7),p(a.selectedRole()==="premium"?23:-1))},dependencies:[N,_e,it,nt,me,tt,ce,pe],encapsulation:2});let e=o;return e})();function St(e){return{free:"\u514D\u8CBB\u6703\u54E1",premium:"\u8D0A\u52A9\u6703\u54E1",admin:"\u7BA1\u7406\u54E1"}[e]||e}function wt(e){return{free:"badge-ghost",premium:"badge-warning",admin:"badge-error"}[e]||"badge-ghost"}function he(e){if(!e)return"-";let o=e instanceof Date?e:e.toDate();return o.toLocaleDateString("zh-TW",{year:"numeric",month:"2-digit",day:"2-digit"})+" "+o.toLocaleTimeString("zh-TW",{hour:"2-digit",minute:"2-digit",hour12:!1})}function we(e,o=new Date){if(!e)return null;let n=(e instanceof Date?e:e.toDate()).getTime()-o.getTime();return Math.ceil(n/(1e3*60*60*24))}function ni(e){let o=e.platforms.quotation,t=o?.role||"free",n=o?.premiumUntil,i=we(n);return{user:e,displayName:e.displayName||"Unknown",email:e.email||"No Email",uidShort:e.uid.substring(0,8),role:t,roleDisplayName:St(t),roleBadgeClass:wt(t),premiumUntilFormatted:n?he(n):null,daysUntilExpiry:i,isExpired:t==="premium"&&i!==null&&i<0,createdAtFormatted:e.createdAt?he(e.createdAt):"-"}}function Dt(e){return e.map(ni)}var oi=(e,o)=>o.user.uid;function ai(e,o){e&1&&f(0,"span",7)}function ri(e,o){if(e&1&&f(0,"lucide-icon",5),e&2){let t=u();_("img",t.RefreshCw)("size",16)}}function si(e,o){e&1&&(r(0,"div",11),f(1,"span",14),s())}function li(e,o){if(e&1&&(r(0,"div",12),f(1,"lucide-icon",15),r(2,"p"),d(3,"\u76EE\u524D\u6C92\u6709\u4F7F\u7528\u8005\u8CC7\u6599"),s()()),e&2){let t=u();l(),_("img",t.Users)("size",48)}}function di(e,o){if(e&1&&f(0,"img",24),e&2){let t=u().$implicit;_("src",t.user.photoURL,$)("alt",t.displayName)}}function ui(e,o){if(e&1&&(r(0,"span",26),f(1,"lucide-icon",5),d(2," \u8D0A\u52A9\u6703\u54E1\uFF08\u5DF2\u904E\u671F\uFF09 "),s()),e&2){let t=u(3);l(),_("img",t.Crown)("size",12)}}function mi(e,o){if(e&1&&f(0,"lucide-icon",5),e&2){let t=u(4);_("img",t.Shield)("size",12)}}function ci(e,o){if(e&1&&f(0,"lucide-icon",5),e&2){let t=u(4);_("img",t.Crown)("size",12)}}function pi(e,o){if(e&1&&(r(0,"span",26),c(1,mi,1,2,"lucide-icon",5)(2,ci,1,2,"lucide-icon",5),d(3),s()),e&2){let t=u().$implicit;Y(t.roleBadgeClass),l(),p(t.role==="admin"?1:t.role==="premium"?2:-1),l(2),F(" ",t.roleDisplayName," ")}}function _i(e,o){if(e&1&&(r(0,"div",33),d(1),s()),e&2){let t=u(2).$implicit;V("text-error",t.daysUntilExpiry<7)("text-warning",t.daysUntilExpiry>=7&&t.daysUntilExpiry<30),l(),F(" (\u5269\u9918 ",t.daysUntilExpiry," \u5929) ")}}function Ci(e,o){if(e&1&&(r(0,"div")(1,"div"),d(2),s(),c(3,_i,2,5,"div",32),s()),e&2){let t=u().$implicit;l(2),S(t.premiumUntilFormatted),l(),p(t.daysUntilExpiry!==null&&t.daysUntilExpiry>0?3:-1)}}function gi(e,o){e&1&&(r(0,"span",28),d(1,"-"),s())}function fi(e,o){if(e&1){let t=E();r(0,"button",34),x("click",function(){C(t);let i=u().$implicit,a=u(2);return g(a.confirmDelete(i.user))}),d(1," \u522A\u9664 "),s()}}function xi(e,o){if(e&1){let t=E();r(0,"tr")(1,"td")(2,"div",21)(3,"div",22)(4,"div",23),c(5,di,1,2,"img",24),s()(),r(6,"div")(7,"div",25),d(8),s()()()(),r(9,"td"),d(10),s(),r(11,"td"),c(12,ui,3,2,"span",26)(13,pi,4,4,"span",27),s(),r(14,"td"),c(15,Ci,4,2,"div")(16,gi,2,0,"span",28),s(),r(17,"td"),d(18),s(),r(19,"td")(20,"div",29)(21,"button",30),x("click",function(){let i=C(t).$implicit,a=u(2);return g(a.startEdit(i.user))}),d(22," \u7DE8\u8F2F "),s(),c(23,fi,2,0,"button",31),s()()()}if(e&2){let t=o.$implicit;l(5),p(t.user.photoURL?5:-1),l(3),F(" ",t.displayName," "),l(2),S(t.email),l(2),p(t.isExpired?12:13),l(3),p(t.premiumUntilFormatted?15:16),l(3),S(t.createdAtFormatted),l(5),p(t.role==="free"?23:-1)}}function hi(e,o){if(e&1){let t=E();r(0,"div",16)(1,"table",17)(2,"thead")(3,"tr")(4,"th"),d(5,"\u4F7F\u7528\u8005"),s(),r(6,"th"),d(7,"Email"),s(),r(8,"th",18),d(9,"\u89D2\u8272"),s(),r(10,"th",19),d(11,"\u8D0A\u52A9\u5230\u671F\u65E5"),s(),r(12,"th",19),d(13,"\u8A3B\u518A\u6642\u9593"),s(),r(14,"th",19),d(15,"\u64CD\u4F5C"),s()()(),r(16,"tbody"),L(17,xi,24,7,"tr",null,oi),s()()(),r(19,"app-pagination",20),x("pageChange",function(i){C(t);let a=u();return g(a.onPageChange(i))})("pageSizeChange",function(i){C(t);let a=u();return g(a.onPageSizeChange(i))}),s()}if(e&2){let t=u();l(17),I(t.paginatedUsersDisplay()),l(2),_("totalItems",t.totalUsers())("pageSize",t.pageSize())("currentPage",t.currentPage())}}function bi(e,o){if(e&1){let t=E();r(0,"dialog",13)(1,"div",35)(2,"app-user-edit-form",36),x("save",function(i){C(t);let a=u();return g(a.handleSave(i))})("cancel",function(){C(t);let i=u();return g(i.cancelEdit())}),s()(),r(3,"form",37),x("click",function(){C(t);let i=u();return g(i.cancelEdit())}),r(4,"button"),d(5,"close"),s()()()}if(e&2){let t=u();l(2),_("user",t.editingUser())}}var At=(()=>{let o=class o{constructor(){this.usersStore=y(He),this.Users=mt,this.Crown=Ce,this.Shield=Re,this.Search=dt,this.RefreshCw=lt,this.currentPage=D(1),this.pageSize=D(10),this.editingUser=D(null),this.totalUsers=b(()=>this.usersStore.filteredUsers().length),this.hasUsers=b(()=>this.usersStore.users().length>0),this.paginatedUsersDisplay=b(()=>{let n=this.usersStore.filteredUsers(),i=this.currentPage(),a=this.pageSize(),m=(i-1)*a,h=m+a;return Dt(n.slice(m,h))})}ngOnInit(){this.usersStore.hasUsers()||this.usersStore.loadUsers()}onRefresh(){this.usersStore.loadUsers()}onPageChange(n){this.currentPage.set(n)}onPageSizeChange(n){this.pageSize.set(n),this.currentPage.set(1)}onSearchChange(n){this.usersStore.setSearchQuery(n),this.currentPage.set(1)}startEdit(n){this.editingUser.set(n)}cancelEdit(){this.editingUser.set(null)}handleSave(n){let i=this.editingUser();i&&(this.usersStore.updateUserRole({uid:i.uid,role:n.role,premiumUntil:n.premiumUntil?.toDate()??null}),this.cancelEdit())}confirmDelete(n){let i=n.displayName||n.email||n.uid;confirm(`\u78BA\u5B9A\u8981\u522A\u9664\u4F7F\u7528\u8005\u300C${i}\u300D\u55CE\uFF1F\u6B64\u64CD\u4F5C\u7121\u6CD5\u5FA9\u539F\u3002`)&&this.usersStore.deleteUser(n.uid)}};o.\u0275fac=function(i){return new(i||o)},o.\u0275cmp=U({type:o,selectors:[["app-user-list"]],decls:17,vars:11,consts:[[1,"card","bg-base-100","shadow-sm"],[1,"card-body"],[1,"flex","flex-wrap","items-center","justify-between","gap-3","mb-4"],[1,"flex","items-center","gap-2"],[1,"card-title","flex","items-center","gap-2"],[3,"img","size"],["type","button","title","\u91CD\u65B0\u6574\u7406",1,"btn","btn-sm","btn-ghost","btn-square",3,"click","disabled"],[1,"loading","loading-spinner","loading-sm"],[1,"input","input-sm","input-bordered","flex","items-center","gap-2"],[1,"opacity-50",3,"img","size"],["type","search","placeholder","\u641C\u5C0B\u540D\u7A31\u6216 Email...",1,"grow",3,"input","value"],[1,"flex","justify-center","py-8"],[1,"text-center","py-8","text-base-content/60"],[1,"modal","modal-open"],[1,"loading","loading-spinner","loading-lg"],[1,"mx-auto","mb-2","opacity-30",3,"img","size"],[1,"overflow-x-auto"],[1,"table","table-zebra"],[1,"w-28"],[1,"w-32"],[3,"pageChange","pageSizeChange","totalItems","pageSize","currentPage"],[1,"flex","items-center","gap-3"],[1,"avatar"],[1,"w-10","h-10","rounded-full","bg-primary","text-primary-content"],["referrerpolicy","no-referrer",1,"object-cover",3,"src","alt"],[1,"font-medium"],[1,"badge","badge-soft","gap-1","whitespace-nowrap"],[1,"badge","badge-soft","gap-1","whitespace-nowrap",3,"class"],[1,"text-base-content/40"],[1,"join"],["type","button",1,"btn","btn-sm","btn-ghost","join-item",3,"click"],["type","button",1,"btn","btn-sm","btn-ghost","text-error","join-item"],[1,"text-xs",3,"text-error","text-warning"],[1,"text-xs"],["type","button",1,"btn","btn-sm","btn-ghost","text-error","join-item",3,"click"],[1,"modal-box"],[3,"save","cancel","user"],["method","dialog",1,"modal-backdrop",3,"click"]],template:function(i,a){i&1&&(r(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3)(4,"h2",4),f(5,"lucide-icon",5),d(6," \u4F7F\u7528\u8005\u7BA1\u7406 "),s(),r(7,"button",6),x("click",function(){return a.onRefresh()}),c(8,ai,1,0,"span",7)(9,ri,1,2,"lucide-icon",5),s()(),r(10,"label",8),f(11,"lucide-icon",9),r(12,"input",10),x("input",function(h){return a.onSearchChange(h.target.value)}),s()()(),c(13,si,2,0,"div",11)(14,li,4,2,"div",12)(15,hi,20,3),s()(),c(16,bi,6,1,"dialog",13)),i&2&&(l(5),_("img",a.Users)("size",24),l(2),V("btn-disabled",a.usersStore.loading()),_("disabled",a.usersStore.loading()),l(),p(a.usersStore.loading()?8:9),l(3),_("img",a.Search)("size",16),l(),_("value",a.usersStore.searchQuery()),l(),p(a.usersStore.loading()?13:a.hasUsers()?15:14),l(3),p(a.editingUser()?16:-1))},dependencies:[N,O,z,yt,Xe],encapsulation:2});let e=o;return e})();function vi(e,o){if(e&1){let t=E();T(0,"dialog",0)(1,"div",1)(2,"h3",2),d(3),M(),Ke(4,"img",3),T(5,"div",4)(6,"button",5),R("click",function(){C(t);let i=u();return g(i.onClose())}),d(7,"\u95DC\u9589"),M()()(),T(8,"div",6),R("click",function(i){C(t);let a=u();return g(a.onBackdropClick(i))}),M()()}if(e&2){let t=u();l(3),S(t.title()),l(),K("src",t.proofUrl(),$)}}var Pt=(()=>{let o=class o{constructor(){this.isOpen=w(!1),this.proofUrl=w(""),this.title=w("\u8D0A\u52A9\u6191\u8B49"),this.close=B()}onClose(){this.close.emit()}onBackdropClick(n){n.target===n.currentTarget&&this.onClose()}};o.\u0275fac=function(i){return new(i||o)},o.\u0275cmp=U({type:o,selectors:[["app-proof-modal"]],inputs:{isOpen:[1,"isOpen"],proofUrl:[1,"proofUrl"],title:[1,"title"]},outputs:{close:"close"},decls:1,vars:1,consts:[[1,"modal","modal-open"],[1,"modal-box"],[1,"font-bold","text-lg","mb-4"],["alt","\u6191\u8B49","loading","lazy",1,"w-full","rounded-lg",3,"src"],[1,"modal-action"],[1,"btn",3,"click"],[1,"modal-backdrop",3,"click"]],template:function(i,a){i&1&&c(0,vi,9,2,"dialog",0),i&2&&p(a.isOpen()?0:-1)},dependencies:[N],encapsulation:2});let e=o;return e})();var Ft=(()=>{let o=class o{constructor(){this.NOTIFICATION_URL=pt.googleSheets.notificationUrl}sendSponsorApprovalEmail(n,i){return A(this,null,function*(){if(!this.NOTIFICATION_URL){console.warn("GAS Web App URL not configured, skipping email notification");return}try{let a=yield fetch(this.NOTIFICATION_URL,{method:"POST",headers:{"Content-Type":"text/plain"},body:JSON.stringify({action:"sendApprovalEmail",email:n,userName:i})});if(!a.ok)throw new Error(`HTTP error! status: ${a.status}`);console.log("Sponsor approval email sent successfully")}catch(a){console.error("Failed to send sponsor approval email:",a)}})}};o.\u0275fac=function(i){return new(i||o)},o.\u0275prov=Te({token:o,factory:o.\u0275fac,providedIn:"root"});let e=o;return e})();var Qe=(()=>{let o=class o{constructor(){this.firestoreService=y(Oe),this.notificationService=y(Ft),this.db=Ct(),this.COLLECTION_NAME="donations"}createOrUpdateRequest(n,i,a,m,h,q=!1){return A(this,null,function*(){try{let P=re(this.db,this.COLLECTION_NAME),ie=le(P,H("uid","==",n)),De=yield de(ie),Ae=ee();if(De.empty)yield ft(P,{uid:n,userDisplayName:i,userEmail:a,proof:m,note:h,status:"pending",createdAt:Ae,updatedAt:Ae});else{let Pe=De.docs[0],Fe=Pe.data();if(Fe.status==="pending")throw new Error("\u60A8\u7684\u7533\u8ACB\u6B63\u5728\u5BE9\u6838\u4E2D\uFF0C\u8ACB\u8010\u5FC3\u7B49\u5019");if(Fe.status==="approved"){if(q)throw new Error("\u60A8\u5DF2\u7D93\u662F\u8D0A\u52A9\u6703\u54E1\u4E86");yield Z(se(this.db,this.COLLECTION_NAME,Pe.id),{proof:m,note:h,status:"pending",updatedAt:Ae})}else(Fe.status==="rejected"||Fe.status==="expired")&&(yield Z(se(this.db,this.COLLECTION_NAME,Pe.id),{proof:m,note:h,status:"pending",updatedAt:Ae}))}}catch(P){throw console.error("Failed to create or update donation request:",P),P}})}getPendingRequests(){return A(this,null,function*(){try{let n=re(this.db,this.COLLECTION_NAME),i=le(n,H("status","==","pending"),ze("createdAt","desc"));return(yield de(i)).docs.map(m=>Ue({id:m.id},m.data()))}catch(n){throw console.error("Failed to get pending requests:",n),n}})}getMyRequests(n){return A(this,null,function*(){try{let i=re(this.db,this.COLLECTION_NAME),a=le(i,H("uid","==",n),H("status","in",["pending","rejected","expired"]),ze("createdAt","desc"));return(yield de(a)).docs.map(h=>Ue({id:h.id},h.data()))}catch(i){throw console.error("Failed to get my requests:",i),i}})}withdrawRequest(n,i){return A(this,null,function*(){try{let a=se(this.db,this.COLLECTION_NAME,n);yield Z(a,{status:"rejected",reviewedBy:i,reviewedAt:ee(),updatedAt:ee()})}catch(a){throw console.error("Failed to withdraw request:",a),a}})}getProcessedRequests(){return A(this,null,function*(){try{let n=re(this.db,this.COLLECTION_NAME),i=le(n,H("status","in",["approved","rejected"]),ze("updatedAt","desc"));return(yield de(i)).docs.map(m=>Ue({id:m.id},m.data()))}catch(n){throw console.error("Failed to get processed requests:",n),n}})}resetRequestStatus(n){return A(this,null,function*(){try{let i=se(this.db,this.COLLECTION_NAME,n);yield Z(i,{status:"pending",updatedAt:ee()})}catch(i){throw console.error("Failed to reset request status:",i),i}})}approveRequest(n,i,a,m,h){return A(this,null,function*(){try{let q=se(this.db,this.COLLECTION_NAME,n),P=ee();yield Z(q,{status:"approved",reviewedBy:i,reviewedAt:P,updatedAt:P});let ie=new Date;ie.setMonth(ie.getMonth()+1),yield this.firestoreService.updateUserRole(a,"premium",ie),yield this.notificationService.sendSponsorApprovalEmail(m,h)}catch(q){throw console.error("Failed to approve request:",q),q}})}rejectRequest(n,i){return A(this,null,function*(){try{let a=se(this.db,this.COLLECTION_NAME,n),m=ee();yield Z(a,{status:"rejected",reviewedBy:i,reviewedAt:m,updatedAt:m})}catch(a){throw console.error("Failed to reject request:",a),a}})}markAsExpired(n){return A(this,null,function*(){try{let i=re(this.db,this.COLLECTION_NAME),a=le(i,H("uid","==",n),H("status","==","approved")),m=yield de(a);if(!m.empty){let h=m.docs[0].ref;yield Z(h,{status:"expired",updatedAt:ee()})}}catch(i){throw console.error("Failed to mark request as expired:",i),i}})}deleteUserDonations(n){return A(this,null,function*(){try{let i=re(this.db,this.COLLECTION_NAME),a=le(i,H("uid","==",n)),h=(yield de(a)).docs.map(q=>gt(q.ref));yield Promise.all(h)}catch(i){throw console.error("Failed to delete user donations:",i),i}})}};o.\u0275fac=function(i){return new(i||o)},o.\u0275prov=Te({token:o,factory:o.\u0275fac,providedIn:"root"});let e=o;return e})();var Ut=(e,o)=>o.id;function Ei(e,o){if(e&1&&(r(0,"span",8),d(1),s()),e&2){let t=u();l(),S(t.pendingRequests().length)}}function yi(e,o){e&1&&f(0,"app-user-list")}function Si(e,o){if(e&1&&(r(0,"span",8),d(1),s()),e&2){let t=u(2);l(),S(t.pendingRequests().length)}}function wi(e,o){e&1&&(r(0,"div",12),f(1,"span",14),s())}function Di(e,o){if(e&1){let t=E();r(0,"tr")(1,"td"),d(2),ye(3,"date"),s(),r(4,"td")(5,"div",16),d(6),s(),r(7,"div",17),d(8),s()(),r(9,"td")(10,"button",18),x("click",function(){let i=C(t).$implicit,a=u(4);return g(a.openProofModal(i.proof))}),d(11," \u67E5\u770B\u6191\u8B49 "),s()(),r(12,"td",19),d(13),s(),r(14,"td")(15,"div",20)(16,"button",21),x("click",function(){let i=C(t).$implicit,a=u(4);return g(a.approveRequest(i))}),d(17," \u6838\u51C6 "),s(),r(18,"button",22),x("click",function(){let i=C(t).$implicit,a=u(4);return g(a.rejectRequest(i))}),d(19," \u62D2\u7D55 "),s()()()()}if(e&2){let t=o.$implicit;l(2),F(" ",Se(3,4,t.createdAt.toDate(),"yyyy/MM/dd HH:mm")," "),l(4),S(t.userDisplayName),l(2),F(" ",t.userEmail," "),l(5),S(t.note||"-")}}function Ai(e,o){e&1&&(r(0,"tr")(1,"td",23),d(2," \u76EE\u524D\u6C92\u6709\u5F85\u5BE9\u6838\u7684\u7533\u8ACB "),s()())}function Pi(e,o){if(e&1&&(r(0,"div",13)(1,"table",15)(2,"thead")(3,"tr")(4,"th"),d(5,"\u7533\u8ACB\u6642\u9593"),s(),r(6,"th"),d(7,"\u4F7F\u7528\u8005"),s(),r(8,"th"),d(9,"\u6191\u8B49"),s(),r(10,"th"),d(11,"\u5099\u8A3B"),s(),r(12,"th"),d(13,"\u64CD\u4F5C"),s()()(),r(14,"tbody"),L(15,Di,20,7,"tr",null,Ut),c(17,Ai,3,0,"tr"),s()()()),e&2){let t=u(3);l(15),I(t.pendingRequests()),l(2),p(t.pendingRequests().length===0?17:-1)}}function Fi(e,o){if(e&1&&c(0,wi,2,0,"div",12)(1,Pi,18,1,"div",13),e&2){let t=u(2);p(t.donationLoading()?0:1)}}function Ui(e,o){e&1&&(r(0,"div",12),f(1,"span",14),s())}function Ti(e,o){e&1&&(r(0,"span",24),d(1,"\u5DF2\u6838\u51C6"),s())}function Mi(e,o){e&1&&(r(0,"span",25),d(1,"\u5DF2\u904E\u671F"),s())}function Ni(e,o){e&1&&(r(0,"span",26),d(1,"\u5DF2\u53D6\u6D88"),s())}function qi(e,o){e&1&&(r(0,"span",27),d(1,"\u5DF2\u62D2\u7D55"),s())}function ki(e,o){if(e&1){let t=E();r(0,"button",30),x("click",function(){C(t);let i=u().$implicit,a=u(4);return g(a.startEditFromRequest(i))}),d(1," \u7DE8\u8F2F "),s()}}function Bi(e,o){if(e&1){let t=E();r(0,"button",31),x("click",function(){C(t);let i=u().$implicit,a=u(4);return g(a.resetRequest(i))}),d(1," \u91CD\u65B0\u5BE9\u6838 "),s()}}function Li(e,o){e&1&&(r(0,"span",17),d(1,"-"),s())}function Ii(e,o){if(e&1){let t=E();r(0,"tr")(1,"td"),d(2),ye(3,"date"),s(),r(4,"td")(5,"div",16),d(6),s(),r(7,"div",17),d(8),s()(),r(9,"td"),c(10,Ti,2,0,"span",24)(11,Mi,2,0,"span",25)(12,Ni,2,0,"span",26)(13,qi,2,0,"span",27),s(),r(14,"td")(15,"button",18),x("click",function(){let i=C(t).$implicit,a=u(4);return g(a.openProofModal(i.proof))}),d(16," \u67E5\u770B\u6191\u8B49 "),s()(),r(17,"td",19),d(18),s(),r(19,"td"),c(20,ki,2,0,"button",28)(21,Bi,2,0,"button",29)(22,Li,2,0,"span",17),s()()}if(e&2){let t=o.$implicit;l(2),F(" ",Se(3,6,t.updatedAt.toDate(),"yyyy/MM/dd HH:mm")," "),l(4),S(t.userDisplayName),l(2),F(" ",t.userEmail," "),l(2),p(t.status==="approved"?10:t.status==="expired"?11:t.reviewedBy===t.uid?12:13),l(8),S(t.note||"-"),l(2),p(t.status==="approved"?20:t.status==="rejected"&&t.reviewedBy!==t.uid?21:22)}}function Ri(e,o){e&1&&(r(0,"tr")(1,"td",32),d(2," \u76EE\u524D\u6C92\u6709\u5DF2\u8655\u7406\u7684\u7533\u8ACB "),s()())}function Vi(e,o){if(e&1&&(r(0,"div",13)(1,"table",15)(2,"thead")(3,"tr")(4,"th"),d(5,"\u5BE9\u6838\u6642\u9593"),s(),r(6,"th"),d(7,"\u4F7F\u7528\u8005"),s(),r(8,"th"),d(9,"\u72C0\u614B"),s(),r(10,"th"),d(11,"\u6191\u8B49"),s(),r(12,"th"),d(13,"\u5099\u8A3B"),s(),r(14,"th"),d(15,"\u64CD\u4F5C"),s()()(),r(16,"tbody"),L(17,Ii,23,9,"tr",null,Ut),c(19,Ri,3,0,"tr"),s()()()),e&2){let t=u(3);l(17),I(t.processedRequests()),l(2),p(t.processedRequests().length===0?19:-1)}}function zi(e,o){if(e&1&&c(0,Ui,2,0,"div",12)(1,Vi,20,1,"div",13),e&2){let t=u(2);p(t.donationLoading()?0:1)}}function Oi(e,o){if(e&1){let t=E();r(0,"div",11)(1,"a",7),x("click",function(){C(t);let i=u();return g(i.switchDonationTab("pending"))}),d(2," \u5F85\u5BE9\u6838 "),c(3,Si,2,1,"span",8),s(),r(4,"a",7),x("click",function(){C(t);let i=u();return g(i.switchDonationTab("history"))}),d(5," \u5DF2\u8655\u7406 "),s()(),c(6,Fi,2,1)(7,zi,2,1)}if(e&2){let t=u();l(),V("tab-active",t.donationTab()==="pending"),l(2),p(t.pendingRequests().length>0?3:-1),l(),V("tab-active",t.donationTab()==="history"),l(2),p(t.donationTab()==="pending"?6:7)}}function ji(e,o){if(e&1){let t=E();r(0,"dialog",10)(1,"div",33)(2,"app-user-edit-form",34),x("save",function(i){C(t);let a=u();return g(a.handleSaveEdit(i))})("cancel",function(){C(t);let i=u();return g(i.cancelEdit())}),s()(),r(3,"form",35),x("click",function(){C(t);let i=u();return g(i.cancelEdit())}),r(4,"button"),d(5,"close"),s()()()}if(e&2){let t=u();l(2),_("user",t.editingUser())}}var Tt=(()=>{let o=class o{constructor(){this.donationService=y(Qe),this.toastService=y(te),this.authService=y(ge),this.usersStore=y(He),this.pendingRequests=D([]),this.processedRequests=D([]),this.activeTab=D("users"),this.donationTab=D("pending"),this.donationLoading=D(!1),this.isProofModalOpen=D(!1),this.selectedProofUrl=D(""),this.editingUser=D(null),this.Shield=Re}switchTab(n){this.activeTab.set(n),n==="donations"&&this.loadPendingRequests()}switchDonationTab(n){this.donationTab.set(n),n==="pending"?this.loadPendingRequests():this.loadProcessedRequests()}loadPendingRequests(){return A(this,null,function*(){this.donationLoading.set(!0);try{let n=yield this.donationService.getPendingRequests();this.pendingRequests.set(n)}catch(n){console.error("Failed to load pending requests:",n),this.toastService.error("\u8F09\u5165\u7533\u8ACB\u5931\u6557")}finally{this.donationLoading.set(!1)}})}loadProcessedRequests(){return A(this,null,function*(){this.donationLoading.set(!0);try{let n=yield this.donationService.getProcessedRequests();this.processedRequests.set(n)}catch(n){console.error("Failed to load processed requests:",n),this.toastService.error("\u8F09\u5165\u6B77\u53F2\u7D00\u9304\u5931\u6557")}finally{this.donationLoading.set(!1)}})}openProofModal(n){this.selectedProofUrl.set(n),this.isProofModalOpen.set(!0)}closeProofModal(){this.isProofModalOpen.set(!1),this.selectedProofUrl.set("")}approveRequest(n){return A(this,null,function*(){if(confirm(`\u78BA\u5B9A\u8981\u6838\u51C6 ${n.userDisplayName} \u7684\u7533\u8ACB\u55CE\uFF1F`))try{let i=this.authService.currentUser();if(!i)return;yield this.donationService.approveRequest(n.id,i.uid,n.uid,n.userEmail,n.userDisplayName),this.toastService.success("\u5DF2\u6838\u51C6\u7533\u8ACB"),yield this.loadPendingRequests(),this.usersStore.loadUsers()}catch(i){console.error("Failed to approve request:",i),this.toastService.error("\u6838\u51C6\u5931\u6557")}})}rejectRequest(n){return A(this,null,function*(){if(confirm(`\u78BA\u5B9A\u8981\u62D2\u7D55 ${n.userDisplayName} \u7684\u7533\u8ACB\u55CE\uFF1F`))try{let i=this.authService.currentUser();if(!i)return;yield this.donationService.rejectRequest(n.id,i.uid),this.toastService.success("\u5DF2\u62D2\u7D55\u7533\u8ACB"),yield this.loadPendingRequests()}catch(i){console.error("Failed to reject request:",i),this.toastService.error("\u62D2\u7D55\u5931\u6557")}})}resetRequest(n){return A(this,null,function*(){if(confirm(`\u78BA\u5B9A\u8981\u91CD\u65B0\u5BE9\u6838 ${n.userDisplayName} \u7684\u7533\u8ACB\u55CE\uFF1F`))try{yield this.donationService.resetRequestStatus(n.id),this.toastService.success("\u5DF2\u91CD\u65B0\u958B\u653E\u5BE9\u6838"),yield this.loadProcessedRequests()}catch(i){console.error("Failed to reset request:",i),this.toastService.error("\u91CD\u65B0\u5BE9\u6838\u5931\u6557")}})}startEditFromRequest(n){let a=this.usersStore.users().find(m=>m.uid===n.uid);a?this.editingUser.set(a):(this.usersStore.loadUsers(),this.toastService.info("\u8F09\u5165\u4F7F\u7528\u8005\u8CC7\u6599\u4E2D..."))}handleSaveEdit(n){let i=this.editingUser();i&&(this.usersStore.updateUserRole({uid:i.uid,role:n.role,premiumUntil:n.premiumUntil?.toDate()??null}),this.cancelEdit(),this.loadProcessedRequests())}cancelEdit(){this.editingUser.set(null)}};o.\u0275fac=function(i){return new(i||o)},o.\u0275cmp=U({type:o,selectors:[["app-admin-panel"]],decls:17,vars:11,consts:[[1,"card","bg-base-100","shadow-sm"],[1,"card-body"],[1,"flex","items-center","justify-between","mb-6"],[1,"flex","items-center","gap-2"],[1,"text-primary",3,"img","size"],[1,"card-title"],[1,"tabs","tabs-boxed"],[1,"tab",3,"click"],[1,"badge","badge-sm","badge-error","ml-1"],[3,"close","isOpen","proofUrl"],[1,"modal","modal-open"],[1,"tabs","tabs-boxed","mb-4"],[1,"flex","justify-center","items-center","py-12"],[1,"overflow-x-auto"],[1,"loading","loading-spinner","loading-lg","text-primary"],[1,"table"],[1,"font-bold"],[1,"text-xs","opacity-50"],[1,"btn","btn-ghost","btn-xs","whitespace-nowrap",3,"click"],[1,"max-w-xs","truncate"],[1,"join"],[1,"btn","btn-success","btn-xs","join-item",3,"click"],[1,"btn","btn-error","btn-xs","join-item",3,"click"],["colspan","5",1,"text-center","py-8","text-base-content/50"],[1,"badge","badge-success","whitespace-nowrap"],[1,"badge","badge-warning","whitespace-nowrap"],[1,"badge","badge-ghost","whitespace-nowrap"],[1,"badge","badge-error","whitespace-nowrap"],[1,"btn","btn-ghost","btn-xs"],[1,"btn","btn-warning","btn-xs"],[1,"btn","btn-ghost","btn-xs",3,"click"],[1,"btn","btn-warning","btn-xs",3,"click"],["colspan","6",1,"text-center","py-8","text-base-content/50"],[1,"modal-box"],[3,"save","cancel","user"],["method","dialog",1,"modal-backdrop",3,"click"]],template:function(i,a){i&1&&(r(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3),f(4,"lucide-icon",4),r(5,"h2",5),d(6,"\u7BA1\u7406\u54E1\u9762\u677F"),s()(),r(7,"div",6)(8,"a",7),x("click",function(){return a.switchTab("users")}),d(9," \u4F7F\u7528\u8005\u7BA1\u7406 "),s(),r(10,"a",7),x("click",function(){return a.switchTab("donations")}),d(11," \u8D0A\u52A9\u5BE9\u6838 "),c(12,Ei,2,1,"span",8),s()()(),c(13,yi,1,0,"app-user-list")(14,Oi,8,6),s()(),r(15,"app-proof-modal",9),x("close",function(){return a.closeProofModal()}),s(),c(16,ji,6,1,"dialog",10)),i&2&&(l(4),_("img",a.Shield)("size",24),l(4),V("tab-active",a.activeTab()==="users"),l(2),V("tab-active",a.activeTab()==="donations"),l(2),p(a.pendingRequests().length>0?12:-1),l(),p(a.activeTab()==="users"?13:14),l(2),_("isOpen",a.isProofModalOpen())("proofUrl",a.selectedProofUrl()),l(),p(a.editingUser()?16:-1))},dependencies:[N,O,z,At,Pt,Xe,ke],encapsulation:2});let e=o;return e})();var Mt={myRequests:[],loading:!1,submitting:!1,error:null},Nt=fe({providedIn:"root"},We(Mt),xe(({myRequests:e})=>({hasPendingRequest:b(()=>e().some(o=>o.status==="pending")),pendingRequest:b(()=>e().find(o=>o.status==="pending")),hasRequests:b(()=>e().length>0)})),je((e,o=y(Qe),t=y(te))=>({loadMyRequests:X(j(J(()=>v(e,{loading:!0,error:null})),W(n=>k(o.getMyRequests(n)).pipe(Q({next:i=>v(e,{myRequests:i,loading:!1}),error:i=>{v(e,{error:i.message||"\u8F09\u5165\u7533\u8ACB\u5931\u6557",loading:!1})}}))))),submitRequest:X(j(J(()=>v(e,{submitting:!0,error:null})),W(({uid:n,displayName:i,email:a,proof:m,note:h,isPremium:q})=>k(o.createOrUpdateRequest(n,i,a,m,h,q)).pipe(Q({next:()=>{v(e,{submitting:!1}),t.success("\u8D0A\u52A9\u7533\u8ACB\u5DF2\u9001\u51FA\uFF0C\u6211\u5011\u6703\u5118\u5FEB\u5BE9\u6838\uFF01"),k(o.getMyRequests(n)).subscribe({next:P=>v(e,{myRequests:P})})},error:P=>{v(e,{error:P.message||"\u7533\u8ACB\u9001\u51FA\u5931\u6557",submitting:!1}),t.error(P.message||"\u7533\u8ACB\u9001\u51FA\u5931\u6557\uFF0C\u8ACB\u7A0D\u5F8C\u518D\u8A66")}}))))),withdrawRequest:X(j(J(()=>v(e,{submitting:!0,error:null})),W(({requestId:n,uid:i})=>k(o.withdrawRequest(n,i)).pipe(Q({next:()=>{v(e,{submitting:!1}),t.success("\u5DF2\u64A4\u56DE\u7533\u8ACB"),k(o.getMyRequests(i)).subscribe({next:a=>v(e,{myRequests:a})})},error:a=>{v(e,{error:a.message||"\u64A4\u56DE\u5931\u6557",submitting:!1}),t.error("\u64A4\u56DE\u5931\u6557\uFF0C\u8ACB\u7A0D\u5F8C\u518D\u8A66")}}))))),markAsExpired:X(j(W(({uid:n,premiumUntil:i,role:a})=>i<new Date&&a==="free"?k(o.markAsExpired(n)).pipe(Q({next:()=>{},error:m=>{console.error("Failed to mark as expired:",m)}})):k(Promise.resolve())))),initForUser(n,i){if(i)return;this.loadMyRequests(n.uid);let a=n.platforms?.quotation;a?.premiumUntil&&this.markAsExpired({uid:n.uid,premiumUntil:a.premiumUntil.toDate(),role:a.role||"free"})},clearError(){v(e,{error:null})},reset(){v(e,Mt)}})));var qt=fe({providedIn:"root"},xe(()=>{let e=y(ge);return{userData:b(()=>e.userData()),userDisplayName:b(()=>e.userDisplayName()),userEmail:b(()=>e.userEmail()),isPremium:b(()=>e.isPremium()),isAdmin:b(()=>e.isAdmin()),formattedCreatedAt:b(()=>{let o=e.userData()?.createdAt;return o?he(o):null}),formattedPremiumUntil:b(()=>{let o=e.userData()?.platforms.quotation?.premiumUntil;return o?he(o):null}),daysUntilExpiry:b(()=>{let o=e.userData()?.platforms.quotation?.premiumUntil;return we(o)}),showExpiryWarning:b(()=>{let o=e.userData()?.platforms.quotation?.premiumUntil;if(!o)return!1;let t=we(o);return t!==null&&t<=7}),currentRole:b(()=>e.userData()?.platforms.quotation?.role||"free")}}));var Wi=(e,o,t,n)=>({request:e,requestId:o,status:"pending",icon:t,iconColor:"text-info",borderColor:"border-info",titleColor:"text-info",title:"\u60A8\u7684\u8D0A\u52A9\u7533\u8ACB\u6B63\u5728\u5BE9\u6838\u4E2D",timeLabel:"\u63D0\u4EA4\u6642\u9593",time:n,message:"\u8ACB\u8010\u5FC3\u7B49\u5019\uFF0C\u6211\u5011\u6703\u5118\u5FEB\u8655\u7406\u60A8\u7684\u7533\u8ACB\u3002",sectionTitle:"\u60A8\u63D0\u4EA4\u7684\u8CC7\u6599",modalId:"pendingProofPreview"}),$i=(e,o,t,n)=>({request:e,requestId:o,status:"cancelled",icon:t,iconColor:"text-base-content/50",borderColor:"border-base-content/20",titleColor:"text-base-content/70",title:"\u60A8\u5DF2\u53D6\u6D88\u7533\u8ACB",timeLabel:"\u53D6\u6D88\u6642\u9593",time:n,message:"\u60A8\u53EF\u4EE5\u96A8\u6642\u91CD\u65B0\u63D0\u4EA4\u7533\u8ACB\u3002",sectionTitle:"\u60A8\u4E4B\u524D\u63D0\u4EA4\u7684\u8CC7\u6599",modalId:"cancelledProofPreview"}),Hi=(e,o,t,n)=>({request:e,requestId:o,status:"rejected",icon:t,iconColor:"text-error",borderColor:"border-error",titleColor:"text-error",title:"\u60A8\u7684\u8D0A\u52A9\u7533\u8ACB\u5DF2\u88AB\u62D2\u7D55",timeLabel:"\u5BE9\u6838\u6642\u9593",time:n,message:"\u60A8\u53EF\u4EE5\u4FEE\u6539\u6191\u8B49\u6216\u5099\u8A3B\u5F8C\u91CD\u65B0\u63D0\u4EA4\u7533\u8ACB\u3002",sectionTitle:"\u60A8\u4E4B\u524D\u63D0\u4EA4\u7684\u8CC7\u6599",modalId:"rejectedProofPreview"}),Xi=(e,o,t,n)=>({request:e,requestId:o,status:"expired",icon:t,iconColor:"text-warning",borderColor:"border-warning",titleColor:"text-warning",title:"\u60A8\u7684\u8D0A\u52A9\u5DF2\u5230\u671F",timeLabel:"\u5230\u671F\u6642\u9593",time:n,message:"\u611F\u8B1D\u60A8\u904E\u53BB\u7684\u652F\u6301\uFF01\u60A8\u53EF\u4EE5\u91CD\u65B0\u7533\u8ACB\u7E8C\u7D04\u3002",sectionTitle:"\u60A8\u4E4B\u524D\u7684\u8D0A\u52A9\u8CC7\u6599",modalId:"expiredProofPreview"}),Qi=(e,o)=>o.id;function Gi(e,o){if(e&1&&(r(0,"div",2)(1,"div",3),f(2,"lucide-icon",4),r(3,"h2",5),d(4,"\u8ACB\u5148\u767B\u5165"),s(),r(5,"p"),d(6,"\u767B\u5165\u5F8C\u5373\u53EF\u67E5\u770B\u6703\u54E1\u8CC7\u8A0A"),s()()()),e&2){let t=u();l(2),_("img",t.User)("size",48)}}function Ji(e,o){e&1&&be(0)}function Ki(e,o){if(e&1&&ue(0,Ji,1,0,"ng-container",10),e&2){let t=u().$implicit,n=u(3),i=ve(4);_("ngTemplateOutlet",i)("ngTemplateOutletContext",Ee(2,Wi,t,t.id,n.Clock,t.createdAt))}}function Yi(e,o){e&1&&be(0)}function Zi(e,o){if(e&1&&ue(0,Yi,1,0,"ng-container",10),e&2){let t=u(2).$implicit,n=u(3),i=ve(4);_("ngTemplateOutlet",i)("ngTemplateOutletContext",Ee(2,$i,t,t.id,n.CircleX,t.updatedAt))}}function en(e,o){e&1&&be(0)}function tn(e,o){if(e&1&&ue(0,en,1,0,"ng-container",10),e&2){let t=u(2).$implicit,n=u(3),i=ve(4);_("ngTemplateOutlet",i)("ngTemplateOutletContext",Ee(2,Hi,t,t.id,n.CircleX,t.updatedAt))}}function nn(e,o){if(e&1&&c(0,Zi,1,7,"ng-container")(1,tn,1,7,"ng-container"),e&2){let t,n=u().$implicit,i=u(3);p(n.reviewedBy===((t=i.authService.currentUser())==null?null:t.uid)?0:1)}}function on(e,o){e&1&&be(0)}function an(e,o){if(e&1&&ue(0,on,1,0,"ng-container",10),e&2){let t=u().$implicit,n=u(3),i=ve(4);_("ngTemplateOutlet",i)("ngTemplateOutletContext",Ee(2,Xi,t,t.id,n.Clock,t.updatedAt))}}function rn(e,o){if(e&1&&c(0,Ki,1,7,"ng-container")(1,nn,2,1)(2,an,1,7,"ng-container"),e&2){let t=o.$implicit;p(t.status==="pending"?0:t.status==="rejected"?1:t.status==="expired"?2:-1)}}function sn(e,o){if(e&1&&L(0,rn,3,1,null,null,Qi),e&2){let t=u(2);I(t.donationsStore.myRequests())}}function ln(e,o){if(e&1){let t=E();r(0,"div",8)(1,"app-donation-form",11),x("submitDonation",function(i){C(t);let a=u(2);return g(a.handleDonationSubmit(i))}),s()()}}function dn(e,o){if(e&1&&(r(0,"div",9),f(1,"lucide-icon",12),r(2,"div")(3,"h3",13),d(4,"\u611F\u8B1D\u60A8\u7684\u8D0A\u52A9\uFF01"),s(),r(5,"div",14),d(6,"\u60A8\u5DF2\u7D93\u662F\u8D0A\u52A9\u6703\u54E1\uFF0C\u4EAB\u6709\u6240\u6709\u9032\u968E\u529F\u80FD\u3002"),s()()()),e&2){let t=u(2);l(),_("img",t.Check)("size",24)}}function un(e,o){e&1&&f(0,"app-admin-panel")}function mn(e,o){if(e&1){let t=E();r(0,"h1",6),d(1,"\u6703\u54E1\u4E2D\u5FC3"),s(),r(2,"app-user-profile",7),x("displayNameChange",function(i){C(t);let a=u();return g(a.handleDisplayNameChange(i))}),s(),c(3,sn,2,0),c(4,ln,2,0,"div",8),c(5,dn,7,2,"div",9),c(6,un,1,0,"app-admin-panel")}if(e&2){let t=u();l(2),_("userDisplayName",t.profileStore.userDisplayName())("userEmail",t.profileStore.userEmail())("isPremium",t.profileStore.isPremium())("isAdmin",t.profileStore.isAdmin())("formattedCreatedAt",t.profileStore.formattedCreatedAt())("formattedPremiumUntil",t.profileStore.formattedPremiumUntil())("daysUntilExpiry",t.profileStore.daysUntilExpiry())("showExpiryWarning",t.profileStore.showExpiryWarning()),l(),p(!t.profileStore.isPremium()&&!t.profileStore.isAdmin()&&t.donationsStore.myRequests().length>0?3:-1),l(),p(!t.profileStore.isPremium()&&!t.profileStore.isAdmin()?4:-1),l(),p(t.profileStore.isPremium()?5:-1),l(),p(t.profileStore.isAdmin()?6:-1)}}function cn(e,o){if(e&1&&(d(0),ye(1,"date")),e&2){let t=u(),n=t.timeLabel,i=t.time;Me(" ",n,"\uFF1A",Se(1,2,i.toDate(),"yyyy/MM/dd HH:mm")," ")}}function pn(e,o){if(e&1){let t=E();r(0,"div",23)(1,"button",32),x("click",function(){C(t);let i=u().requestId,a=u();return g(a.handleWithdraw(i))}),d(2," \u64A4\u56DE\u7533\u8ACB "),s()()}}function _n(e,o){if(e&1){let t=E();r(0,"div")(1,"label",35)(2,"span",36),d(3,"\u8D0A\u52A9\u6191\u8B49"),s()(),r(4,"img",37),x("click",function(){C(t);let i=u(2).modalId,a=u();return g(a.openProofModal(i))}),s()()}if(e&2){let t=u(2).request;l(4),_("src",t.proof,$)}}function Cn(e,o){if(e&1&&(r(0,"div")(1,"label",35)(2,"span",36),d(3,"\u5099\u8A3B"),s()(),r(4,"div",38)(5,"p",39),d(6),s()()()),e&2){let t=u(2).request;l(6),S(t.note)}}function gn(e,o){if(e&1&&(r(0,"div",33),d(1),s(),r(2,"div",34),c(3,_n,5,1,"div"),c(4,Cn,7,1,"div"),s()),e&2){let t=u(),n=t.request,i=t.sectionTitle;l(),S(i),l(2),p(n.proof?3:-1),l(),p(n.note?4:-1)}}function fn(e,o){if(e&1&&(r(0,"div",15)(1,"div",16)(2,"div",17),f(3,"lucide-icon",18),r(4,"div",19)(5,"h3",20),d(6),s(),r(7,"p",21),c(8,cn,2,5),s(),r(9,"p",22),d(10),s(),c(11,pn,3,0,"div",23),s()(),c(12,gn,5,3),s()(),r(13,"dialog",24)(14,"div",25)(15,"h3",26),d(16,"\u8D0A\u52A9\u6191\u8B49"),s(),f(17,"img",27),r(18,"div",28)(19,"form",29)(20,"button",30),d(21,"\u95DC\u9589"),s()()()(),r(22,"form",31)(23,"button"),d(24,"close"),s()()()),e&2){let t=o.request,n=o.status,i=o.icon,a=o.iconColor,m=o.borderColor,h=o.titleColor,q=o.title,P=o.time,ie=o.message,De=o.modalId;_("ngClass",m),l(3),_("img",i)("size",32)("ngClass",a),l(2),_("ngClass",h),l(),S(q),l(2),p(P?8:-1),l(2),S(ie),l(),p(n==="pending"?11:-1),l(),p(n!=="cancelled"?12:-1),l(),_("id",De),l(4),_("src",t.proof,$)}}var sa=(()=>{let o=class o{constructor(){this.authService=y(ge),this.donationsStore=y(Nt),this.profileStore=y(qt),this.User=Ve,this.Check=Le,this.Clock=Ie,this.CircleX=at,Ne(()=>{let n=this.profileStore.userData(),i=this.profileStore.isPremium(),a=this.profileStore.isAdmin();n&&!a&&this.donationsStore.initForUser(n,i)})}handleDonationSubmit(n){let i=this.authService.currentUser(),a=this.profileStore.userData();!i||!a||this.donationsStore.submitRequest({uid:i.uid,displayName:a.displayName||i.email||"Unknown",email:a.email||"No Email",proof:n.proof,note:n.note,isPremium:this.profileStore.isPremium()})}handleDisplayNameChange(n){return A(this,null,function*(){try{yield this.authService.updateDisplayName(n)}catch(i){console.error("Failed to update display name:",i)}})}handleWithdraw(n){if(!confirm("\u78BA\u5B9A\u8981\u64A4\u56DE\u7533\u8ACB\u55CE\uFF1F\u64A4\u56DE\u5F8C\u60A8\u53EF\u4EE5\u91CD\u65B0\u63D0\u4EA4\u3002"))return;let i=this.authService.currentUser();i&&this.donationsStore.withdrawRequest({requestId:n,uid:i.uid})}openProofModal(n){let i=document.getElementById(n);i&&i.showModal()}};o.\u0275fac=function(i){return new(i||o)},o.\u0275cmp=U({type:o,selectors:[["app-member"]],decls:5,vars:1,consts:[["requestStatusCard",""],[1,"mx-auto","px-4","py-8"],[1,"card","bg-base-100","shadow-sm"],[1,"card-body","text-center"],[1,"mx-auto","text-base-content/50",3,"img","size"],[1,"card-title","justify-center"],[1,"text-3xl","font-bold","mb-6"],[3,"displayNameChange","userDisplayName","userEmail","isPremium","isAdmin","formattedCreatedAt","formattedPremiumUntil","daysUntilExpiry","showExpiryWarning"],["id","donation-form"],[1,"alert","alert-success","alert-soft"],[4,"ngTemplateOutlet","ngTemplateOutletContext"],[3,"submitDonation"],[3,"img","size"],[1,"font-bold"],[1,"text-sm"],[1,"card","bg-base-100","shadow-sm","border-2","mb-6",3,"ngClass"],[1,"card-body"],[1,"flex","items-start","gap-4"],[1,"flex-shrink-0",3,"img","size","ngClass"],[1,"flex-1"],[1,"card-title",3,"ngClass"],[1,"text-sm","opacity-70","mt-1"],[1,"text-sm","mt-2"],[1,"mt-4"],[1,"modal",3,"id"],[1,"modal-box","max-w-4xl"],[1,"font-bold","text-lg","mb-4"],["alt","\u6191\u8B49",1,"w-full","rounded-lg",3,"src"],[1,"modal-action"],["method","dialog"],[1,"btn"],["method","dialog",1,"modal-backdrop"],[1,"btn","btn-outline","btn-warning","btn-sm",3,"click"],[1,"divider"],[1,"grid","grid-cols-1","md:grid-cols-2","gap-4"],[1,"label"],[1,"label-text","font-semibold"],["alt","\u8D0A\u52A9\u6191\u8B49",1,"max-w-3xs","w-full","rounded-lg","border","border-base-300","cursor-pointer","hover:opacity-80","transition",3,"click","src"],[1,"p-4","bg-base-200","rounded-lg"],[1,"text-sm","whitespace-pre-wrap"]],template:function(i,a){i&1&&(r(0,"div",1),c(1,Gi,7,2,"div",2)(2,mn,7,12),s(),ue(3,fn,25,12,"ng-template",null,0,Ze)),i&2&&(l(),p(a.authService.isAuthenticated()?2:1))},dependencies:[N,qe,et,O,z,vt,Et,Tt,ke],encapsulation:2});let e=o;return e})();export{sa as MemberComponent};
