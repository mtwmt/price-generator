<!-- 服務項目 -->
<div class="card bg-base-100 shadow-sm mb-4" [formGroup]="form()">
  <div class="card-body p-4 md:p-4">
    <div class="flex items-center justify-between mb-3">
      <div class="flex items-center gap-3">
        <div
          class="flex items-center justify-center w-12 h-12 rounded-full bg-base-200"
        >
          <lucide-icon
            [img]="ShoppingCart"
            [size]="20"
            class="text-base-content/70"
          />
        </div>
        <h2 class="text-lg font-semibold text-base-content">服務項目</h2>
      </div>
      <button type="button" class="btn btn-info btn-sm" (click)="onAddField()">
        <lucide-icon [img]="ListPlus" [size]="16" />
        <span class="inline">新增項目</span>
      </button>
    </div>

    <!-- 服務項目列表 -->
    <div cdkDropList (cdkDropListDropped)="onDrop($event)">
      <ng-container formArrayName="serviceItems">
        @for (item of serviceItems.controls; track $index; let idx = $index) {
          <div
            cdkDrag
            [cdkDragDisabled]="serviceItems.length <= 1"
            class="group relative"
            [ngClass]=""
          >
            <!-- 服務項目 -->
            <div class="flex items-center gap-2">
              @if (serviceItems.length > 1) {
                <!-- Drag Handle -->
                <div
                  cdkDragHandle
                  class="cursor-move opacity-30 hover:opacity-100 transition-opacity duration-200 flex-shrink-0 touch-none"
                  title="拖曳排序"
                >
                  <lucide-icon
                    [img]="GripVertical"
                    [size]="20"
                    class="text-base-content"
                  />
                </div>
              }

              <!-- 服務項目元件 -->
              <div class="flex-1">
                <app-service-item-control
                  [formGroup]="$any(item)"
                  [index]="idx"
                  (removeField)="onRemoveField(idx)"
                />
                <hr
                  class="my-2 border-secondary md:hidden"
                  [class.hidden]="$last"
                />
                <!-- <div class="divider h-[1px] my-2"></div> -->
              </div>
            </div>
          </div>
        }
      </ng-container>
    </div>

    <!-- 嵌入計價設定 -->
    <ng-content></ng-content>
  </div>
</div>
