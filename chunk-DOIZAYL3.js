import{a as Ds,b as z,c as be,d as Se,e as Bn,f as jn,g as Dt,h as Vt}from"./chunk-J7TIPUY3.js";import{a as Rs}from"./chunk-TNYAEZNZ.js";import{A as Es,D as Mn,F as Ie,I as Ce,J as Jt,K as Mi,L as At,a as kn,b as Fn,d as ds,e as ms,f as ki,g as fs,h as ps,i as gs,j as _s,l as Fi,o as Ee,q as ve,s as Te,y as ys,z as ws}from"./chunk-AMOAE4LU.js";import{$ as F,$a as ie,Ab as cs,Ac as Ae,Bb as T,Cb as J,Db as et,Eb as Rn,Gb as se,Ha as lt,Hb as oe,Ib as ae,M as mt,Ma as we,Mb as Ni,Nb as tn,O as Qt,Ob as en,Oc as Is,Qb as nn,R as Wt,Rb as ls,Tc as As,Ub as Q,Vb as Dn,W as L,Xa as S,Xb as Rt,Ya as x,Yb as st,Yc as Cs,Zc as bs,_c as Ln,aa as M,ab as re,bb as P,c as xt,cb as _,cd as Ss,db as w,eb as N,ed as qn,fb as xn,fd as xs,gb as Pn,gd as Ps,ha as H,hb as as,hd as Tt,ic as Vn,id as It,k as _t,kb as Ye,kc as hs,lb as K,lc as Nn,m as Sn,mb as us,nb as k,nc as ht,ob as Vi,p as vt,pb as A,uc as vs,va as Pt,vc as On,ya as I,yb as Ze,yc as Ts,zb as Ht,zc as Un}from"./chunk-4R6RTNNY.js";import{a as os,h as j}from"./chunk-FJYW2LMB.js";var _a=(i,e)=>({"border-warning bg-warning/10":i,"border-error bg-error/10":e}),ya=(i,e)=>({"text-warning":i,"text-error":e});function wa(i,e){if(i&1){let n=K();_(0,"div",9)(1,"input",11),ae("ngModelChange",function(a){F(n);let c=A();return oe(c.editingName,a)||(c.editingName=a),M(a)}),k("keyup.enter",function(){F(n);let a=A();return M(a.saveEditing())})("keyup.escape",function(){F(n);let a=A();return M(a.cancelEditing())}),w(),_(2,"button",12),k("click",function(){F(n);let a=A();return M(a.saveEditing())}),N(3,"lucide-icon",3),w(),_(4,"button",13),k("click",function(){F(n);let a=A();return M(a.cancelEditing())}),N(5,"lucide-icon",3),w()()}if(i&2){let n=A();I(),se("ngModel",n.editingName),I(2),P("img",n.Check)("size",16),I(2),P("img",n.X)("size",16)}}function Ea(i,e){i&1&&(_(0,"span",14),T(1,"\u7BA1\u7406\u54E1"),w())}function va(i,e){i&1&&(_(0,"span",15),T(1,"\u8D0A\u52A9\u6703\u54E1"),w())}function Ta(i,e){i&1&&(_(0,"span",16),T(1,"\u514D\u8CBB\u6703\u54E1"),w())}function Ia(i,e){if(i&1&&(_(0,"div",10),T(1),_(2,"span"),S(3,Ea,2,0,"span",14)(4,va,2,0,"span",15)(5,Ta,2,0,"span",16),w()()),i&2){let n=A();I(),et(" ",n.userDisplayName()," "),I(2),x(n.isAdmin()?3:n.isPremium()?4:5)}}function Aa(i,e){if(i&1&&(_(0,"div",5),N(1,"lucide-icon",6),_(2,"div")(3,"div",8),T(4,"Email"),w(),_(5,"div",17),T(6),w()()()),i&2){let n=A();I(),P("img",n.Mail)("size",20),I(5),J(n.userEmail())}}function Ca(i,e){if(i&1&&(_(0,"div",5),N(1,"lucide-icon",6),_(2,"div")(3,"div",8),T(4,"\u8A3B\u518A\u6642\u9593"),w(),_(5,"div",17),T(6),w()()()),i&2){let n=A();I(),P("img",n.Clock)("size",20),I(5),J(n.formattedCreatedAt())}}function ba(i,e){if(i&1&&(_(0,"div",20),T(1," \u6703\u54E1\u5373\u5C07\u5230\u671F "),w(),_(2,"div",17),T(3),w()),i&2){let n=A(3);I(3),Rn(" \u5230\u671F\u65E5\uFF1A",n.formattedPremiumUntil(),"\uFF08\u5269\u9918 ",n.daysUntilExpiry()," \u5929\uFF09 ")}}function Sa(i,e){if(i&1&&(_(0,"div",21),T(1,"\u6703\u54E1\u5DF2\u5230\u671F"),w(),_(2,"div",17),T(3),w()),i&2){let n=A(3);I(3),et(" \u5230\u671F\u65E5\uFF1A",n.formattedPremiumUntil()," ")}}function xa(i,e){if(i&1&&(_(0,"div",18),N(1,"lucide-icon",19),_(2,"div"),S(3,ba,4,2)(4,Sa,4,1),w()()),i&2){let n=A(2);P("ngClass",Ni(5,_a,n.daysUntilExpiry()!==null&&n.daysUntilExpiry()>0,n.daysUntilExpiry()!==null&&n.daysUntilExpiry()<=0)),I(),P("img",n.Calendar)("size",20)("ngClass",Ni(8,ya,n.daysUntilExpiry()!==null&&n.daysUntilExpiry()>0,n.daysUntilExpiry()!==null&&n.daysUntilExpiry()<=0)),I(2),x(n.daysUntilExpiry()!==null&&n.daysUntilExpiry()>0?3:4)}}function Pa(i,e){if(i&1&&(_(0,"span",8),T(1),w()),i&2){let n=A(3);I(),et(" (\u5269\u9918 ",n.daysUntilExpiry()," \u5929) ")}}function Ra(i,e){if(i&1&&(_(0,"div",5),N(1,"lucide-icon",6),_(2,"div")(3,"div",8),T(4,"\u6703\u54E1\u5230\u671F\u65E5"),w(),_(5,"div",17),T(6),S(7,Pa,2,1,"span",8),w()()()),i&2){let n=A(2);I(),P("img",n.Calendar)("size",20),I(5),et(" ",n.formattedPremiumUntil()," "),I(),x(n.daysUntilExpiry()!==null?7:-1)}}function Da(i,e){if(i&1&&S(0,xa,5,11,"div",18)(1,Ra,8,4,"div",5),i&2){let n=A();x(n.showExpiryWarning()?0:1)}}var ks=(()=>{let e=class e{constructor(){this.userDisplayName=st.required(),this.userEmail=st(null),this.isPremium=st(!1),this.isAdmin=st(!1),this.formattedCreatedAt=st(null),this.formattedPremiumUntil=st(null),this.daysUntilExpiry=st(null),this.showExpiryWarning=st(!1),this.displayNameChange=Rt(),this.isEditing=H(!1),this.editingName=H(""),this.Crown=Ae,this.User=qn,this.Mail=Is,this.Calendar=vs,this.Clock=Un,this.Pencil=As,this.Check=On,this.X=Ps}startEditing(){this.editingName.set(this.userDisplayName()),this.isEditing.set(!0)}cancelEditing(){this.isEditing.set(!1),this.editingName.set("")}saveEditing(){let s=this.editingName().trim();s&&s!==this.userDisplayName()&&this.displayNameChange.emit(s),this.isEditing.set(!1)}};e.\u0275fac=function(a){return new(a||e)},e.\u0275cmp=lt({type:e,selectors:[["app-user-profile"]],inputs:{userDisplayName:[1,"userDisplayName"],userEmail:[1,"userEmail"],isPremium:[1,"isPremium"],isAdmin:[1,"isAdmin"],formattedCreatedAt:[1,"formattedCreatedAt"],formattedPremiumUntil:[1,"formattedPremiumUntil"],daysUntilExpiry:[1,"daysUntilExpiry"],showExpiryWarning:[1,"showExpiryWarning"]},outputs:{displayNameChange:"displayNameChange"},decls:16,vars:8,consts:[[1,"card","bg-base-100","shadow-sm","mb-6"],[1,"card-body"],[1,"card-title","flex","items-center","gap-2"],[3,"img","size"],[1,"grid","grid-cols-1","md:grid-cols-2","gap-4","mt-4"],[1,"flex","items-center","gap-3"],[1,"text-base-content/70",3,"img","size"],[1,"flex-1"],[1,"text-sm","text-base-content/70"],[1,"flex","items-center","gap-2","mt-1"],[1,"font-medium","flex","items-center","gap-2"],["type","text","maxlength","50",1,"input","input-bordered","input-sm","flex-1","max-w-xs",3,"ngModelChange","keyup.enter","keyup.escape","ngModel"],["title","\u4FDD\u5B58",1,"btn","btn-success","btn-sm","btn-square",3,"click"],["title","\u53D6\u6D88",1,"btn","btn-ghost","btn-sm","btn-square",3,"click"],[1,"badge","badge-soft","badge-error","badge-sm"],[1,"badge","badge-soft","badge-warning","badge-sm"],[1,"badge","badge-soft","badge-sm"],[1,"font-medium"],[1,"flex","items-center","gap-3","p-3","rounded-lg","border",3,"ngClass"],[3,"img","size","ngClass"],[1,"text-sm","text-warning","font-semibold"],[1,"text-sm","text-error","font-semibold"]],template:function(a,c){a&1&&(_(0,"div",0)(1,"div",1)(2,"h2",2),N(3,"lucide-icon",3),T(4," \u6703\u54E1\u8CC7\u8A0A "),w(),_(5,"div",4)(6,"div",5),N(7,"lucide-icon",6),_(8,"div",7)(9,"div",8),T(10,"\u4F7F\u7528\u8005\u540D\u7A31"),w(),S(11,wa,6,5,"div",9)(12,Ia,6,2,"div",10),w()(),S(13,Aa,7,3,"div",5),S(14,Ca,7,3,"div",5),S(15,Da,2,1),w()()()),a&2&&(I(3),P("img",c.User)("size",24),I(4),P("img",c.User)("size",20),I(4),x(c.isEditing()?11:12),I(2),x(c.userEmail()?13:-1),I(),x(c.formattedCreatedAt()?14:-1),I(),x(c.formattedPremiumUntil()?15:-1))},dependencies:[ht,Vn,Ie,Ee,ve,Mn,Te,It,Tt],encapsulation:2});let i=e;return i})();var Fs=(()=>{let e=class e{constructor(){this.toastService=L(Jt),this.submitDonation=Rt(),this.donationProof=H(null),this.donationNote=H(""),this.Crown=Ae,this.Upload=Ss}handleDonationProof(s){if(s.length===0)return;let a=s[0],c=new FileReader;c.onload=()=>{let E=c.result;this.donationProof.set(E)},c.onerror=()=>{this.toastService.error("\u6A94\u6848\u8B80\u53D6\u5931\u6557\uFF0C\u8ACB\u91CD\u8A66")},c.readAsDataURL(a)}onSubmit(){let s=!!this.donationProof(),a=!!this.donationNote().trim();if(!s&&!a){this.toastService.error("\u8ACB\u4E0A\u50B3\u8D0A\u52A9\u6191\u8B49\u6216\u586B\u5BEB\u5099\u8A3B");return}this.submitDonation.emit({proof:this.donationProof()||"",note:this.donationNote()}),this.donationProof.set(null),this.donationNote.set("")}};e.\u0275fac=function(a){return new(a||e)},e.\u0275cmp=lt({type:e,selectors:[["app-donation-form"]],outputs:{submitDonation:"submitDonation"},decls:27,vars:11,consts:[[1,"card","bg-base-100","shadow-sm"],[1,"card-body"],[1,"card-title","flex","items-center","gap-2"],[3,"img","size"],[1,"text-base-content/70"],[1,"divider"],[1,"form-control"],[1,"label"],[1,"label-text","font-medium"],[3,"fileSelected","label","supportedFormats","accept","previewUrl"],[1,"form-control","mt-4"],["placeholder","\u8ACB\u8F38\u5165\u5099\u8A3B\uFF0C\u4F8B\u5982\uFF1A\u8F49\u5E33\u5E33\u865F\u5F8C\u4E94\u78BC\u3001\u8D0A\u52A9\u65E5\u671F\u7B49...","maxlength","500",1,"textarea","textarea-bordered","h-24","w-full",3,"ngModelChange","ngModel"],[1,"label","flex","justify-between"],[1,"label-text-alt"],[1,"card-actions","justify-end","mt-4"],["type","button",1,"btn","btn-warning","gap-2",3,"click","disabled"]],template:function(a,c){a&1&&(_(0,"div",0)(1,"div",1)(2,"h2",2),N(3,"lucide-icon",3),T(4," \u5347\u7D1A\u70BA\u8D0A\u52A9\u6703\u54E1 "),w(),_(5,"p",4),T(6," \u611F\u8B1D\u60A8\u7684\u652F\u6301\uFF01\u4E0A\u50B3\u8D0A\u52A9\u6191\u8B49\u5F8C\uFF0C\u6211\u5011\u6703\u5118\u5FEB\u5BE9\u6838\u4E26\u5347\u7D1A\u60A8\u7684\u6703\u54E1\u7B49\u7D1A\u3002 "),w(),N(7,"div",5),_(8,"div",6)(9,"label",7)(10,"span",8),T(11,"\u8D0A\u52A9\u6191\u8B49"),w()(),_(12,"app-file-upload",9),k("fileSelected",function(b){return c.handleDonationProof(b)}),w()(),_(13,"div",10)(14,"label",7)(15,"span",8),T(16,"\u5099\u8A3B"),w()(),_(17,"textarea",11),ae("ngModelChange",function(b){return oe(c.donationNote,b)||(c.donationNote=b),b}),w(),_(18,"label",12)(19,"span",13),T(20,"\u63D0\u4F9B\u66F4\u591A\u8CC7\u8A0A\u6709\u52A9\u65BC\u6211\u5011\u66F4\u5FEB\u5B8C\u6210\u5BE9\u6838"),w(),_(21,"span",13),T(22),w()()(),_(23,"div",14)(24,"button",15),k("click",function(){return c.onSubmit()}),N(25,"lucide-icon",3),T(26," \u63D0\u4EA4\u8D0A\u52A9\u7533\u8ACB "),w()()()()),a&2&&(I(3),P("img",c.Crown)("size",24),I(9),P("label","\u4E0A\u50B3\u8D0A\u52A9\u6191\u8B49\uFF08\u8F49\u5E33\u622A\u5716\u6216\u6536\u64DA\uFF09")("supportedFormats","\u652F\u63F4 PNG\u3001JPG\u3001GIF")("accept","image/gif, image/jpeg, image/png")("previewUrl",c.donationProof()),I(5),se("ngModel",c.donationNote),I(5),et("",c.donationNote().length," / 500"),I(2),P("disabled",!c.donationProof()&&!c.donationNote().trim()),I(),P("img",c.Upload)("size",18))},dependencies:[ht,Ie,Ee,ve,Mn,Te,It,Tt,Rs],encapsulation:2});let i=e;return i})();var Gn=(()=>{let e=class e{constructor(){this.http=L(Fn),this.authService=L(At),this.apiUrl=`${Ce.portalApiUrl}/api/admin`}withAuth(s){return _t(this.authService.getIdToken()).pipe(mt(a=>{if(!a)return Sn(()=>new Error("\u672A\u767B\u5165\u6216\u7121\u6CD5\u53D6\u5F97\u9A57\u8B49 Token"));let c=new kn({Authorization:`Bearer ${a}`,"x-platform-key":"quotation"});return s(c)}))}getAllUsers(s){let a=s?`${this.apiUrl}/users?limit=${s}`:`${this.apiUrl}/users`;return this.withAuth(c=>this.http.get(a,{headers:c}))}getPendingDonations(){return this.withAuth(s=>this.http.get(`${this.apiUrl}/donations/pending`,{headers:s}))}getProcessedDonations(){return this.withAuth(s=>this.http.get(`${this.apiUrl}/donations/processed`,{headers:s}))}approveDonation(s){return this.withAuth(a=>this.http.post(`${this.apiUrl}/donations/${s}/approve`,{},{headers:a}))}rejectDonation(s){return this.withAuth(a=>this.http.post(`${this.apiUrl}/donations/${s}/reject`,{},{headers:a}))}resetDonationStatus(s){return this.withAuth(a=>this.http.post(`${this.apiUrl}/donations/${s}/reset`,{},{headers:a}))}updateUserRole(s,a,c){return this.withAuth(E=>this.http.patch(`${this.apiUrl}/users/${s}/role`,{role:a,premiumUntil:c},{headers:E}))}deleteUser(s){return this.withAuth(a=>this.http.delete(`${this.apiUrl}/users/${s}`,{headers:a}))}};e.\u0275fac=function(a){return new(a||e)},e.\u0275prov=Wt({token:e,factory:e.\u0275fac,providedIn:"root"});let i=e;return i})();var Va={users:[],searchQuery:"",loading:!1,updating:!1,error:null},$n=be({providedIn:"root"},jn(Va),Se(({users:i,searchQuery:e})=>({totalUsers:Q(()=>i().length),hasUsers:Q(()=>i().length>0),filteredUsers:Q(()=>{let n=e().toLowerCase().trim();return n?i().filter(s=>s.displayName?.toLowerCase().includes(n)||s.email?.toLowerCase().includes(n)):i()})})),Bn((i,e=L(Gn),n=L(Jt))=>({loadUsers:Dt(xt(Qt(()=>z(i,{loading:!0,error:null})),mt(s=>e.getAllUsers(s!=null&&typeof s=="number"?s:void 0).pipe(Vt({next:a=>{let c=Mi.mapMany(a.data);z(i,{users:c,loading:!1})},error:a=>{z(i,{error:a.message||"\u8F09\u5165\u4F7F\u7528\u8005\u5217\u8868\u5931\u6557",loading:!1}),n.error("\u8F09\u5165\u4F7F\u7528\u8005\u5217\u8868\u5931\u6557")}}))))),updateUserRole:Dt(xt(Qt(()=>z(i,{updating:!0,error:null})),mt(({uid:s,role:a,premiumUntil:c})=>e.updateUserRole(s,a,c?c.toISOString():null).pipe(Vt({next:()=>{z(i,{updating:!1}),n.success("\u4F7F\u7528\u8005\u6B0A\u9650\u5DF2\u66F4\u65B0"),e.getAllUsers().subscribe({next:E=>{let b=Mi.mapMany(E.data);z(i,{users:b})}})},error:E=>{z(i,{error:E.message||"\u66F4\u65B0\u4F7F\u7528\u8005\u6B0A\u9650\u5931\u6557",updating:!1}),n.error("\u66F4\u65B0\u4F7F\u7528\u8005\u6B0A\u9650\u5931\u6557")}}))))),deleteUser:Dt(xt(Qt(()=>z(i,{updating:!0,error:null})),mt(s=>e.deleteUser(s).pipe(Vt({next:()=>{let a=i.users().filter(c=>c.uid!==s);z(i,{users:a,updating:!1}),n.success("\u4F7F\u7528\u8005\u5DF2\u522A\u9664")},error:a=>{z(i,{error:a.message||"\u522A\u9664\u4F7F\u7528\u8005\u5931\u6557",updating:!1}),n.error("\u522A\u9664\u4F7F\u7528\u8005\u5931\u6557")}}))))),clearError(){z(i,{error:null})},setSearchQuery(s){z(i,{searchQuery:s})}})));var Ms=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},Os={};var Kn,Us;(function(){var i;function e(f,l){function d(){}d.prototype=l.prototype,f.F=l.prototype,f.prototype=new d,f.prototype.constructor=f,f.D=function(p,m,y){for(var h=Array(arguments.length-2),ct=2;ct<arguments.length;ct++)h[ct-2]=arguments[ct];return l.prototype[m].apply(p,h)}}function n(){this.blockSize=-1}function s(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.C=Array(this.blockSize),this.o=this.h=0,this.u()}e(s,n),s.prototype.u=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0};function a(f,l,d){d||(d=0);let p=Array(16);if(typeof l=="string")for(var m=0;m<16;++m)p[m]=l.charCodeAt(d++)|l.charCodeAt(d++)<<8|l.charCodeAt(d++)<<16|l.charCodeAt(d++)<<24;else for(m=0;m<16;++m)p[m]=l[d++]|l[d++]<<8|l[d++]<<16|l[d++]<<24;l=f.g[0],d=f.g[1],m=f.g[2];let y=f.g[3],h;h=l+(y^d&(m^y))+p[0]+3614090360&4294967295,l=d+(h<<7&4294967295|h>>>25),h=y+(m^l&(d^m))+p[1]+3905402710&4294967295,y=l+(h<<12&4294967295|h>>>20),h=m+(d^y&(l^d))+p[2]+606105819&4294967295,m=y+(h<<17&4294967295|h>>>15),h=d+(l^m&(y^l))+p[3]+3250441966&4294967295,d=m+(h<<22&4294967295|h>>>10),h=l+(y^d&(m^y))+p[4]+4118548399&4294967295,l=d+(h<<7&4294967295|h>>>25),h=y+(m^l&(d^m))+p[5]+1200080426&4294967295,y=l+(h<<12&4294967295|h>>>20),h=m+(d^y&(l^d))+p[6]+2821735955&4294967295,m=y+(h<<17&4294967295|h>>>15),h=d+(l^m&(y^l))+p[7]+4249261313&4294967295,d=m+(h<<22&4294967295|h>>>10),h=l+(y^d&(m^y))+p[8]+1770035416&4294967295,l=d+(h<<7&4294967295|h>>>25),h=y+(m^l&(d^m))+p[9]+2336552879&4294967295,y=l+(h<<12&4294967295|h>>>20),h=m+(d^y&(l^d))+p[10]+4294925233&4294967295,m=y+(h<<17&4294967295|h>>>15),h=d+(l^m&(y^l))+p[11]+2304563134&4294967295,d=m+(h<<22&4294967295|h>>>10),h=l+(y^d&(m^y))+p[12]+1804603682&4294967295,l=d+(h<<7&4294967295|h>>>25),h=y+(m^l&(d^m))+p[13]+4254626195&4294967295,y=l+(h<<12&4294967295|h>>>20),h=m+(d^y&(l^d))+p[14]+2792965006&4294967295,m=y+(h<<17&4294967295|h>>>15),h=d+(l^m&(y^l))+p[15]+1236535329&4294967295,d=m+(h<<22&4294967295|h>>>10),h=l+(m^y&(d^m))+p[1]+4129170786&4294967295,l=d+(h<<5&4294967295|h>>>27),h=y+(d^m&(l^d))+p[6]+3225465664&4294967295,y=l+(h<<9&4294967295|h>>>23),h=m+(l^d&(y^l))+p[11]+643717713&4294967295,m=y+(h<<14&4294967295|h>>>18),h=d+(y^l&(m^y))+p[0]+3921069994&4294967295,d=m+(h<<20&4294967295|h>>>12),h=l+(m^y&(d^m))+p[5]+3593408605&4294967295,l=d+(h<<5&4294967295|h>>>27),h=y+(d^m&(l^d))+p[10]+38016083&4294967295,y=l+(h<<9&4294967295|h>>>23),h=m+(l^d&(y^l))+p[15]+3634488961&4294967295,m=y+(h<<14&4294967295|h>>>18),h=d+(y^l&(m^y))+p[4]+3889429448&4294967295,d=m+(h<<20&4294967295|h>>>12),h=l+(m^y&(d^m))+p[9]+568446438&4294967295,l=d+(h<<5&4294967295|h>>>27),h=y+(d^m&(l^d))+p[14]+3275163606&4294967295,y=l+(h<<9&4294967295|h>>>23),h=m+(l^d&(y^l))+p[3]+4107603335&4294967295,m=y+(h<<14&4294967295|h>>>18),h=d+(y^l&(m^y))+p[8]+1163531501&4294967295,d=m+(h<<20&4294967295|h>>>12),h=l+(m^y&(d^m))+p[13]+2850285829&4294967295,l=d+(h<<5&4294967295|h>>>27),h=y+(d^m&(l^d))+p[2]+4243563512&4294967295,y=l+(h<<9&4294967295|h>>>23),h=m+(l^d&(y^l))+p[7]+1735328473&4294967295,m=y+(h<<14&4294967295|h>>>18),h=d+(y^l&(m^y))+p[12]+2368359562&4294967295,d=m+(h<<20&4294967295|h>>>12),h=l+(d^m^y)+p[5]+4294588738&4294967295,l=d+(h<<4&4294967295|h>>>28),h=y+(l^d^m)+p[8]+2272392833&4294967295,y=l+(h<<11&4294967295|h>>>21),h=m+(y^l^d)+p[11]+1839030562&4294967295,m=y+(h<<16&4294967295|h>>>16),h=d+(m^y^l)+p[14]+4259657740&4294967295,d=m+(h<<23&4294967295|h>>>9),h=l+(d^m^y)+p[1]+2763975236&4294967295,l=d+(h<<4&4294967295|h>>>28),h=y+(l^d^m)+p[4]+1272893353&4294967295,y=l+(h<<11&4294967295|h>>>21),h=m+(y^l^d)+p[7]+4139469664&4294967295,m=y+(h<<16&4294967295|h>>>16),h=d+(m^y^l)+p[10]+3200236656&4294967295,d=m+(h<<23&4294967295|h>>>9),h=l+(d^m^y)+p[13]+681279174&4294967295,l=d+(h<<4&4294967295|h>>>28),h=y+(l^d^m)+p[0]+3936430074&4294967295,y=l+(h<<11&4294967295|h>>>21),h=m+(y^l^d)+p[3]+3572445317&4294967295,m=y+(h<<16&4294967295|h>>>16),h=d+(m^y^l)+p[6]+76029189&4294967295,d=m+(h<<23&4294967295|h>>>9),h=l+(d^m^y)+p[9]+3654602809&4294967295,l=d+(h<<4&4294967295|h>>>28),h=y+(l^d^m)+p[12]+3873151461&4294967295,y=l+(h<<11&4294967295|h>>>21),h=m+(y^l^d)+p[15]+530742520&4294967295,m=y+(h<<16&4294967295|h>>>16),h=d+(m^y^l)+p[2]+3299628645&4294967295,d=m+(h<<23&4294967295|h>>>9),h=l+(m^(d|~y))+p[0]+4096336452&4294967295,l=d+(h<<6&4294967295|h>>>26),h=y+(d^(l|~m))+p[7]+1126891415&4294967295,y=l+(h<<10&4294967295|h>>>22),h=m+(l^(y|~d))+p[14]+2878612391&4294967295,m=y+(h<<15&4294967295|h>>>17),h=d+(y^(m|~l))+p[5]+4237533241&4294967295,d=m+(h<<21&4294967295|h>>>11),h=l+(m^(d|~y))+p[12]+1700485571&4294967295,l=d+(h<<6&4294967295|h>>>26),h=y+(d^(l|~m))+p[3]+2399980690&4294967295,y=l+(h<<10&4294967295|h>>>22),h=m+(l^(y|~d))+p[10]+4293915773&4294967295,m=y+(h<<15&4294967295|h>>>17),h=d+(y^(m|~l))+p[1]+2240044497&4294967295,d=m+(h<<21&4294967295|h>>>11),h=l+(m^(d|~y))+p[8]+1873313359&4294967295,l=d+(h<<6&4294967295|h>>>26),h=y+(d^(l|~m))+p[15]+4264355552&4294967295,y=l+(h<<10&4294967295|h>>>22),h=m+(l^(y|~d))+p[6]+2734768916&4294967295,m=y+(h<<15&4294967295|h>>>17),h=d+(y^(m|~l))+p[13]+1309151649&4294967295,d=m+(h<<21&4294967295|h>>>11),h=l+(m^(d|~y))+p[4]+4149444226&4294967295,l=d+(h<<6&4294967295|h>>>26),h=y+(d^(l|~m))+p[11]+3174756917&4294967295,y=l+(h<<10&4294967295|h>>>22),h=m+(l^(y|~d))+p[2]+718787259&4294967295,m=y+(h<<15&4294967295|h>>>17),h=d+(y^(m|~l))+p[9]+3951481745&4294967295,f.g[0]=f.g[0]+l&4294967295,f.g[1]=f.g[1]+(m+(h<<21&4294967295|h>>>11))&4294967295,f.g[2]=f.g[2]+m&4294967295,f.g[3]=f.g[3]+y&4294967295}s.prototype.v=function(f,l){l===void 0&&(l=f.length);let d=l-this.blockSize,p=this.C,m=this.h,y=0;for(;y<l;){if(m==0)for(;y<=d;)a(this,f,y),y+=this.blockSize;if(typeof f=="string"){for(;y<l;)if(p[m++]=f.charCodeAt(y++),m==this.blockSize){a(this,p),m=0;break}}else for(;y<l;)if(p[m++]=f[y++],m==this.blockSize){a(this,p),m=0;break}}this.h=m,this.o+=l},s.prototype.A=function(){var f=Array((this.h<56?this.blockSize:this.blockSize*2)-this.h);f[0]=128;for(var l=1;l<f.length-8;++l)f[l]=0;l=this.o*8;for(var d=f.length-8;d<f.length;++d)f[d]=l&255,l/=256;for(this.v(f),f=Array(16),l=0,d=0;d<4;++d)for(let p=0;p<32;p+=8)f[l++]=this.g[d]>>>p&255;return f};function c(f,l){var d=b;return Object.prototype.hasOwnProperty.call(d,f)?d[f]:d[f]=l(f)}function E(f,l){this.h=l;let d=[],p=!0;for(let m=f.length-1;m>=0;m--){let y=f[m]|0;p&&y==l||(d[m]=y,p=!1)}this.g=d}var b={};function R(f){return-128<=f&&f<128?c(f,function(l){return new E([l|0],l<0?-1:0)}):new E([f|0],f<0?-1:0)}function V(f){if(isNaN(f)||!isFinite(f))return G;if(f<0)return Y(V(-f));let l=[],d=1;for(let p=0;f>=d;p++)l[p]=f/d|0,d*=4294967296;return new E(l,0)}function at(f,l){if(f.length==0)throw Error("number format error: empty string");if(l=l||10,l<2||36<l)throw Error("radix out of range: "+l);if(f.charAt(0)=="-")return Y(at(f.substring(1),l));if(f.indexOf("-")>=0)throw Error('number format error: interior "-" character');let d=V(Math.pow(l,8)),p=G;for(let y=0;y<f.length;y+=8){var m=Math.min(8,f.length-y);let h=parseInt(f.substring(y,y+m),l);m<8?(m=V(Math.pow(l,m)),p=p.j(m).add(V(h))):(p=p.j(d),p=p.add(V(h)))}return p}var G=R(0),Fe=R(1),de=R(16777216);i=E.prototype,i.m=function(){if(ut(this))return-Y(this).m();let f=0,l=1;for(let d=0;d<this.g.length;d++){let p=this.i(d);f+=(p>=0?p:4294967296+p)*l,l*=4294967296}return f},i.toString=function(f){if(f=f||10,f<2||36<f)throw Error("radix out of range: "+f);if(pt(this))return"0";if(ut(this))return"-"+Y(this).toString(f);let l=V(Math.pow(f,6));var d=this;let p="";for(;;){let m=pe(d,l).g;d=me(d,m.j(l));let y=((d.g.length>0?d.g[0]:d.h)>>>0).toString(f);if(d=m,pt(d))return y+p;for(;y.length<6;)y="0"+y;p=y+p}},i.i=function(f){return f<0?0:f<this.g.length?this.g[f]:this.h};function pt(f){if(f.h!=0)return!1;for(let l=0;l<f.g.length;l++)if(f.g[l]!=0)return!1;return!0}function ut(f){return f.h==-1}i.l=function(f){return f=me(this,f),ut(f)?-1:pt(f)?0:1};function Y(f){let l=f.g.length,d=[];for(let p=0;p<l;p++)d[p]=~f.g[p];return new E(d,~f.h).add(Fe)}i.abs=function(){return ut(this)?Y(this):this},i.add=function(f){let l=Math.max(this.g.length,f.g.length),d=[],p=0;for(let m=0;m<=l;m++){let y=p+(this.i(m)&65535)+(f.i(m)&65535),h=(y>>>16)+(this.i(m)>>>16)+(f.i(m)>>>16);p=h>>>16,y&=65535,h&=65535,d[m]=h<<16|y}return new E(d,d[d.length-1]&-2147483648?-1:0)};function me(f,l){return f.add(Y(l))}i.j=function(f){if(pt(this)||pt(f))return G;if(ut(this))return ut(f)?Y(this).j(Y(f)):Y(Y(this).j(f));if(ut(f))return Y(this.j(Y(f)));if(this.l(de)<0&&f.l(de)<0)return V(this.m()*f.m());let l=this.g.length+f.g.length,d=[];for(var p=0;p<2*l;p++)d[p]=0;for(p=0;p<this.g.length;p++)for(let m=0;m<f.g.length;m++){let y=this.i(p)>>>16,h=this.i(p)&65535,ct=f.i(m)>>>16,qt=f.i(m)&65535;d[2*p+2*m]+=h*qt,fe(d,2*p+2*m),d[2*p+2*m+1]+=y*qt,fe(d,2*p+2*m+1),d[2*p+2*m+1]+=h*ct,fe(d,2*p+2*m+1),d[2*p+2*m+2]+=y*ct,fe(d,2*p+2*m+2)}for(f=0;f<l;f++)d[f]=d[2*f+1]<<16|d[2*f];for(f=l;f<2*l;f++)d[f]=0;return new E(d,0)};function fe(f,l){for(;(f[l]&65535)!=f[l];)f[l+1]+=f[l]>>>16,f[l]&=65535,l++}function Ut(f,l){this.g=f,this.h=l}function pe(f,l){if(pt(l))throw Error("division by zero");if(pt(f))return new Ut(G,G);if(ut(f))return l=pe(Y(f),l),new Ut(Y(l.g),Y(l.h));if(ut(l))return l=pe(f,Y(l)),new Ut(Y(l.g),l.h);if(f.g.length>30){if(ut(f)||ut(l))throw Error("slowDivide_ only works with positive integers.");for(var d=Fe,p=l;p.l(f)<=0;)d=Lt(d),p=Lt(p);var m=gt(d,1),y=gt(p,1);for(p=gt(p,2),d=gt(d,2);!pt(p);){var h=y.add(p);h.l(f)<=0&&(m=m.add(d),y=h),p=gt(p,1),d=gt(d,1)}return l=me(f,m.j(l)),new Ut(m,l)}for(m=G;f.l(l)>=0;){for(d=Math.max(1,Math.floor(f.m()/l.m())),p=Math.ceil(Math.log(d)/Math.LN2),p=p<=48?1:Math.pow(2,p-48),y=V(d),h=y.j(l);ut(h)||h.l(f)>0;)d-=p,y=V(d),h=y.j(l);pt(y)&&(y=Fe),m=m.add(y),f=me(f,h)}return new Ut(m,f)}i.B=function(f){return pe(this,f).h},i.and=function(f){let l=Math.max(this.g.length,f.g.length),d=[];for(let p=0;p<l;p++)d[p]=this.i(p)&f.i(p);return new E(d,this.h&f.h)},i.or=function(f){let l=Math.max(this.g.length,f.g.length),d=[];for(let p=0;p<l;p++)d[p]=this.i(p)|f.i(p);return new E(d,this.h|f.h)},i.xor=function(f){let l=Math.max(this.g.length,f.g.length),d=[];for(let p=0;p<l;p++)d[p]=this.i(p)^f.i(p);return new E(d,this.h^f.h)};function Lt(f){let l=f.g.length+1,d=[];for(let p=0;p<l;p++)d[p]=f.i(p)<<1|f.i(p-1)>>>31;return new E(d,f.h)}function gt(f,l){let d=l>>5;l%=32;let p=f.g.length-d,m=[];for(let y=0;y<p;y++)m[y]=l>0?f.i(y+d)>>>l|f.i(y+d+1)<<32-l:f.i(y+d);return new E(m,f.h)}s.prototype.digest=s.prototype.A,s.prototype.reset=s.prototype.u,s.prototype.update=s.prototype.v,Us=Os.Md5=s,E.prototype.add=E.prototype.add,E.prototype.multiply=E.prototype.j,E.prototype.modulo=E.prototype.B,E.prototype.compare=E.prototype.l,E.prototype.toNumber=E.prototype.m,E.prototype.toString=E.prototype.toString,E.prototype.getBits=E.prototype.i,E.fromNumber=V,E.fromString=at,Kn=Os.Integer=E}).apply(typeof Ms<"u"?Ms:typeof self<"u"?self:typeof window<"u"?window:{});var Qn=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},Nt={};var Ls,Na,qs,Bs,js,zs,Gs,$s,Ks;(function(){var i,e=Object.defineProperty;function n(t){t=[typeof globalThis=="object"&&globalThis,t,typeof window=="object"&&window,typeof self=="object"&&self,typeof Qn=="object"&&Qn];for(var r=0;r<t.length;++r){var o=t[r];if(o&&o.Math==Math)return o}throw Error("Cannot find global object")}var s=n(this);function a(t,r){if(r)t:{var o=s;t=t.split(".");for(var u=0;u<t.length-1;u++){var g=t[u];if(!(g in o))break t;o=o[g]}t=t[t.length-1],u=o[t],r=r(u),r!=u&&r!=null&&e(o,t,{configurable:!0,writable:!0,value:r})}}a("Symbol.dispose",function(t){return t||Symbol("Symbol.dispose")}),a("Array.prototype.values",function(t){return t||function(){return this[Symbol.iterator]()}}),a("Object.entries",function(t){return t||function(r){var o=[],u;for(u in r)Object.prototype.hasOwnProperty.call(r,u)&&o.push([u,r[u]]);return o}});var c=c||{},E=this||self;function b(t){var r=typeof t;return r=="object"&&t!=null||r=="function"}function R(t,r,o){return t.call.apply(t.bind,arguments)}function V(t,r,o){return V=R,V.apply(null,arguments)}function at(t,r){var o=Array.prototype.slice.call(arguments,1);return function(){var u=o.slice();return u.push.apply(u,arguments),t.apply(this,u)}}function G(t,r){function o(){}o.prototype=r.prototype,t.Z=r.prototype,t.prototype=new o,t.prototype.constructor=t,t.Ob=function(u,g,v){for(var C=Array(arguments.length-2),D=2;D<arguments.length;D++)C[D-2]=arguments[D];return r.prototype[g].apply(u,C)}}var Fe=typeof AsyncContext<"u"&&typeof AsyncContext.Snapshot=="function"?t=>t&&AsyncContext.Snapshot.wrap(t):t=>t;function de(t){let r=t.length;if(r>0){let o=Array(r);for(let u=0;u<r;u++)o[u]=t[u];return o}return[]}function pt(t,r){for(let u=1;u<arguments.length;u++){let g=arguments[u];var o=typeof g;if(o=o!="object"?o:g?Array.isArray(g)?"array":o:"null",o=="array"||o=="object"&&typeof g.length=="number"){o=t.length||0;let v=g.length||0;t.length=o+v;for(let C=0;C<v;C++)t[o+C]=g[C]}else t.push(g)}}class ut{constructor(r,o){this.i=r,this.j=o,this.h=0,this.g=null}get(){let r;return this.h>0?(this.h--,r=this.g,this.g=r.next,r.next=null):r=this.i(),r}}function Y(t){E.setTimeout(()=>{throw t},0)}function me(){var t=f;let r=null;return t.g&&(r=t.g,t.g=t.g.next,t.g||(t.h=null),r.next=null),r}class fe{constructor(){this.h=this.g=null}add(r,o){let u=Ut.get();u.set(r,o),this.h?this.h.next=u:this.g=u,this.h=u}}var Ut=new ut(()=>new pe,t=>t.reset());class pe{constructor(){this.next=this.g=this.h=null}set(r,o){this.h=r,this.g=o,this.next=null}reset(){this.next=this.g=this.h=null}}let Lt,gt=!1,f=new fe,l=()=>{let t=Promise.resolve(void 0);Lt=()=>{t.then(d)}};function d(){for(var t;t=me();){try{t.h.call(t.g)}catch(o){Y(o)}var r=Ut;r.j(t),r.h<100&&(r.h++,t.next=r.g,r.g=t)}gt=!1}function p(){this.u=this.u,this.C=this.C}p.prototype.u=!1,p.prototype.dispose=function(){this.u||(this.u=!0,this.N())},p.prototype[Symbol.dispose]=function(){this.dispose()},p.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()};function m(t,r){this.type=t,this.g=this.target=r,this.defaultPrevented=!1}m.prototype.h=function(){this.defaultPrevented=!0};var y=(function(){if(!E.addEventListener||!Object.defineProperty)return!1;var t=!1,r=Object.defineProperty({},"passive",{get:function(){t=!0}});try{let o=()=>{};E.addEventListener("test",o,r),E.removeEventListener("test",o,r)}catch{}return t})();function h(t){return/^[\s\xa0]*$/.test(t)}function ct(t,r){m.call(this,t?t.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,t&&this.init(t,r)}G(ct,m),ct.prototype.init=function(t,r){let o=this.type=t.type,u=t.changedTouches&&t.changedTouches.length?t.changedTouches[0]:null;this.target=t.target||t.srcElement,this.g=r,r=t.relatedTarget,r||(o=="mouseover"?r=t.fromElement:o=="mouseout"&&(r=t.toElement)),this.relatedTarget=r,u?(this.clientX=u.clientX!==void 0?u.clientX:u.pageX,this.clientY=u.clientY!==void 0?u.clientY:u.pageY,this.screenX=u.screenX||0,this.screenY=u.screenY||0):(this.clientX=t.clientX!==void 0?t.clientX:t.pageX,this.clientY=t.clientY!==void 0?t.clientY:t.pageY,this.screenX=t.screenX||0,this.screenY=t.screenY||0),this.button=t.button,this.key=t.key||"",this.ctrlKey=t.ctrlKey,this.altKey=t.altKey,this.shiftKey=t.shiftKey,this.metaKey=t.metaKey,this.pointerId=t.pointerId||0,this.pointerType=t.pointerType,this.state=t.state,this.i=t,t.defaultPrevented&&ct.Z.h.call(this)},ct.prototype.h=function(){ct.Z.h.call(this);let t=this.i;t.preventDefault?t.preventDefault():t.returnValue=!1};var qt="closure_listenable_"+(Math.random()*1e6|0),qo=0;function Bo(t,r,o,u,g){this.listener=t,this.proxy=null,this.src=r,this.type=o,this.capture=!!u,this.ha=g,this.key=++qo,this.da=this.fa=!1}function hn(t){t.da=!0,t.listener=null,t.proxy=null,t.src=null,t.ha=null}function dn(t,r,o){for(let u in t)r.call(o,t[u],u,t)}function jo(t,r){for(let o in t)r.call(void 0,t[o],o,t)}function rr(t){let r={};for(let o in t)r[o]=t[o];return r}let sr="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function or(t,r){let o,u;for(let g=1;g<arguments.length;g++){u=arguments[g];for(o in u)t[o]=u[o];for(let v=0;v<sr.length;v++)o=sr[v],Object.prototype.hasOwnProperty.call(u,o)&&(t[o]=u[o])}}function mn(t){this.src=t,this.g={},this.h=0}mn.prototype.add=function(t,r,o,u,g){let v=t.toString();t=this.g[v],t||(t=this.g[v]=[],this.h++);let C=ci(t,r,u,g);return C>-1?(r=t[C],o||(r.fa=!1)):(r=new Bo(r,this.src,v,!!u,g),r.fa=o,t.push(r)),r};function ui(t,r){let o=r.type;if(o in t.g){var u=t.g[o],g=Array.prototype.indexOf.call(u,r,void 0),v;(v=g>=0)&&Array.prototype.splice.call(u,g,1),v&&(hn(r),t.g[o].length==0&&(delete t.g[o],t.h--))}}function ci(t,r,o,u){for(let g=0;g<t.length;++g){let v=t[g];if(!v.da&&v.listener==r&&v.capture==!!o&&v.ha==u)return g}return-1}var li="closure_lm_"+(Math.random()*1e6|0),hi={};function ar(t,r,o,u,g){if(u&&u.once)return cr(t,r,o,u,g);if(Array.isArray(r)){for(let v=0;v<r.length;v++)ar(t,r[v],o,u,g);return null}return o=pi(o),t&&t[qt]?t.J(r,o,b(u)?!!u.capture:!!u,g):ur(t,r,o,!1,u,g)}function ur(t,r,o,u,g,v){if(!r)throw Error("Invalid event type");let C=b(g)?!!g.capture:!!g,D=mi(t);if(D||(t[li]=D=new mn(t)),o=D.add(r,o,u,C,v),o.proxy)return o;if(u=zo(),o.proxy=u,u.src=t,u.listener=o,t.addEventListener)y||(g=C),g===void 0&&(g=!1),t.addEventListener(r.toString(),u,g);else if(t.attachEvent)t.attachEvent(hr(r.toString()),u);else if(t.addListener&&t.removeListener)t.addListener(u);else throw Error("addEventListener and attachEvent are unavailable.");return o}function zo(){function t(o){return r.call(t.src,t.listener,o)}let r=Go;return t}function cr(t,r,o,u,g){if(Array.isArray(r)){for(let v=0;v<r.length;v++)cr(t,r[v],o,u,g);return null}return o=pi(o),t&&t[qt]?t.K(r,o,b(u)?!!u.capture:!!u,g):ur(t,r,o,!0,u,g)}function lr(t,r,o,u,g){if(Array.isArray(r))for(var v=0;v<r.length;v++)lr(t,r[v],o,u,g);else u=b(u)?!!u.capture:!!u,o=pi(o),t&&t[qt]?(t=t.i,v=String(r).toString(),v in t.g&&(r=t.g[v],o=ci(r,o,u,g),o>-1&&(hn(r[o]),Array.prototype.splice.call(r,o,1),r.length==0&&(delete t.g[v],t.h--)))):t&&(t=mi(t))&&(r=t.g[r.toString()],t=-1,r&&(t=ci(r,o,u,g)),(o=t>-1?r[t]:null)&&di(o))}function di(t){if(typeof t!="number"&&t&&!t.da){var r=t.src;if(r&&r[qt])ui(r.i,t);else{var o=t.type,u=t.proxy;r.removeEventListener?r.removeEventListener(o,u,t.capture):r.detachEvent?r.detachEvent(hr(o),u):r.addListener&&r.removeListener&&r.removeListener(u),(o=mi(r))?(ui(o,t),o.h==0&&(o.src=null,r[li]=null)):hn(t)}}}function hr(t){return t in hi?hi[t]:hi[t]="on"+t}function Go(t,r){if(t.da)t=!0;else{r=new ct(r,this);let o=t.listener,u=t.ha||t.src;t.fa&&di(t),t=o.call(u,r)}return t}function mi(t){return t=t[li],t instanceof mn?t:null}var fi="__closure_events_fn_"+(Math.random()*1e9>>>0);function pi(t){return typeof t=="function"?t:(t[fi]||(t[fi]=function(r){return t.handleEvent(r)}),t[fi])}function nt(){p.call(this),this.i=new mn(this),this.M=this,this.G=null}G(nt,p),nt.prototype[qt]=!0,nt.prototype.removeEventListener=function(t,r,o,u){lr(this,t,r,o,u)};function it(t,r){var o,u=t.G;if(u)for(o=[];u;u=u.G)o.push(u);if(t=t.M,u=r.type||r,typeof r=="string")r=new m(r,t);else if(r instanceof m)r.target=r.target||t;else{var g=r;r=new m(u,t),or(r,g)}g=!0;let v,C;if(o)for(C=o.length-1;C>=0;C--)v=r.g=o[C],g=fn(v,u,!0,r)&&g;if(v=r.g=t,g=fn(v,u,!0,r)&&g,g=fn(v,u,!1,r)&&g,o)for(C=0;C<o.length;C++)v=r.g=o[C],g=fn(v,u,!1,r)&&g}nt.prototype.N=function(){if(nt.Z.N.call(this),this.i){var t=this.i;for(let r in t.g){let o=t.g[r];for(let u=0;u<o.length;u++)hn(o[u]);delete t.g[r],t.h--}}this.G=null},nt.prototype.J=function(t,r,o,u){return this.i.add(String(t),r,!1,o,u)},nt.prototype.K=function(t,r,o,u){return this.i.add(String(t),r,!0,o,u)};function fn(t,r,o,u){if(r=t.i.g[String(r)],!r)return!0;r=r.concat();let g=!0;for(let v=0;v<r.length;++v){let C=r[v];if(C&&!C.da&&C.capture==o){let D=C.listener,Z=C.ha||C.src;C.fa&&ui(t.i,C),g=D.call(Z,u)!==!1&&g}}return g&&!u.defaultPrevented}function $o(t,r){if(typeof t!="function")if(t&&typeof t.handleEvent=="function")t=V(t.handleEvent,t);else throw Error("Invalid listener argument");return Number(r)>2147483647?-1:E.setTimeout(t,r||0)}function dr(t){t.g=$o(()=>{t.g=null,t.i&&(t.i=!1,dr(t))},t.l);let r=t.h;t.h=null,t.m.apply(null,r)}class Ko extends p{constructor(r,o){super(),this.m=r,this.l=o,this.h=null,this.i=!1,this.g=null}j(r){this.h=arguments,this.g?this.i=!0:dr(this)}N(){super.N(),this.g&&(E.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function Me(t){p.call(this),this.h=t,this.g={}}G(Me,p);var mr=[];function fr(t){dn(t.g,function(r,o){this.g.hasOwnProperty(o)&&di(r)},t),t.g={}}Me.prototype.N=function(){Me.Z.N.call(this),fr(this)},Me.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var gi=E.JSON.stringify,Qo=E.JSON.parse,Wo=class{stringify(t){return E.JSON.stringify(t,void 0)}parse(t){return E.JSON.parse(t,void 0)}};function pr(){}function gr(){}var Oe={OPEN:"a",hb:"b",ERROR:"c",tb:"d"};function _i(){m.call(this,"d")}G(_i,m);function yi(){m.call(this,"c")}G(yi,m);var Yt={},_r=null;function pn(){return _r=_r||new nt}Yt.Ia="serverreachability";function yr(t){m.call(this,Yt.Ia,t)}G(yr,m);function Ue(t){let r=pn();it(r,new yr(r))}Yt.STAT_EVENT="statevent";function wr(t,r){m.call(this,Yt.STAT_EVENT,t),this.stat=r}G(wr,m);function rt(t){let r=pn();it(r,new wr(r,t))}Yt.Ja="timingevent";function Er(t,r){m.call(this,Yt.Ja,t),this.size=r}G(Er,m);function Le(t,r){if(typeof t!="function")throw Error("Fn must not be null and must be a function");return E.setTimeout(function(){t()},r)}function qe(){this.g=!0}qe.prototype.ua=function(){this.g=!1};function Ho(t,r,o,u,g,v){t.info(function(){if(t.g)if(v){var C="",D=v.split("&");for(let B=0;B<D.length;B++){var Z=D[B].split("=");if(Z.length>1){let tt=Z[0];Z=Z[1];let Et=tt.split("_");C=Et.length>=2&&Et[1]=="type"?C+(tt+"="+Z+"&"):C+(tt+"=redacted&")}}}else C=null;else C=v;return"XMLHTTP REQ ("+u+") [attempt "+g+"]: "+r+`
`+o+`
`+C})}function Jo(t,r,o,u,g,v,C){t.info(function(){return"XMLHTTP RESP ("+u+") [ attempt "+g+"]: "+r+`
`+o+`
`+v+" "+C})}function ge(t,r,o,u){t.info(function(){return"XMLHTTP TEXT ("+r+"): "+Yo(t,o)+(u?" "+u:"")})}function Xo(t,r){t.info(function(){return"TIMEOUT: "+r})}qe.prototype.info=function(){};function Yo(t,r){if(!t.g)return r;if(!r)return null;try{let v=JSON.parse(r);if(v){for(t=0;t<v.length;t++)if(Array.isArray(v[t])){var o=v[t];if(!(o.length<2)){var u=o[1];if(Array.isArray(u)&&!(u.length<1)){var g=u[0];if(g!="noop"&&g!="stop"&&g!="close")for(let C=1;C<u.length;C++)u[C]=""}}}}return gi(v)}catch{return r}}var gn={NO_ERROR:0,cb:1,qb:2,pb:3,kb:4,ob:5,rb:6,Ga:7,TIMEOUT:8,ub:9},vr={ib:"complete",Fb:"success",ERROR:"error",Ga:"abort",xb:"ready",yb:"readystatechange",TIMEOUT:"timeout",sb:"incrementaldata",wb:"progress",lb:"downloadprogress",Nb:"uploadprogress"},Tr;function wi(){}G(wi,pr),wi.prototype.g=function(){return new XMLHttpRequest},Tr=new wi;function Be(t){return encodeURIComponent(String(t))}function Zo(t){var r=1;t=t.split(":");let o=[];for(;r>0&&t.length;)o.push(t.shift()),r--;return t.length&&o.push(t.join(":")),o}function Bt(t,r,o,u){this.j=t,this.i=r,this.l=o,this.S=u||1,this.V=new Me(this),this.H=45e3,this.J=null,this.o=!1,this.u=this.B=this.A=this.M=this.F=this.T=this.D=null,this.G=[],this.g=null,this.C=0,this.m=this.v=null,this.X=-1,this.K=!1,this.P=0,this.O=null,this.W=this.L=this.U=this.R=!1,this.h=new Ir}function Ir(){this.i=null,this.g="",this.h=!1}var Ar={},Ei={};function vi(t,r,o){t.M=1,t.A=yn(wt(r)),t.u=o,t.R=!0,Cr(t,null)}function Cr(t,r){t.F=Date.now(),_n(t),t.B=wt(t.A);var o=t.B,u=t.S;Array.isArray(u)||(u=[String(u)]),Ur(o.i,"t",u),t.C=0,o=t.j.L,t.h=new Ir,t.g=ns(t.j,o?r:null,!t.u),t.P>0&&(t.O=new Ko(V(t.Y,t,t.g),t.P)),r=t.V,o=t.g,u=t.ba;var g="readystatechange";Array.isArray(g)||(g&&(mr[0]=g.toString()),g=mr);for(let v=0;v<g.length;v++){let C=ar(o,g[v],u||r.handleEvent,!1,r.h||r);if(!C)break;r.g[C.key]=C}r=t.J?rr(t.J):{},t.u?(t.v||(t.v="POST"),r["Content-Type"]="application/x-www-form-urlencoded",t.g.ea(t.B,t.v,t.u,r)):(t.v="GET",t.g.ea(t.B,t.v,null,r)),Ue(),Ho(t.i,t.v,t.B,t.l,t.S,t.u)}Bt.prototype.ba=function(t){t=t.target;let r=this.O;r&&Gt(t)==3?r.j():this.Y(t)},Bt.prototype.Y=function(t){try{if(t==this.g)t:{let D=Gt(this.g),Z=this.g.ya(),B=this.g.ca();if(!(D<3)&&(D!=3||this.g&&(this.h.h||this.g.la()||$r(this.g)))){this.K||D!=4||Z==7||(Z==8||B<=0?Ue(3):Ue(2)),Ti(this);var r=this.g.ca();this.X=r;var o=ta(this);if(this.o=r==200,Jo(this.i,this.v,this.B,this.l,this.S,D,r),this.o){if(this.U&&!this.L){e:{if(this.g){var u,g=this.g;if((u=g.g?g.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!h(u)){var v=u;break e}}v=null}if(t=v)ge(this.i,this.l,t,"Initial handshake response via X-HTTP-Initial-Response"),this.L=!0,Ii(this,t);else{this.o=!1,this.m=3,rt(12),Zt(this),je(this);break t}}if(this.R){t=!0;let tt;for(;!this.K&&this.C<o.length;)if(tt=ea(this,o),tt==Ei){D==4&&(this.m=4,rt(14),t=!1),ge(this.i,this.l,null,"[Incomplete Response]");break}else if(tt==Ar){this.m=4,rt(15),ge(this.i,this.l,o,"[Invalid Chunk]"),t=!1;break}else ge(this.i,this.l,tt,null),Ii(this,tt);if(br(this)&&this.C!=0&&(this.h.g=this.h.g.slice(this.C),this.C=0),D!=4||o.length!=0||this.h.h||(this.m=1,rt(16),t=!1),this.o=this.o&&t,!t)ge(this.i,this.l,o,"[Invalid Chunked Response]"),Zt(this),je(this);else if(o.length>0&&!this.W){this.W=!0;var C=this.j;C.g==this&&C.aa&&!C.P&&(C.j.info("Great, no buffering proxy detected. Bytes received: "+o.length),Ri(C),C.P=!0,rt(11))}}else ge(this.i,this.l,o,null),Ii(this,o);D==4&&Zt(this),this.o&&!this.K&&(D==4?Yr(this.j,this):(this.o=!1,_n(this)))}else pa(this.g),r==400&&o.indexOf("Unknown SID")>0?(this.m=3,rt(12)):(this.m=0,rt(13)),Zt(this),je(this)}}}catch{}finally{}};function ta(t){if(!br(t))return t.g.la();let r=$r(t.g);if(r==="")return"";let o="",u=r.length,g=Gt(t.g)==4;if(!t.h.i){if(typeof TextDecoder>"u")return Zt(t),je(t),"";t.h.i=new E.TextDecoder}for(let v=0;v<u;v++)t.h.h=!0,o+=t.h.i.decode(r[v],{stream:!(g&&v==u-1)});return r.length=0,t.h.g+=o,t.C=0,t.h.g}function br(t){return t.g?t.v=="GET"&&t.M!=2&&t.j.Aa:!1}function ea(t,r){var o=t.C,u=r.indexOf(`
`,o);return u==-1?Ei:(o=Number(r.substring(o,u)),isNaN(o)?Ar:(u+=1,u+o>r.length?Ei:(r=r.slice(u,u+o),t.C=u+o,r)))}Bt.prototype.cancel=function(){this.K=!0,Zt(this)};function _n(t){t.T=Date.now()+t.H,Sr(t,t.H)}function Sr(t,r){if(t.D!=null)throw Error("WatchDog timer not null");t.D=Le(V(t.aa,t),r)}function Ti(t){t.D&&(E.clearTimeout(t.D),t.D=null)}Bt.prototype.aa=function(){this.D=null;let t=Date.now();t-this.T>=0?(Xo(this.i,this.B),this.M!=2&&(Ue(),rt(17)),Zt(this),this.m=2,je(this)):Sr(this,this.T-t)};function je(t){t.j.I==0||t.K||Yr(t.j,t)}function Zt(t){Ti(t);var r=t.O;r&&typeof r.dispose=="function"&&r.dispose(),t.O=null,fr(t.V),t.g&&(r=t.g,t.g=null,r.abort(),r.dispose())}function Ii(t,r){try{var o=t.j;if(o.I!=0&&(o.g==t||Ai(o.h,t))){if(!t.L&&Ai(o.h,t)&&o.I==3){try{var u=o.Ba.g.parse(r)}catch{u=null}if(Array.isArray(u)&&u.length==3){var g=u;if(g[0]==0){t:if(!o.v){if(o.g)if(o.g.F+3e3<t.F)An(o),Tn(o);else break t;Pi(o),rt(18)}}else o.xa=g[1],0<o.xa-o.K&&g[2]<37500&&o.F&&o.A==0&&!o.C&&(o.C=Le(V(o.Va,o),6e3));Rr(o.h)<=1&&o.ta&&(o.ta=void 0)}else ee(o,11)}else if((t.L||o.g==t)&&An(o),!h(r))for(g=o.Ba.g.parse(r),r=0;r<g.length;r++){let B=g[r],tt=B[0];if(!(tt<=o.K))if(o.K=tt,B=B[1],o.I==2)if(B[0]=="c"){o.M=B[1],o.ba=B[2];let Et=B[3];Et!=null&&(o.ka=Et,o.j.info("VER="+o.ka));let ne=B[4];ne!=null&&(o.za=ne,o.j.info("SVER="+o.za));let $t=B[5];$t!=null&&typeof $t=="number"&&$t>0&&(u=1.5*$t,o.O=u,o.j.info("backChannelRequestTimeoutMs_="+u)),u=o;let Kt=t.g;if(Kt){let bn=Kt.g?Kt.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(bn){var v=u.h;v.g||bn.indexOf("spdy")==-1&&bn.indexOf("quic")==-1&&bn.indexOf("h2")==-1||(v.j=v.l,v.g=new Set,v.h&&(Ci(v,v.h),v.h=null))}if(u.G){let Di=Kt.g?Kt.g.getResponseHeader("X-HTTP-Session-Id"):null;Di&&(u.wa=Di,$(u.J,u.G,Di))}}o.I=3,o.l&&o.l.ra(),o.aa&&(o.T=Date.now()-t.F,o.j.info("Handshake RTT: "+o.T+"ms")),u=o;var C=t;if(u.na=es(u,u.L?u.ba:null,u.W),C.L){Dr(u.h,C);var D=C,Z=u.O;Z&&(D.H=Z),D.D&&(Ti(D),_n(D)),u.g=C}else Jr(u);o.i.length>0&&In(o)}else B[0]!="stop"&&B[0]!="close"||ee(o,7);else o.I==3&&(B[0]=="stop"||B[0]=="close"?B[0]=="stop"?ee(o,7):xi(o):B[0]!="noop"&&o.l&&o.l.qa(B),o.A=0)}}Ue(4)}catch{}}var na=class{constructor(t,r){this.g=t,this.map=r}};function xr(t){this.l=t||10,E.PerformanceNavigationTiming?(t=E.performance.getEntriesByType("navigation"),t=t.length>0&&(t[0].nextHopProtocol=="hq"||t[0].nextHopProtocol=="h2")):t=!!(E.chrome&&E.chrome.loadTimes&&E.chrome.loadTimes()&&E.chrome.loadTimes().wasFetchedViaSpdy),this.j=t?this.l:1,this.g=null,this.j>1&&(this.g=new Set),this.h=null,this.i=[]}function Pr(t){return t.h?!0:t.g?t.g.size>=t.j:!1}function Rr(t){return t.h?1:t.g?t.g.size:0}function Ai(t,r){return t.h?t.h==r:t.g?t.g.has(r):!1}function Ci(t,r){t.g?t.g.add(r):t.h=r}function Dr(t,r){t.h&&t.h==r?t.h=null:t.g&&t.g.has(r)&&t.g.delete(r)}xr.prototype.cancel=function(){if(this.i=Vr(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&this.g.size!==0){for(let t of this.g.values())t.cancel();this.g.clear()}};function Vr(t){if(t.h!=null)return t.i.concat(t.h.G);if(t.g!=null&&t.g.size!==0){let r=t.i;for(let o of t.g.values())r=r.concat(o.G);return r}return de(t.i)}var Nr=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function ia(t,r){if(t){t=t.split("&");for(let o=0;o<t.length;o++){let u=t[o].indexOf("="),g,v=null;u>=0?(g=t[o].substring(0,u),v=t[o].substring(u+1)):g=t[o],r(g,v?decodeURIComponent(v.replace(/\+/g," ")):"")}}}function jt(t){this.g=this.o=this.j="",this.u=null,this.m=this.h="",this.l=!1;let r;t instanceof jt?(this.l=t.l,ze(this,t.j),this.o=t.o,this.g=t.g,Ge(this,t.u),this.h=t.h,bi(this,Lr(t.i)),this.m=t.m):t&&(r=String(t).match(Nr))?(this.l=!1,ze(this,r[1]||"",!0),this.o=$e(r[2]||""),this.g=$e(r[3]||"",!0),Ge(this,r[4]),this.h=$e(r[5]||"",!0),bi(this,r[6]||"",!0),this.m=$e(r[7]||"")):(this.l=!1,this.i=new Qe(null,this.l))}jt.prototype.toString=function(){let t=[];var r=this.j;r&&t.push(Ke(r,kr,!0),":");var o=this.g;return(o||r=="file")&&(t.push("//"),(r=this.o)&&t.push(Ke(r,kr,!0),"@"),t.push(Be(o).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),o=this.u,o!=null&&t.push(":",String(o))),(o=this.h)&&(this.g&&o.charAt(0)!="/"&&t.push("/"),t.push(Ke(o,o.charAt(0)=="/"?oa:sa,!0))),(o=this.i.toString())&&t.push("?",o),(o=this.m)&&t.push("#",Ke(o,ua)),t.join("")},jt.prototype.resolve=function(t){let r=wt(this),o=!!t.j;o?ze(r,t.j):o=!!t.o,o?r.o=t.o:o=!!t.g,o?r.g=t.g:o=t.u!=null;var u=t.h;if(o)Ge(r,t.u);else if(o=!!t.h){if(u.charAt(0)!="/")if(this.g&&!this.h)u="/"+u;else{var g=r.h.lastIndexOf("/");g!=-1&&(u=r.h.slice(0,g+1)+u)}if(g=u,g==".."||g==".")u="";else if(g.indexOf("./")!=-1||g.indexOf("/.")!=-1){u=g.lastIndexOf("/",0)==0,g=g.split("/");let v=[];for(let C=0;C<g.length;){let D=g[C++];D=="."?u&&C==g.length&&v.push(""):D==".."?((v.length>1||v.length==1&&v[0]!="")&&v.pop(),u&&C==g.length&&v.push("")):(v.push(D),u=!0)}u=v.join("/")}else u=g}return o?r.h=u:o=t.i.toString()!=="",o?bi(r,Lr(t.i)):o=!!t.m,o&&(r.m=t.m),r};function wt(t){return new jt(t)}function ze(t,r,o){t.j=o?$e(r,!0):r,t.j&&(t.j=t.j.replace(/:$/,""))}function Ge(t,r){if(r){if(r=Number(r),isNaN(r)||r<0)throw Error("Bad port number "+r);t.u=r}else t.u=null}function bi(t,r,o){r instanceof Qe?(t.i=r,ca(t.i,t.l)):(o||(r=Ke(r,aa)),t.i=new Qe(r,t.l))}function $(t,r,o){t.i.set(r,o)}function yn(t){return $(t,"zx",Math.floor(Math.random()*2147483648).toString(36)+Math.abs(Math.floor(Math.random()*2147483648)^Date.now()).toString(36)),t}function $e(t,r){return t?r?decodeURI(t.replace(/%25/g,"%2525")):decodeURIComponent(t):""}function Ke(t,r,o){return typeof t=="string"?(t=encodeURI(t).replace(r,ra),o&&(t=t.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),t):null}function ra(t){return t=t.charCodeAt(0),"%"+(t>>4&15).toString(16)+(t&15).toString(16)}var kr=/[#\/\?@]/g,sa=/[#\?:]/g,oa=/[#\?]/g,aa=/[#\?@]/g,ua=/#/g;function Qe(t,r){this.h=this.g=null,this.i=t||null,this.j=!!r}function te(t){t.g||(t.g=new Map,t.h=0,t.i&&ia(t.i,function(r,o){t.add(decodeURIComponent(r.replace(/\+/g," ")),o)}))}i=Qe.prototype,i.add=function(t,r){te(this),this.i=null,t=_e(this,t);let o=this.g.get(t);return o||this.g.set(t,o=[]),o.push(r),this.h+=1,this};function Fr(t,r){te(t),r=_e(t,r),t.g.has(r)&&(t.i=null,t.h-=t.g.get(r).length,t.g.delete(r))}function Mr(t,r){return te(t),r=_e(t,r),t.g.has(r)}i.forEach=function(t,r){te(this),this.g.forEach(function(o,u){o.forEach(function(g){t.call(r,g,u,this)},this)},this)};function Or(t,r){te(t);let o=[];if(typeof r=="string")Mr(t,r)&&(o=o.concat(t.g.get(_e(t,r))));else for(t=Array.from(t.g.values()),r=0;r<t.length;r++)o=o.concat(t[r]);return o}i.set=function(t,r){return te(this),this.i=null,t=_e(this,t),Mr(this,t)&&(this.h-=this.g.get(t).length),this.g.set(t,[r]),this.h+=1,this},i.get=function(t,r){return t?(t=Or(this,t),t.length>0?String(t[0]):r):r};function Ur(t,r,o){Fr(t,r),o.length>0&&(t.i=null,t.g.set(_e(t,r),de(o)),t.h+=o.length)}i.toString=function(){if(this.i)return this.i;if(!this.g)return"";let t=[],r=Array.from(this.g.keys());for(let u=0;u<r.length;u++){var o=r[u];let g=Be(o);o=Or(this,o);for(let v=0;v<o.length;v++){let C=g;o[v]!==""&&(C+="="+Be(o[v])),t.push(C)}}return this.i=t.join("&")};function Lr(t){let r=new Qe;return r.i=t.i,t.g&&(r.g=new Map(t.g),r.h=t.h),r}function _e(t,r){return r=String(r),t.j&&(r=r.toLowerCase()),r}function ca(t,r){r&&!t.j&&(te(t),t.i=null,t.g.forEach(function(o,u){let g=u.toLowerCase();u!=g&&(Fr(this,u),Ur(this,g,o))},t)),t.j=r}function la(t,r){let o=new qe;if(E.Image){let u=new Image;u.onload=at(zt,o,"TestLoadImage: loaded",!0,r,u),u.onerror=at(zt,o,"TestLoadImage: error",!1,r,u),u.onabort=at(zt,o,"TestLoadImage: abort",!1,r,u),u.ontimeout=at(zt,o,"TestLoadImage: timeout",!1,r,u),E.setTimeout(function(){u.ontimeout&&u.ontimeout()},1e4),u.src=t}else r(!1)}function ha(t,r){let o=new qe,u=new AbortController,g=setTimeout(()=>{u.abort(),zt(o,"TestPingServer: timeout",!1,r)},1e4);fetch(t,{signal:u.signal}).then(v=>{clearTimeout(g),v.ok?zt(o,"TestPingServer: ok",!0,r):zt(o,"TestPingServer: server error",!1,r)}).catch(()=>{clearTimeout(g),zt(o,"TestPingServer: error",!1,r)})}function zt(t,r,o,u,g){try{g&&(g.onload=null,g.onerror=null,g.onabort=null,g.ontimeout=null),u(o)}catch{}}function da(){this.g=new Wo}function wn(t){this.i=t.Sb||null,this.h=t.ab||!1}G(wn,pr),wn.prototype.g=function(){return new En(this.i,this.h)};function En(t,r){nt.call(this),this.H=t,this.o=r,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.A=new Headers,this.h=null,this.F="GET",this.D="",this.g=!1,this.B=this.j=this.l=null,this.v=new AbortController}G(En,nt),i=En.prototype,i.open=function(t,r){if(this.readyState!=0)throw this.abort(),Error("Error reopening a connection");this.F=t,this.D=r,this.readyState=1,He(this)},i.send=function(t){if(this.readyState!=1)throw this.abort(),Error("need to call open() first. ");if(this.v.signal.aborted)throw this.abort(),Error("Request was aborted.");this.g=!0;let r={headers:this.A,method:this.F,credentials:this.m,cache:void 0,signal:this.v.signal};t&&(r.body=t),(this.H||E).fetch(new Request(this.D,r)).then(this.Pa.bind(this),this.ga.bind(this))},i.abort=function(){this.response=this.responseText="",this.A=new Headers,this.status=0,this.v.abort(),this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),this.readyState>=1&&this.g&&this.readyState!=4&&(this.g=!1,We(this)),this.readyState=0},i.Pa=function(t){if(this.g&&(this.l=t,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=t.headers,this.readyState=2,He(this)),this.g&&(this.readyState=3,He(this),this.g)))if(this.responseType==="arraybuffer")t.arrayBuffer().then(this.Na.bind(this),this.ga.bind(this));else if(typeof E.ReadableStream<"u"&&"body"in t){if(this.j=t.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.B=new TextDecoder;qr(this)}else t.text().then(this.Oa.bind(this),this.ga.bind(this))};function qr(t){t.j.read().then(t.Ma.bind(t)).catch(t.ga.bind(t))}i.Ma=function(t){if(this.g){if(this.o&&t.value)this.response.push(t.value);else if(!this.o){var r=t.value?t.value:new Uint8Array(0);(r=this.B.decode(r,{stream:!t.done}))&&(this.response=this.responseText+=r)}t.done?We(this):He(this),this.readyState==3&&qr(this)}},i.Oa=function(t){this.g&&(this.response=this.responseText=t,We(this))},i.Na=function(t){this.g&&(this.response=t,We(this))},i.ga=function(){this.g&&We(this)};function We(t){t.readyState=4,t.l=null,t.j=null,t.B=null,He(t)}i.setRequestHeader=function(t,r){this.A.append(t,r)},i.getResponseHeader=function(t){return this.h&&this.h.get(t.toLowerCase())||""},i.getAllResponseHeaders=function(){if(!this.h)return"";let t=[],r=this.h.entries();for(var o=r.next();!o.done;)o=o.value,t.push(o[0]+": "+o[1]),o=r.next();return t.join(`\r
`)};function He(t){t.onreadystatechange&&t.onreadystatechange.call(t)}Object.defineProperty(En.prototype,"withCredentials",{get:function(){return this.m==="include"},set:function(t){this.m=t?"include":"same-origin"}});function Br(t){let r="";return dn(t,function(o,u){r+=u,r+=":",r+=o,r+=`\r
`}),r}function Si(t,r,o){t:{for(u in o){var u=!1;break t}u=!0}u||(o=Br(o),typeof t=="string"?o!=null&&Be(o):$(t,r,o))}function W(t){nt.call(this),this.headers=new Map,this.L=t||null,this.h=!1,this.g=null,this.D="",this.o=0,this.l="",this.j=this.B=this.v=this.A=!1,this.m=null,this.F="",this.H=!1}G(W,nt);var ma=/^https?$/i,fa=["POST","PUT"];i=W.prototype,i.Fa=function(t){this.H=t},i.ea=function(t,r,o,u){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+t);r=r?r.toUpperCase():"GET",this.D=t,this.l="",this.o=0,this.A=!1,this.h=!0,this.g=this.L?this.L.g():Tr.g(),this.g.onreadystatechange=Fe(V(this.Ca,this));try{this.B=!0,this.g.open(r,String(t),!0),this.B=!1}catch(v){jr(this,v);return}if(t=o||"",o=new Map(this.headers),u)if(Object.getPrototypeOf(u)===Object.prototype)for(var g in u)o.set(g,u[g]);else if(typeof u.keys=="function"&&typeof u.get=="function")for(let v of u.keys())o.set(v,u.get(v));else throw Error("Unknown input type for opt_headers: "+String(u));u=Array.from(o.keys()).find(v=>v.toLowerCase()=="content-type"),g=E.FormData&&t instanceof E.FormData,!(Array.prototype.indexOf.call(fa,r,void 0)>=0)||u||g||o.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(let[v,C]of o)this.g.setRequestHeader(v,C);this.F&&(this.g.responseType=this.F),"withCredentials"in this.g&&this.g.withCredentials!==this.H&&(this.g.withCredentials=this.H);try{this.m&&(clearTimeout(this.m),this.m=null),this.v=!0,this.g.send(t),this.v=!1}catch(v){jr(this,v)}};function jr(t,r){t.h=!1,t.g&&(t.j=!0,t.g.abort(),t.j=!1),t.l=r,t.o=5,zr(t),vn(t)}function zr(t){t.A||(t.A=!0,it(t,"complete"),it(t,"error"))}i.abort=function(t){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.o=t||7,it(this,"complete"),it(this,"abort"),vn(this))},i.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),vn(this,!0)),W.Z.N.call(this)},i.Ca=function(){this.u||(this.B||this.v||this.j?Gr(this):this.Xa())},i.Xa=function(){Gr(this)};function Gr(t){if(t.h&&typeof c<"u"){if(t.v&&Gt(t)==4)setTimeout(t.Ca.bind(t),0);else if(it(t,"readystatechange"),Gt(t)==4){t.h=!1;try{let v=t.ca();t:switch(v){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var r=!0;break t;default:r=!1}var o;if(!(o=r)){var u;if(u=v===0){let C=String(t.D).match(Nr)[1]||null;!C&&E.self&&E.self.location&&(C=E.self.location.protocol.slice(0,-1)),u=!ma.test(C?C.toLowerCase():"")}o=u}if(o)it(t,"complete"),it(t,"success");else{t.o=6;try{var g=Gt(t)>2?t.g.statusText:""}catch{g=""}t.l=g+" ["+t.ca()+"]",zr(t)}}finally{vn(t)}}}}function vn(t,r){if(t.g){t.m&&(clearTimeout(t.m),t.m=null);let o=t.g;t.g=null,r||it(t,"ready");try{o.onreadystatechange=null}catch{}}}i.isActive=function(){return!!this.g};function Gt(t){return t.g?t.g.readyState:0}i.ca=function(){try{return Gt(this)>2?this.g.status:-1}catch{return-1}},i.la=function(){try{return this.g?this.g.responseText:""}catch{return""}},i.La=function(t){if(this.g){var r=this.g.responseText;return t&&r.indexOf(t)==0&&(r=r.substring(t.length)),Qo(r)}};function $r(t){try{if(!t.g)return null;if("response"in t.g)return t.g.response;switch(t.F){case"":case"text":return t.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in t.g)return t.g.mozResponseArrayBuffer}return null}catch{return null}}function pa(t){let r={};t=(t.g&&Gt(t)>=2&&t.g.getAllResponseHeaders()||"").split(`\r
`);for(let u=0;u<t.length;u++){if(h(t[u]))continue;var o=Zo(t[u]);let g=o[0];if(o=o[1],typeof o!="string")continue;o=o.trim();let v=r[g]||[];r[g]=v,v.push(o)}jo(r,function(u){return u.join(", ")})}i.ya=function(){return this.o},i.Ha=function(){return typeof this.l=="string"?this.l:String(this.l)};function Je(t,r,o){return o&&o.internalChannelParams&&o.internalChannelParams[t]||r}function Kr(t){this.za=0,this.i=[],this.j=new qe,this.ba=this.na=this.J=this.W=this.g=this.wa=this.G=this.H=this.u=this.U=this.o=null,this.Ya=this.V=0,this.Sa=Je("failFast",!1,t),this.F=this.C=this.v=this.m=this.l=null,this.X=!0,this.xa=this.K=-1,this.Y=this.A=this.D=0,this.Qa=Je("baseRetryDelayMs",5e3,t),this.Za=Je("retryDelaySeedMs",1e4,t),this.Ta=Je("forwardChannelMaxRetries",2,t),this.va=Je("forwardChannelRequestTimeoutMs",2e4,t),this.ma=t&&t.xmlHttpFactory||void 0,this.Ua=t&&t.Rb||void 0,this.Aa=t&&t.useFetchStreams||!1,this.O=void 0,this.L=t&&t.supportsCrossDomainXhr||!1,this.M="",this.h=new xr(t&&t.concurrentRequestLimit),this.Ba=new da,this.S=t&&t.fastHandshake||!1,this.R=t&&t.encodeInitMessageHeaders||!1,this.S&&this.R&&(this.R=!1),this.Ra=t&&t.Pb||!1,t&&t.ua&&this.j.ua(),t&&t.forceLongPolling&&(this.X=!1),this.aa=!this.S&&this.X&&t&&t.detectBufferingProxy||!1,this.ia=void 0,t&&t.longPollingTimeout&&t.longPollingTimeout>0&&(this.ia=t.longPollingTimeout),this.ta=void 0,this.T=0,this.P=!1,this.ja=this.B=null}i=Kr.prototype,i.ka=8,i.I=1,i.connect=function(t,r,o,u){rt(0),this.W=t,this.H=r||{},o&&u!==void 0&&(this.H.OSID=o,this.H.OAID=u),this.F=this.X,this.J=es(this,null,this.W),In(this)};function xi(t){if(Qr(t),t.I==3){var r=t.V++,o=wt(t.J);if($(o,"SID",t.M),$(o,"RID",r),$(o,"TYPE","terminate"),Xe(t,o),r=new Bt(t,t.j,r),r.M=2,r.A=yn(wt(o)),o=!1,E.navigator&&E.navigator.sendBeacon)try{o=E.navigator.sendBeacon(r.A.toString(),"")}catch{}!o&&E.Image&&(new Image().src=r.A,o=!0),o||(r.g=ns(r.j,null),r.g.ea(r.A)),r.F=Date.now(),_n(r)}ts(t)}function Tn(t){t.g&&(Ri(t),t.g.cancel(),t.g=null)}function Qr(t){Tn(t),t.v&&(E.clearTimeout(t.v),t.v=null),An(t),t.h.cancel(),t.m&&(typeof t.m=="number"&&E.clearTimeout(t.m),t.m=null)}function In(t){if(!Pr(t.h)&&!t.m){t.m=!0;var r=t.Ea;Lt||l(),gt||(Lt(),gt=!0),f.add(r,t),t.D=0}}function ga(t,r){return Rr(t.h)>=t.h.j-(t.m?1:0)?!1:t.m?(t.i=r.G.concat(t.i),!0):t.I==1||t.I==2||t.D>=(t.Sa?0:t.Ta)?!1:(t.m=Le(V(t.Ea,t,r),Zr(t,t.D)),t.D++,!0)}i.Ea=function(t){if(this.m)if(this.m=null,this.I==1){if(!t){this.V=Math.floor(Math.random()*1e5),t=this.V++;let g=new Bt(this,this.j,t),v=this.o;if(this.U&&(v?(v=rr(v),or(v,this.U)):v=this.U),this.u!==null||this.R||(g.J=v,v=null),this.S)t:{for(var r=0,o=0;o<this.i.length;o++){e:{var u=this.i[o];if("__data__"in u.map&&(u=u.map.__data__,typeof u=="string")){u=u.length;break e}u=void 0}if(u===void 0)break;if(r+=u,r>4096){r=o;break t}if(r===4096||o===this.i.length-1){r=o+1;break t}}r=1e3}else r=1e3;r=Hr(this,g,r),o=wt(this.J),$(o,"RID",t),$(o,"CVER",22),this.G&&$(o,"X-HTTP-Session-Id",this.G),Xe(this,o),v&&(this.R?r="headers="+Be(Br(v))+"&"+r:this.u&&Si(o,this.u,v)),Ci(this.h,g),this.Ra&&$(o,"TYPE","init"),this.S?($(o,"$req",r),$(o,"SID","null"),g.U=!0,vi(g,o,null)):vi(g,o,r),this.I=2}}else this.I==3&&(t?Wr(this,t):this.i.length==0||Pr(this.h)||Wr(this))};function Wr(t,r){var o;r?o=r.l:o=t.V++;let u=wt(t.J);$(u,"SID",t.M),$(u,"RID",o),$(u,"AID",t.K),Xe(t,u),t.u&&t.o&&Si(u,t.u,t.o),o=new Bt(t,t.j,o,t.D+1),t.u===null&&(o.J=t.o),r&&(t.i=r.G.concat(t.i)),r=Hr(t,o,1e3),o.H=Math.round(t.va*.5)+Math.round(t.va*.5*Math.random()),Ci(t.h,o),vi(o,u,r)}function Xe(t,r){t.H&&dn(t.H,function(o,u){$(r,u,o)}),t.l&&dn({},function(o,u){$(r,u,o)})}function Hr(t,r,o){o=Math.min(t.i.length,o);let u=t.l?V(t.l.Ka,t.l,t):null;t:{var g=t.i;let D=-1;for(;;){let Z=["count="+o];D==-1?o>0?(D=g[0].g,Z.push("ofs="+D)):D=0:Z.push("ofs="+D);let B=!0;for(let tt=0;tt<o;tt++){var v=g[tt].g;let Et=g[tt].map;if(v-=D,v<0)D=Math.max(0,g[tt].g-100),B=!1;else try{v="req"+v+"_"||"";try{var C=Et instanceof Map?Et:Object.entries(Et);for(let[ne,$t]of C){let Kt=$t;b($t)&&(Kt=gi($t)),Z.push(v+ne+"="+encodeURIComponent(Kt))}}catch(ne){throw Z.push(v+"type="+encodeURIComponent("_badmap")),ne}}catch{u&&u(Et)}}if(B){C=Z.join("&");break t}}C=void 0}return t=t.i.splice(0,o),r.G=t,C}function Jr(t){if(!t.g&&!t.v){t.Y=1;var r=t.Da;Lt||l(),gt||(Lt(),gt=!0),f.add(r,t),t.A=0}}function Pi(t){return t.g||t.v||t.A>=3?!1:(t.Y++,t.v=Le(V(t.Da,t),Zr(t,t.A)),t.A++,!0)}i.Da=function(){if(this.v=null,Xr(this),this.aa&&!(this.P||this.g==null||this.T<=0)){var t=4*this.T;this.j.info("BP detection timer enabled: "+t),this.B=Le(V(this.Wa,this),t)}},i.Wa=function(){this.B&&(this.B=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.P=!0,rt(10),Tn(this),Xr(this))};function Ri(t){t.B!=null&&(E.clearTimeout(t.B),t.B=null)}function Xr(t){t.g=new Bt(t,t.j,"rpc",t.Y),t.u===null&&(t.g.J=t.o),t.g.P=0;var r=wt(t.na);$(r,"RID","rpc"),$(r,"SID",t.M),$(r,"AID",t.K),$(r,"CI",t.F?"0":"1"),!t.F&&t.ia&&$(r,"TO",t.ia),$(r,"TYPE","xmlhttp"),Xe(t,r),t.u&&t.o&&Si(r,t.u,t.o),t.O&&(t.g.H=t.O);var o=t.g;t=t.ba,o.M=1,o.A=yn(wt(r)),o.u=null,o.R=!0,Cr(o,t)}i.Va=function(){this.C!=null&&(this.C=null,Tn(this),Pi(this),rt(19))};function An(t){t.C!=null&&(E.clearTimeout(t.C),t.C=null)}function Yr(t,r){var o=null;if(t.g==r){An(t),Ri(t),t.g=null;var u=2}else if(Ai(t.h,r))o=r.G,Dr(t.h,r),u=1;else return;if(t.I!=0){if(r.o)if(u==1){o=r.u?r.u.length:0,r=Date.now()-r.F;var g=t.D;u=pn(),it(u,new Er(u,o)),In(t)}else Jr(t);else if(g=r.m,g==3||g==0&&r.X>0||!(u==1&&ga(t,r)||u==2&&Pi(t)))switch(o&&o.length>0&&(r=t.h,r.i=r.i.concat(o)),g){case 1:ee(t,5);break;case 4:ee(t,10);break;case 3:ee(t,6);break;default:ee(t,2)}}}function Zr(t,r){let o=t.Qa+Math.floor(Math.random()*t.Za);return t.isActive()||(o*=2),o*r}function ee(t,r){if(t.j.info("Error code "+r),r==2){var o=V(t.bb,t),u=t.Ua;let g=!u;u=new jt(u||"//www.google.com/images/cleardot.gif"),E.location&&E.location.protocol=="http"||ze(u,"https"),yn(u),g?la(u.toString(),o):ha(u.toString(),o)}else rt(2);t.I=0,t.l&&t.l.pa(r),ts(t),Qr(t)}i.bb=function(t){t?(this.j.info("Successfully pinged google.com"),rt(2)):(this.j.info("Failed to ping google.com"),rt(1))};function ts(t){if(t.I=0,t.ja=[],t.l){let r=Vr(t.h);(r.length!=0||t.i.length!=0)&&(pt(t.ja,r),pt(t.ja,t.i),t.h.i.length=0,de(t.i),t.i.length=0),t.l.oa()}}function es(t,r,o){var u=o instanceof jt?wt(o):new jt(o);if(u.g!="")r&&(u.g=r+"."+u.g),Ge(u,u.u);else{var g=E.location;u=g.protocol,r=r?r+"."+g.hostname:g.hostname,g=+g.port;let v=new jt(null);u&&ze(v,u),r&&(v.g=r),g&&Ge(v,g),o&&(v.h=o),u=v}return o=t.G,r=t.wa,o&&r&&$(u,o,r),$(u,"VER",t.ka),Xe(t,u),u}function ns(t,r,o){if(r&&!t.L)throw Error("Can't create secondary domain capable XhrIo object.");return r=t.Aa&&!t.ma?new W(new wn({ab:o})):new W(t.ma),r.Fa(t.L),r}i.isActive=function(){return!!this.l&&this.l.isActive(this)};function is(){}i=is.prototype,i.ra=function(){},i.qa=function(){},i.pa=function(){},i.oa=function(){},i.isActive=function(){return!0},i.Ka=function(){};function Cn(){}Cn.prototype.g=function(t,r){return new dt(t,r)};function dt(t,r){nt.call(this),this.g=new Kr(r),this.l=t,this.h=r&&r.messageUrlParams||null,t=r&&r.messageHeaders||null,r&&r.clientProtocolHeaderRequired&&(t?t["X-Client-Protocol"]="webchannel":t={"X-Client-Protocol":"webchannel"}),this.g.o=t,t=r&&r.initMessageHeaders||null,r&&r.messageContentType&&(t?t["X-WebChannel-Content-Type"]=r.messageContentType:t={"X-WebChannel-Content-Type":r.messageContentType}),r&&r.sa&&(t?t["X-WebChannel-Client-Profile"]=r.sa:t={"X-WebChannel-Client-Profile":r.sa}),this.g.U=t,(t=r&&r.Qb)&&!h(t)&&(this.g.u=t),this.A=r&&r.supportsCrossDomainXhr||!1,this.v=r&&r.sendRawJson||!1,(r=r&&r.httpSessionIdParam)&&!h(r)&&(this.g.G=r,t=this.h,t!==null&&r in t&&(t=this.h,r in t&&delete t[r])),this.j=new ye(this)}G(dt,nt),dt.prototype.m=function(){this.g.l=this.j,this.A&&(this.g.L=!0),this.g.connect(this.l,this.h||void 0)},dt.prototype.close=function(){xi(this.g)},dt.prototype.o=function(t){var r=this.g;if(typeof t=="string"){var o={};o.__data__=t,t=o}else this.v&&(o={},o.__data__=gi(t),t=o);r.i.push(new na(r.Ya++,t)),r.I==3&&In(r)},dt.prototype.N=function(){this.g.l=null,delete this.j,xi(this.g),delete this.g,dt.Z.N.call(this)};function rs(t){_i.call(this),t.__headers__&&(this.headers=t.__headers__,this.statusCode=t.__status__,delete t.__headers__,delete t.__status__);var r=t.__sm__;if(r){t:{for(let o in r){t=o;break t}t=void 0}(this.i=t)&&(t=this.i,r=r!==null&&t in r?r[t]:void 0),this.data=r}else this.data=t}G(rs,_i);function ss(){yi.call(this),this.status=1}G(ss,yi);function ye(t){this.g=t}G(ye,is),ye.prototype.ra=function(){it(this.g,"a")},ye.prototype.qa=function(t){it(this.g,new rs(t))},ye.prototype.pa=function(t){it(this.g,new ss)},ye.prototype.oa=function(){it(this.g,"b")},Cn.prototype.createWebChannel=Cn.prototype.g,dt.prototype.send=dt.prototype.o,dt.prototype.open=dt.prototype.m,dt.prototype.close=dt.prototype.close,Ks=Nt.createWebChannelTransport=function(){return new Cn},$s=Nt.getStatEventTarget=function(){return pn()},Gs=Nt.Event=Yt,zs=Nt.Stat={jb:0,mb:1,nb:2,Hb:3,Mb:4,Jb:5,Kb:6,Ib:7,Gb:8,Lb:9,PROXY:10,NOPROXY:11,Eb:12,Ab:13,Bb:14,zb:15,Cb:16,Db:17,fb:18,eb:19,gb:20},gn.NO_ERROR=0,gn.TIMEOUT=8,gn.HTTP_ERROR=6,js=Nt.ErrorCode=gn,vr.COMPLETE="complete",Bs=Nt.EventType=vr,gr.EventType=Oe,Oe.OPEN="a",Oe.CLOSE="b",Oe.ERROR="c",Oe.MESSAGE="d",nt.prototype.listen=nt.prototype.J,qs=Nt.WebChannel=gr,Na=Nt.FetchXmlHttpFactory=wn,W.prototype.listenOnce=W.prototype.K,W.prototype.getLastError=W.prototype.Ha,W.prototype.getLastErrorCode=W.prototype.ya,W.prototype.getStatus=W.prototype.ca,W.prototype.getResponseJson=W.prototype.La,W.prototype.getResponseText=W.prototype.la,W.prototype.send=W.prototype.ea,W.prototype.setWithCredentials=W.prototype.Fa,Ls=Nt.XhrIo=W}).apply(typeof Qn<"u"?Qn:typeof self<"u"?self:typeof window<"u"?window:{});var Qs="@firebase/firestore",Ws="4.9.2";var ot=class{constructor(e){this.uid=e}isAuthenticated(){return this.uid!=null}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}};ot.UNAUTHENTICATED=new ot(null),ot.GOOGLE_CREDENTIALS=new ot("google-credentials-uid"),ot.FIRST_PARTY=new ot("first-party-uid"),ot.MOCK_USER=new ot("mock-user");var ri="12.3.0";var Wn=new fs("@firebase/firestore");function yt(i,...e){if(Wn.logLevel<=ki.DEBUG){let n=e.map(uo);Wn.debug(`Firestore (${ri}): ${i}`,...n)}}function ao(i,...e){if(Wn.logLevel<=ki.ERROR){let n=e.map(uo);Wn.error(`Firestore (${ri}): ${i}`,...n)}}function uo(i){if(typeof i=="string")return i;try{return(function(n){return JSON.stringify(n)})(i)}catch{return i}}function ft(i,e,n){let s="Unexpected state";typeof e=="string"?s=e:n=e,co(i,s,n)}function co(i,e,n){let s=`FIRESTORE (${ri}) INTERNAL ASSERTION FAILED: ${e} (ID: ${i.toString(16)})`;if(n!==void 0)try{s+=" CONTEXT: "+JSON.stringify(n)}catch{s+=" CONTEXT: "+n}throw ao(s),new Error(s)}function ue(i,e,n,s){let a="Unexpected state";typeof n=="string"?a=n:s=n,i||co(e,a,s)}var q={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"},U=class extends ds{constructor(e,n){super(e,n),this.code=e,this.message=n,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}};var ce=class{constructor(){this.promise=new Promise((e,n)=>{this.resolve=e,this.reject=n})}};var Li=class{constructor(e,n){this.user=n,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}},qi=class{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,n){e.enqueueRetryable(()=>n(ot.UNAUTHENTICATED))}shutdown(){}};var Bi=class{constructor(e){this.t=e,this.currentUser=ot.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,n){ue(this.o===void 0,42304);let s=this.i,a=R=>this.i!==s?(s=this.i,n(R)):Promise.resolve(),c=new ce;this.o=()=>{this.i++,this.currentUser=this.u(),c.resolve(),c=new ce,e.enqueueRetryable(()=>a(this.currentUser))};let E=()=>{let R=c;e.enqueueRetryable(()=>j(this,null,function*(){yield R.promise,yield a(this.currentUser)}))},b=R=>{yt("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=R,this.o&&(this.auth.addAuthTokenListener(this.o),E())};this.t.onInit(R=>b(R)),setTimeout(()=>{if(!this.auth){let R=this.t.getImmediate({optional:!0});R?b(R):(yt("FirebaseAuthCredentialsProvider","Auth not yet detected"),c.resolve(),c=new ce)}},0),E()}getToken(){let e=this.i,n=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(n).then(s=>this.i!==e?(yt("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):s?(ue(typeof s.accessToken=="string",31837,{l:s}),new Li(s.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.o&&this.auth.removeAuthTokenListener(this.o),this.o=void 0}u(){let e=this.auth&&this.auth.getUid();return ue(e===null||typeof e=="string",2055,{h:e}),new ot(e)}},ji=class{constructor(e,n,s){this.P=e,this.T=n,this.I=s,this.type="FirstParty",this.user=ot.FIRST_PARTY,this.A=new Map}R(){return this.I?this.I():null}get headers(){this.A.set("X-Goog-AuthUser",this.P);let e=this.R();return e&&this.A.set("Authorization",e),this.T&&this.A.set("X-Goog-Iam-Authorization-Token",this.T),this.A}},zi=class{constructor(e,n,s){this.P=e,this.T=n,this.I=s}getToken(){return Promise.resolve(new ji(this.P,this.T,this.I))}start(e,n){e.enqueueRetryable(()=>n(ot.FIRST_PARTY))}shutdown(){}invalidateToken(){}},Hn=class{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}},Gi=class{constructor(e,n){this.V=n,this.forceRefresh=!1,this.appCheck=null,this.m=null,this.p=null,gs(e)&&e.settings.appCheckToken&&(this.p=e.settings.appCheckToken)}start(e,n){ue(this.o===void 0,3512);let s=c=>{c.error!=null&&yt("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${c.error.message}`);let E=c.token!==this.m;return this.m=c.token,yt("FirebaseAppCheckTokenProvider",`Received ${E?"new":"existing"} token.`),E?n(c.token):Promise.resolve()};this.o=c=>{e.enqueueRetryable(()=>s(c))};let a=c=>{yt("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=c,this.o&&this.appCheck.addTokenListener(this.o)};this.V.onInit(c=>a(c)),setTimeout(()=>{if(!this.appCheck){let c=this.V.getImmediate({optional:!0});c?a(c):yt("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){if(this.p)return Promise.resolve(new Hn(this.p));let e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then(n=>n?(ue(typeof n.token=="string",44558,{tokenResult:n}),this.m=n.token,new Hn(n.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.o&&this.appCheck.removeTokenListener(this.o),this.o=void 0}};function ka(i){let e=typeof self<"u"&&(self.crypto||self.msCrypto),n=new Uint8Array(i);if(e&&typeof e.getRandomValues=="function")e.getRandomValues(n);else for(let s=0;s<i;s++)n[s]=Math.floor(256*Math.random());return n}var $i=class{static newId(){let e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",n=62*Math.floor(4.129032258064516),s="";for(;s.length<20;){let a=ka(40);for(let c=0;c<a.length;++c)s.length<20&&a[c]<n&&(s+=e.charAt(a[c]%62))}return s}};function Ft(i,e){return i<e?-1:i>e?1:0}function Fa(i,e){let n=Math.min(i.length,e.length);for(let s=0;s<n;s++){let a=i.charAt(s),c=e.charAt(s);if(a!==c)return Oi(a)===Oi(c)?Ft(a,c):Oi(a)?1:-1}return Ft(i.length,e.length)}var Ma=55296,Oa=57343;function Oi(i){let e=i.charCodeAt(0);return e>=Ma&&e<=Oa}var Hs="__name__",Jn=class i{constructor(e,n,s){n===void 0?n=0:n>e.length&&ft(637,{offset:n,range:e.length}),s===void 0?s=e.length-n:s>e.length-n&&ft(1746,{length:s,range:e.length-n}),this.segments=e,this.offset=n,this.len=s}get length(){return this.len}isEqual(e){return i.comparator(this,e)===0}child(e){let n=this.segments.slice(this.offset,this.limit());return e instanceof i?e.forEach(s=>{n.push(s)}):n.push(e),this.construct(n)}limit(){return this.offset+this.length}popFirst(e){return e=e===void 0?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return this.length===0}isPrefixOf(e){if(e.length<this.length)return!1;for(let n=0;n<this.length;n++)if(this.get(n)!==e.get(n))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let n=0;n<this.length;n++)if(this.get(n)!==e.get(n))return!1;return!0}forEach(e){for(let n=this.offset,s=this.limit();n<s;n++)e(this.segments[n])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,n){let s=Math.min(e.length,n.length);for(let a=0;a<s;a++){let c=i.compareSegments(e.get(a),n.get(a));if(c!==0)return c}return Ft(e.length,n.length)}static compareSegments(e,n){let s=i.isNumericId(e),a=i.isNumericId(n);return s&&!a?-1:!s&&a?1:s&&a?i.extractNumericId(e).compare(i.extractNumericId(n)):Fa(e,n)}static isNumericId(e){return e.startsWith("__id")&&e.endsWith("__")}static extractNumericId(e){return Kn.fromString(e.substring(4,e.length-2))}},kt=class i extends Jn{construct(e,n,s){return new i(e,n,s)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...e){let n=[];for(let s of e){if(s.indexOf("//")>=0)throw new U(q.INVALID_ARGUMENT,`Invalid segment (${s}). Paths must not contain // in them.`);n.push(...s.split("/").filter(a=>a.length>0))}return new i(n)}static emptyPath(){return new i([])}},Ua=/^[_a-zA-Z][_a-zA-Z0-9]*$/,Ki=class i extends Jn{construct(e,n,s){return new i(e,n,s)}static isValidIdentifier(e){return Ua.test(e)}canonicalString(){return this.toArray().map(e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),i.isValidIdentifier(e)||(e="`"+e+"`"),e)).join(".")}toString(){return this.canonicalString()}isKeyField(){return this.length===1&&this.get(0)===Hs}static keyField(){return new i([Hs])}static fromServerFormat(e){let n=[],s="",a=0,c=()=>{if(s.length===0)throw new U(q.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);n.push(s),s=""},E=!1;for(;a<e.length;){let b=e[a];if(b==="\\"){if(a+1===e.length)throw new U(q.INVALID_ARGUMENT,"Path has trailing escape character: "+e);let R=e[a+1];if(R!=="\\"&&R!=="."&&R!=="`")throw new U(q.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);s+=R,a+=2}else b==="`"?(E=!E,a++):b!=="."||E?(s+=b,a++):(c(),a++)}if(c(),E)throw new U(q.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new i(n)}static emptyPath(){return new i([])}};var Mt=class i{constructor(e){this.path=e}static fromPath(e){return new i(kt.fromString(e))}static fromName(e){return new i(kt.fromString(e).popFirst(5))}static empty(){return new i(kt.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return e!==null&&kt.comparator(this.path,e.path)===0}toString(){return this.path.toString()}static comparator(e,n){return kt.comparator(e.path,n.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new i(new kt(e.slice()))}};function La(i,e,n,s){if(e===!0&&s===!0)throw new U(q.INVALID_ARGUMENT,`${i} and ${n} cannot be used together.`)}function qa(i){return typeof i=="object"&&i!==null&&(Object.getPrototypeOf(i)===Object.prototype||Object.getPrototypeOf(i)===null)}function X(i,e){let n={typeString:i};return e&&(n.value=e),n}function cn(i,e){if(!qa(i))throw new U(q.INVALID_ARGUMENT,"JSON must be an object");let n;for(let s in e)if(e[s]){let a=e[s].typeString,c="value"in e[s]?{value:e[s].value}:void 0;if(!(s in i)){n=`JSON missing required field: '${s}'`;break}let E=i[s];if(a&&typeof E!==a){n=`JSON field '${s}' must be a ${a}.`;break}if(c!==void 0&&E!==c.value){n=`Expected '${s}' field to equal '${c.value}'`;break}}if(n)throw new U(q.INVALID_ARGUMENT,n);return!0}var Js=-62135596800,Xs=1e6,le=class i{static now(){return i.fromMillis(Date.now())}static fromDate(e){return i.fromMillis(e.getTime())}static fromMillis(e){let n=Math.floor(e/1e3),s=Math.floor((e-1e3*n)*Xs);return new i(n,s)}constructor(e,n){if(this.seconds=e,this.nanoseconds=n,n<0)throw new U(q.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+n);if(n>=1e9)throw new U(q.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+n);if(e<Js)throw new U(q.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new U(q.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/Xs}_compareTo(e){return this.seconds===e.seconds?Ft(this.nanoseconds,e.nanoseconds):Ft(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{type:i._jsonSchemaVersion,seconds:this.seconds,nanoseconds:this.nanoseconds}}static fromJSON(e){if(cn(e,i._jsonSchema))return new i(e.seconds,e.nanoseconds)}valueOf(){let e=this.seconds-Js;return String(e).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}};le._jsonSchemaVersion="firestore/timestamp/1.0",le._jsonSchema={type:X("string",le._jsonSchemaVersion),seconds:X("number"),nanoseconds:X("number")};var Qi=class{constructor(e,n,s,a){this.indexId=e,this.collectionGroup=n,this.fields=s,this.indexState=a}};Qi.UNKNOWN_ID=-1;function Ba(i){return i.name==="IndexedDbTransactionError"}function ja(i){return i===0&&1/i==-1/0}var za="remoteDocuments",lo="owner";var ho="mutationQueues";var mo="mutations";var fo="documentMutations",Ga="remoteDocumentsV14";var po="remoteDocumentGlobal";var go="targets";var _o="targetDocuments";var yo="targetGlobal",wo="collectionParents";var Eo="clientMetadata";var vo="bundles";var To="namedQueries";var $a="indexConfiguration";var Ka="indexState";var Qa="indexEntries";var Io="documentOverlays";var Wa="globals";var Ha=[ho,mo,fo,za,go,lo,yo,_o,Eo,po,wo,vo,To],Dl=[...Ha,Io],Ja=[ho,mo,fo,Ga,go,lo,yo,_o,Eo,po,wo,vo,To,Io],Xa=Ja,Ya=[...Xa,$a,Ka,Qa];var Vl=[...Ya,Wa];var Ve=class i{constructor(e,n){this.comparator=e,this.root=n||St.EMPTY}insert(e,n){return new i(this.comparator,this.root.insert(e,n,this.comparator).copy(null,null,St.BLACK,null,null))}remove(e){return new i(this.comparator,this.root.remove(e,this.comparator).copy(null,null,St.BLACK,null,null))}get(e){let n=this.root;for(;!n.isEmpty();){let s=this.comparator(e,n.key);if(s===0)return n.value;s<0?n=n.left:s>0&&(n=n.right)}return null}indexOf(e){let n=0,s=this.root;for(;!s.isEmpty();){let a=this.comparator(e,s.key);if(a===0)return n+s.left.size;a<0?s=s.left:(n+=s.left.size+1,s=s.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal((n,s)=>(e(n,s),!1))}toString(){let e=[];return this.inorderTraversal((n,s)=>(e.push(`${n}:${s}`),!1)),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new xe(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new xe(this.root,e,this.comparator,!1)}getReverseIterator(){return new xe(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new xe(this.root,e,this.comparator,!0)}},xe=class{constructor(e,n,s,a){this.isReverse=a,this.nodeStack=[];let c=1;for(;!e.isEmpty();)if(c=n?s(e.key,n):1,n&&a&&(c*=-1),c<0)e=this.isReverse?e.left:e.right;else{if(c===0){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop(),n={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return n}hasNext(){return this.nodeStack.length>0}peek(){if(this.nodeStack.length===0)return null;let e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}},St=class i{constructor(e,n,s,a,c){this.key=e,this.value=n,this.color=s??i.RED,this.left=a??i.EMPTY,this.right=c??i.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,n,s,a,c){return new i(e??this.key,n??this.value,s??this.color,a??this.left,c??this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,n,s){let a=this,c=s(e,a.key);return a=c<0?a.copy(null,null,null,a.left.insert(e,n,s),null):c===0?a.copy(null,n,null,null,null):a.copy(null,null,null,null,a.right.insert(e,n,s)),a.fixUp()}removeMin(){if(this.left.isEmpty())return i.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,n){let s,a=this;if(n(e,a.key)<0)a.left.isEmpty()||a.left.isRed()||a.left.left.isRed()||(a=a.moveRedLeft()),a=a.copy(null,null,null,a.left.remove(e,n),null);else{if(a.left.isRed()&&(a=a.rotateRight()),a.right.isEmpty()||a.right.isRed()||a.right.left.isRed()||(a=a.moveRedRight()),n(e,a.key)===0){if(a.right.isEmpty())return i.EMPTY;s=a.right.min(),a=a.copy(s.key,s.value,null,null,a.right.removeMin())}a=a.copy(null,null,null,null,a.right.remove(e,n))}return a.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){let e=this.copy(null,null,i.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){let e=this.copy(null,null,i.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){let e=this.left.copy(null,null,!this.left.color,null,null),n=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,n)}checkMaxDepth(){let e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed())throw ft(43730,{key:this.key,value:this.value});if(this.right.isRed())throw ft(14113,{key:this.key,value:this.value});let e=this.left.check();if(e!==this.right.check())throw ft(27949);return e+(this.isRed()?0:1)}};St.EMPTY=null,St.RED=!0,St.BLACK=!1;St.EMPTY=new class{constructor(){this.size=0}get key(){throw ft(57766)}get value(){throw ft(16141)}get color(){throw ft(16727)}get left(){throw ft(29726)}get right(){throw ft(36894)}copy(e,n,s,a,c){return this}insert(e,n,s){return new St(e,n)}remove(e,n){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};var Xn=class i{constructor(e){this.comparator=e,this.data=new Ve(this.comparator)}has(e){return this.data.get(e)!==null}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal((n,s)=>(e(n),!1))}forEachInRange(e,n){let s=this.data.getIteratorFrom(e[0]);for(;s.hasNext();){let a=s.getNext();if(this.comparator(a.key,e[1])>=0)return;n(a.key)}}forEachWhile(e,n){let s;for(s=n!==void 0?this.data.getIteratorFrom(n):this.data.getIterator();s.hasNext();)if(!e(s.getNext().key))return}firstAfterOrEqual(e){let n=this.data.getIteratorFrom(e);return n.hasNext()?n.getNext().key:null}getIterator(){return new Yn(this.data.getIterator())}getIteratorFrom(e){return new Yn(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let n=this;return n.size<e.size&&(n=e,e=this),e.forEach(s=>{n=n.add(s)}),n}isEqual(e){if(!(e instanceof i)||this.size!==e.size)return!1;let n=this.data.getIterator(),s=e.data.getIterator();for(;n.hasNext();){let a=n.getNext().key,c=s.getNext().key;if(this.comparator(a,c)!==0)return!1}return!0}toArray(){let e=[];return this.forEach(n=>{e.push(n)}),e}toString(){let e=[];return this.forEach(n=>e.push(n)),"SortedSet("+e.toString()+")"}copy(e){let n=new i(this.comparator);return n.data=e,n}},Yn=class{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}};var Wi=class extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}};var Xt=class i{constructor(e){this.binaryString=e}static fromBase64String(e){let n=(function(a){try{return atob(a)}catch(c){throw typeof DOMException<"u"&&c instanceof DOMException?new Wi("Invalid base64 string: "+c):c}})(e);return new i(n)}static fromUint8Array(e){let n=(function(a){let c="";for(let E=0;E<a.length;++E)c+=String.fromCharCode(a[E]);return c})(e);return new i(n)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return(function(n){return btoa(n)})(this.binaryString)}toUint8Array(){return(function(n){let s=new Uint8Array(n.length);for(let a=0;a<n.length;a++)s[a]=n.charCodeAt(a);return s})(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return Ft(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}};Xt.EMPTY_BYTE_STRING=new Xt("");var Za=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function tu(i){if(ue(!!i,39018),typeof i=="string"){let e=0,n=Za.exec(i);if(ue(!!n,46558,{timestamp:i}),n[1]){let a=n[1];a=(a+"000000000").substr(0,9),e=Number(a)}let s=new Date(i);return{seconds:Math.floor(s.getTime()/1e3),nanos:e}}return{seconds:rn(i.seconds),nanos:rn(i.nanos)}}function rn(i){return typeof i=="number"?i:typeof i=="string"?Number(i):0}function eu(i){return typeof i=="string"?Xt.fromBase64String(i):Xt.fromUint8Array(i)}var Ys="(default)",Hi=class i{constructor(e,n){this.projectId=e,this.database=n||Ys}static empty(){return new i("","")}get isDefaultDatabase(){return this.database===Ys}isEqual(e){return e instanceof i&&e.projectId===this.projectId&&e.database===this.database}};var Ao="__type__",nu="__max__";var Co="__vector__",bo="value";function iu(i){return(i?.mapValue?.fields||{})[Ao]?.stringValue===Co}function ru(i){return(((i.mapValue||{}).fields||{}).__type__||{}).stringValue===nu}var kl={mapValue:{fields:{[Ao]:{stringValue:Co},[bo]:{arrayValue:{}}}}};var Ji=class{constructor(e,n=null,s=[],a=[],c=null,E="F",b=null,R=null){this.path=e,this.collectionGroup=n,this.explicitOrderBy=s,this.filters=a,this.limit=c,this.limitType=E,this.startAt=b,this.endAt=R,this.Ie=null,this.Ee=null,this.de=null,this.startAt,this.endAt}};function su(i){return new Ji(i)}var Fl=new Ve(Mt.comparator);var Ml=new Ve(Mt.comparator);var Ol=new Ve(Mt.comparator),Ul=new Xn(Mt.comparator);var Ll=new Xn(Ft);var Zs,O;(O=Zs||(Zs={}))[O.OK=0]="OK",O[O.CANCELLED=1]="CANCELLED",O[O.UNKNOWN=2]="UNKNOWN",O[O.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",O[O.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",O[O.NOT_FOUND=5]="NOT_FOUND",O[O.ALREADY_EXISTS=6]="ALREADY_EXISTS",O[O.PERMISSION_DENIED=7]="PERMISSION_DENIED",O[O.UNAUTHENTICATED=16]="UNAUTHENTICATED",O[O.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",O[O.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",O[O.ABORTED=10]="ABORTED",O[O.OUT_OF_RANGE=11]="OUT_OF_RANGE",O[O.UNIMPLEMENTED=12]="UNIMPLEMENTED",O[O.INTERNAL=13]="INTERNAL",O[O.UNAVAILABLE=14]="UNAVAILABLE",O[O.DATA_LOSS=15]="DATA_LOSS";var ql=new Kn([4294967295,4294967295],0);var Zn=class{constructor(){}Dt(e,n){this.Ct(e,n),n.vt()}Ct(e,n){if("nullValue"in e)this.Ft(n,5);else if("booleanValue"in e)this.Ft(n,10),n.Mt(e.booleanValue?1:0);else if("integerValue"in e)this.Ft(n,15),n.Mt(rn(e.integerValue));else if("doubleValue"in e){let s=rn(e.doubleValue);isNaN(s)?this.Ft(n,13):(this.Ft(n,15),ja(s)?n.Mt(0):n.Mt(s))}else if("timestampValue"in e){let s=e.timestampValue;this.Ft(n,20),typeof s=="string"&&(s=tu(s)),n.xt(`${s.seconds||""}`),n.Mt(s.nanos||0)}else if("stringValue"in e)this.Ot(e.stringValue,n),this.Nt(n);else if("bytesValue"in e)this.Ft(n,30),n.Bt(eu(e.bytesValue)),this.Nt(n);else if("referenceValue"in e)this.Lt(e.referenceValue,n);else if("geoPointValue"in e){let s=e.geoPointValue;this.Ft(n,45),n.Mt(s.latitude||0),n.Mt(s.longitude||0)}else"mapValue"in e?ru(e)?this.Ft(n,Number.MAX_SAFE_INTEGER):iu(e)?this.kt(e.mapValue,n):(this.qt(e.mapValue,n),this.Nt(n)):"arrayValue"in e?(this.Qt(e.arrayValue,n),this.Nt(n)):ft(19022,{$t:e})}Ot(e,n){this.Ft(n,25),this.Ut(e,n)}Ut(e,n){n.xt(e)}qt(e,n){let s=e.fields||{};this.Ft(n,55);for(let a of Object.keys(s))this.Ot(a,n),this.Ct(s[a],n)}kt(e,n){let s=e.fields||{};this.Ft(n,53);let a=bo,c=s[a].arrayValue?.values?.length||0;this.Ft(n,15),n.Mt(rn(c)),this.Ot(a,n),this.Ct(s[a],n)}Qt(e,n){let s=e.values||[];this.Ft(n,50);for(let a of s)this.Ct(a,n)}Lt(e,n){this.Ft(n,37),Mt.fromName(e).path.forEach(s=>{this.Ft(n,60),this.Ut(s,n)})}Ft(e,n){e.Mt(n)}Nt(e){e.Mt(2)}};Zn.Kt=new Zn;var Bl=new Uint8Array(0);var So=41943040,bt=class i{static withCacheSize(e){return new i(e,i.DEFAULT_COLLECTION_PERCENTILE,i.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}constructor(e,n,s){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=n,this.maximumSequenceNumbersToCollect=s}};bt.DEFAULT_COLLECTION_PERCENTILE=10,bt.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,bt.DEFAULT=new bt(So,bt.DEFAULT_COLLECTION_PERCENTILE,bt.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),bt.DISABLED=new bt(-1,0,0);var ou=1048576;function Ui(){return typeof document<"u"?document:null}var Xi=class{constructor(e,n,s=1e3,a=1.5,c=6e4){this.Mi=e,this.timerId=n,this.d_=s,this.A_=a,this.R_=c,this.V_=0,this.m_=null,this.f_=Date.now(),this.reset()}reset(){this.V_=0}g_(){this.V_=this.R_}p_(e){this.cancel();let n=Math.floor(this.V_+this.y_()),s=Math.max(0,Date.now()-this.f_),a=Math.max(0,n-s);a>0&&yt("ExponentialBackoff",`Backing off for ${a} ms (base delay: ${this.V_} ms, delay with jitter: ${n} ms, last attempt: ${s} ms ago)`),this.m_=this.Mi.enqueueAfterDelay(this.timerId,a,()=>(this.f_=Date.now(),e())),this.V_*=this.A_,this.V_<this.d_&&(this.V_=this.d_),this.V_>this.R_&&(this.V_=this.R_)}w_(){this.m_!==null&&(this.m_.skipDelay(),this.m_=null)}cancel(){this.m_!==null&&(this.m_.cancel(),this.m_=null)}y_(){return(Math.random()-.5)*this.V_}};var Yi=class i{constructor(e,n,s,a,c){this.asyncQueue=e,this.timerId=n,this.targetTimeMs=s,this.op=a,this.removalCallback=c,this.deferred=new ce,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(E=>{})}get promise(){return this.deferred.promise}static createAndSchedule(e,n,s,a,c){let E=Date.now()+s,b=new i(e,n,E,a,c);return b.start(s),b}start(e){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){this.timerHandle!==null&&(this.clearTimeout(),this.deferred.reject(new U(q.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>this.timerHandle!==null?(this.clearTimeout(),this.op().then(e=>this.deferred.resolve(e))):Promise.resolve())}clearTimeout(){this.timerHandle!==null&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}};var to,eo;(eo=to||(to={})).Ma="default",eo.Cache="cache";function au(i){let e={};return i.timeoutSeconds!==void 0&&(e.timeoutSeconds=i.timeoutSeconds),e}var no=new Map;var uu="firestore.googleapis.com",io=!0,ti=class{constructor(e){if(e.host===void 0){if(e.ssl!==void 0)throw new U(q.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host=uu,this.ssl=io}else this.host=e.host,this.ssl=e.ssl??io;if(this.isUsingEmulator=e.emulatorOptions!==void 0,this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,e.cacheSizeBytes===void 0)this.cacheSizeBytes=So;else{if(e.cacheSizeBytes!==-1&&e.cacheSizeBytes<ou)throw new U(q.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}La("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:e.experimentalAutoDetectLongPolling===void 0?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=au(e.experimentalLongPollingOptions??{}),(function(s){if(s.timeoutSeconds!==void 0){if(isNaN(s.timeoutSeconds))throw new U(q.INVALID_ARGUMENT,`invalid long polling timeout: ${s.timeoutSeconds} (must not be NaN)`);if(s.timeoutSeconds<5)throw new U(q.INVALID_ARGUMENT,`invalid long polling timeout: ${s.timeoutSeconds} (minimum allowed value is 5)`);if(s.timeoutSeconds>30)throw new U(q.INVALID_ARGUMENT,`invalid long polling timeout: ${s.timeoutSeconds} (maximum allowed value is 30)`)}})(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&(function(s,a){return s.timeoutSeconds===a.timeoutSeconds})(this.experimentalLongPollingOptions,e.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}},Zi=class{constructor(e,n,s,a){this._authCredentials=e,this._appCheckCredentials=n,this._databaseId=s,this._app=a,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new ti({}),this._settingsFrozen=!1,this._emulatorOptions={},this._terminateTask="notTerminated"}get app(){if(!this._app)throw new U(q.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return this._terminateTask!=="notTerminated"}_setSettings(e){if(this._settingsFrozen)throw new U(q.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new ti(e),this._emulatorOptions=e.emulatorOptions||{},e.credentials!==void 0&&(this._authCredentials=(function(s){if(!s)return new qi;switch(s.type){case"firstParty":return new zi(s.sessionIndex||"0",s.iamToken||null,s.authTokenFactory||null);case"provider":return s.client;default:throw new U(q.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}})(e.credentials))}_getSettings(){return this._settings}_getEmulatorOptions(){return this._emulatorOptions}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask==="notTerminated"&&(this._terminateTask=this._terminate()),this._terminateTask}_restart(){return j(this,null,function*(){this._terminateTask==="notTerminated"?yield this._terminate():this._terminateTask="notTerminated"})}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return(function(n){let s=no.get(n);s&&(yt("ComponentProvider","Removing Datastore"),no.delete(n),s.terminate())})(this),Promise.resolve()}};var tr=class i{constructor(e,n,s){this.converter=n,this._query=s,this.type="query",this.firestore=e}withConverter(e){return new i(this.firestore,e,this._query)}},he=class i{constructor(e,n,s){this.converter=n,this._key=s,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new er(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new i(this.firestore,e,this._key)}toJSON(){return{type:i._jsonSchemaVersion,referencePath:this._key.toString()}}static fromJSON(e,n,s){if(cn(n,i._jsonSchema))return new i(e,s||null,new Mt(kt.fromString(n.referencePath)))}};he._jsonSchemaVersion="firestore/documentReference/1.0",he._jsonSchema={type:X("string",he._jsonSchemaVersion),referencePath:X("string")};var er=class i extends tr{constructor(e,n,s){super(e,n,su(s)),this._path=s,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){let e=this._path.popLast();return e.isEmpty()?null:new he(this.firestore,null,new Mt(e))}withConverter(e){return new i(this.firestore,e,this._path)}};var ro="AsyncQueue",ei=class{constructor(e=Promise.resolve()){this.Xu=[],this.ec=!1,this.tc=[],this.nc=null,this.rc=!1,this.sc=!1,this.oc=[],this.M_=new Xi(this,"async_queue_retry"),this._c=()=>{let s=Ui();s&&yt(ro,"Visibility state changed to "+s.visibilityState),this.M_.w_()},this.ac=e;let n=Ui();n&&typeof n.addEventListener=="function"&&n.addEventListener("visibilitychange",this._c)}get isShuttingDown(){return this.ec}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.uc(),this.cc(e)}enterRestrictedMode(e){if(!this.ec){this.ec=!0,this.sc=e||!1;let n=Ui();n&&typeof n.removeEventListener=="function"&&n.removeEventListener("visibilitychange",this._c)}}enqueue(e){if(this.uc(),this.ec)return new Promise(()=>{});let n=new ce;return this.cc(()=>this.ec&&this.sc?Promise.resolve():(e().then(n.resolve,n.reject),n.promise)).then(()=>n.promise)}enqueueRetryable(e){this.enqueueAndForget(()=>(this.Xu.push(e),this.lc()))}lc(){return j(this,null,function*(){if(this.Xu.length!==0){try{yield this.Xu[0](),this.Xu.shift(),this.M_.reset()}catch(e){if(!Ba(e))throw e;yt(ro,"Operation failed with retryable error: "+e)}this.Xu.length>0&&this.M_.p_(()=>this.lc())}})}cc(e){let n=this.ac.then(()=>(this.rc=!0,e().catch(s=>{throw this.nc=s,this.rc=!1,ao("INTERNAL UNHANDLED ERROR: ",so(s)),s}).then(s=>(this.rc=!1,s))));return this.ac=n,n}enqueueAfterDelay(e,n,s){this.uc(),this.oc.indexOf(e)>-1&&(n=0);let a=Yi.createAndSchedule(this,e,n,s,c=>this.hc(c));return this.tc.push(a),a}uc(){this.nc&&ft(47125,{Pc:so(this.nc)})}verifyOperationInProgress(){}Tc(){return j(this,null,function*(){let e;do e=this.ac,yield e;while(e!==this.ac)})}Ic(e){for(let n of this.tc)if(n.timerId===e)return!0;return!1}Ec(e){return this.Tc().then(()=>{this.tc.sort((n,s)=>n.targetTimeMs-s.targetTimeMs);for(let n of this.tc)if(n.skipDelay(),e!=="all"&&n.timerId===e)break;return this.Tc()})}dc(e){this.oc.push(e)}hc(e){let n=this.tc.indexOf(e);this.tc.splice(n,1)}};function so(i){let e=i.message||"";return i.stack&&(e=i.stack.includes(i.message)?i.stack:i.message+`
`+i.stack),e}var nr=class extends Zi{constructor(e,n,s,a){super(e,n,s,a),this.type="firestore",this._queue=new ei,this._persistenceKey=a?.name||"[DEFAULT]"}_terminate(){return j(this,null,function*(){if(this._firestoreClient){let e=this._firestoreClient.terminate();this._queue=new ei(e),this._firestoreClient=void 0,yield e}})}};var sn=class i{constructor(e){this._byteString=e}static fromBase64String(e){try{return new i(Xt.fromBase64String(e))}catch(n){throw new U(q.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+n)}}static fromUint8Array(e){return new i(Xt.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}toJSON(){return{type:i._jsonSchemaVersion,bytes:this.toBase64()}}static fromJSON(e){if(cn(e,i._jsonSchema))return i.fromBase64String(e.bytes)}};sn._jsonSchemaVersion="firestore/bytes/1.0",sn._jsonSchema={type:X("string",sn._jsonSchemaVersion),bytes:X("string")};var ni=class{constructor(...e){for(let n=0;n<e.length;++n)if(e[n].length===0)throw new U(q.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new Ki(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}};var on=class i{constructor(e,n){if(!isFinite(e)||e<-90||e>90)throw new U(q.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(n)||n<-180||n>180)throw new U(q.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+n);this._lat=e,this._long=n}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}_compareTo(e){return Ft(this._lat,e._lat)||Ft(this._long,e._long)}toJSON(){return{latitude:this._lat,longitude:this._long,type:i._jsonSchemaVersion}}static fromJSON(e){if(cn(e,i._jsonSchema))return new i(e.latitude,e.longitude)}};on._jsonSchemaVersion="firestore/geoPoint/1.0",on._jsonSchema={type:X("string",on._jsonSchemaVersion),latitude:X("number"),longitude:X("number")};var an=class i{constructor(e){this._values=(e||[]).map(n=>n)}toArray(){return this._values.map(e=>e)}isEqual(e){return(function(s,a){if(s.length!==a.length)return!1;for(let c=0;c<s.length;++c)if(s[c]!==a[c])return!1;return!0})(this._values,e._values)}toJSON(){return{type:i._jsonSchemaVersion,vectorValues:this._values}}static fromJSON(e){if(cn(e,i._jsonSchema)){if(Array.isArray(e.vectorValues)&&e.vectorValues.every(n=>typeof n=="number"))return new i(e.vectorValues);throw new U(q.INVALID_ARGUMENT,"Expected 'vectorValues' field to be a number array")}}};an._jsonSchemaVersion="firestore/vectorValue/1.0",an._jsonSchema={type:X("string",an._jsonSchemaVersion),vectorValues:X("object")};var cu=new RegExp("[~\\*/\\[\\]]");function lu(i,e,n){if(e.search(cu)>=0)throw oo(`Invalid field path (${e}). Paths must not contain '~', '*', '/', '[', or ']'`,i,!1,void 0,n);try{return new ni(...e.split("."))._internalPath}catch{throw oo(`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,i,!1,void 0,n)}}function oo(i,e,n,s,a){let c=s&&!s.isEmpty(),E=a!==void 0,b=`Function ${e}() called with invalid data`;n&&(b+=" (via `toFirestore()`)"),b+=". ";let R="";return(c||E)&&(R+=" (found",c&&(R+=` in field ${s}`),E&&(R+=` in document ${a}`),R+=")"),new U(q.INVALID_ARGUMENT,b+i+R)}var ii=class{constructor(e,n,s,a,c){this._firestore=e,this._userDataWriter=n,this._key=s,this._document=a,this._converter=c}get id(){return this._key.path.lastSegment()}get ref(){return new he(this._firestore,this._converter,this._key)}exists(){return this._document!==null}data(){if(this._document){if(this._converter){let e=new ir(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){let n=this._document.data.field(xo("DocumentSnapshot.get",e));if(n!==null)return this._userDataWriter.convertValue(n)}}},ir=class extends ii{data(){return super.data()}};function xo(i,e){return typeof e=="string"?lu(i,e):e instanceof ni?e._internalPath:e._delegate._internalPath}var Pe=class{constructor(e,n){this.hasPendingWrites=e,this.fromCache=n}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}},Re=class i extends ii{constructor(e,n,s,a,c,E){super(e,n,s,a,E),this._firestore=e,this._firestoreImpl=e,this.metadata=c}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){let n=new De(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(n,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,n={}){if(this._document){let s=this._document.data.field(xo("DocumentSnapshot.get",e));if(s!==null)return this._userDataWriter.convertValue(s,n.serverTimestamps)}}toJSON(){if(this.metadata.hasPendingWrites)throw new U(q.FAILED_PRECONDITION,"DocumentSnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");let e=this._document,n={};return n.type=i._jsonSchemaVersion,n.bundle="",n.bundleSource="DocumentSnapshot",n.bundleName=this._key.toString(),!e||!e.isValidDocument()||!e.isFoundDocument()?n:(this._userDataWriter.convertObjectMap(e.data.value.mapValue.fields,"previous"),n.bundle=(this._firestore,this.ref.path,"NOT SUPPORTED"),n)}};Re._jsonSchemaVersion="firestore/documentSnapshot/1.0",Re._jsonSchema={type:X("string",Re._jsonSchemaVersion),bundleSource:X("string","DocumentSnapshot"),bundleName:X("string"),bundle:X("string")};var De=class extends Re{data(e={}){return super.data(e)}},un=class i{constructor(e,n,s,a){this._firestore=e,this._userDataWriter=n,this._snapshot=a,this.metadata=new Pe(a.hasPendingWrites,a.fromCache),this.query=s}get docs(){let e=[];return this.forEach(n=>e.push(n)),e}get size(){return this._snapshot.docs.size}get empty(){return this.size===0}forEach(e,n){this._snapshot.docs.forEach(s=>{e.call(n,new De(this._firestore,this._userDataWriter,s.key,s,new Pe(this._snapshot.mutatedKeys.has(s.key),this._snapshot.fromCache),this.query.converter))})}docChanges(e={}){let n=!!e.includeMetadataChanges;if(n&&this._snapshot.excludesMetadataChanges)throw new U(q.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===n||(this._cachedChanges=(function(a,c){if(a._snapshot.oldDocs.isEmpty()){let E=0;return a._snapshot.docChanges.map(b=>{let R=new De(a._firestore,a._userDataWriter,b.doc.key,b.doc,new Pe(a._snapshot.mutatedKeys.has(b.doc.key),a._snapshot.fromCache),a.query.converter);return b.doc,{type:"added",doc:R,oldIndex:-1,newIndex:E++}})}{let E=a._snapshot.oldDocs;return a._snapshot.docChanges.filter(b=>c||b.type!==3).map(b=>{let R=new De(a._firestore,a._userDataWriter,b.doc.key,b.doc,new Pe(a._snapshot.mutatedKeys.has(b.doc.key),a._snapshot.fromCache),a.query.converter),V=-1,at=-1;return b.type!==0&&(V=E.indexOf(b.doc.key),E=E.delete(b.doc.key)),b.type!==1&&(E=E.add(b.doc),at=E.indexOf(b.doc.key)),{type:hu(b.type),doc:R,oldIndex:V,newIndex:at}})}})(this,n),this._cachedChangesIncludeMetadataChanges=n),this._cachedChanges}toJSON(){if(this.metadata.hasPendingWrites)throw new U(q.FAILED_PRECONDITION,"QuerySnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");let e={};e.type=i._jsonSchemaVersion,e.bundleSource="QuerySnapshot",e.bundleName=$i.newId(),this._firestore._databaseId.database,this._firestore._databaseId.projectId;let n=[],s=[],a=[];return this.docs.forEach(c=>{c._document!==null&&(n.push(c._document),s.push(this._userDataWriter.convertObjectMap(c._document.data.value.mapValue.fields,"previous")),a.push(c.ref.path))}),e.bundle=(this._firestore,this.query._query,e.bundleName,"NOT SUPPORTED"),e}};function hu(i){switch(i){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return ft(61501,{type:i})}}un._jsonSchemaVersion="firestore/querySnapshot/1.0",un._jsonSchema={type:X("string",un._jsonSchemaVersion),bundleSource:X("string","QuerySnapshot"),bundleName:X("string"),bundle:X("string")};(function(e,n=!0){(function(a){ri=a})(_s),ps(new ms("firestore",(s,{instanceIdentifier:a,options:c})=>{let E=s.getProvider("app").getImmediate(),b=new nr(new Bi(s.getProvider("auth-internal")),new Gi(E,s.getProvider("app-check-internal")),(function(V,at){if(!Object.prototype.hasOwnProperty.apply(V.options,["projectId"]))throw new U(q.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new Hi(V.options.projectId,at)})(E,a),E);return c=os({useFetchStreams:n},c),b._setSettings(c),b},"PUBLIC").setMultipleInstances(!0)),Fi(Qs,Ws,e),Fi(Qs,Ws,"esm2020")})();function Ot(i){return i?i instanceof Date?i:typeof i=="string"?new Date(i):typeof i.toDate=="function"?i.toDate():new Date(i):null}function Ne(i){let e=Ot(i);return e?e.toLocaleDateString("zh-TW",{year:"numeric",month:"2-digit",day:"2-digit"})+" "+e.toLocaleTimeString("zh-TW",{hour:"2-digit",minute:"2-digit",hour12:!1}):"-"}function ln(i,e=new Date){let n=Ot(i);if(!n)return null;let s=n.getTime()-e.getTime();return Math.ceil(s/(1e3*60*60*24))}function du(i,e){if(i&1&&N(0,"img",5),i&2){let n=A();P("src",n.user().photoURL,Pt)("alt",n.user().displayName)}}function mu(i,e){if(i&1){let n=K();_(0,"div",8)(1,"label",9)(2,"span",10),T(3,"\u8D0A\u52A9\u5230\u671F\u65E5"),w()(),_(4,"input",18),ae("ngModelChange",function(a){F(n);let c=A();return oe(c.premiumUntilDate,a)||(c.premiumUntilDate=a),M(a)}),w(),_(5,"label",9)(6,"span",19),T(7,"\u8A2D\u5B9A\u8D0A\u52A9\u6703\u54E1\u7684\u6709\u6548\u671F\u9650"),w()()()}if(i&2){let n=A();I(4),se("ngModel",n.premiumUntilDate)}}var si=(()=>{let e=class e{constructor(){this.user=st.required(),this.save=Rt(),this.cancel=Rt(),this.selectedRole=H("free"),this.premiumUntilDate=H(""),Dn(()=>{let a=this.user().platforms.quotation;if(this.selectedRole.set(a?.role||"free"),a?.premiumUntil){let c=Ot(a.premiumUntil);c?this.premiumUntilDate.set(c.toISOString().split("T")[0]):this.premiumUntilDate.set("")}else this.premiumUntilDate.set("")})}handleCancel(){this.cancel.emit()}handleSave(){let s={role:this.selectedRole()};this.selectedRole()==="premium"&&this.premiumUntilDate()?s.premiumUntil=le.fromDate(new Date(this.premiumUntilDate())):s.premiumUntil=null,this.save.emit(s)}};e.\u0275fac=function(a){return new(a||e)},e.\u0275cmp=lt({type:e,selectors:[["app-user-edit-form"]],inputs:{user:[1,"user"]},outputs:{save:"save",cancel:"cancel"},decls:29,vars:5,consts:[[1,"font-bold","text-lg","mb-4"],[1,"mb-4","p-4","bg-base-200","rounded-lg"],[1,"flex","items-center","gap-3"],[1,"avatar"],[1,"w-12","h-12","rounded-full","bg-primary","text-primary-content"],["referrerpolicy","no-referrer",1,"object-cover",3,"src","alt"],[1,"font-medium"],[1,"text-sm","text-base-content/60"],[1,"form-control","mb-4"],[1,"label"],[1,"label-text","font-medium"],[1,"select","select-bordered",3,"ngModelChange","ngModel"],["value","free"],["value","premium"],["value","admin"],[1,"flex","justify-end","gap-2","mt-6"],["type","button",1,"btn","btn-ghost",3,"click"],["type","button",1,"btn","btn-primary",3,"click"],["type","date",1,"input","input-bordered",3,"ngModelChange","ngModel"],[1,"label-text-alt"]],template:function(a,c){a&1&&(_(0,"h3",0),T(1,"\u7DE8\u8F2F\u4F7F\u7528\u8005\u6B0A\u9650"),w(),_(2,"div",1)(3,"div",2)(4,"div",3)(5,"div",4),S(6,du,1,2,"img",5),w()(),_(7,"div")(8,"div",6),T(9),w(),_(10,"div",7),T(11),w()()()(),_(12,"div",8)(13,"label",9)(14,"span",10),T(15,"\u89D2\u8272"),w()(),_(16,"select",11),ae("ngModelChange",function(b){return oe(c.selectedRole,b)||(c.selectedRole=b),b}),_(17,"option",12),T(18,"\u514D\u8CBB\u6703\u54E1"),w(),_(19,"option",13),T(20,"\u8D0A\u52A9\u6703\u54E1"),w(),_(21,"option",14),T(22,"\u7BA1\u7406\u54E1"),w()()(),S(23,mu,8,1,"div",8),_(24,"div",15)(25,"button",16),k("click",function(){return c.handleCancel()}),T(26," \u53D6\u6D88 "),w(),_(27,"button",17),k("click",function(){return c.handleSave()}),T(28," \u5132\u5B58 "),w()()),a&2&&(I(6),x(c.user().photoURL?6:-1),I(3),J(c.user().displayName||"\u672A\u547D\u540D"),I(2),J(c.user().email),I(5),se("ngModel",c.selectedRole),I(7),x(c.selectedRole()==="premium"?23:-1))},dependencies:[ht,Ie,ws,Es,Ee,ys,ve,Te],encapsulation:2});let i=e;return i})();function Po(i){return{free:"\u514D\u8CBB\u6703\u54E1",premium:"\u8D0A\u52A9\u6703\u54E1",admin:"\u7BA1\u7406\u54E1"}[i]||i}function Ro(i){return{free:"badge-ghost",premium:"badge-warning",admin:"badge-error"}[i]||"badge-ghost"}function fu(i){let e=i.platforms.quotation,n=e?.role||"free",s=e?.premiumUntil,a=ln(s);return{user:i,displayName:i.displayName||"Unknown",email:i.email||"No Email",uidShort:i.uid.substring(0,8),role:n,roleDisplayName:Po(n),roleBadgeClass:Ro(n),premiumUntilFormatted:s?Ne(s):null,daysUntilExpiry:a,isExpired:n==="premium"&&a!==null&&a<0,createdAtFormatted:i.createdAt?Ne(i.createdAt):"-"}}function Do(i){return i.map(fu)}var pu=(i,e)=>e.user.uid;function gu(i,e){i&1&&N(0,"span",7)}function _u(i,e){if(i&1&&N(0,"lucide-icon",5),i&2){let n=A();P("img",n.RefreshCw)("size",16)}}function yu(i,e){i&1&&(_(0,"div",11),N(1,"span",14),w())}function wu(i,e){if(i&1&&(_(0,"div",12),N(1,"lucide-icon",15),_(2,"p"),T(3,"\u76EE\u524D\u6C92\u6709\u4F7F\u7528\u8005\u8CC7\u6599"),w()()),i&2){let n=A();I(),P("img",n.Users)("size",48)}}function Eu(i,e){if(i&1&&N(0,"img",24),i&2){let n=A().$implicit;P("src",n.user.photoURL,Pt)("alt",n.displayName)}}function vu(i,e){if(i&1&&(_(0,"span",26),N(1,"lucide-icon",5),T(2," \u8D0A\u52A9\u6703\u54E1\uFF08\u5DF2\u904E\u671F\uFF09 "),w()),i&2){let n=A(3);I(),P("img",n.Crown)("size",12)}}function Tu(i,e){if(i&1&&N(0,"lucide-icon",5),i&2){let n=A(4);P("img",n.Shield)("size",12)}}function Iu(i,e){if(i&1&&N(0,"lucide-icon",5),i&2){let n=A(4);P("img",n.Crown)("size",12)}}function Au(i,e){if(i&1&&(_(0,"span",26),S(1,Tu,1,2,"lucide-icon",5)(2,Iu,1,2,"lucide-icon",5),T(3),w()),i&2){let n=A().$implicit;cs(n.roleBadgeClass),I(),x(n.role==="admin"?1:n.role==="premium"?2:-1),I(2),et(" ",n.roleDisplayName," ")}}function Cu(i,e){if(i&1&&(_(0,"div",33),T(1),w()),i&2){let n=A(2).$implicit;Ht("text-error",n.daysUntilExpiry<7)("text-warning",n.daysUntilExpiry>=7&&n.daysUntilExpiry<30),I(),et(" (\u5269\u9918 ",n.daysUntilExpiry," \u5929) ")}}function bu(i,e){if(i&1&&(_(0,"div")(1,"div"),T(2),w(),S(3,Cu,2,5,"div",32),w()),i&2){let n=A().$implicit;I(2),J(n.premiumUntilFormatted),I(),x(n.daysUntilExpiry!==null&&n.daysUntilExpiry>0?3:-1)}}function Su(i,e){i&1&&(_(0,"span",28),T(1,"-"),w())}function xu(i,e){if(i&1){let n=K();_(0,"button",34),k("click",function(){F(n);let a=A().$implicit,c=A(2);return M(c.confirmDelete(a.user))}),T(1," \u522A\u9664 "),w()}}function Pu(i,e){if(i&1){let n=K();_(0,"tr")(1,"td")(2,"div",21)(3,"div",22)(4,"div",23),S(5,Eu,1,2,"img",24),w()(),_(6,"div")(7,"div",25),T(8),w()()()(),_(9,"td"),T(10),w(),_(11,"td"),S(12,vu,3,2,"span",26)(13,Au,4,4,"span",27),w(),_(14,"td"),S(15,bu,4,2,"div")(16,Su,2,0,"span",28),w(),_(17,"td"),T(18),w(),_(19,"td")(20,"div",29)(21,"button",30),k("click",function(){let a=F(n).$implicit,c=A(2);return M(c.startEdit(a.user))}),T(22," \u7DE8\u8F2F "),w(),S(23,xu,2,0,"button",31),w()()()}if(i&2){let n=e.$implicit;I(5),x(n.user.photoURL?5:-1),I(3),et(" ",n.displayName," "),I(2),J(n.email),I(2),x(n.isExpired?12:13),I(3),x(n.premiumUntilFormatted?15:16),I(3),J(n.createdAtFormatted),I(5),x(n.role==="free"?23:-1)}}function Ru(i,e){if(i&1){let n=K();_(0,"div",16)(1,"table",17)(2,"thead")(3,"tr")(4,"th"),T(5,"\u4F7F\u7528\u8005"),w(),_(6,"th"),T(7,"Email"),w(),_(8,"th",18),T(9,"\u89D2\u8272"),w(),_(10,"th",19),T(11,"\u8D0A\u52A9\u5230\u671F\u65E5"),w(),_(12,"th",19),T(13,"\u8A3B\u518A\u6642\u9593"),w(),_(14,"th",19),T(15,"\u64CD\u4F5C"),w()()(),_(16,"tbody"),ie(17,Pu,24,7,"tr",null,pu),w()()(),_(19,"app-pagination",20),k("pageChange",function(a){F(n);let c=A();return M(c.onPageChange(a))})("pageSizeChange",function(a){F(n);let c=A();return M(c.onPageSizeChange(a))}),w()}if(i&2){let n=A();I(17),re(n.paginatedUsersDisplay()),I(2),P("totalItems",n.totalUsers())("pageSize",n.pageSize())("currentPage",n.currentPage())}}function Du(i,e){if(i&1){let n=K();_(0,"dialog",13)(1,"div",35)(2,"app-user-edit-form",36),k("save",function(a){F(n);let c=A();return M(c.handleSave(a))})("cancel",function(){F(n);let a=A();return M(a.cancelEdit())}),w()(),_(3,"form",37),k("click",function(){F(n);let a=A();return M(a.cancelEdit())}),_(4,"button"),T(5,"close"),w()()()}if(i&2){let n=A();I(2),P("user",n.editingUser())}}var Vo=(()=>{let e=class e{constructor(){this.usersStore=L($n),this.Users=xs,this.Crown=Ae,this.Shield=Ln,this.Search=bs,this.RefreshCw=Cs,this.currentPage=H(1),this.pageSize=H(10),this.editingUser=H(null),this.totalUsers=Q(()=>this.usersStore.filteredUsers().length),this.hasUsers=Q(()=>this.usersStore.users().length>0),this.paginatedUsersDisplay=Q(()=>{let s=this.usersStore.filteredUsers(),a=this.currentPage(),c=this.pageSize(),E=(a-1)*c,b=E+c;return Do(s.slice(E,b))})}ngOnInit(){this.usersStore.hasUsers()||this.usersStore.loadUsers()}onRefresh(){this.usersStore.loadUsers()}onPageChange(s){this.currentPage.set(s)}onPageSizeChange(s){this.pageSize.set(s),this.currentPage.set(1)}onSearchChange(s){this.usersStore.setSearchQuery(s),this.currentPage.set(1)}startEdit(s){this.editingUser.set(s)}cancelEdit(){this.editingUser.set(null)}handleSave(s){let a=this.editingUser();a&&(this.usersStore.updateUserRole({uid:a.uid,role:s.role,premiumUntil:s.premiumUntil?.toDate()??null}),this.cancelEdit())}confirmDelete(s){let a=s.displayName||s.email||s.uid;confirm(`\u78BA\u5B9A\u8981\u522A\u9664\u4F7F\u7528\u8005\u300C${a}\u300D\u55CE\uFF1F\u6B64\u64CD\u4F5C\u7121\u6CD5\u5FA9\u539F\u3002`)&&this.usersStore.deleteUser(s.uid)}};e.\u0275fac=function(a){return new(a||e)},e.\u0275cmp=lt({type:e,selectors:[["app-user-list"]],decls:17,vars:11,consts:[[1,"card","bg-base-100","shadow-sm"],[1,"card-body"],[1,"flex","flex-wrap","items-center","justify-between","gap-3","mb-4"],[1,"flex","items-center","gap-2"],[1,"card-title","flex","items-center","gap-2"],[3,"img","size"],["type","button","title","\u91CD\u65B0\u6574\u7406",1,"btn","btn-sm","btn-ghost","btn-square",3,"click","disabled"],[1,"loading","loading-spinner","loading-sm"],[1,"input","input-sm","input-bordered","flex","items-center","gap-2"],[1,"opacity-50",3,"img","size"],["type","search","placeholder","\u641C\u5C0B\u540D\u7A31\u6216 Email...",1,"grow",3,"input","value"],[1,"flex","justify-center","py-8"],[1,"text-center","py-8","text-base-content/60"],[1,"modal","modal-open"],[1,"loading","loading-spinner","loading-lg"],[1,"mx-auto","mb-2","opacity-30",3,"img","size"],[1,"overflow-x-auto"],[1,"table","table-zebra"],[1,"w-28"],[1,"w-32"],[3,"pageChange","pageSizeChange","totalItems","pageSize","currentPage"],[1,"flex","items-center","gap-3"],[1,"avatar"],[1,"w-10","h-10","rounded-full","bg-primary","text-primary-content"],["referrerpolicy","no-referrer",1,"object-cover",3,"src","alt"],[1,"font-medium"],[1,"badge","badge-soft","gap-1","whitespace-nowrap"],[1,"badge","badge-soft","gap-1","whitespace-nowrap",3,"class"],[1,"text-base-content/40"],[1,"join"],["type","button",1,"btn","btn-sm","btn-ghost","join-item",3,"click"],["type","button",1,"btn","btn-sm","btn-ghost","text-error","join-item"],[1,"text-xs",3,"text-error","text-warning"],[1,"text-xs"],["type","button",1,"btn","btn-sm","btn-ghost","text-error","join-item",3,"click"],[1,"modal-box"],[3,"save","cancel","user"],["method","dialog",1,"modal-backdrop",3,"click"]],template:function(a,c){a&1&&(_(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3)(4,"h2",4),N(5,"lucide-icon",5),T(6," \u4F7F\u7528\u8005\u7BA1\u7406 "),w(),_(7,"button",6),k("click",function(){return c.onRefresh()}),S(8,gu,1,0,"span",7)(9,_u,1,2,"lucide-icon",5),w()(),_(10,"label",8),N(11,"lucide-icon",9),_(12,"input",10),k("input",function(b){return c.onSearchChange(b.target.value)}),w()()(),S(13,yu,2,0,"div",11)(14,wu,4,2,"div",12)(15,Ru,20,3),w()(),S(16,Du,6,1,"dialog",13)),a&2&&(I(5),P("img",c.Users)("size",24),I(2),Ht("btn-disabled",c.usersStore.loading()),P("disabled",c.usersStore.loading()),I(),x(c.usersStore.loading()?8:9),I(3),P("img",c.Search)("size",16),I(),P("value",c.usersStore.searchQuery()),I(),x(c.usersStore.loading()?13:c.hasUsers()?15:14),I(3),x(c.editingUser()?16:-1))},dependencies:[ht,It,Tt,Ds,si],encapsulation:2});let i=e;return i})();function Vu(i,e){if(i&1){let n=K();xn(0,"dialog",0)(1,"div",1)(2,"h3",2),T(3),Pn(),as(4,"img",3),xn(5,"div",4)(6,"button",5),Vi("click",function(){F(n);let a=A();return M(a.onClose())}),T(7,"\u95DC\u9589"),Pn()()(),xn(8,"div",6),Vi("click",function(a){F(n);let c=A();return M(c.onBackdropClick(a))}),Pn()()}if(i&2){let n=A();I(3),J(n.title()),I(),us("src",n.proofUrl(),Pt)}}var No=(()=>{let e=class e{constructor(){this.isOpen=st(!1),this.proofUrl=st(""),this.title=st("\u8D0A\u52A9\u6191\u8B49"),this.close=Rt()}onClose(){this.close.emit()}onBackdropClick(s){s.target===s.currentTarget&&this.onClose()}};e.\u0275fac=function(a){return new(a||e)},e.\u0275cmp=lt({type:e,selectors:[["app-proof-modal"]],inputs:{isOpen:[1,"isOpen"],proofUrl:[1,"proofUrl"],title:[1,"title"]},outputs:{close:"close"},decls:1,vars:1,consts:[[1,"modal","modal-open"],[1,"modal-box"],[1,"font-bold","text-lg","mb-4"],["alt","\u6191\u8B49","loading","lazy",1,"w-full","rounded-lg",3,"src"],[1,"modal-action"],[1,"btn",3,"click"],[1,"modal-backdrop",3,"click"]],template:function(a,c){a&1&&S(0,Vu,9,2,"dialog",0),a&2&&x(c.isOpen()?0:-1)},dependencies:[ht],encapsulation:2});let i=e;return i})();var ko=(()=>{let e=class e{constructor(){this.http=L(Fn),this.authService=L(At),this.apiUrl=`${Ce.portalApiUrl}/api/user/donations`}submitDonation(s){return this.withAuth(a=>this.http.post(this.apiUrl,s,{headers:a}))}getMyDonations(){return this.withAuth(s=>this.http.get(`${this.apiUrl}/my`,{headers:s}))}withdrawDonation(s){return this.withAuth(a=>this.http.delete(`${this.apiUrl}/${s}`,{headers:a}))}markAsExpired(){return this.withAuth(s=>this.http.post(`${this.apiUrl}/mark-expired`,{},{headers:s}))}withAuth(s){return _t(this.authService.getIdToken()).pipe(mt(a=>{if(!a)return Sn(()=>new Error("\u672A\u767B\u5165\u6216\u7121\u6CD5\u53D6\u5F97\u9A57\u8B49 Token"));let c=new kn({Authorization:`Bearer ${a}`,"x-platform-key":"quotation"});return s(c)}))}};e.\u0275fac=function(a){return new(a||e)},e.\u0275prov=Wt({token:e,factory:e.\u0275fac,providedIn:"root"});let i=e;return i})();var ke=class{static mapMany(e){return e.map(n=>this.mapOne(n))}static mapOne(e){return{id:e.id,uid:e.uid,userDisplayName:e.userDisplayName||"\u672A\u77E5\u4F7F\u7528\u8005",userEmail:e.userEmail||"-",proof:e.proof||"",note:(e.note||"").replace(/\\n/g,`
`),status:e.status,createdAt:e.createdAt,updatedAt:e.updatedAt,reviewedBy:e.reviewedBy||void 0,reviewedAt:e.reviewedAt||void 0}}};var Fo=(()=>{let e=class e{constructor(){this.NOTIFICATION_URL=Ce.googleSheets.notificationUrl}sendSponsorApprovalEmail(s,a){return j(this,null,function*(){if(!this.NOTIFICATION_URL){console.warn("GAS Web App URL not configured, skipping email notification");return}try{let c=yield fetch(this.NOTIFICATION_URL,{method:"POST",headers:{"Content-Type":"text/plain"},body:JSON.stringify({action:"sendApprovalEmail",email:s,userName:a})});if(!c.ok)throw new Error(`HTTP error! status: ${c.status}`);console.log("Sponsor approval email sent successfully")}catch(c){console.error("Failed to send sponsor approval email:",c)}})}};e.\u0275fac=function(a){return new(a||e)},e.\u0275prov=Wt({token:e,factory:e.\u0275fac,providedIn:"root"});let i=e;return i})();var oi=be({providedIn:"root"},Se(()=>{let i=L(At);return{userData:Q(()=>i.userData()),userDisplayName:Q(()=>i.userDisplayName()),userEmail:Q(()=>i.userEmail()),isPremium:Q(()=>i.isPremium()),isAdmin:Q(()=>i.isAdmin()),formattedCreatedAt:Q(()=>{let e=i.userData()?.createdAt;return e?Ne(e):null}),formattedPremiumUntil:Q(()=>{let e=i.userData()?.platforms.quotation?.premiumUntil;return e?Ne(e):null}),daysUntilExpiry:Q(()=>{let e=i.userData()?.platforms.quotation?.premiumUntil;return ln(e)}),showExpiryWarning:Q(()=>{let e=i.userData()?.platforms.quotation?.premiumUntil;if(!e)return!1;let n=ln(e);return n!==null&&n<=7}),currentRole:Q(()=>i.userData()?.platforms.quotation?.role||"free")}}));var ai=(()=>{let e=class e{constructor(){this.donationApi=L(ko),this.adminApi=L(Gn),this.notificationService=L(Fo),this.profileStore=L(oi)}createOrUpdateRequest(s,a,c,E,b,R=!1){return j(this,null,function*(){try{if(this.profileStore.isAdmin())throw new Error("\u7BA1\u7406\u54E1\u4E0D\u9700\u8981\u7533\u8ACB\u8D0A\u52A9\uFF0C\u60A8\u5DF2\u64C1\u6709\u6240\u6709\u6B0A\u9650");yield vt(this.donationApi.submitDonation({note:b,proof:E}))}catch(V){throw console.error("Failed to create or update donation request:",V),V}})}getPendingRequests(){return j(this,null,function*(){try{let s=yield vt(this.adminApi.getPendingDonations());return ke.mapMany(s.data)}catch(s){throw console.error("Failed to get pending requests:",s),s}})}getMyRequests(s){return j(this,null,function*(){try{let a=yield vt(this.donationApi.getMyDonations());return ke.mapMany(a.data)}catch(a){throw console.error("Failed to get my requests:",a),a}})}approveRequest(s,a,c,E,b){return j(this,null,function*(){try{yield vt(this.adminApi.approveDonation(s)),yield this.notificationService.sendSponsorApprovalEmail(E,b)}catch(R){throw console.error("Failed to approve request:",R),R}})}rejectRequest(s,a){return j(this,null,function*(){try{yield vt(this.adminApi.rejectDonation(s))}catch(c){throw console.error("Failed to reject request:",c),c}})}withdrawRequest(s,a){return j(this,null,function*(){try{yield vt(this.donationApi.withdrawDonation(s))}catch(c){throw console.error("Failed to withdraw request:",c),c}})}getProcessedRequests(){return j(this,null,function*(){try{let s=yield vt(this.adminApi.getProcessedDonations());return ke.mapMany(s.data)}catch(s){throw console.error("Failed to get processed requests:",s),s}})}resetRequestStatus(s){return j(this,null,function*(){try{yield vt(this.adminApi.resetDonationStatus(s))}catch(a){throw console.error("Failed to reset request status:",a),a}})}markAsExpired(s){return j(this,null,function*(){try{yield vt(this.donationApi.markAsExpired())}catch(a){throw console.error("Failed to mark as expired:",a),a}})}deleteUserDonations(s){return j(this,null,function*(){})}};e.\u0275fac=function(a){return new(a||e)},e.\u0275prov=Wt({token:e,factory:e.\u0275fac,providedIn:"root"});let i=e;return i})();var Mo=(i,e)=>e.id;function Nu(i,e){if(i&1&&(_(0,"span",8),T(1),w()),i&2){let n=A();I(),J(n.pendingRequests().length)}}function ku(i,e){i&1&&N(0,"app-user-list")}function Fu(i,e){if(i&1&&(_(0,"span",8),T(1),w()),i&2){let n=A(2);I(),J(n.pendingRequests().length)}}function Mu(i,e){i&1&&(_(0,"div",12),N(1,"span",14),w())}function Ou(i,e){if(i&1){let n=K();_(0,"tr")(1,"td"),T(2),en(3,"date"),w(),_(4,"td")(5,"div",16),T(6),w(),_(7,"div",17),T(8),w()(),_(9,"td")(10,"button",18),k("click",function(){let a=F(n).$implicit,c=A(4);return M(c.openProofModal(a.proof))}),T(11," \u67E5\u770B\u6191\u8B49 "),w()(),_(12,"td",19),T(13),w(),_(14,"td")(15,"div",20)(16,"button",21),k("click",function(){let a=F(n).$implicit,c=A(4);return M(c.approveRequest(a))}),T(17," \u6838\u51C6 "),w(),_(18,"button",22),k("click",function(){let a=F(n).$implicit,c=A(4);return M(c.rejectRequest(a))}),T(19," \u62D2\u7D55 "),w()()()()}if(i&2){let n=e.$implicit;I(2),et(" ",nn(3,4,n.createdAt,"yyyy/MM/dd HH:mm")," "),I(4),J(n.userDisplayName),I(2),et(" ",n.userEmail," "),I(5),et(" ",n.note||"-"," ")}}function Uu(i,e){i&1&&(_(0,"tr")(1,"td",23),T(2," \u76EE\u524D\u6C92\u6709\u5F85\u5BE9\u6838\u7684\u7533\u8ACB "),w()())}function Lu(i,e){if(i&1&&(_(0,"div",13)(1,"table",15)(2,"thead")(3,"tr")(4,"th"),T(5,"\u7533\u8ACB\u6642\u9593"),w(),_(6,"th"),T(7,"\u4F7F\u7528\u8005"),w(),_(8,"th"),T(9,"\u6191\u8B49"),w(),_(10,"th"),T(11,"\u5099\u8A3B"),w(),_(12,"th"),T(13,"\u64CD\u4F5C"),w()()(),_(14,"tbody"),ie(15,Ou,20,7,"tr",null,Mo),S(17,Uu,3,0,"tr"),w()()()),i&2){let n=A(3);I(15),re(n.pendingRequests()),I(2),x(n.pendingRequests().length===0?17:-1)}}function qu(i,e){if(i&1&&S(0,Mu,2,0,"div",12)(1,Lu,18,1,"div",13),i&2){let n=A(2);x(n.donationLoading()?0:1)}}function Bu(i,e){i&1&&(_(0,"div",12),N(1,"span",14),w())}function ju(i,e){i&1&&(_(0,"span",24),T(1,"\u5DF2\u6838\u51C6"),w())}function zu(i,e){i&1&&(_(0,"span",25),T(1,"\u5DF2\u904E\u671F"),w())}function Gu(i,e){i&1&&(_(0,"span",26),T(1,"\u5DF2\u53D6\u6D88"),w())}function $u(i,e){i&1&&(_(0,"span",27),T(1,"\u5DF2\u62D2\u7D55"),w())}function Ku(i,e){if(i&1){let n=K();_(0,"button",30),k("click",function(){F(n);let a=A().$implicit,c=A(4);return M(c.startEditFromRequest(a))}),T(1," \u7DE8\u8F2F "),w()}}function Qu(i,e){if(i&1){let n=K();_(0,"button",31),k("click",function(){F(n);let a=A().$implicit,c=A(4);return M(c.resetRequest(a))}),T(1," \u91CD\u65B0\u5BE9\u6838 "),w()}}function Wu(i,e){i&1&&(_(0,"span",17),T(1,"-"),w())}function Hu(i,e){if(i&1){let n=K();_(0,"tr")(1,"td"),T(2),en(3,"date"),w(),_(4,"td")(5,"div",16),T(6),w(),_(7,"div",17),T(8),w()(),_(9,"td"),S(10,ju,2,0,"span",24)(11,zu,2,0,"span",25)(12,Gu,2,0,"span",26)(13,$u,2,0,"span",27),w(),_(14,"td")(15,"button",18),k("click",function(){let a=F(n).$implicit,c=A(4);return M(c.openProofModal(a.proof))}),T(16," \u67E5\u770B\u6191\u8B49 "),w()(),_(17,"td",19),T(18),w(),_(19,"td"),S(20,Ku,2,0,"button",28)(21,Qu,2,0,"button",29)(22,Wu,2,0,"span",17),w()()}if(i&2){let n=e.$implicit;I(2),et(" ",nn(3,6,n.updatedAt,"yyyy/MM/dd HH:mm")," "),I(4),J(n.userDisplayName),I(2),et(" ",n.userEmail," "),I(2),x(n.status==="approved"?10:n.status==="expired"?11:n.reviewedBy===n.uid?12:13),I(8),et(" ",n.note||"-"," "),I(2),x(n.status==="approved"?20:n.status==="rejected"&&n.reviewedBy!==n.uid?21:22)}}function Ju(i,e){i&1&&(_(0,"tr")(1,"td",32),T(2," \u76EE\u524D\u6C92\u6709\u5DF2\u8655\u7406\u7684\u7533\u8ACB "),w()())}function Xu(i,e){if(i&1&&(_(0,"div",13)(1,"table",15)(2,"thead")(3,"tr")(4,"th"),T(5,"\u5BE9\u6838\u6642\u9593"),w(),_(6,"th"),T(7,"\u4F7F\u7528\u8005"),w(),_(8,"th"),T(9,"\u72C0\u614B"),w(),_(10,"th"),T(11,"\u6191\u8B49"),w(),_(12,"th"),T(13,"\u5099\u8A3B"),w(),_(14,"th"),T(15,"\u64CD\u4F5C"),w()()(),_(16,"tbody"),ie(17,Hu,23,9,"tr",null,Mo),S(19,Ju,3,0,"tr"),w()()()),i&2){let n=A(3);I(17),re(n.processedRequests()),I(2),x(n.processedRequests().length===0?19:-1)}}function Yu(i,e){if(i&1&&S(0,Bu,2,0,"div",12)(1,Xu,20,1,"div",13),i&2){let n=A(2);x(n.donationLoading()?0:1)}}function Zu(i,e){if(i&1){let n=K();_(0,"div",11)(1,"a",7),k("click",function(){F(n);let a=A();return M(a.switchDonationTab("pending"))}),T(2," \u5F85\u5BE9\u6838 "),S(3,Fu,2,1,"span",8),w(),_(4,"a",7),k("click",function(){F(n);let a=A();return M(a.switchDonationTab("history"))}),T(5," \u5DF2\u8655\u7406 "),w()(),S(6,qu,2,1)(7,Yu,2,1)}if(i&2){let n=A();I(),Ht("tab-active",n.donationTab()==="pending"),I(2),x(n.pendingRequests().length>0?3:-1),I(),Ht("tab-active",n.donationTab()==="history"),I(2),x(n.donationTab()==="pending"?6:7)}}function tc(i,e){if(i&1){let n=K();_(0,"dialog",10)(1,"div",33)(2,"app-user-edit-form",34),k("save",function(a){F(n);let c=A();return M(c.handleSaveEdit(a))})("cancel",function(){F(n);let a=A();return M(a.cancelEdit())}),w()(),_(3,"form",35),k("click",function(){F(n);let a=A();return M(a.cancelEdit())}),_(4,"button"),T(5,"close"),w()()()}if(i&2){let n=A();I(2),P("user",n.editingUser())}}var Oo=(()=>{let e=class e{constructor(){this.donationService=L(ai),this.toastService=L(Jt),this.authService=L(At),this.usersStore=L($n),this.pendingRequests=H([]),this.processedRequests=H([]),this.activeTab=H("users"),this.donationTab=H("pending"),this.donationLoading=H(!1),this.isProofModalOpen=H(!1),this.selectedProofUrl=H(""),this.editingUser=H(null),this.Shield=Ln}switchTab(s){this.activeTab.set(s),s==="donations"&&this.loadPendingRequests()}switchDonationTab(s){this.donationTab.set(s),s==="pending"?this.loadPendingRequests():this.loadProcessedRequests()}loadPendingRequests(){return j(this,null,function*(){this.donationLoading.set(!0);try{let s=yield this.donationService.getPendingRequests();this.pendingRequests.set(s)}catch(s){console.error("Failed to load pending requests:",s),this.toastService.error("\u8F09\u5165\u7533\u8ACB\u5931\u6557")}finally{this.donationLoading.set(!1)}})}loadProcessedRequests(){return j(this,null,function*(){this.donationLoading.set(!0);try{let s=yield this.donationService.getProcessedRequests();this.processedRequests.set(s)}catch(s){console.error("Failed to load processed requests:",s),this.toastService.error("\u8F09\u5165\u6B77\u53F2\u7D00\u9304\u5931\u6557")}finally{this.donationLoading.set(!1)}})}openProofModal(s){this.selectedProofUrl.set(s),this.isProofModalOpen.set(!0)}closeProofModal(){this.isProofModalOpen.set(!1),this.selectedProofUrl.set("")}approveRequest(s){return j(this,null,function*(){if(confirm(`\u78BA\u5B9A\u8981\u6838\u51C6 ${s.userDisplayName} \u7684\u7533\u8ACB\u55CE\uFF1F`))try{let a=this.authService.currentUser();if(!a)return;yield this.donationService.approveRequest(s.id,a.uid,s.uid,s.userEmail,s.userDisplayName),this.toastService.success("\u5DF2\u6838\u51C6\u7533\u8ACB"),yield this.loadPendingRequests(),this.usersStore.loadUsers()}catch(a){console.error("Failed to approve request:",a),this.toastService.error("\u6838\u51C6\u5931\u6557")}})}rejectRequest(s){return j(this,null,function*(){if(confirm(`\u78BA\u5B9A\u8981\u62D2\u7D55 ${s.userDisplayName} \u7684\u7533\u8ACB\u55CE\uFF1F`))try{let a=this.authService.currentUser();if(!a)return;yield this.donationService.rejectRequest(s.id,a.uid),this.toastService.success("\u5DF2\u62D2\u7D55\u7533\u8ACB"),yield this.loadPendingRequests()}catch(a){console.error("Failed to reject request:",a),this.toastService.error("\u62D2\u7D55\u5931\u6557")}})}resetRequest(s){return j(this,null,function*(){if(confirm(`\u78BA\u5B9A\u8981\u91CD\u65B0\u5BE9\u6838 ${s.userDisplayName} \u7684\u7533\u8ACB\u55CE\uFF1F`))try{yield this.donationService.resetRequestStatus(s.id),this.toastService.success("\u5DF2\u91CD\u65B0\u958B\u653E\u5BE9\u6838"),yield this.loadProcessedRequests()}catch(a){console.error("Failed to reset request:",a),this.toastService.error("\u91CD\u65B0\u5BE9\u6838\u5931\u6557")}})}startEditFromRequest(s){let c=this.usersStore.users().find(E=>E.uid===s.uid);c?this.editingUser.set(c):(this.usersStore.loadUsers(),this.toastService.info("\u8F09\u5165\u4F7F\u7528\u8005\u8CC7\u6599\u4E2D..."))}handleSaveEdit(s){let a=this.editingUser();a&&(this.usersStore.updateUserRole({uid:a.uid,role:s.role,premiumUntil:Ot(s.premiumUntil)}),this.cancelEdit(),this.loadProcessedRequests())}cancelEdit(){this.editingUser.set(null)}};e.\u0275fac=function(a){return new(a||e)},e.\u0275cmp=lt({type:e,selectors:[["app-admin-panel"]],decls:17,vars:11,consts:[[1,"card","bg-base-100","shadow-sm"],[1,"card-body"],[1,"flex","items-center","justify-between","mb-6"],[1,"flex","items-center","gap-2"],[1,"text-primary",3,"img","size"],[1,"card-title"],[1,"tabs","tabs-boxed"],[1,"tab",3,"click"],[1,"badge","badge-sm","badge-error","ml-1"],[3,"close","isOpen","proofUrl"],[1,"modal","modal-open"],[1,"tabs","tabs-boxed","mb-4"],[1,"flex","justify-center","items-center","py-12"],[1,"overflow-x-auto"],[1,"loading","loading-spinner","loading-lg","text-primary"],[1,"table"],[1,"font-bold"],[1,"text-xs","opacity-50"],[1,"btn","btn-ghost","btn-xs","whitespace-nowrap",3,"click"],[1,"max-w-xs","whitespace-pre-wrap","text-xs"],[1,"join"],[1,"btn","btn-success","btn-xs","join-item",3,"click"],[1,"btn","btn-error","btn-xs","join-item",3,"click"],["colspan","5",1,"text-center","py-8","text-base-content/50"],[1,"badge","badge-success","whitespace-nowrap"],[1,"badge","badge-warning","whitespace-nowrap"],[1,"badge","badge-ghost","whitespace-nowrap"],[1,"badge","badge-error","whitespace-nowrap"],[1,"btn","btn-ghost","btn-xs"],[1,"btn","btn-warning","btn-xs"],[1,"btn","btn-ghost","btn-xs",3,"click"],[1,"btn","btn-warning","btn-xs",3,"click"],["colspan","6",1,"text-center","py-8","text-base-content/50"],[1,"modal-box"],[3,"save","cancel","user"],["method","dialog",1,"modal-backdrop",3,"click"]],template:function(a,c){a&1&&(_(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3),N(4,"lucide-icon",4),_(5,"h2",5),T(6,"\u7BA1\u7406\u54E1\u9762\u677F"),w()(),_(7,"div",6)(8,"a",7),k("click",function(){return c.switchTab("users")}),T(9," \u4F7F\u7528\u8005\u7BA1\u7406 "),w(),_(10,"a",7),k("click",function(){return c.switchTab("donations")}),T(11," \u8D0A\u52A9\u5BE9\u6838 "),S(12,Nu,2,1,"span",8),w()()(),S(13,ku,1,0,"app-user-list")(14,Zu,8,6),w()(),_(15,"app-proof-modal",9),k("close",function(){return c.closeProofModal()}),w(),S(16,tc,6,1,"dialog",10)),a&2&&(I(4),P("img",c.Shield)("size",24),I(4),Ht("tab-active",c.activeTab()==="users"),I(2),Ht("tab-active",c.activeTab()==="donations"),I(2),x(c.pendingRequests().length>0?12:-1),I(),x(c.activeTab()==="users"?13:14),I(2),P("isOpen",c.isProofModalOpen())("proofUrl",c.selectedProofUrl()),I(),x(c.editingUser()?16:-1))},dependencies:[ht,It,Tt,Vo,No,si,Nn],encapsulation:2});let i=e;return i})();var Uo={myRequests:[],loading:!1,submitting:!1,error:null},Lo=be({providedIn:"root"},jn(Uo),Se(({myRequests:i})=>({hasPendingRequest:Q(()=>i().some(e=>e.status==="pending")),pendingRequest:Q(()=>i().find(e=>e.status==="pending")),hasRequests:Q(()=>i().length>0)})),Bn((i,e=L(ai),n=L(Jt))=>({loadMyRequests:Dt(xt(Qt(()=>z(i,{loading:!0,error:null})),mt(s=>_t(e.getMyRequests(s)).pipe(Vt({next:a=>z(i,{myRequests:a,loading:!1}),error:a=>{z(i,{error:a.message||"\u8F09\u5165\u7533\u8ACB\u5931\u6557",loading:!1})}}))))),submitRequest:Dt(xt(Qt(()=>z(i,{submitting:!0,error:null})),mt(({uid:s,displayName:a,email:c,proof:E,note:b,isPremium:R})=>_t(e.createOrUpdateRequest(s,a,c,E,b,R)).pipe(Vt({next:()=>{z(i,{submitting:!1}),n.success("\u8D0A\u52A9\u7533\u8ACB\u5DF2\u9001\u51FA\uFF0C\u6211\u5011\u6703\u5118\u5FEB\u5BE9\u6838\uFF01"),_t(e.getMyRequests(s)).subscribe({next:V=>z(i,{myRequests:V})})},error:V=>{z(i,{error:V.message||"\u7533\u8ACB\u9001\u51FA\u5931\u6557",submitting:!1}),n.error(V.message||"\u7533\u8ACB\u9001\u51FA\u5931\u6557\uFF0C\u8ACB\u7A0D\u5F8C\u518D\u8A66")}}))))),withdrawRequest:Dt(xt(Qt(()=>z(i,{submitting:!0,error:null})),mt(({requestId:s,uid:a})=>_t(e.withdrawRequest(s,a)).pipe(Vt({next:()=>{z(i,{submitting:!1}),n.success("\u5DF2\u64A4\u56DE\u7533\u8ACB"),_t(e.getMyRequests(a)).subscribe({next:c=>z(i,{myRequests:c})})},error:c=>{z(i,{error:c.message||"\u64A4\u56DE\u5931\u6557",submitting:!1}),n.error("\u64A4\u56DE\u5931\u6557\uFF0C\u8ACB\u7A0D\u5F8C\u518D\u8A66")}}))))),markAsExpired:Dt(xt(mt(({uid:s,premiumUntil:a,role:c})=>{let E=Ot(a);return E&&E<new Date&&c==="free"?_t(e.markAsExpired(s)).pipe(Vt({next:()=>{},error:b=>{console.error("Failed to mark as expired:",b)}})):_t(Promise.resolve())}))),initForUser(s,a){if(a)return;this.loadMyRequests(s.uid);let c=s.platforms?.quotation;if(c?.premiumUntil){let E=Ot(c.premiumUntil);E&&this.markAsExpired({uid:s.uid,premiumUntil:E,role:c.role||"free"})}},clearError(){z(i,{error:null})},reset(){z(i,Uo)}})));var ec=(i,e,n,s)=>({request:i,requestId:e,status:"pending",icon:n,iconColor:"text-info",borderColor:"border-info",titleColor:"text-info",title:"\u60A8\u7684\u8D0A\u52A9\u7533\u8ACB\u6B63\u5728\u5BE9\u6838\u4E2D",timeLabel:"\u63D0\u4EA4\u6642\u9593",time:s,message:"\u8ACB\u8010\u5FC3\u7B49\u5019\uFF0C\u6211\u5011\u6703\u5118\u5FEB\u8655\u7406\u60A8\u7684\u7533\u8ACB\u3002",sectionTitle:"\u60A8\u63D0\u4EA4\u7684\u8CC7\u6599",modalId:"pendingProofPreview"}),nc=(i,e,n,s)=>({request:i,requestId:e,status:"cancelled",icon:n,iconColor:"text-base-content/50",borderColor:"border-base-content/20",titleColor:"text-base-content/70",title:"\u60A8\u5DF2\u53D6\u6D88\u7533\u8ACB",timeLabel:"\u53D6\u6D88\u6642\u9593",time:s,message:"\u60A8\u53EF\u4EE5\u96A8\u6642\u91CD\u65B0\u63D0\u4EA4\u7533\u8ACB\u3002",sectionTitle:"\u60A8\u4E4B\u524D\u63D0\u4EA4\u7684\u8CC7\u6599",modalId:"cancelledProofPreview"}),ic=(i,e,n,s)=>({request:i,requestId:e,status:"rejected",icon:n,iconColor:"text-error",borderColor:"border-error",titleColor:"text-error",title:"\u60A8\u7684\u8D0A\u52A9\u7533\u8ACB\u5DF2\u88AB\u62D2\u7D55",timeLabel:"\u5BE9\u6838\u6642\u9593",time:s,message:"\u60A8\u53EF\u4EE5\u4FEE\u6539\u6191\u8B49\u6216\u5099\u8A3B\u5F8C\u91CD\u65B0\u63D0\u4EA4\u7533\u8ACB\u3002",sectionTitle:"\u60A8\u4E4B\u524D\u63D0\u4EA4\u7684\u8CC7\u6599",modalId:"rejectedProofPreview"}),rc=(i,e,n,s)=>({request:i,requestId:e,status:"expired",icon:n,iconColor:"text-warning",borderColor:"border-warning",titleColor:"text-warning",title:"\u60A8\u7684\u8D0A\u52A9\u5DF2\u5230\u671F",timeLabel:"\u5230\u671F\u6642\u9593",time:s,message:"\u611F\u8B1D\u60A8\u904E\u53BB\u7684\u652F\u6301\uFF01\u60A8\u53EF\u4EE5\u91CD\u65B0\u7533\u8ACB\u7E8C\u7D04\u3002",sectionTitle:"\u60A8\u4E4B\u524D\u7684\u8D0A\u52A9\u8CC7\u6599",modalId:"expiredProofPreview"}),sc=(i,e)=>e.id;function oc(i,e){if(i&1&&(_(0,"div",2)(1,"div",3),N(2,"lucide-icon",4),_(3,"h2",5),T(4,"\u8ACB\u5148\u767B\u5165"),w(),_(5,"p"),T(6,"\u767B\u5165\u5F8C\u5373\u53EF\u67E5\u770B\u6703\u54E1\u8CC7\u8A0A"),w()()()),i&2){let n=A();I(2),P("img",n.User)("size",48)}}function ac(i,e){i&1&&Ye(0)}function uc(i,e){if(i&1&&we(0,ac,1,0,"ng-container",10),i&2){let n=A().$implicit,s=A(3),a=Ze(4);P("ngTemplateOutlet",a)("ngTemplateOutletContext",tn(2,ec,n,n.id,s.Clock,n.createdAt))}}function cc(i,e){i&1&&Ye(0)}function lc(i,e){if(i&1&&we(0,cc,1,0,"ng-container",10),i&2){let n=A(2).$implicit,s=A(3),a=Ze(4);P("ngTemplateOutlet",a)("ngTemplateOutletContext",tn(2,nc,n,n.id,s.CircleX,n.updatedAt))}}function hc(i,e){i&1&&Ye(0)}function dc(i,e){if(i&1&&we(0,hc,1,0,"ng-container",10),i&2){let n=A(2).$implicit,s=A(3),a=Ze(4);P("ngTemplateOutlet",a)("ngTemplateOutletContext",tn(2,ic,n,n.id,s.CircleX,n.updatedAt))}}function mc(i,e){if(i&1&&S(0,lc,1,7,"ng-container")(1,dc,1,7,"ng-container"),i&2){let n,s=A().$implicit,a=A(3);x(s.reviewedBy===((n=a.authService.currentUser())==null?null:n.uid)?0:1)}}function fc(i,e){i&1&&Ye(0)}function pc(i,e){if(i&1&&we(0,fc,1,0,"ng-container",10),i&2){let n=A().$implicit,s=A(3),a=Ze(4);P("ngTemplateOutlet",a)("ngTemplateOutletContext",tn(2,rc,n,n.id,s.Clock,n.updatedAt))}}function gc(i,e){if(i&1&&S(0,uc,1,7,"ng-container")(1,mc,2,1)(2,pc,1,7,"ng-container"),i&2){let n=e.$implicit;x(n.status==="pending"?0:n.status==="rejected"?1:n.status==="expired"?2:-1)}}function _c(i,e){if(i&1&&ie(0,gc,3,1,null,null,sc),i&2){let n=A(2);re(n.donationsStore.myRequests())}}function yc(i,e){if(i&1){let n=K();_(0,"div",8)(1,"app-donation-form",11),k("submitDonation",function(a){F(n);let c=A(2);return M(c.handleDonationSubmit(a))}),w()()}}function wc(i,e){if(i&1&&(_(0,"div",9),N(1,"lucide-icon",12),_(2,"div")(3,"h3",13),T(4,"\u611F\u8B1D\u60A8\u7684\u8D0A\u52A9\uFF01"),w(),_(5,"div",14),T(6,"\u60A8\u5DF2\u7D93\u662F\u8D0A\u52A9\u6703\u54E1\uFF0C\u4EAB\u6709\u6240\u6709\u9032\u968E\u529F\u80FD\u3002"),w()()()),i&2){let n=A(2);I(),P("img",n.Check)("size",24)}}function Ec(i,e){i&1&&N(0,"app-admin-panel")}function vc(i,e){if(i&1){let n=K();_(0,"h1",6),T(1,"\u6703\u54E1\u4E2D\u5FC3"),w(),_(2,"app-user-profile",7),k("displayNameChange",function(a){F(n);let c=A();return M(c.handleDisplayNameChange(a))}),w(),S(3,_c,2,0),S(4,yc,2,0,"div",8),S(5,wc,7,2,"div",9),S(6,Ec,1,0,"app-admin-panel")}if(i&2){let n=A();I(2),P("userDisplayName",n.profileStore.userDisplayName())("userEmail",n.profileStore.userEmail())("isPremium",n.profileStore.isPremium())("isAdmin",n.profileStore.isAdmin())("formattedCreatedAt",n.profileStore.formattedCreatedAt())("formattedPremiumUntil",n.profileStore.formattedPremiumUntil())("daysUntilExpiry",n.profileStore.daysUntilExpiry())("showExpiryWarning",n.profileStore.showExpiryWarning()),I(),x(!n.profileStore.isPremium()&&!n.profileStore.isAdmin()&&n.donationsStore.myRequests().length>0?3:-1),I(),x(!n.profileStore.isPremium()&&!n.profileStore.isAdmin()?4:-1),I(),x(n.profileStore.isPremium()?5:-1),I(),x(n.profileStore.isAdmin()?6:-1)}}function Tc(i,e){if(i&1&&(T(0),en(1,"date")),i&2){let n=A(),s=n.timeLabel,a=n.time;Rn(" ",s,"\uFF1A",nn(1,2,a,"yyyy/MM/dd HH:mm")," ")}}function Ic(i,e){if(i&1){let n=K();_(0,"div",23)(1,"button",32),k("click",function(){F(n);let a=A().requestId,c=A();return M(c.handleWithdraw(a))}),T(2," \u64A4\u56DE\u7533\u8ACB "),w()()}}function Ac(i,e){if(i&1){let n=K();_(0,"div")(1,"label",35)(2,"span",36),T(3,"\u8D0A\u52A9\u6191\u8B49"),w()(),_(4,"img",37),k("click",function(){F(n);let a=A(2).modalId,c=A();return M(c.openProofModal(a))}),w()()}if(i&2){let n=A(2).request;I(4),P("src",n.proof,Pt)}}function Cc(i,e){if(i&1&&(_(0,"div")(1,"label",35)(2,"span",36),T(3,"\u5099\u8A3B"),w()(),_(4,"div",38)(5,"p",39),T(6),w()()()),i&2){let n=A(2).request;I(6),J(n.note)}}function bc(i,e){if(i&1&&(_(0,"div",33),T(1),w(),_(2,"div",34),S(3,Ac,5,1,"div"),S(4,Cc,7,1,"div"),w()),i&2){let n=A(),s=n.request,a=n.sectionTitle;I(),J(a),I(2),x(s.proof?3:-1),I(),x(s.note?4:-1)}}function Sc(i,e){if(i&1&&(_(0,"div",15)(1,"div",16)(2,"div",17),N(3,"lucide-icon",18),_(4,"div",19)(5,"h3",20),T(6),w(),_(7,"p",21),S(8,Tc,2,5),w(),_(9,"p",22),T(10),w(),S(11,Ic,3,0,"div",23),w()(),S(12,bc,5,3),w()(),_(13,"dialog",24)(14,"div",25)(15,"h3",26),T(16,"\u8D0A\u52A9\u6191\u8B49"),w(),N(17,"img",27),_(18,"div",28)(19,"form",29)(20,"button",30),T(21,"\u95DC\u9589"),w()()()(),_(22,"form",31)(23,"button"),T(24,"close"),w()()()),i&2){let n=e.request,s=e.status,a=e.icon,c=e.iconColor,E=e.borderColor,b=e.titleColor,R=e.title,V=e.time,at=e.message,G=e.modalId;P("ngClass",E),I(3),P("img",a)("size",32)("ngClass",c),I(2),P("ngClass",b),I(),J(R),I(2),x(V?8:-1),I(2),J(at),I(),x(s==="pending"?11:-1),I(),x(s!=="cancelled"?12:-1),I(),P("id",G),I(4),P("src",n.proof,Pt)}}var Id=(()=>{let e=class e{constructor(){this.authService=L(At),this.donationsStore=L(Lo),this.profileStore=L(oi),this.User=qn,this.Check=On,this.Clock=Un,this.CircleX=Ts,Dn(()=>{let s=this.profileStore.userData(),a=this.profileStore.isPremium(),c=this.profileStore.isAdmin();s&&!c&&this.donationsStore.initForUser(s,a)})}handleDonationSubmit(s){let a=this.authService.currentUser(),c=this.profileStore.userData();!a||!c||this.donationsStore.submitRequest({uid:a.uid,displayName:c.displayName||a.email||"Unknown",email:c.email||"No Email",proof:s.proof,note:s.note,isPremium:this.profileStore.isPremium()})}handleDisplayNameChange(s){return j(this,null,function*(){try{yield this.authService.updateDisplayName(s)}catch(a){console.error("Failed to update display name:",a)}})}handleWithdraw(s){if(!confirm("\u78BA\u5B9A\u8981\u64A4\u56DE\u7533\u8ACB\u55CE\uFF1F\u64A4\u56DE\u5F8C\u60A8\u53EF\u4EE5\u91CD\u65B0\u63D0\u4EA4\u3002"))return;let a=this.authService.currentUser();a&&this.donationsStore.withdrawRequest({requestId:s,uid:a.uid})}openProofModal(s){let a=document.getElementById(s);a&&a.showModal()}};e.\u0275fac=function(a){return new(a||e)},e.\u0275cmp=lt({type:e,selectors:[["app-member"]],decls:5,vars:1,consts:[["requestStatusCard",""],[1,"mx-auto","px-4","py-8"],[1,"card","bg-base-100","shadow-sm"],[1,"card-body","text-center"],[1,"mx-auto","text-base-content/50",3,"img","size"],[1,"card-title","justify-center"],[1,"text-3xl","font-bold","mb-6"],[3,"displayNameChange","userDisplayName","userEmail","isPremium","isAdmin","formattedCreatedAt","formattedPremiumUntil","daysUntilExpiry","showExpiryWarning"],["id","donation-form"],[1,"alert","alert-success","alert-soft"],[4,"ngTemplateOutlet","ngTemplateOutletContext"],[3,"submitDonation"],[3,"img","size"],[1,"font-bold"],[1,"text-sm"],[1,"card","bg-base-100","shadow-sm","border-2","mb-6",3,"ngClass"],[1,"card-body"],[1,"flex","items-start","gap-4"],[1,"flex-shrink-0",3,"img","size","ngClass"],[1,"flex-1"],[1,"card-title",3,"ngClass"],[1,"text-sm","opacity-70","mt-1"],[1,"text-sm","mt-2"],[1,"mt-4"],[1,"modal",3,"id"],[1,"modal-box","max-w-4xl"],[1,"font-bold","text-lg","mb-4"],["alt","\u6191\u8B49",1,"w-full","rounded-lg",3,"src"],[1,"modal-action"],["method","dialog"],[1,"btn"],["method","dialog",1,"modal-backdrop"],[1,"btn","btn-outline","btn-warning","btn-sm",3,"click"],[1,"divider"],[1,"grid","grid-cols-1","md:grid-cols-2","gap-4"],[1,"label"],[1,"label-text","font-semibold"],["alt","\u8D0A\u52A9\u6191\u8B49",1,"max-w-3xs","w-full","rounded-lg","border","border-base-300","cursor-pointer","hover:opacity-80","transition",3,"click","src"],[1,"p-4","bg-base-200","rounded-lg"],[1,"text-sm","whitespace-pre-wrap"]],template:function(a,c){a&1&&(_(0,"div",1),S(1,oc,7,2,"div",2)(2,vc,7,12),w(),we(3,Sc,25,12,"ng-template",null,0,ls)),a&2&&(I(),x(c.authService.isAuthenticated()?2:1))},dependencies:[ht,Vn,hs,It,Tt,ks,Fs,Oo,Nn],encapsulation:2});let i=e;return i})();export{Id as MemberComponent};
