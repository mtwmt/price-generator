<div class="card bg-base-100 shadow-sm mb-6">
  <div class="card-body">
    <h2 class="card-title flex items-center gap-2">
      <lucide-icon [img]="User" [size]="24" />
      會員資訊
    </h2>

    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mt-4">
      <!-- 使用者名稱 + 會員等級 -->
      <div class="flex items-center gap-3">
        <lucide-icon [img]="User" [size]="20" class="text-base-content/70" />
        <div class="flex-1">
          <div class="text-sm text-base-content/70">使用者名稱</div>
          @if (isEditing()) {
            <!-- 編輯模式 -->
            <div class="flex items-center gap-2 mt-1">
              <input
                type="text"
                class="input input-bordered input-sm flex-1 max-w-xs"
                [(ngModel)]="editingName"
                maxlength="50"
                (keyup.enter)="saveEditing()"
                (keyup.escape)="cancelEditing()"
              />
              <button
                class="btn btn-success btn-sm btn-square"
                (click)="saveEditing()"
                title="保存"
              >
                <lucide-icon [img]="Check" [size]="16" />
              </button>
              <button
                class="btn btn-ghost btn-sm btn-square"
                (click)="cancelEditing()"
                title="取消"
              >
                <lucide-icon [img]="X" [size]="16" />
              </button>
            </div>
          } @else {
            <!-- 顯示模式 -->
            <div class="font-medium flex items-center gap-2">
              {{ userDisplayName() }}
              <!-- TODO: 顯示編輯按鈕 -->
              <!-- <button
                class="btn btn-ghost btn-xs btn-square opacity-50 hover:opacity-100"
                (click)="startEditing()"
                title="編輯名稱"
              >
                <lucide-icon [img]="Pencil" [size]="14" />
              </button> -->
              <span>
                @if (isAdmin()) {
                  <span class="badge badge-soft badge-error badge-sm"
                    >管理員</span
                  >
                } @else if (isPremium()) {
                  <span class="badge badge-soft badge-warning badge-sm"
                    >贊助會員</span
                  >
                } @else {
                  <span class="badge badge-soft badge-sm">免費會員</span>
                }
              </span>
            </div>
          }
        </div>
      </div>

      <!-- Email -->
      @if (userEmail()) {
        <div class="flex items-center gap-3">
          <lucide-icon [img]="Mail" [size]="20" class="text-base-content/70" />
          <div>
            <div class="text-sm text-base-content/70">Email</div>
            <div class="font-medium">{{ userEmail() }}</div>
          </div>
        </div>
      }

      <!-- 註冊時間 -->
      @if (formattedCreatedAt()) {
        <div class="flex items-center gap-3">
          <lucide-icon [img]="Clock" [size]="20" class="text-base-content/70" />
          <div>
            <div class="text-sm text-base-content/70">註冊時間</div>
            <div class="font-medium">{{ formattedCreatedAt() }}</div>
          </div>
        </div>
      }

      <!-- 會員到期資訊 -->
      @if (formattedPremiumUntil()) {
        @if (showExpiryWarning()) {
          <!-- 即將到期或已過期 -->
          <div
            class="flex items-center gap-3 p-3 rounded-lg border"
            [ngClass]="{
              'border-warning bg-warning/10':
                daysUntilExpiry() !== null && daysUntilExpiry()! > 0,
              'border-error bg-error/10':
                daysUntilExpiry() !== null && daysUntilExpiry()! <= 0,
            }"
          >
            <lucide-icon
              [img]="Calendar"
              [size]="20"
              [ngClass]="{
                'text-warning':
                  daysUntilExpiry() !== null && daysUntilExpiry()! > 0,
                'text-error':
                  daysUntilExpiry() !== null && daysUntilExpiry()! <= 0,
              }"
            />
            <div>
              @if (daysUntilExpiry() !== null && daysUntilExpiry()! > 0) {
                <div class="text-sm text-warning font-semibold">
                  會員即將到期
                </div>
                <div class="font-medium">
                  到期日：{{ formattedPremiumUntil() }}（剩餘
                  {{ daysUntilExpiry() }} 天）
                </div>
              } @else {
                <div class="text-sm text-error font-semibold">會員已到期</div>
                <div class="font-medium">
                  到期日：{{ formattedPremiumUntil() }}
                </div>
              }
            </div>
          </div>
        } @else {
          <!-- 正常狀態 -->
          <div class="flex items-center gap-3">
            <lucide-icon
              [img]="Calendar"
              [size]="20"
              class="text-base-content/70"
            />
            <div>
              <div class="text-sm text-base-content/70">會員到期日</div>
              <div class="font-medium">
                {{ formattedPremiumUntil() }}
                @if (daysUntilExpiry() !== null) {
                  <span class="text-sm text-base-content/70">
                    (剩餘 {{ daysUntilExpiry() }} 天)
                  </span>
                }
              </div>
            </div>
          </div>
        }
      }
    </div>
  </div>
</div>
