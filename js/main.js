"use strict";

(function () {
  var modal = document.querySelector('#modal');
  var form = document.querySelector('form#form');
  var inputs = document.querySelectorAll('input, textarea, select');

  var formData = function formData() {
    var data = {
      company: document.querySelector('[name=company]').value,
      name: document.querySelector('[name=name]').value,
      phone: document.querySelector('[name=phone]').value,
      email: document.querySelector('[name=email]').value,
      description: document.querySelector('[name=description]').value,
      items: []
    };
    document.querySelectorAll('[data-item]').forEach(function (element, index) {
      if (index === 0) {
        return;
      }

      data.items.push({
        category: element.querySelector('[name=category]').value,
        item: element.querySelector('[name=item]').value,
        price: element.querySelector('[name=price]').value,
        number: element.querySelector('[name=number]').value,
        amount: element.querySelector('[name=amount]').value
      });
    });
    return data;
  };

  var setAmount = function setAmount(element) {
    var price = element.querySelector('[name=price]').value || 0;
    var number = element.querySelector('[name=number]').value || 1;
    element.querySelector('[name=amount]').value = price * number;
  };

  var setTotal = function setTotal() {
    var total = document.querySelectorAll('[name=amount]');
    var getTotal = 0;
    total.forEach(function (e) {
      getTotal += +e.value;
    });
    document.querySelector('#total-price').textContent = getTotal;
  };

  var delItem = function delItem() {
    document.querySelectorAll('.delItem').forEach(function (e, i) {
      e.addEventListener('click', function (e) {
        if (document.querySelectorAll('[data-item]').length > 2) {
          this.parentElement.parentElement.remove();
          setTotal();
        }
      });
    });
  };

  var updateDom = function updateDom() {
    document.querySelectorAll('[data-item]').forEach(function (element, index) {
      element.querySelector('[name=price]').addEventListener('change', function (ev) {
        setAmount(element);
        setTotal();
      });
      element.querySelector('[name=number]').addEventListener('change', function (ev) {
        setAmount(element);
        setTotal();
      });
      delItem();
    });
  };

  var createItem = function createItem(data) {
    return data.map(function (e) {
      return "\n        <tr>\n          <td class=\"text-left\">".concat(e.category, "</td>\n          <td class=\"text-left\">").concat(e.item, "</td>\n          <td>").concat(e.price, "</td>\n          <td>").concat(e.number, "</td>\n          <td class=\"price\">").concat(e.amount, "</td>\n        </tr> \n      ");
    });
  };

  var createModal = function createModal(data) {
    return "\n      <div class=\"table-responsive\">\n        <table class=\"table table-vcenter\">\n          <tr>\n            <th>\u5831\u50F9\u4EBA\u54E1</th>\n            <td>".concat(data.name, "</td>\n          </tr>\n          <tr>\n            <th>\u806F\u7D61\u96FB\u8A71</th>\n            <td>").concat(data.phone, "</td>\n          </tr>\n          <tr>\n            <th>E-Mail</th>\n            <td>").concat(data.email, "</td>\n          </tr>\n        </table>\n        <table class=\"table table-vcenter\">\n          <thead>\n            <tr>\n              <th>\u985E\u5225</th>\n              <th>\u9805\u76EE</th>\n              <th>\u55AE\u50F9</th>\n              <th>\u6578\u91CF / \u9801</th>\n              <th>\u91D1\u984D</th>\n            </tr>\n          </thead>\n          <tbody>\n            ").concat(createItem(data.items).join(''), "\n          </tbody>\n        </table>\n      </div>\n    ");
  }; // validate form


  var constraints = {
    company: {
      presence: {
        message: '^請輸入業主名稱'
      }
    },
    name: {
      presence: {
        message: '^請輸入報價人員'
      }
    },
    email: {
      presence: {
        message: '^請輸入 E-Mail'
      },
      email: {
        message: '格式錯誤'
      }
    },
    phone: {
      presence: {
        message: '^請輸入聯絡電話'
      },
      format: {
        pattern: '^09[0-9]{8}$',
        message: '^手機格式錯誤'
      }
    },
    item: {
      presence: {
        message: '^項目名稱不得為空'
      }
    },
    price: {
      presence: {
        message: '^單價名稱不得為空'
      }
    }
  };

  var resetFormInput = function resetFormInput(formInput) {
    formInput.classList.remove('is-invalid');
    formInput.parentNode.querySelectorAll('.invalid-feedback').forEach(function (el) {
      el.remove();
    });
  };

  var addError = function addError(formInput, error) {
    var block = document.createElement('div');
    block.classList.add('invalid-feedback');
    block.innerText = error;
    formInput.parentNode.appendChild(block);
  };

  var showErrorsForInput = function showErrorsForInput(input, errors) {
    resetFormInput(input);

    if (errors) {
      input.classList.add('is-invalid');
      errors.forEach(function (err) {
        addError(input, err);
      });
    }
  };

  var showErrors = function showErrors(form, errors) {
    form.querySelectorAll('input[name], select[name]').forEach(function (input) {
      showErrorsForInput(input, errors && errors[input.name]);
    });
  };

  var handleFormSubmit = function handleFormSubmit(form, input) {
    var errors = validate(form, constraints);

    if (!errors) {
      return true;
    }

    showErrors(form, errors || {});
    return false;
  };

  updateDom();

  for (var i = 0; i < inputs.length; ++i) {
    inputs.item(i).addEventListener('change', function (ev) {
      var errors = validate(form, constraints) || {};
      showErrorsForInput(this, errors[this.name]);
    });
  } // add item row


  document.querySelector('#addItem').addEventListener('click', function (e) {
    e.preventDefault();
    var row = document.querySelector('[data-item]');
    var newRow = row.cloneNode(true);
    newRow.style.display = 'flex';
    document.querySelector('[data-items]').append(newRow);
    updateDom();
  }); // on Submit

  modal.addEventListener('show.bs.modal', function (e) {
    if (!handleFormSubmit(form)) {
      e.preventDefault();
      this.querySelector('.modal-title').textContent = '';
      this.querySelector('.modal-body').textContent = '';
    } else {
      var data = formData();
      var modalTitle = document.querySelector('.modal-title');
      var modalBody = document.querySelector('.modal-body');
      modalTitle.append(data.company + '-報價單');
      modalBody.insertAdjacentHTML('beforeend', createModal(data));
    }
  });
  modal.addEventListener('hidden.bs.modal', function (e) {
    e.preventDefault();
    this.querySelector('.modal-title').textContent = '';
    this.querySelector('.modal-body').textContent = '';
  }); // Print

  var printScreen = function printScreen(print) {
    var printArea = print.innerHTML;
    var printPage = window.open('', 'Printing...', '');
    printPage.document.open();
    printPage.document.write("<html>\n        <head>\n        <meta charset=\"UTF-8\" />\n        <meta http-equiv=\"X-UA-Compatible\" content=\"IE=edge\" />\n        <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\" />\n          <title>\u5831\u50F9\u55AE\u7522\u751F\u5668</title>\n          <link rel=\"stylesheet\" href=\"https://unpkg.com/@tabler/core@latest/dist/css/tabler.min.css\"/>\n        </head>\n        <body onload='window.print();window.close()'>");
    printPage.document.write(printArea);
    printPage.document.close('</body></html>');
  };

  document.querySelector('#print').addEventListener('click', function () {
    var now = new Date().toLocaleDateString();
    var printHtml = document.querySelector('.modal-dialog .modal-content');
    var newPrintHtml = printHtml.cloneNode(true);
    newPrintHtml.querySelector('.modal-footer').remove();
    newPrintHtml.insertAdjacentHTML('beforeend', "<p style=\"text-align: right;\">\u5831\u50F9\u6642\u9593\uFF1A".concat(now, "</p>"));
    printScreen(newPrintHtml);
  });
})();
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm1haW4uanMiXSwibmFtZXMiOlsibW9kYWwiLCJkb2N1bWVudCIsInF1ZXJ5U2VsZWN0b3IiLCJmb3JtIiwiaW5wdXRzIiwicXVlcnlTZWxlY3RvckFsbCIsImZvcm1EYXRhIiwiZGF0YSIsImNvbXBhbnkiLCJ2YWx1ZSIsIm5hbWUiLCJwaG9uZSIsImVtYWlsIiwiZGVzY3JpcHRpb24iLCJpdGVtcyIsImZvckVhY2giLCJlbGVtZW50IiwiaW5kZXgiLCJwdXNoIiwiY2F0ZWdvcnkiLCJpdGVtIiwicHJpY2UiLCJudW1iZXIiLCJhbW91bnQiLCJzZXRBbW91bnQiLCJzZXRUb3RhbCIsInRvdGFsIiwiZ2V0VG90YWwiLCJlIiwidGV4dENvbnRlbnQiLCJkZWxJdGVtIiwiaSIsImFkZEV2ZW50TGlzdGVuZXIiLCJsZW5ndGgiLCJwYXJlbnRFbGVtZW50IiwicmVtb3ZlIiwidXBkYXRlRG9tIiwiZXYiLCJjcmVhdGVJdGVtIiwibWFwIiwiY3JlYXRlTW9kYWwiLCJqb2luIiwiY29uc3RyYWludHMiLCJwcmVzZW5jZSIsIm1lc3NhZ2UiLCJmb3JtYXQiLCJwYXR0ZXJuIiwicmVzZXRGb3JtSW5wdXQiLCJmb3JtSW5wdXQiLCJjbGFzc0xpc3QiLCJwYXJlbnROb2RlIiwiZWwiLCJhZGRFcnJvciIsImVycm9yIiwiYmxvY2siLCJjcmVhdGVFbGVtZW50IiwiYWRkIiwiaW5uZXJUZXh0IiwiYXBwZW5kQ2hpbGQiLCJzaG93RXJyb3JzRm9ySW5wdXQiLCJpbnB1dCIsImVycm9ycyIsImVyciIsInNob3dFcnJvcnMiLCJoYW5kbGVGb3JtU3VibWl0IiwidmFsaWRhdGUiLCJwcmV2ZW50RGVmYXVsdCIsInJvdyIsIm5ld1JvdyIsImNsb25lTm9kZSIsInN0eWxlIiwiZGlzcGxheSIsImFwcGVuZCIsIm1vZGFsVGl0bGUiLCJtb2RhbEJvZHkiLCJpbnNlcnRBZGphY2VudEhUTUwiLCJwcmludFNjcmVlbiIsInByaW50IiwicHJpbnRBcmVhIiwiaW5uZXJIVE1MIiwicHJpbnRQYWdlIiwid2luZG93Iiwib3BlbiIsIndyaXRlIiwiY2xvc2UiLCJub3ciLCJEYXRlIiwidG9Mb2NhbGVEYXRlU3RyaW5nIiwicHJpbnRIdG1sIiwibmV3UHJpbnRIdG1sIl0sIm1hcHBpbmdzIjoiOztBQUFBLENBQUMsWUFBWTtBQUNYLE1BQU1BLEtBQUssR0FBR0MsUUFBUSxDQUFDQyxhQUFULENBQXVCLFFBQXZCLENBQWQ7QUFDQSxNQUFNQyxJQUFJLEdBQUdGLFFBQVEsQ0FBQ0MsYUFBVCxDQUF1QixXQUF2QixDQUFiO0FBQ0EsTUFBTUUsTUFBTSxHQUFHSCxRQUFRLENBQUNJLGdCQUFULENBQTBCLHlCQUExQixDQUFmOztBQUNBLE1BQU1DLFFBQVEsR0FBRyxTQUFYQSxRQUFXLEdBQVk7QUFDM0IsUUFBTUMsSUFBSSxHQUFHO0FBQ1hDLE1BQUFBLE9BQU8sRUFBRVAsUUFBUSxDQUFDQyxhQUFULENBQXVCLGdCQUF2QixFQUF5Q08sS0FEdkM7QUFFWEMsTUFBQUEsSUFBSSxFQUFFVCxRQUFRLENBQUNDLGFBQVQsQ0FBdUIsYUFBdkIsRUFBc0NPLEtBRmpDO0FBR1hFLE1BQUFBLEtBQUssRUFBRVYsUUFBUSxDQUFDQyxhQUFULENBQXVCLGNBQXZCLEVBQXVDTyxLQUhuQztBQUlYRyxNQUFBQSxLQUFLLEVBQUVYLFFBQVEsQ0FBQ0MsYUFBVCxDQUF1QixjQUF2QixFQUF1Q08sS0FKbkM7QUFLWEksTUFBQUEsV0FBVyxFQUFFWixRQUFRLENBQUNDLGFBQVQsQ0FBdUIsb0JBQXZCLEVBQTZDTyxLQUwvQztBQU1YSyxNQUFBQSxLQUFLLEVBQUU7QUFOSSxLQUFiO0FBU0FiLElBQUFBLFFBQVEsQ0FBQ0ksZ0JBQVQsQ0FBMEIsYUFBMUIsRUFBeUNVLE9BQXpDLENBQWlELFVBQUNDLE9BQUQsRUFBVUMsS0FBVixFQUFvQjtBQUNuRSxVQUFJQSxLQUFLLEtBQUssQ0FBZCxFQUFpQjtBQUNmO0FBQ0Q7O0FBQ0RWLE1BQUFBLElBQUksQ0FBQ08sS0FBTCxDQUFXSSxJQUFYLENBQWdCO0FBQ2RDLFFBQUFB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SixHQUFXQyxrQkFBWCxFQUFaO0FBQ0EsUUFBTUMsU0FBUyxHQUFHdkYsUUFBUSxDQUFDQyxhQUFULENBQXVCLDhCQUF2QixDQUFsQjtBQUVBLFFBQU11RixZQUFZLEdBQUdELFNBQVMsQ0FBQ25CLFNBQVYsQ0FBb0IsSUFBcEIsQ0FBckI7QUFDQW9CLElBQUFBLFlBQVksQ0FBQ3ZGLGFBQWIsQ0FBMkIsZUFBM0IsRUFBNENpQyxNQUE1QztBQUNBc0QsSUFBQUEsWUFBWSxDQUFDZCxrQkFBYixDQUNFLFdBREYsMEVBRXdDVSxHQUZ4QztBQUtBVCxJQUFBQSxXQUFXLENBQUNhLFlBQUQsQ0FBWDtBQUNELEdBWkQ7QUFhRCxDQXRSRCIsInNvdXJjZXNDb250ZW50IjpbIihmdW5jdGlvbiAoKSB7XHJcbiAgY29uc3QgbW9kYWwgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcjbW9kYWwnKTtcclxuICBjb25zdCBmb3JtID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignZm9ybSNmb3JtJyk7XHJcbiAgY29uc3QgaW5wdXRzID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnaW5wdXQsIHRleHRhcmVhLCBzZWxlY3QnKTtcclxuICBjb25zdCBmb3JtRGF0YSA9IGZ1bmN0aW9uICgpIHtcclxuICAgIGNvbnN0IGRhdGEgPSB7XHJcbiAgICAgIGNvbXBhbnk6IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJ1tuYW1lPWNvbXBhbnldJykudmFsdWUsXHJcbiAgICAgIG5hbWU6IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJ1tuYW1lPW5hbWVdJykudmFsdWUsXHJcbiAgICAgIHBob25lOiBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCdbbmFtZT1waG9uZV0nKS52YWx1ZSxcclxuICAgICAgZW1haWw6IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJ1tuYW1lPWVtYWlsXScpLnZhbHVlLFxyXG4gICAgICBkZXNjcmlwdGlvbjogZG9jdW1lbnQucXVlcnlTZWxlY3RvcignW25hbWU9ZGVzY3JpcHRpb25dJykudmFsdWUsXHJcbiAgICAgIGl0ZW1zOiBbXSxcclxuICAgIH07XHJcblxyXG4gICAgZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnW2RhdGEtaXRlbV0nKS5mb3JFYWNoKChlbGVtZW50LCBpbmRleCkgPT4ge1xyXG4gICAgICBpZiAoaW5kZXggPT09IDApIHtcclxuICAgICAgICByZXR1cm47XHJcbiAgICAgIH1cclxuICAgICAgZGF0YS5pdGVtcy5wdXNoKHtcclxuICAgICAgICBjYXRlZ29yeTogZWxlbWVudC5xdWVyeVNlbGVjdG9yKCdbbmFtZT1jYXRlZ29yeV0nKS52YWx1ZSxcclxuICAgICAgICBpdGVtOiBlbGVtZW50LnF1ZXJ5U2VsZWN0b3IoJ1tuYW1lPWl0ZW1dJykudmFsdWUsXHJcbiAgICAgICAgcHJpY2U6IGVsZW1lbnQucXVlcnlTZWxlY3RvcignW25hbWU9cHJpY2VdJykudmFsdWUsXHJcbiAgICAgICAgbnVtYmVyOiBlbGVtZW50LnF1ZXJ5U2VsZWN0b3IoJ1tuYW1lPW51bWJlcl0nKS52YWx1ZSxcclxuICAgICAgICBhbW91bnQ6IGVsZW1lbnQucXVlcnlTZWxlY3RvcignW25hbWU9YW1vdW50XScpLnZhbHVlLFxyXG4gICAgICB9KTtcclxuICAgIH0pO1xyXG5cclxuICAgIHJldHVybiBkYXRhO1xyXG4gIH07XHJcbiAgY29uc3Qgc2V0QW1vdW50ID0gKGVsZW1lbnQpID0+IHtcclxuICAgIGNvbnN0IHByaWNlID0gZWxlbWVudC5xdWVyeVNlbGVjdG9yKCdbbmFtZT1wcmljZV0nKS52YWx1ZSB8fCAwO1xyXG4gICAgY29uc3QgbnVtYmVyID0gZWxlbWVudC5xdWVyeVNlbGVjdG9yKCdbbmFtZT1udW1iZXJdJykudmFsdWUgfHwgMTtcclxuICAgIGVsZW1lbnQucXVlcnlTZWxlY3RvcignW25hbWU9YW1vdW50XScpLnZhbHVlID0gcHJpY2UgKiBudW1iZXI7XHJcbiAgfTtcclxuICBjb25zdCBzZXRUb3RhbCA9ICgpID0+IHtcclxuICAgIGNvbnN0IHRvdGFsID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnW25hbWU9YW1vdW50XScpO1xyXG4gICAgbGV0IGdldFRvdGFsID0gMDtcclxuICAgIHRvdGFsLmZvckVhY2goKGUpID0+IHtcclxuICAgICAgZ2V0VG90YWwgKz0gK2UudmFsdWU7XHJcbiAgICB9KTtcclxuICAgIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJyN0b3RhbC1wcmljZScpLnRleHRDb250ZW50ID0gZ2V0VG90YWw7XHJcbiAgfTtcclxuICBcclxuICBjb25zdCBkZWxJdGVtID0gKCkgPT4ge1xyXG4gICAgZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnLmRlbEl0ZW0nKS5mb3JFYWNoKChlLCBpKSA9PiB7XHJcbiAgICAgIGUuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBmdW5jdGlvbiAoZSkge1xyXG4gICAgICAgIGlmIChkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCdbZGF0YS1pdGVtXScpLmxlbmd0aCA+IDIpIHtcclxuICAgICAgICAgIHRoaXMucGFyZW50RWxlbWVudC5wYXJlbnRFbGVtZW50LnJlbW92ZSgpO1xyXG4gICAgICAgICAgc2V0VG90YWwoKTtcclxuICAgICAgICB9XHJcbiAgICAgIH0pO1xyXG4gICAgfSk7XHJcbiAgfTtcclxuXHJcbiAgY29uc3QgdXBkYXRlRG9tID0gKCkgPT4ge1xyXG4gICAgZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnW2RhdGEtaXRlbV0nKS5mb3JFYWNoKChlbGVtZW50LCBpbmRleCkgPT4ge1xyXG4gICAgICBlbGVtZW50LnF1ZXJ5U2VsZWN0b3IoJ1tuYW1lPXByaWNlXScpLmFkZEV2ZW50TGlzdGVuZXIoJ2NoYW5nZScsIChldikgPT4ge1xyXG4gICAgICAgIHNldEFtb3VudChlbGVtZW50KTtcclxuICAgICAgICBzZXRUb3RhbCgpO1xyXG4gICAgICB9KTtcclxuXHJcbiAgICAgIGVsZW1lbnRcclxuICAgICAgICAucXVlcnlTZWxlY3RvcignW25hbWU9bnVtYmVyXScpXHJcbiAgICAgICAgLmFkZEV2ZW50TGlzdGVuZXIoJ2NoYW5nZScsIChldikgPT4ge1xyXG4gICAgICAgICAgc2V0QW1vdW50KGVsZW1lbnQpO1xyXG4gICAgICAgICAgc2V0VG90YWwoKTtcclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgIGRlbEl0ZW0oKTtcclxuICAgIH0pO1xyXG4gIH07XHJcblxyXG4gIGNvbnN0IGNyZWF0ZUl0ZW0gPSAoZGF0YSkgPT4ge1xyXG4gICAgcmV0dXJuIGRhdGEubWFwKFxyXG4gICAgICAoZSkgPT5cclxuICAgICAgICBgXHJcbiAgICAgICAgPHRyPlxyXG4gICAgICAgICAgPHRkIGNsYXNzPVwidGV4dC1sZWZ0XCI+JHtlLmNhdGVnb3J5fTwvdGQ+XHJcbiAgICAgICAgICA8dGQgY2xhc3M9XCJ0ZXh0LWxlZnRcIj4ke2UuaXRlbX08L3RkPlxyXG4gICAgICAgICAgPHRkPiR7ZS5wcmljZX08L3RkPlxyXG4gICAgICAgICAgPHRkPiR7ZS5udW1iZXJ9PC90ZD5cclxuICAgICAgICAgIDx0ZCBjbGFzcz1cInByaWNlXCI+JHtlLmFtb3VudH08L3RkPlxyXG4gICAgICAgIDwvdHI+IFxyXG4gICAgICBgXHJcbiAgICApO1xyXG4gIH07XHJcbiAgY29uc3QgY3JlYXRlTW9kYWwgPSAoZGF0YSkgPT4ge1xyXG4gICAgcmV0dXJuIGBcclxuICAgICAgPGRpdiBjbGFzcz1cInRhYmxlLXJlc3BvbnNpdmVcIj5cclxuICAgICAgICA8dGFibGUgY2xhc3M9XCJ0YWJsZSB0YWJsZS12Y2VudGVyXCI+XHJcbiAgICAgICAgICA8dHI+XHJcbiAgICAgICAgICAgIDx0aD7loLHlg7nkurrlk6E8L3RoPlxyXG4gICAgICAgICAgICA8dGQ+JHtkYXRhLm5hbWV9PC90ZD5cclxuICAgICAgICAgIDwvdHI+XHJcbiAgICAgICAgICA8dHI+XHJcbiAgICAgICAgICAgIDx0aD7oga/ntaHpm7voqbE8L3RoPlxyXG4gICAgICAgICAgICA8dGQ+JHtkYXRhLnBob25lfTwvdGQ+XHJcbiAgICAgICAgICA8L3RyPlxyXG4gICAgICAgICAgPHRyPlxyXG4gICAgICAgICAgICA8dGg+RS1NYWlsPC90aD5cclxuICAgICAgICAgICAgPHRkPiR7ZGF0YS5lbWFpbH08L3RkPlxyXG4gICAgICAgICAgPC90cj5cclxuICAgICAgICA8L3RhYmxlPlxyXG4gICAgICAgIDx0YWJsZSBjbGFzcz1cInRhYmxlIHRhYmxlLXZjZW50ZXJcIj5cclxuICAgICAgICAgIDx0aGVhZD5cclxuICAgICAgICAgICAgPHRyPlxyXG4gICAgICAgICAgICAgIDx0aD7poZ7liKU8L3RoPlxyXG4gICAgICAgICAgICAgIDx0aD7poIXnm648L3RoPlxyXG4gICAgICAgICAgICAgIDx0aD7llq7lg7k8L3RoPlxyXG4gICAgICAgICAgICAgIDx0aD7mlbjph48gLyDpoIE8L3RoPlxyXG4gICAgICAgICAgICAgIDx0aD7ph5HpoY08L3RoPlxyXG4gICAgICAgICAgICA8L3RyPlxyXG4gICAgICAgICAgPC90aGVhZD5cclxuICAgICAgICAgIDx0Ym9keT5cclxuICAgICAgICAgICAgJHtjcmVhdGVJdGVtKGRhdGEuaXRlbXMpLmpvaW4oJycpfVxyXG4gICAgICAgICAgPC90Ym9keT5cclxuICAgICAgICA8L3RhYmxlPlxyXG4gICAgICA8L2Rpdj5cclxuICAgIGA7XHJcbiAgfTtcclxuXHJcbiAgLy8gdmFsaWRhdGUgZm9ybVxyXG4gIGNvbnN0IGNvbnN0cmFpbnRzID0ge1xyXG4gICAgY29tcGFueToge1xyXG4gICAgICBwcmVzZW5jZToge1xyXG4gICAgICAgIG1lc3NhZ2U6ICde6KuL6Ly45YWl5qWt5Li75ZCN56ixJyxcclxuICAgICAgfSxcclxuICAgIH0sXHJcbiAgICBuYW1lOiB7XHJcbiAgICAgIHByZXNlbmNlOiB7XHJcbiAgICAgICAgbWVzc2FnZTogJ17oq4vovLjlhaXloLHlg7nkurrlk6EnLFxyXG4gICAgICB9LFxyXG4gICAgfSxcclxuICAgIGVtYWlsOiB7XHJcbiAgICAgIHByZXNlbmNlOiB7XHJcbiAgICAgICAgbWVzc2FnZTogJ17oq4vovLjlhaUgRS1NYWlsJyxcclxuICAgICAgfSxcclxuICAgICAgZW1haWw6IHtcclxuICAgICAgICBtZXNzYWdlOiAn5qC85byP6Yyv6KqkJyxcclxuICAgICAgfSxcclxuICAgIH0sXHJcbiAgICBwaG9uZToge1xyXG4gICAgICBwcmVzZW5jZToge1xyXG4gICAgICAgIG1lc3NhZ2U6ICde6KuL6Ly45YWl6IGv57Wh6Zu76KmxJyxcclxuICAgICAgfSxcclxuICAgICAgZm9ybWF0OiB7XHJcbiAgICAgICAgcGF0dGVybjogJ14wOVswLTldezh9JCcsXHJcbiAgICAgICAgbWVzc2FnZTogJ17miYvmqZ/moLzlvI/pjK/oqqQnLFxyXG4gICAgICB9LFxyXG4gICAgfSxcclxuICAgIGl0ZW06IHtcclxuICAgICAgcHJlc2VuY2U6IHtcclxuICAgICAgICBtZXNzYWdlOiAnXumgheebruWQjeeoseS4jeW+l+eCuuepuicsXHJcbiAgICAgIH0sXHJcbiAgICB9LFxyXG4gICAgcHJpY2U6IHtcclxuICAgICAgcHJlc2VuY2U6IHtcclxuICAgICAgICBtZXNzYWdlOiAnXuWWruWDueWQjeeoseS4jeW+l+eCuuepuicsXHJcbiAgICAgIH0sXHJcbiAgICB9LFxyXG4gIH07XHJcblxyXG4gIGNvbnN0IHJlc2V0Rm9ybUlucHV0ID0gKGZvcm1JbnB1dCkgPT4ge1xyXG4gICAgZm9ybUlucHV0LmNsYXNzTGlzdC5yZW1vdmUoJ2lzLWludmFsaWQnKTtcclxuICAgIGZvcm1JbnB1dC5wYXJlbnROb2RlLnF1ZXJ5U2VsZWN0b3JBbGwoJy5pbnZhbGlkLWZlZWRiYWNrJykuZm9yRWFjaCgoZWwpID0+IHtcclxuICAgICAgZWwucmVtb3ZlKCk7XHJcbiAgICB9KTtcclxuICB9O1xyXG5cclxuICBjb25zdCBhZGRFcnJvciA9IChmb3JtSW5wdXQsIGVycm9yKSA9PiB7XHJcbiAgICBjb25zdCBibG9jayA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xyXG4gICAgYmxvY2suY2xhc3NMaXN0LmFkZCgnaW52YWxpZC1mZWVkYmFjaycpO1xyXG4gICAgYmxvY2suaW5uZXJUZXh0ID0gZXJyb3I7XHJcbiAgICBmb3JtSW5wdXQucGFyZW50Tm9kZS5hcHBlbmRDaGlsZChibG9jayk7XHJcbiAgfTtcclxuXHJcbiAgY29uc3Qgc2hvd0Vycm9yc0ZvcklucHV0ID0gKGlucHV0LCBlcnJvcnMpID0+IHtcclxuICAgIHJlc2V0Rm9ybUlucHV0KGlucHV0KTtcclxuICAgIGlmIChlcnJvcnMpIHtcclxuICAgICAgaW5wdXQuY2xhc3NMaXN0LmFkZCgnaXMtaW52YWxpZCcpO1xyXG5cclxuICAgICAgZXJyb3JzLmZvckVhY2goKGVycikgPT4ge1xyXG4gICAgICAgIGFkZEVycm9yKGlucHV0LCBlcnIpO1xyXG4gICAgICB9KTtcclxuICAgIH1cclxuICB9O1xyXG5cclxuICBjb25zdCBzaG93RXJyb3JzID0gKGZvcm0sIGVycm9ycykgPT4ge1xyXG4gICAgZm9ybS5xdWVyeVNlbGVjdG9yQWxsKCdpbnB1dFtuYW1lXSwgc2VsZWN0W25hbWVdJykuZm9yRWFjaCgoaW5wdXQpID0+IHtcclxuICAgICAgc2hvd0Vycm9yc0ZvcklucHV0KGlucHV0LCBlcnJvcnMgJiYgZXJyb3JzW2lucHV0Lm5hbWVdKTtcclxuICAgIH0pO1xyXG4gIH07XHJcblxyXG4gIGNvbnN0IGhhbmRsZUZvcm1TdWJtaXQgPSAoZm9ybSwgaW5wdXQpID0+IHtcclxuICAgIGNvbnN0IGVycm9ycyA9IHZhbGlkYXRlKGZvcm0sIGNvbnN0cmFpbnRzKTtcclxuICAgIGlmICghZXJyb3JzKSB7XHJcbiAgICAgIHJldHVybiB0cnVlO1xyXG4gICAgfVxyXG5cclxuICAgIHNob3dFcnJvcnMoZm9ybSwgZXJyb3JzIHx8IHt9KTtcclxuICAgIHJldHVybiBmYWxzZTtcclxuICB9O1xyXG5cclxuICB1cGRhdGVEb20oKTtcclxuXHJcbiAgZm9yICh2YXIgaSA9IDA7IGkgPCBpbnB1dHMubGVuZ3RoOyArK2kpIHtcclxuICAgIGlucHV0cy5pdGVtKGkpLmFkZEV2ZW50TGlzdGVuZXIoJ2NoYW5nZScsIGZ1bmN0aW9uIChldikge1xyXG4gICAgICBjb25zdCBlcnJvcnMgPSB2YWxpZGF0ZShmb3JtLCBjb25zdHJhaW50cykgfHwge307XHJcblxyXG4gICAgICBzaG93RXJyb3JzRm9ySW5wdXQodGhpcywgZXJyb3JzW3RoaXMubmFtZV0pO1xyXG4gICAgfSk7XHJcbiAgfVxyXG5cclxuICAvLyBhZGQgaXRlbSByb3dcclxuICBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcjYWRkSXRlbScpLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgZnVuY3Rpb24gKGUpIHtcclxuICAgIGUucHJldmVudERlZmF1bHQoKTtcclxuICAgIGNvbnN0IHJvdyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJ1tkYXRhLWl0ZW1dJyk7XHJcbiAgICBjb25zdCBuZXdSb3cgPSByb3cuY2xvbmVOb2RlKHRydWUpO1xyXG4gICAgbmV3Um93LnN0eWxlLmRpc3BsYXkgPSAnZmxleCc7XHJcbiAgICBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCdbZGF0YS1pdGVtc10nKS5hcHBlbmQobmV3Um93KTtcclxuICAgIHVwZGF0ZURvbSgpO1xyXG4gIH0pO1xyXG5cclxuICAvLyBvbiBTdWJtaXRcclxuICBtb2RhbC5hZGRFdmVudExpc3RlbmVyKCdzaG93LmJzLm1vZGFsJywgZnVuY3Rpb24gKGUpIHtcclxuICAgIGlmICghaGFuZGxlRm9ybVN1Ym1pdChmb3JtKSkge1xyXG4gICAgICBlLnByZXZlbnREZWZhdWx0KCk7XHJcbiAgICAgIHRoaXMucXVlcnlTZWxlY3RvcignLm1vZGFsLXRpdGxlJykudGV4dENvbnRlbnQgPSAnJztcclxuICAgICAgdGhpcy5xdWVyeVNlbGVjdG9yKCcubW9kYWwtYm9keScpLnRleHRDb250ZW50ID0gJyc7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICBjb25zdCBkYXRhID0gZm9ybURhdGEoKTtcclxuICAgICAgY29uc3QgbW9kYWxUaXRsZSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5tb2RhbC10aXRsZScpO1xyXG4gICAgICBjb25zdCBtb2RhbEJvZHkgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcubW9kYWwtYm9keScpO1xyXG5cclxuICAgICAgbW9kYWxUaXRsZS5hcHBlbmQoZGF0YS5jb21wYW55ICsgJy3loLHlg7nllq4nKTtcclxuICAgICAgbW9kYWxCb2R5Lmluc2VydEFkamFjZW50SFRNTCgnYmVmb3JlZW5kJywgY3JlYXRlTW9kYWwoZGF0YSkpO1xyXG4gICAgfVxyXG4gIH0pO1xyXG5cclxuICBtb2RhbC5hZGRFdmVudExpc3RlbmVyKCdoaWRkZW4uYnMubW9kYWwnLCBmdW5jdGlvbiAoZSkge1xyXG4gICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xyXG4gICAgdGhpcy5xdWVyeVNlbGVjdG9yKCcubW9kYWwtdGl0bGUnKS50ZXh0Q29udGVudCA9ICcnO1xyXG4gICAgdGhpcy5xdWVyeVNlbGVjdG9yKCcubW9kYWwtYm9keScpLnRleHRDb250ZW50ID0gJyc7XHJcbiAgfSk7XHJcblxyXG4gIC8vIFByaW50XHJcbiAgY29uc3QgcHJpbnRTY3JlZW4gPSAocHJpbnQpID0+IHtcclxuICAgIGNvbnN0IHByaW50QXJlYSA9IHByaW50LmlubmVySFRNTDtcclxuICAgIGNvbnN0IHByaW50UGFnZSA9IHdpbmRvdy5vcGVuKCcnLCAnUHJpbnRpbmcuLi4nLCAnJyk7XHJcbiAgICBwcmludFBhZ2UuZG9jdW1lbnQub3BlbigpO1xyXG4gICAgcHJpbnRQYWdlLmRvY3VtZW50LndyaXRlKFxyXG4gICAgICBgPGh0bWw+XHJcbiAgICAgICAgPGhlYWQ+XHJcbiAgICAgICAgPG1ldGEgY2hhcnNldD1cIlVURi04XCIgLz5cclxuICAgICAgICA8bWV0YSBodHRwLWVxdWl2PVwiWC1VQS1Db21wYXRpYmxlXCIgY29udGVudD1cIklFPWVkZ2VcIiAvPlxyXG4gICAgICAgIDxtZXRhIG5hbWU9XCJ2aWV3cG9ydFwiIGNvbnRlbnQ9XCJ3aWR0aD1kZXZpY2Utd2lkdGgsIGluaXRpYWwtc2NhbGU9MS4wXCIgLz5cclxuICAgICAgICAgIDx0aXRsZT7loLHlg7nllq7nlKLnlJ/lmag8L3RpdGxlPlxyXG4gICAgICAgICAgPGxpbmsgcmVsPVwic3R5bGVzaGVldFwiIGhyZWY9XCJodHRwczovL3VucGtnLmNvbS9AdGFibGVyL2NvcmVAbGF0ZXN0L2Rpc3QvY3NzL3RhYmxlci5taW4uY3NzXCIvPlxyXG4gICAgICAgIDwvaGVhZD5cclxuICAgICAgICA8Ym9keSBvbmxvYWQ9J3dpbmRvdy5wcmludCgpO3dpbmRvdy5jbG9zZSgpJz5gXHJcbiAgICApO1xyXG4gICAgcHJpbnRQYWdlLmRvY3VtZW50LndyaXRlKHByaW50QXJlYSk7XHJcbiAgICBwcmludFBhZ2UuZG9jdW1lbnQuY2xvc2UoJzwvYm9keT48L2h0bWw+Jyk7XHJcbiAgfTtcclxuXHJcbiAgZG9jdW1lbnQucXVlcnlTZWxlY3RvcignI3ByaW50JykuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBmdW5jdGlvbiAoKSB7XHJcbiAgICBjb25zdCBub3cgPSBuZXcgRGF0ZSgpLnRvTG9jYWxlRGF0ZVN0cmluZygpO1xyXG4gICAgY29uc3QgcHJpbnRIdG1sID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLm1vZGFsLWRpYWxvZyAubW9kYWwtY29udGVudCcpO1xyXG5cclxuICAgIGNvbnN0IG5ld1ByaW50SHRtbCA9IHByaW50SHRtbC5jbG9uZU5vZGUodHJ1ZSk7XHJcbiAgICBuZXdQcmludEh0bWwucXVlcnlTZWxlY3RvcignLm1vZGFsLWZvb3RlcicpLnJlbW92ZSgpO1xyXG4gICAgbmV3UHJpbnRIdG1sLmluc2VydEFkamFjZW50SFRNTChcclxuICAgICAgJ2JlZm9yZWVuZCcsXHJcbiAgICAgIGA8cCBzdHlsZT1cInRleHQtYWxpZ246IHJpZ2h0O1wiPuWgseWDueaZgumWk++8miR7bm93fTwvcD5gXHJcbiAgICApO1xyXG5cclxuICAgIHByaW50U2NyZWVuKG5ld1ByaW50SHRtbCk7XHJcbiAgfSk7XHJcbn0pKCk7XHJcbiJdLCJmaWxlIjoibWFpbi5qcyJ9
