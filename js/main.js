"use strict";

(function () {
  var modal = document.querySelector('#modal');
  var form = document.querySelector('form#form');
  var inputs = document.querySelectorAll('input, textarea, select');

  var formData = function formData() {
    var data = {
      company: document.querySelector('[name=company]').value,
      name: document.querySelector('[name=name]').value,
      phone: document.querySelector('[name=phone]').value,
      email: document.querySelector('[name=email]').value,
      description: document.querySelector('[name=description]').value,
      items: []
    };
    document.querySelectorAll('[data-item]').forEach(function (element, index) {
      if (index === 0) {
        return;
      }

      data.items.push({
        category: element.querySelector('[name=category]').value,
        item: element.querySelector('[name=item]').value,
        price: element.querySelector('[name=price]').value,
        number: element.querySelector('[name=number]').value,
        amount: element.querySelector('[name=amount]').value
      });
    }); // const data = {
    //   company: 'JAV',
    //   name: 'Mandy',
    //   phone: '0912345678',
    //   email: '123@123.tw',
    //   description: 'more and more',
    //   items: [
    //     {
    //       category: 'jquery',
    //       item: 'gotop',
    //       price: '500',
    //       number: '1',
    //       amount: '500',
    //     },
    //     {
    //       category: 'jquery',
    //       item: 'light/dark themes',
    //       price: '3000',
    //       number: '1',
    //       amount: '3000',
    //     },
    //     {
    //       category: 'jquery',
    //       item: 'more fold',
    //       price: '1000',
    //       number: '1',
    //       amount: '1000',
    //     },
    //     {
    //       category: 'page',
    //       item: 'list (main)',
    //       price: '3000',
    //       number: '1',
    //       amount: '3000',
    //     },
    //     {
    //       category: 'page',
    //       item: 'list',
    //       price: '1000',
    //       number: '3',
    //       amount: '3000',
    //     },
    //   ],
    // };

    return data;
  };

  var setAmount = function setAmount(element) {
    var price = element.querySelector('[name=price]').value || 0;
    var number = element.querySelector('[name=number]').value || 1;
    element.querySelector('[name=amount]').value = price * number;
  };

  var setTotal = function setTotal() {
    var total = document.querySelectorAll('[name=amount]');
    var getTotal = 0;
    total.forEach(function (e) {
      getTotal += +e.value;
    });
    document.querySelector('#total-price').textContent = getTotal;
  };

  var updateDom = function updateDom() {
    document.querySelectorAll('[data-item]').forEach(function (element, index) {
      element.querySelector('[name=price]').addEventListener('change', function (ev) {
        setAmount(element);
        setTotal();
      });
      element.querySelector('[name=number]').addEventListener('change', function (ev) {
        setAmount(element);
        setTotal();
      });

      if (index > 1) {
        element.querySelector('.delItem').addEventListener('click', function (e) {
          this.parentElement.parentElement.remove();
          setTotal();
        });
      }
    });
  };

  var createItem = function createItem(data) {
    console.log('createItem', data);
    return data.map(function (e) {
      return "\n        <tr>\n          <td class=\"text-left\">".concat(e.category, "</td>\n          <td class=\"text-left\">").concat(e.item, "</td>\n          <td>").concat(e.price, "</td>\n          <td>").concat(e.number, "</td>\n          <td class=\"price\">").concat(e.amount, "</td>\n        </tr> \n      ");
    });
  };

  var createModal = function createModal(data) {
    return "\n      <div class=\"table-responsive\">\n        <table class=\"table table-vcenter\">\n          <tr>\n            <th>\u5831\u50F9\u4EBA\u54E1</th>\n            <td>".concat(data.name, "</td>\n          </tr>\n          <tr>\n            <th>\u806F\u7D61\u96FB\u8A71</th>\n            <td>").concat(data.phone, "</td>\n          </tr>\n          <tr>\n            <th>E-Mail</th>\n            <td>").concat(data.email, "</td>\n          </tr>\n        </table>\n        <table class=\"table table-vcenter\">\n          <thead>\n            <tr>\n              <th>\u985E\u5225</th>\n              <th>\u9805\u76EE</th>\n              <th>\u55AE\u50F9</th>\n              <th>\u6578\u91CF / \u9801</th>\n              <th>\u91D1\u984D</th>\n            </tr>\n          </thead>\n          <tbody>\n            ").concat(createItem(data.items).join(''), "\n          </tbody>\n        </table>\n      </div>\n    ");
  }; // validate form


  var constraints = {
    company: {
      presence: {
        message: '^請輸入業主名稱'
      }
    },
    name: {
      presence: {
        message: '^請輸入報價人員'
      }
    },
    email: {
      presence: {
        message: '^請輸入 E-Mail'
      },
      email: {
        message: '格式錯誤'
      }
    },
    phone: {
      presence: {
        message: '^請輸入聯絡電話'
      },
      format: {
        pattern: '^09[0-9]{8}$',
        message: '^手機格式錯誤'
      }
    }
  };

  var resetFormInput = function resetFormInput(formInput) {
    formInput.classList.remove('is-invalid');
    formInput.parentNode.querySelectorAll('.invalid-feedback').forEach(function (el) {
      el.remove();
    });
  };

  var addError = function addError(formInput, error) {
    var block = document.createElement('div');
    block.classList.add('invalid-feedback');
    block.innerText = error;
    formInput.parentNode.appendChild(block);
  };

  var showErrorsForInput = function showErrorsForInput(input, errors) {
    resetFormInput(input);

    if (errors) {
      input.classList.add('is-invalid');
      errors.forEach(function (err) {
        addError(input, err);
      });
    }
  };

  var showErrors = function showErrors(form, errors) {
    form.querySelectorAll('input[name], select[name]').forEach(function (input) {
      showErrorsForInput(input, errors && errors[input.name]);
    });
  };

  var handleFormSubmit = function handleFormSubmit(form, input) {
    var errors = validate(form, constraints);

    if (!errors) {
      return true;
    }

    showErrors(form, errors || {});
    return false;
  };

  updateDom();

  for (var i = 0; i < inputs.length; ++i) {
    inputs.item(i).addEventListener('change', function (ev) {
      var errors = validate(form, constraints) || {};
      showErrorsForInput(this, errors[this.name]);
    });
  } // add item row


  document.querySelector('#addItem').addEventListener('click', function (e) {
    e.preventDefault();
    var row = document.querySelector('[data-item]');
    var newRow = row.cloneNode(true);
    newRow.style.display = 'flex';
    document.querySelector('[data-items]').append(newRow);
    updateDom();
  }); // on Submit

  modal.addEventListener('show.bs.modal', function (e) {
    if (!handleFormSubmit(form)) {
      e.preventDefault();
      console.log('this', this);
      this.querySelector('.modal-title').textContent = '';
      this.querySelector('.modal-body').textContent = '';
    } else {
      var data = formData();
      var modalTitle = document.querySelector('.modal-title');
      var modalBody = document.querySelector('.modal-body');
      modalTitle.append(data.company);
      modalBody.insertAdjacentHTML('beforeend', createModal(data));
    }
  });
  modal.addEventListener('hidden.bs.modal', function (e) {
    e.preventDefault();
    this.querySelector('.modal-title').textContent = '';
    this.querySelector('.modal-body').textContent = '';
  });
})();
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm1haW4uanMiXSwibmFtZXMiOlsibW9kYWwiLCJkb2N1bWVudCIsInF1ZXJ5U2VsZWN0b3IiLCJmb3JtIiwiaW5wdXRzIiwicXVlcnlTZWxlY3RvckFsbCIsImZvcm1EYXRhIiwiZGF0YSIsImNvbXBhbnkiLCJ2YWx1ZSIsIm5hbWUiLCJwaG9uZSIsImVtYWlsIiwiZGVzY3JpcHRpb24iLCJpdGVtcyIsImZvckVhY2giLCJlbGVtZW50IiwiaW5kZXgiLCJwdXNoIiwiY2F0ZWdvcnkiLCJpdGVtIiwicHJpY2UiLCJudW1iZXIiLCJhbW91bnQiLCJzZXRBbW91bnQiLCJzZXRUb3RhbCIsInRvdGFsIiwiZ2V0VG90YWwiLCJlIiwidGV4dENvbnRlbnQiLCJ1cGRhdGVEb20iLCJhZGRFdmVudExpc3RlbmVyIiwiZXYiLCJwYXJlbnRFbGVtZW50IiwicmVtb3ZlIiwiY3JlYXRlSXRlbSIsImNvbnNvbGUiLCJsb2ciLCJtYXAiLCJjcmVhdGVNb2RhbCIsImpvaW4iLCJjb25zdHJhaW50cyIsInByZXNlbmNlIiwibWVzc2FnZSIsImZvcm1hdCIsInBhdHRlcm4iLCJyZXNldEZvcm1JbnB1dCIsImZvcm1JbnB1dCIsImNsYXNzTGlzdCIsInBhcmVudE5vZGUiLCJlbCIsImFkZEVycm9yIiwiZXJyb3IiLCJibG9jayIsImNyZWF0ZUVsZW1lbnQiLCJhZGQiLCJpbm5lclRleHQiLCJhcHBlbmRDaGlsZCIsInNob3dFcnJvcnNGb3JJbnB1dCIsImlucHV0IiwiZXJyb3JzIiwiZXJyIiwic2hvd0Vycm9ycyIsImhhbmRsZUZvcm1TdWJtaXQiLCJ2YWxpZGF0ZSIsImkiLCJsZW5ndGgiLCJwcmV2ZW50RGVmYXVsdCIsInJvdyIsIm5ld1JvdyIsImNsb25lTm9kZSIsInN0eWxlIiwiZGlzcGxheSIsImFwcGVuZCIsIm1vZGFsVGl0bGUiLCJtb2RhbEJvZHkiLCJpbnNlcnRBZGphY2VudEhUTUwiXSwibWFwcGluZ3MiOiI7O0FBQUEsQ0FBQyxZQUFZO0FBQ1gsTUFBTUEsS0FB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RDtBQUNGLEdBZEQ7QUFnQkFQLEVBQUFBLEtBQUssQ0FBQytCLGdCQUFOLENBQXVCLGlCQUF2QixFQUEwQyxVQUFVSCxDQUFWLEVBQWE7QUFDckRBLElBQUFBLENBQUMsQ0FBQ3VDLGNBQUY7QUFDQSxTQUFLakUsYUFBTCxDQUFtQixjQUFuQixFQUFtQzJCLFdBQW5DLEdBQWlELEVBQWpEO0FBQ0EsU0FBSzNCLGFBQUwsQ0FBbUIsYUFBbkIsRUFBa0MyQixXQUFsQyxHQUFnRCxFQUFoRDtBQUNELEdBSkQ7QUFNRCxDQXRSRCIsInNvdXJjZXNDb250ZW50IjpbIihmdW5jdGlvbiAoKSB7XHJcbiAgY29uc3QgbW9kYWwgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcjbW9kYWwnKTtcclxuICBjb25zdCBmb3JtID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignZm9ybSNmb3JtJyk7XHJcbiAgY29uc3QgaW5wdXRzID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnaW5wdXQsIHRleHRhcmVhLCBzZWxlY3QnKTtcclxuICBjb25zdCBmb3JtRGF0YSA9IGZ1bmN0aW9uICgpIHtcclxuICAgIGNvbnN0IGRhdGEgPSB7XHJcbiAgICAgIGNvbXBhbnk6IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJ1tuYW1lPWNvbXBhbnldJykudmFsdWUsXHJcbiAgICAgIG5hbWU6IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJ1tuYW1lPW5hbWVdJykudmFsdWUsXHJcbiAgICAgIHBob25lOiBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCdbbmFtZT1waG9uZV0nKS52YWx1ZSxcclxuICAgICAgZW1haWw6IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJ1tuYW1lPWVtYWlsXScpLnZhbHVlLFxyXG4gICAgICBkZXNjcmlwdGlvbjogZG9jdW1lbnQucXVlcnlTZWxlY3RvcignW25hbWU9ZGVzY3JpcHRpb25dJykudmFsdWUsXHJcbiAgICAgIGl0ZW1zOiBbXSxcclxuICAgIH07XHJcblxyXG4gICAgZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnW2RhdGEtaXRlbV0nKS5mb3JFYWNoKChlbGVtZW50LCBpbmRleCkgPT4ge1xyXG4gICAgICBpZiAoaW5kZXggPT09IDApIHtcclxuICAgICAgICByZXR1cm47XHJcbiAgICAgIH1cclxuICAgICAgZGF0YS5pdGVtcy5wdXNoKHtcclxuICAgICAgICBjYXRlZ29yeTogZWxlbWVudC5xdWVyeVNlbGVjdG9yKCdbbmFtZT1jYXRlZ29yeV0nKS52YWx1ZSxcclxuICAgICAgICBpdGVtOiBlbGVtZW50LnF1ZXJ5U2VsZWN0b3IoJ1tuYW1lPWl0ZW1dJykudmFsdWUsXHJcbiAgICAgICAgcHJpY2U6IGVsZW1lbnQucXVlcnlTZWxlY3RvcignW25hbWU9cHJpY2VdJykudmFsdWUsXHJcbiAgICAgICAgbnVtYmVyOiBlbGVtZW50LnF1ZXJ5U2VsZWN0b3IoJ1tuYW1lPW51bWJlcl0nKS52YWx1ZSxcclxuICAgICAgICBhbW91bnQ6IGVsZW1lbnQucXVlcnlTZWxlY3RvcignW25hbWU9YW1vdW50XScpLnZhbHVlLFxyXG4gICAgICB9KTtcclxuICAgIH0pO1xyXG5cclxuICAgIC8vIGNvbnN0IGRhdGEgPSB7XHJcbiAgICAvLyAgIGNvbXBhbnk6ICdKQVYnLFxyXG4gICAgLy8gICBuYW1lOiAnTWFuZHknLFxyXG4gICAgLy8gICBwaG9uZTogJzA5MTIzNDU2NzgnLFxyXG4gICAgLy8gICBlbWFpbDogJzEyM0AxMjMudHcnLFxyXG4gICAgLy8gICBkZXNjcmlwdGlvbjogJ21vcmUgYW5kIG1vcmUnLFxyXG4gICAgLy8gICBpdGVtczogW1xyXG4gICAgLy8gICAgIHtcclxuICAgIC8vICAgICAgIGNhdGVnb3J5OiAnanF1ZXJ5JyxcclxuICAgIC8vICAgICAgIGl0ZW06ICdnb3RvcCcsXHJcbiAgICAvLyAgICAgICBwcmljZTogJzUwMCcsXHJcbiAgICAvLyAgICAgICBudW1iZXI6ICcxJyxcclxuICAgIC8vICAgICAgIGFtb3VudDogJzUwMCcsXHJcbiAgICAvLyAgICAgfSxcclxuICAgIC8vICAgICB7XHJcbiAgICAvLyAgICAgICBjYXRlZ29yeTogJ2pxdWVyeScsXHJcbiAgICAvLyAgICAgICBpdGVtOiAnbGlnaHQvZGFyayB0aGVtZXMnLFxyXG4gICAgLy8gICAgICAgcHJpY2U6ICczMDAwJyxcclxuICAgIC8vICAgICAgIG51bWJlcjogJzEnLFxyXG4gICAgLy8gICAgICAgYW1vdW50OiAnMzAwMCcsXHJcbiAgICAvLyAgICAgfSxcclxuICAgIC8vICAgICB7XHJcbiAgICAvLyAgICAgICBjYXRlZ29yeTogJ2pxdWVyeScsXHJcbiAgICAvLyAgICAgICBpdGVtOiAnbW9yZSBmb2xkJyxcclxuICAgIC8vICAgICAgIHByaWNlOiAnMTAwMCcsXHJcbiAgICAvLyAgICAgICBudW1iZXI6ICcxJyxcclxuICAgIC8vICAgICAgIGFtb3VudDogJzEwMDAnLFxyXG4gICAgLy8gICAgIH0sXHJcbiAgICAvLyAgICAge1xyXG4gICAgLy8gICAgICAgY2F0ZWdvcnk6ICdwYWdlJyxcclxuICAgIC8vICAgICAgIGl0ZW06ICdsaXN0IChtYWluKScsXHJcbiAgICAvLyAgICAgICBwcmljZTogJzMwMDAnLFxyXG4gICAgLy8gICAgICAgbnVtYmVyOiAnMScsXHJcbiAgICAvLyAgICAgICBhbW91bnQ6ICczMDAwJyxcclxuICAgIC8vICAgICB9LFxyXG4gICAgLy8gICAgIHtcclxuICAgIC8vICAgICAgIGNhdGVnb3J5OiAncGFnZScsXHJcbiAgICAvLyAgICAgICBpdGVtOiAnbGlzdCcsXHJcbiAgICAvLyAgICAgICBwcmljZTogJzEwMDAnLFxyXG4gICAgLy8gICAgICAgbnVtYmVyOiAnMycsXHJcbiAgICAvLyAgICAgICBhbW91bnQ6ICczMDAwJyxcclxuICAgIC8vICAgICB9LFxyXG4gICAgLy8gICBdLFxyXG4gICAgLy8gfTtcclxuXHJcbiAgICByZXR1cm4gZGF0YTtcclxuICB9O1xyXG4gIGNvbnN0IHNldEFtb3VudCA9IChlbGVtZW50KSA9PiB7XHJcbiAgICBjb25zdCBwcmljZSA9IGVsZW1lbnQucXVlcnlTZWxlY3RvcignW25hbWU9cHJpY2VdJykudmFsdWUgfHwgMDtcclxuICAgIGNvbnN0IG51bWJlciA9IGVsZW1lbnQucXVlcnlTZWxlY3RvcignW25hbWU9bnVtYmVyXScpLnZhbHVlIHx8IDE7XHJcbiAgICBlbGVtZW50LnF1ZXJ5U2VsZWN0b3IoJ1tuYW1lPWFtb3VudF0nKS52YWx1ZSA9IHByaWNlICogbnVtYmVyO1xyXG4gIH07XHJcbiAgY29uc3Qgc2V0VG90YWwgPSAoKSA9PiB7XHJcbiAgICBjb25zdCB0b3RhbCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJ1tuYW1lPWFtb3VudF0nKTtcclxuICAgIGxldCBnZXRUb3RhbCA9IDA7XHJcbiAgICB0b3RhbC5mb3JFYWNoKChlKSA9PiB7XHJcbiAgICAgIGdldFRvdGFsICs9ICtlLnZhbHVlO1xyXG4gICAgfSk7XHJcbiAgICBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcjdG90YWwtcHJpY2UnKS50ZXh0Q29udGVudCA9IGdldFRvdGFsO1xyXG4gIH07XHJcbiAgY29uc3QgdXBkYXRlRG9tID0gKCkgPT4ge1xyXG4gICAgZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnW2RhdGEtaXRlbV0nKS5mb3JFYWNoKChlbGVtZW50LCBpbmRleCkgPT4ge1xyXG4gICAgICBlbGVtZW50LnF1ZXJ5U2VsZWN0b3IoJ1tuYW1lPXByaWNlXScpLmFkZEV2ZW50TGlzdGVuZXIoJ2NoYW5nZScsIChldikgPT4ge1xyXG4gICAgICAgIHNldEFtb3VudChlbGVtZW50KTtcclxuICAgICAgICBzZXRUb3RhbCgpO1xyXG4gICAgICB9KTtcclxuXHJcbiAgICAgIGVsZW1lbnRcclxuICAgICAgICAucXVlcnlTZWxlY3RvcignW25hbWU9bnVtYmVyXScpXHJcbiAgICAgICAgLmFkZEV2ZW50TGlzdGVuZXIoJ2NoYW5nZScsIChldikgPT4ge1xyXG4gICAgICAgICAgc2V0QW1vdW50KGVsZW1lbnQpO1xyXG4gICAgICAgICAgc2V0VG90YWwoKTtcclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgIGlmIChpbmRleCA+IDEpIHtcclxuICAgICAgICBlbGVtZW50XHJcbiAgICAgICAgICAucXVlcnlTZWxlY3RvcignLmRlbEl0ZW0nKVxyXG4gICAgICAgICAgLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgZnVuY3Rpb24gKGUpIHtcclxuICAgICAgICAgICAgdGhpcy5wYXJlbnRFbGVtZW50LnBhcmVudEVsZW1lbnQucmVtb3ZlKCk7XHJcbiAgICAgICAgICAgIHNldFRvdGFsKCk7XHJcbiAgICAgICAgICB9KTtcclxuICAgICAgfVxyXG4gICAgfSk7XHJcbiAgfTtcclxuXHJcbiAgY29uc3QgY3JlYXRlSXRlbSA9IChkYXRhKSA9PiB7XHJcbiAgICBjb25zb2xlLmxvZygnY3JlYXRlSXRlbScsIGRhdGEpO1xyXG5cclxuICAgIHJldHVybiBkYXRhLm1hcChcclxuICAgICAgKGUpID0+XHJcbiAgICAgICAgYFxyXG4gICAgICAgIDx0cj5cclxuICAgICAgICAgIDx0ZCBjbGFzcz1cInRleHQtbGVmdFwiPiR7ZS5jYXRlZ29yeX08L3RkPlxyXG4gICAgICAgICAgPHRkIGNsYXNzPVwidGV4dC1sZWZ0XCI+JHtlLml0ZW19PC90ZD5cclxuICAgICAgICAgIDx0ZD4ke2UucHJpY2V9PC90ZD5cclxuICAgICAgICAgIDx0ZD4ke2UubnVtYmVyfTwvdGQ+XHJcbiAgICAgICAgICA8dGQgY2xhc3M9XCJwcmljZVwiPiR7ZS5hbW91bnR9PC90ZD5cclxuICAgICAgICA8L3RyPiBcclxuICAgICAgYFxyXG4gICAgKTtcclxuICB9O1xyXG4gIGNvbnN0IGNyZWF0ZU1vZGFsID0gKGRhdGEpID0+IHtcclxuICAgIHJldHVybiBgXHJcbiAgICAgIDxkaXYgY2xhc3M9XCJ0YWJsZS1yZXNwb25zaXZlXCI+XHJcbiAgICAgICAgPHRhYmxlIGNsYXNzPVwidGFibGUgdGFibGUtdmNlbnRlclwiPlxyXG4gICAgICAgICAgPHRyPlxyXG4gICAgICAgICAgICA8dGg+5aCx5YO55Lq65ZOhPC90aD5cclxuICAgICAgICAgICAgPHRkPiR7ZGF0YS5uYW1lfTwvdGQ+XHJcbiAgICAgICAgICA8L3RyPlxyXG4gICAgICAgICAgPHRyPlxyXG4gICAgICAgICAgICA8dGg+6IGv57Wh6Zu76KmxPC90aD5cclxuICAgICAgICAgICAgPHRkPiR7ZGF0YS5waG9uZX08L3RkPlxyXG4gICAgICAgICAgPC90cj5cclxuICAgICAgICAgIDx0cj5cclxuICAgICAgICAgICAgPHRoPkUtTWFpbDwvdGg+XHJcbiAgICAgICAgICAgIDx0ZD4ke2RhdGEuZW1haWx9PC90ZD5cclxuICAgICAgICAgIDwvdHI+XHJcbiAgICAgICAgPC90YWJsZT5cclxuICAgICAgICA8dGFibGUgY2xhc3M9XCJ0YWJsZSB0YWJsZS12Y2VudGVyXCI+XHJcbiAgICAgICAgICA8dGhlYWQ+XHJcbiAgICAgICAgICAgIDx0cj5cclxuICAgICAgICAgICAgICA8dGg+6aGe5YilPC90aD5cclxuICAgICAgICAgICAgICA8dGg+6aCF55uuPC90aD5cclxuICAgICAgICAgICAgICA8dGg+5Zau5YO5PC90aD5cclxuICAgICAgICAgICAgICA8dGg+5pW46YePIC8g6aCBPC90aD5cclxuICAgICAgICAgICAgICA8dGg+6YeR6aGNPC90aD5cclxuICAgICAgICAgICAgPC90cj5cclxuICAgICAgICAgIDwvdGhlYWQ+XHJcbiAgICAgICAgICA8dGJvZHk+XHJcbiAgICAgICAgICAgICR7Y3JlYXRlSXRlbShkYXRhLml0ZW1zKS5qb2luKCcnKX1cclxuICAgICAgICAgIDwvdGJvZHk+XHJcbiAgICAgICAgPC90YWJsZT5cclxuICAgICAgPC9kaXY+XHJcbiAgICBgO1xyXG4gIH07XHJcblxyXG4gIC8vIHZhbGlkYXRlIGZvcm1cclxuICBjb25zdCBjb25zdHJhaW50cyA9IHtcclxuICAgIGNvbXBhbnk6IHtcclxuICAgICAgcHJlc2VuY2U6IHtcclxuICAgICAgICBtZXNzYWdlOiAnXuiri+i8uOWFpealreS4u+WQjeeosScsXHJcbiAgICAgIH0sXHJcbiAgICB9LFxyXG4gICAgbmFtZToge1xyXG4gICAgICBwcmVzZW5jZToge1xyXG4gICAgICAgIG1lc3NhZ2U6ICde6KuL6Ly45YWl5aCx5YO55Lq65ZOhJyxcclxuICAgICAgfSxcclxuICAgIH0sXHJcbiAgICBlbWFpbDoge1xyXG4gICAgICBwcmVzZW5jZToge1xyXG4gICAgICAgIG1lc3NhZ2U6ICde6KuL6Ly45YWlIEUtTWFpbCcsXHJcbiAgICAgIH0sXHJcbiAgICAgIGVtYWlsOiB7XHJcbiAgICAgICAgbWVzc2FnZTogJ+agvOW8j+mMr+iqpCcsXHJcbiAgICAgIH0sXHJcbiAgICB9LFxyXG4gICAgcGhvbmU6IHtcclxuICAgICAgcHJlc2VuY2U6IHtcclxuICAgICAgICBtZXNzYWdlOiAnXuiri+i8uOWFpeiBr+e1oembu+ipsScsXHJcbiAgICAgIH0sXHJcbiAgICAgIGZvcm1hdDoge1xyXG4gICAgICAgIHBhdHRlcm46ICdeMDlbMC05XXs4fSQnLFxyXG4gICAgICAgIG1lc3NhZ2U6ICde5omL5qmf5qC85byP6Yyv6KqkJyxcclxuICAgICAgfSxcclxuICAgIH0sXHJcbiAgfTtcclxuXHJcbiAgY29uc3QgcmVzZXRGb3JtSW5wdXQgPSAoZm9ybUlucHV0KSA9PiB7XHJcbiAgICBmb3JtSW5wdXQuY2xhc3NMaXN0LnJlbW92ZSgnaXMtaW52YWxpZCcpO1xyXG4gICAgZm9ybUlucHV0LnBhcmVudE5vZGUucXVlcnlTZWxlY3RvckFsbCgnLmludmFsaWQtZmVlZGJhY2snKS5mb3JFYWNoKChlbCkgPT4ge1xyXG4gICAgICBlbC5yZW1vdmUoKTtcclxuICAgIH0pO1xyXG4gIH07XHJcblxyXG4gIGNvbnN0IGFkZEVycm9yID0gKGZvcm1JbnB1dCwgZXJyb3IpID0+IHtcclxuICAgIGNvbnN0IGJsb2NrID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7XHJcbiAgICBibG9jay5jbGFzc0xpc3QuYWRkKCdpbnZhbGlkLWZlZWRiYWNrJyk7XHJcbiAgICBibG9jay5pbm5lclRleHQgPSBlcnJvcjtcclxuICAgIGZvcm1JbnB1dC5wYXJlbnROb2RlLmFwcGVuZENoaWxkKGJsb2NrKTtcclxuICB9O1xyXG5cclxuICBjb25zdCBzaG93RXJyb3JzRm9ySW5wdXQgPSAoaW5wdXQsIGVycm9ycykgPT4ge1xyXG4gICAgcmVzZXRGb3JtSW5wdXQoaW5wdXQpO1xyXG4gICAgaWYgKGVycm9ycykge1xyXG4gICAgICBpbnB1dC5jbGFzc0xpc3QuYWRkKCdpcy1pbnZhbGlkJyk7XHJcblxyXG4gICAgICBlcnJvcnMuZm9yRWFjaCgoZXJyKSA9PiB7XHJcbiAgICAgICAgYWRkRXJyb3IoaW5wdXQsIGVycik7XHJcbiAgICAgIH0pO1xyXG4gICAgfVxyXG4gIH07XHJcblxyXG4gIGNvbnN0IHNob3dFcnJvcnMgPSAoZm9ybSwgZXJyb3JzKSA9PiB7XHJcbiAgICBmb3JtLnF1ZXJ5U2VsZWN0b3JBbGwoJ2lucHV0W25hbWVdLCBzZWxlY3RbbmFtZV0nKS5mb3JFYWNoKChpbnB1dCkgPT4ge1xyXG4gICAgICBzaG93RXJyb3JzRm9ySW5wdXQoaW5wdXQsIGVycm9ycyAmJiBlcnJvcnNbaW5wdXQubmFtZV0pO1xyXG4gICAgfSk7XHJcbiAgfTtcclxuXHJcbiAgY29uc3QgaGFuZGxlRm9ybVN1Ym1pdCA9IChmb3JtLCBpbnB1dCkgPT4ge1xyXG4gICAgY29uc3QgZXJyb3JzID0gdmFsaWRhdGUoZm9ybSwgY29uc3RyYWludHMpO1xyXG4gICAgaWYgKCFlcnJvcnMpIHtcclxuICAgICAgcmV0dXJuIHRydWU7XHJcbiAgICB9XHJcblxyXG4gICAgc2hvd0Vycm9ycyhmb3JtLCBlcnJvcnMgfHwge30pO1xyXG4gICAgcmV0dXJuIGZhbHNlO1xyXG4gIH07XHJcblxyXG4gIHVwZGF0ZURvbSgpO1xyXG5cclxuICBmb3IgKHZhciBpID0gMDsgaSA8IGlucHV0cy5sZW5ndGg7ICsraSkge1xyXG4gICAgaW5wdXRzLml0ZW0oaSkuYWRkRXZlbnRMaXN0ZW5lcignY2hhbmdlJywgZnVuY3Rpb24gKGV2KSB7XHJcbiAgICAgIGNvbnN0IGVycm9ycyA9IHZhbGlkYXRlKGZvcm0sIGNvbnN0cmFpbnRzKSB8fCB7fTtcclxuXHJcbiAgICAgIHNob3dFcnJvcnNGb3JJbnB1dCh0aGlzLCBlcnJvcnNbdGhpcy5uYW1lXSk7XHJcbiAgICB9KTtcclxuICB9XHJcblxyXG4gIC8vIGFkZCBpdGVtIHJvd1xyXG4gIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJyNhZGRJdGVtJykuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBmdW5jdGlvbiAoZSkge1xyXG4gICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xyXG4gICAgY29uc3Qgcm93ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignW2RhdGEtaXRlbV0nKTtcclxuICAgIGNvbnN0IG5ld1JvdyA9IHJvdy5jbG9uZU5vZGUodHJ1ZSk7XHJcbiAgICBuZXdSb3cuc3R5bGUuZGlzcGxheSA9ICdmbGV4JztcclxuICAgIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJ1tkYXRhLWl0ZW1zXScpLmFwcGVuZChuZXdSb3cpO1xyXG4gICAgdXBkYXRlRG9tKCk7XHJcbiAgfSk7XHJcblxyXG4gIC8vIG9uIFN1Ym1pdFxyXG4gIG1vZGFsLmFkZEV2ZW50TGlzdGVuZXIoJ3Nob3cuYnMubW9kYWwnLCBmdW5jdGlvbiAoZSkge1xyXG4gICAgaWYgKCFoYW5kbGVGb3JtU3VibWl0KGZvcm0pKSB7XHJcbiAgICAgIGUucHJldmVudERlZmF1bHQoKTtcclxuICAgICAgY29uc29sZS5sb2coJ3RoaXMnLCB0aGlzKTtcclxuICAgICAgdGhpcy5xdWVyeVNlbGVjdG9yKCcubW9kYWwtdGl0bGUnKS50ZXh0Q29udGVudCA9ICcnO1xyXG4gICAgICB0aGlzLnF1ZXJ5U2VsZWN0b3IoJy5tb2RhbC1ib2R5JykudGV4dENvbnRlbnQgPSAnJztcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIGNvbnN0IGRhdGEgPSBmb3JtRGF0YSgpO1xyXG4gICAgICBjb25zdCBtb2RhbFRpdGxlID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLm1vZGFsLXRpdGxlJyk7XHJcbiAgICAgIGNvbnN0IG1vZGFsQm9keSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5tb2RhbC1ib2R5Jyk7XHJcblxyXG4gICAgICBtb2RhbFRpdGxlLmFwcGVuZChkYXRhLmNvbXBhbnkpO1xyXG4gICAgICBtb2RhbEJvZHkuaW5zZXJ0QWRqYWNlbnRIVE1MKCdiZWZvcmVlbmQnLCBjcmVhdGVNb2RhbChkYXRhKSk7XHJcbiAgICB9XHJcbiAgfSk7XHJcblxyXG4gIG1vZGFsLmFkZEV2ZW50TGlzdGVuZXIoJ2hpZGRlbi5icy5tb2RhbCcsIGZ1bmN0aW9uIChlKSB7XHJcbiAgICBlLnByZXZlbnREZWZhdWx0KCk7XHJcbiAgICB0aGlzLnF1ZXJ5U2VsZWN0b3IoJy5tb2RhbC10aXRsZScpLnRleHRDb250ZW50ID0gJyc7XHJcbiAgICB0aGlzLnF1ZXJ5U2VsZWN0b3IoJy5tb2RhbC1ib2R5JykudGV4dENvbnRlbnQgPSAnJztcclxuICB9KTtcclxuXHJcbn0pKCk7XHJcbiJdLCJmaWxlIjoibWFpbi5qcyJ9
